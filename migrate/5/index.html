<!DOCTYPE html><html lang="zh-cmn-Hans"><head><title data-rh="true">从 v4 升级到 v5 | webpack 中文文档</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="theme-color" content="#2B3A42"/><meta data-rh="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-rh="true" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:site_name" content="webpack"/><meta data-rh="true" property="og:type" content="website"/><meta data-rh="true" property="og:title" content="从 v4 升级到 v5 | webpack 中文文档"/><meta data-rh="true" property="og:description" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:image" content="https://webpack.js.org/icon-pwa-512x512.d3dae4189855b3a72ff9.png"/><meta data-rh="true" property="twitter:card" content="summary"/><meta data-rh="true" property="twitter:site" content="@webpack"/><meta data-rh="true" property="twitter:creator" content="@webpack"/><meta data-rh="true" property="twitter:domain" content="https://webpack.js.org/"/><meta data-rh="true" name="keywords" content="webpack5, webpack, webpack 中文文档, webpack 官方中文, webpack 5 官方中文, 印记中文, docschina, docschina.org, webpack.docschina.org, doc.react-china.org, nodejs.cn, vue.docschina.org, babel.docschina.org, parceljs.docschina.org, rollup.docschina.org, koajs.docschina.org"/><meta data-rh="true" name="mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-status-bar-style" content="black"/><meta data-rh="true" name="apple-mobile-web-app-title" content="webpack"/><meta data-rh="true" name="msapplication-TileImage" content="/icon_150x150.png"/><meta data-rh="true" name="msapplication-TileColor" content="#465e69"/><link data-rh="true" rel="icon" type="image/x-icon" href="/favicon.f326220248556af65f41.ico"/><link data-rh="true" rel="manifest" href="/manifest.json"/><link data-rh="true" rel="canonical" href="https://webpack.docschina.org/migrate/5/"/><link data-rh="true" rel="icon" sizes="192x192" href="/icon_192x192.png"/><link data-rh="true" rel="icon" sizes="512x512" href="/icon_512x512.png"/><link data-rh="true" rel="apple-touch-icon" href="/icon_180x180.png"/><link data-rh="true" rel="mask-icon" href="/logo-on-white-bg.47eff95f9c01c5972f6f.svg" color="#465e69"/><link rel="stylesheet" href=/index.c114afea0778b47a418a.css /><link rel="stylesheet" href=/9517.acfe42251eae743e4e22.css /></head><body><div id="root"><div class="site"><div class="site__header"><header class="bg-blue-800 dark:bg-gray-900"><div class="flex items-center py-10 px-[16px] justify-between md:px-[24px] md:max-w-[1024px] md:mx-auto md:justify-start"><button class="bg-transparent border-none md:hidden"><svg viewBox="-62 138 25 25" width="20" height="20" class="fill-current text-white"><path fill="currentColor" d="M-60.2 140.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8zM-60.2 148.7h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8zM-60.2 157.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8z"></path></svg></button><a class="md:mr-auto" href="/"><img class="logo" src="/site-logo.1fcab817090e78435061.svg" alt="webpack logo" width="122" height="35"/></a><nav class="hidden md:inline-grid md:grid-flow-col md:gap-x-[18px]"><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/concepts/">中文文档</a><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/contribute/">参与贡献</a><a href="https://webpack.js.org/vote/" target="_blank" rel="noopener noreferrer" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200">投票</a><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/blog/">博客</a><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200">印记中文</a><a href="https://github.com/webpack/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on GitHub"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 6.8 9.5c.5 0 .7-.2.7-.5v-1.7C6.7 20 6.1 18 6.1 18c-.4-1.2-1-1.5-1-1.5-1-.6 0-.6 0-.6 1 0 1.5 1 1.5 1 .9 1.6 2.4 1.1 3 .9 0-.7.3-1.1.6-1.4-2.2-.2-4.6-1-4.6-4.9 0-1.1.4-2 1-2.7 0-.3-.4-1.3.2-2.7 0 0 .8-.2 2.7 1a9.4 9.4 0 0 1 5 0c2-1.2 2.8-1 2.8-1 .5 1.4.1 2.4 0 2.7.7.7 1 1.6 1 2.7 0 3.8-2.3 4.7-4.5 5 .4.2.7.8.7 1.8V21c0 .3.2.6.7.5 4-1.3 6.8-5 6.8-9.5A10 10 0 0 0 12 2z"></path></svg></a><a href="https://twitter.com/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on Twitter"><svg viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" width="16"><path d="M28 6.937c-.957.425-1.985.711-3.064.84a5.343 5.343 0 0 0 2.345-2.951 10.696 10.696 0 0 1-3.388 1.295 5.334 5.334 0 0 0-9.089 4.864A15.143 15.143 0 0 1 3.809 5.411a5.321 5.321 0 0 0-.721 2.683 5.33 5.33 0 0 0 2.372 4.439 5.323 5.323 0 0 1-2.416-.667v.067a5.335 5.335 0 0 0 4.279 5.23 5.336 5.336 0 0 1-2.409.092 5.34 5.34 0 0 0 4.983 3.705 10.699 10.699 0 0 1-6.625 2.284c-.43 0-.855-.025-1.273-.075a15.102 15.102 0 0 0 8.177 2.396c9.812 0 15.176-8.128 15.176-15.177 0-.231-.005-.461-.015-.69A10.855 10.855 0 0 0 28 6.937z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on StackOverflow"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M17.4 20.2v-5.4h1.8V22H3v-7.2h1.8v5.4zM6.8 14.3l.3-1.7 8.8 1.8-.3 1.8zm1.1-4.2.8-1.6 8.1 3.8-.7 1.6zm2.3-4 1.1-1.4 7 5.8-1.2 1.4L10 6m4.7-4L20 9l-1.4 1-5.4-7 1.4-1m-8 16.5v-1.8h9v1.8z"></path></svg></a><nav class="dropdown "><button aria-haspopup="true" aria-expanded="false" aria-label="Select language"><svg viewBox="0 0 610 560" xmlns="http://www.w3.org/2000/svg" class="dropdown__language text-gray-100 hover:text-blue-200 transition-colors duration-200"><path d="m304.8 99.2-162.5-57.3v353.6l162.5-52.6z"></path><path d="m300.9 99 168.7-57.3v353.6l-168.7-52.5zm-200.7 358.4 200.7-66.9v-291.5l-200.7 66.9z" fill="currentColor"></path><path d="m392.4 461.8 28.4 46.8 15-43.5zm-223.9-262.3c-1.1-1 1.4 8.6 4.8 12 6.1 6.1 10.8 6.9 13.3 7 5.6.2 12.5-1.4 16.5-3.1s10.9-5.2 13.5-10.4c.6-1.1 2.1-3 1.1-7.5-.7-3.5-3-4.8-5.7-4.6s-11 2.4-15 3.6-12.2 3.7-15.8 4.5-11.5-.3-12.7-1.5zm101.2 114.8c-1.6-.6-34.3-14.1-38.9-16.4a368 368 0 0 0 -17.5-7.5c12.3-19 20.1-33.4 21.2-35.6 1.9-4 15-29.5 15.3-31.1s.7-7.5.4-8.9-5.1 1.3-11.6 3.5-18.9 10.2-23.7 11.2-20.1 6.8-28 9.4c-7.8 2.6-22.7 7.1-28.8 8.8-6.1 1.6-11.4 1.8-14.9 2.8 0 0 .5 4.8 1.4 6.2s4.1 5 7.9 5.9c3.8 1 10 .6 12.8-.1s7.7-3.1 8.4-4.1c.7-1.1-.3-4.3.8-5.3s16.1-4.5 21.7-6.2 27.2-9.2 30.1-8.8a916 916 0 0 1 -23.9 47.7 821 821 0 0 1 -45 63.3c-5.3 6-18 21.5-22.4 25 1.1.3 9-.4 10.4-1.3 8.9-5.5 23.8-24.1 28.6-29.7a489.1 489.1 0 0 0 36.7-49.4c1.9.8 17.6 13.6 21.7 16.4a293 293 0 0 0 23.7 13.3c3.5 1.5 16.9 7.7 17.5 5.6.7-1.8-2.3-14.1-3.9-14.7z"></path><path clip-rule="evenodd" d="m194.1 484.7a204.9 204.9 0 0 0 30.7 14.5 233.6 233.6 0 0 0 46.4 12c.5 0 16 1.9 19.2 1.9h15.7c6.1-.5 11.8-.9 17.9-1.7 4.9-.7 10.3-1.6 15.5-2.8 3.8-.9 7.8-1.7 11.7-3 3.7-1 7.8-2.4 11.8-3.8l8.2-3.1c2.3-1 5.1-2.3 7.7-3.3a243 243 0 0 0 19.2-10c2.3-1.2 7.5-5.2 10.3-5.2 3.1 0 5.2 2.8 5.2 5.2 0 5.1-6.8 6.6-9.9 8.9-3.3 2.3-7.3 4-10.8 5.9-7 3.7-14.1 6.8-20.9 9.4a251 251 0 0 1 -27.3 8.5c-3.3.7-6.6 1.6-9.9 2.1-1.7.3-19.9 3.1-24.9 3.1h-23a293.9 293.9 0 0 1 -35.1-5.2 196 196 0 0 1 -33.1-10.3c-12-4.5-24.6-10.5-36.4-18.3-2.1-1.4-2.3-2.8-2.3-4.4a5 5 0 0 1 5.1-5.1c2.4.1 8 4.2 9 4.7zm101.4-98.1-189.9 63.2v-280.1l189.9-63.2zm10.6-288.3v292.7a6 6 0 0 1 -1.2 2.6c-.3.5-1 1.2-1.6 1.4a14621 14621 0 0 1 -203.1 67.6c-2.1 0-4-1.4-5.1-3.7 0-.2-.2-.3-.2-.7v-292.8c.3-.9.5-2.1 1.2-2.8 1.4-1.9 3.8-2.3 5.4-2.8 3-1 196.1-65.8 198.9-65.8 1.9 0 5.7 1.2 5.7 4.3z" fill-rule="evenodd"></path><path clip-rule="evenodd" d="m464.3 388-158-49.1v-236l158-53.7zm10.6-345.8v352.4c-.2 4-3 5.7-5.6 5.7-2.3 0-18.6-5.6-21.4-6.4l-65.8-20.4-14.6-4.7-12.9-4c-18.6-5.7-37.6-11.5-56.3-17.8-.7-.2-2.4-2.6-2.4-3.1v-246.1c.3-.9.7-1.9 1.6-2.6 1.4-1.6 61.1-21.4 84.7-29.3 6.3-2.3 84.8-29.3 87.3-29.3 3 .1 5.4 2.3 5.4 5.6z" fill-rule="evenodd"></path><path d="m515 461.8-211.1-67.3.9-292.8 210.2 66.9z"></path><path clip-rule="evenodd" d="m408.6 232.5-20.7 50.1 38.1 11.5zm-12.4-47.2 27.2 8.2 49.5 178.6-27.9-8.5-10-36.7-57.7-17.5-12.4 29.9-27.9-8.5z" fill="currentColor" fill-rule="evenodd"></path></svg><i aria-hidden="true" class="dropdown__arrow"></i></button><div class="dropdown__list "><ul><li><a href="https://webpack.js.org/migrate/5/" class="px-5 block"><span>English</span></a></li><li><a href="https://webpack.docschina.org/migrate/5/" class="px-5 block"><span lang="zh">中文</span></a></li><li><a href="https://webpack.kr/migrate/5/" class="px-5 block"><span lang="ko">한국어</span></a></li></ul></div></nav></nav><div class="inline-flex items-center ml-[18px]"><button aria-label="Switch to dark theme" class="bg-transparent border-none cursor-pointer text-[16px] p-0 inline-flex items-center text-gray-100 hover:text-blue-200 transition-colors duration-200" data-testid="hello-darkness"><svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18.1406C11.6016 18.1406 11.2782 18.464 11.2782 18.8624V21.0281C11.2782 21.4265 11.6016 21.7499 12 21.7499C12.3985 21.7499 12.7219 21.4265 12.7219 21.0281V18.8624C12.7219 18.464 12.3985 18.1406 12 18.1406V18.1406Z" fill="currentColor"></path><path d="M12 2.25006C11.6016 2.25006 11.2782 2.5735 11.2782 2.97194V5.13756C11.2782 5.536 11.6016 5.85944 12 5.85944C12.3985 5.85944 12.7219 5.536 12.7219 5.13756V2.97194C12.7219 2.5735 12.3985 2.25006 12 2.25006V2.25006Z" fill="currentColor"></path><path d="M5.85936 12C5.85936 11.6015 5.53592 11.2781 5.13749 11.2781H2.97186C2.57342 11.2781 2.24999 11.6015 2.24999 12C2.24999 12.3984 2.57342 12.7218 2.97186 12.7218H5.13749C5.53592 12.7218 5.85936 12.3984 5.85936 12V12Z" fill="currentColor"></path><path d="M21.0281 11.2781H18.8625C18.4641 11.2781 18.1406 11.6015 18.1406 12C18.1406 12.3984 18.4641 12.7218 18.8625 12.7218H21.0281C21.4266 12.7218 21.75 12.3984 21.75 12C21.75 11.6015 21.4266 11.2781 21.0281 11.2781V11.2781Z" fill="currentColor"></path><path d="M7.14841 16.1298C6.95622 16.1298 6.77341 16.2048 6.63747 16.3407L5.10466 17.8735C4.96872 18.0094 4.89372 18.1923 4.89372 18.3844C4.89372 18.5766 4.96872 18.7594 5.10466 18.8954C5.2406 19.0313 5.42341 19.1063 5.6156 19.1063C5.80779 19.1063 5.9906 19.0313 6.12654 18.8954L7.65935 17.3626C7.9406 17.0813 7.9406 16.6219 7.65935 16.3407C7.52341 16.2048 7.3406 16.1298 7.14841 16.1298V16.1298Z" fill="currentColor"></path><path d="M16.8516 7.87036C17.0437 7.87036 17.2266 7.79536 17.3625 7.65942L18.8953 6.12661C19.0312 5.99067 19.1062 5.80786 19.1062 5.61567C19.1062 5.42349 19.0312 5.24067 18.8953 5.10474C18.7594 4.9688 18.5766 4.8938 18.3844 4.8938C18.1922 4.8938 18.0094 4.9688 17.8734 5.10474L16.3406 6.63755C16.2047 6.77349 16.1297 6.9563 16.1297 7.14849C16.1297 7.34067 16.2047 7.52349 16.3406 7.65942C16.4766 7.79536 16.6594 7.87036 16.8516 7.87036V7.87036Z" fill="currentColor"></path><path d="M6.12654 5.10474C5.9906 4.9688 5.80779 4.8938 5.6156 4.8938C5.42341 4.8938 5.2406 4.9688 5.10466 5.10474C4.96872 5.24067 4.89372 5.42349 4.89372 5.61567C4.89372 5.80786 4.96872 5.99067 5.10466 6.12661L6.63747 7.65942C6.77341 7.79536 6.95622 7.87036 7.14841 7.87036C7.3406 7.87036 7.52341 7.79536 7.65935 7.65942C7.79529 7.52349 7.87029 7.34067 7.87029 7.14849C7.87029 6.9563 7.79529 6.77349 7.65935 6.63755L6.12654 5.10474V5.10474Z" fill="currentColor"></path><path d="M17.3625 16.3407C17.2266 16.2048 17.0437 16.1298 16.8516 16.1298C16.6594 16.1298 16.4766 16.2048 16.3406 16.3407C16.0594 16.6219 16.0594 17.0813 16.3406 17.3626L17.8734 18.8954C18.0094 19.0313 18.1922 19.1063 18.3844 19.1063C18.5766 19.1063 18.7594 19.0313 18.8953 18.8954C19.0312 18.7594 19.1062 18.5766 19.1062 18.3844C19.1062 18.1923 19.0312 18.0094 18.8953 17.8735L17.3625 16.3407V16.3407Z" fill="currentColor"></path><path d="M12 7.5C9.52031 7.5 7.5 9.52031 7.5 12C7.5 14.4797 9.52031 16.5 12 16.5C14.4797 16.5 16.5 14.4797 16.5 12C16.5 9.52031 14.4797 7.5 12 7.5Z" fill="currentColor"></path></svg></button><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="bg-gray-100 dark:bg-gray-800 hidden md:block"><div class="md:max-w-[1024px] md:mx-auto md:grid md:grid-flow-col md:justify-end md:gap-x-[20px] md:px-[24px]" data-testid="sub-navigation"><a title="api" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/api/">API</a><a title="概念" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/concepts/">概念</a><a title="配置" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/configuration/">配置</a><a title="指南" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/guides/">指南</a><a title="loader" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/loaders/">loader</a><a title="迁移" aria-current="page" class="!text-black dark:!text-white text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/migrate/">迁移</a><a title="plugin" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/plugins/">plugin</a></div></div></header></div><div class="container site__content"><div class="sponsors"><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="sponsors__content"><img class="sponsors__img__docschina" src="/docschina-logo.59f03f74b3c450856c01.png"/><div class="sponsors__content-cont">翻译/文档内容有任何问题，请联系我们</div></a></div><nav class="sidebar site__sidebar"><div class="sidebar__inner"><div class="relative z-0 bg-white dark:bg-gray-100 "><select class="text-gray-600 text-14 px-5 py-5 appearance-none box-border border border-gray-200 border-solid flex-col flex w-full rounded-none bg-transparent bg-none"><option selected="" value="5">Webpack 5</option><option value="4">Webpack 4</option></select><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="absolute right-5 top-5 fill-current text-gray-300 z-[-1]" width="20" height="20"><path d="M4.5 7.5c.5-.4 1-.4 1.6 0l3.9 3.8 4-3.8c.4-.4 1-.4 1.5 0 .4.5.4 1.2 0 1.7l-4.7 4.5a1 1 0 0 1-1.6 0L4.5 9.2c-.4-.5-.4-1.2 0-1.7z"></path></svg></div><div class="sidebar-item sidebar-item--disabled`"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title sidebar-link__print" href="/migrate/printable/" rel="nofollow noopener noreferrer" alt="Print" title="Print" target="_blank">Print Section<img src="/icon-print.d4d2cfa27f8b9a98e34a.svg" width="27" height="20" alt="Printer Icon"/></a></div><div><div class="sidebar-item  sidebar-item--disabled"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title" href="/migrate/">Migrate</a></div></div><div><div class="sidebar-item sidebar-item--open "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0z"></path></svg><a aria-current="page" class="sidebar-item__title active" href="/migrate/5/">从 v4 升级到 v5</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="准备工作 "><a aria-current="page" class="active" href="/migrate/5/#preparations">准备工作 </a></li><li class="sidebar-item__anchor" title="升级 webpack 4 及其相关的 plugin/loader "><a aria-current="page" class="active" href="/migrate/5/#upgrade-webpack-and-its-plugins-loaders">升级 webpack 4 及其相关的 plugin/loader </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="确保你的构建没有错误或警告 "><a aria-current="page" class="active" href="/migrate/5/#make-sure-your-build-has-no-errors-or-warnings">确保你的构建没有错误或警告 </a></li><li class="sidebar-item__anchor" title="请确保设置了 mode "><a aria-current="page" class="active" href="/migrate/5/#make-sure-to-use-mode">请确保设置了 mode </a></li><li class="sidebar-item__anchor" title="升级废弃的配置项 "><a aria-current="page" class="active" href="/migrate/5/#update-outdated-options">升级废弃的配置项 </a></li><li class="sidebar-item__anchor" title="测试 webpack 5 兼容性 "><a aria-current="page" class="active" href="/migrate/5/#test-webpack-5-compatibility">测试 webpack 5 兼容性 </a></li></ul></li><li class="sidebar-item__anchor" title="升级至 webpack 5 "><a aria-current="page" class="active" href="/migrate/5/#upgrade-webpack-to-5">升级至 webpack 5 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="清理配置 "><a aria-current="page" class="active" href="/migrate/5/#clean-up-configuration">清理配置 </a></li><li class="sidebar-item__anchor" title="需要旧版浏览器的支持？比如 IE 11？ "><a aria-current="page" class="active" href="/migrate/5/#need-to-support-an-older-browser-like-ie-11">需要旧版浏览器的支持？比如 IE 11？ </a></li><li class="sidebar-item__anchor" title="清理代码 "><a aria-current="page" class="active" href="/migrate/5/#cleanup-the-code">清理代码 </a></li><li class="sidebar-item__anchor" title="运行单个构建并遵循以下建议 "><a aria-current="page" class="active" href="/migrate/5/#run-a-single-build-and-follow-advises">运行单个构建并遵循以下建议 </a></li></ul></li><li class="sidebar-item__anchor" title="所有情况都运行如常？ "><a aria-current="page" class="active" href="/migrate/5/#everything-works">所有情况都运行如常？ </a></li><li class="sidebar-item__anchor" title="运行异常？ "><a aria-current="page" class="active" href="/migrate/5/#it-is-not-working">运行异常？ </a></li><li class="sidebar-item__anchor" title="发现本指南中缺失的东西？ "><a aria-current="page" class="active" href="/migrate/5/#something-missing-in-this-guide">发现本指南中缺失的东西？ </a></li><li class="sidebar-item__anchor" title="内核的改变 "><a aria-current="page" class="active" href="/migrate/5/#changes-to-internals">内核的改变 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="loader 的 getOptions 方法 "><a aria-current="page" class="active" href="/migrate/5/#getoptions-method-for-loaders">loader 的 getOptions 方法 </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0z"></path></svg><a class="sidebar-item__title" href="/migrate/4/">To v4 from v3</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Node.js v4 "><a class="" href="/migrate/4/#nodejs-v4">Node.js v4 </a></li><li class="sidebar-item__anchor" title="脚手架（CLI） "><a class="" href="/migrate/4/#cli">脚手架（CLI） </a></li><li class="sidebar-item__anchor" title="更新插件 "><a class="" href="/migrate/4/#update-plugins">更新插件 </a></li><li class="sidebar-item__anchor" title="模式（mode） "><a class="" href="/migrate/4/#mode">模式（mode） </a></li><li class="sidebar-item__anchor" title="不推荐或被移除的插件 "><a class="" href="/migrate/4/#deprecatedremoved-plugins">不推荐或被移除的插件 </a></li><li class="sidebar-item__anchor" title="CommonsChunkPlugin "><a class="" href="/migrate/4/#commonschunkplugin">CommonsChunkPlugin </a></li><li class="sidebar-item__anchor" title="import() 和 CommonJS "><a class="" href="/migrate/4/#import-and-commonjs">import() 和 CommonJS </a></li><li class="sidebar-item__anchor" title="json 和 loaders "><a class="" href="/migrate/4/#json-and-loaders">json 和 loaders </a></li><li class="sidebar-item__anchor" title="module.loaders "><a class="" href="/migrate/4/#moduleloaders">module.loaders </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0z"></path></svg><a class="sidebar-item__title" href="/migrate/3/">从 v1 升级到 v2 或 v3</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="resolve.root, resolve.fallback, resolve.modulesDirectories "><a class="" href="/migrate/3/#resolveroot-resolvefallback-resolvemodulesdirectories">resolve.root, resolve.fallback, resolve.modulesDirectories </a></li><li class="sidebar-item__anchor" title="resolve.extensions "><a class="" href="/migrate/3/#resolveextensions">resolve.extensions </a></li><li class="sidebar-item__anchor" title="resolve.* "><a class="" href="/migrate/3/#resolve">resolve.* </a></li><li class="sidebar-item__anchor" title="module.loaders is now module.rules "><a class="" href="/migrate/3/#moduleloaders-is-now-modulerules">module.loaders is now module.rules </a></li><li class="sidebar-item__anchor" title="链式 loaders "><a class="" href="/migrate/3/#chaining-loaders">链式 loaders </a></li><li class="sidebar-item__anchor" title="已移除 -loader 模块名称自动扩展 "><a class="" href="/migrate/3/#automatic--loader-module-name-extension-removed">已移除 -loader 模块名称自动扩展 </a></li><li class="sidebar-item__anchor" title="json-loader 不再需要手动添加 "><a class="" href="/migrate/3/#json-loader-is-not-required-anymore">json-loader 不再需要手动添加 </a></li><li class="sidebar-item__anchor" title="配置中的 loader 默认相对于 context 进行解析 "><a class="" href="/migrate/3/#loaders-in-configuration-resolve-relative-to-context">配置中的 loader 默认相对于 context 进行解析 </a></li><li class="sidebar-item__anchor" title="module.preLoaders and module.postLoaders were removed: "><a class="" href="/migrate/3/#modulepreloaders-and-modulepostloaders-were-removed">module.preLoaders and module.postLoaders were removed: </a></li><li class="sidebar-item__anchor" title="UglifyJsPlugin sourceMap "><a class="" href="/migrate/3/#uglifyjsplugin-sourcemap">UglifyJsPlugin sourceMap </a></li><li class="sidebar-item__anchor" title="UglifyJsPlugin warnings "><a class="" href="/migrate/3/#uglifyjsplugin-warnings">UglifyJsPlugin warnings </a></li><li class="sidebar-item__anchor" title="UglifyJsPlugin minimize loaders "><a class="" href="/migrate/3/#uglifyjsplugin-minimize-loaders">UglifyJsPlugin minimize loaders </a></li><li class="sidebar-item__anchor" title="DedupePlugin has been removed "><a class="" href="/migrate/3/#dedupeplugin-has-been-removed">DedupePlugin has been removed </a></li><li class="sidebar-item__anchor" title="BannerPlugin - 破坏性改动 "><a class="" href="/migrate/3/#bannerplugin---breaking-change">BannerPlugin - 破坏性改动 </a></li><li class="sidebar-item__anchor" title="默认加载 OccurrenceOrderPlugin "><a class="" href="/migrate/3/#occurrenceorderplugin-is-now-on-by-default">默认加载 OccurrenceOrderPlugin </a></li><li class="sidebar-item__anchor" title="ExtractTextWebpackPlugin - 破坏性改动 "><a class="" href="/migrate/3/#extracttextwebpackplugin---breaking-change">ExtractTextWebpackPlugin - 破坏性改动 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="ExtractTextPlugin.extract "><a class="" href="/migrate/3/#extracttextpluginextract">ExtractTextPlugin.extract </a></li><li class="sidebar-item__anchor" title="new ExtractTextPlugin({options}) "><a class="" href="/migrate/3/#new-extracttextpluginoptions">new ExtractTextPlugin({options}) </a></li></ul></li><li class="sidebar-item__anchor" title="全动态 require 现在默认会失败 "><a class="" href="/migrate/3/#full-dynamic-requires-now-fail-by-default">全动态 require 现在默认会失败 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="在 CLI 和配置中使用自定义参数 "><a class="" href="/migrate/3/#using-custom-arguments-in-cli-and-configuration">在 CLI 和配置中使用自定义参数 </a></li></ul></li><li class="sidebar-item__anchor" title="require.ensure and AMD require are asynchronous "><a class="" href="/migrate/3/#requireensure-and-amd-require-are-asynchronous">require.ensure and AMD require are asynchronous </a></li><li class="sidebar-item__anchor" title="通过 options 中配置 loader "><a class="" href="/migrate/3/#loader-configuration-is-through-options">通过 options 中配置 loader </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="什么是 options ？ "><a class="" href="/migrate/3/#what-are-options">什么是 options ？ </a></li></ul></li><li class="sidebar-item__anchor" title="LoaderOptionsPlugin context "><a class="" href="/migrate/3/#loaderoptionsplugin-context">LoaderOptionsPlugin context </a></li><li class="sidebar-item__anchor" title="debug "><a class="" href="/migrate/3/#debug">debug </a></li><li class="sidebar-item__anchor" title="ES2015 的代码分离 "><a class="" href="/migrate/3/#code-splitting-with-es2015">ES2015 的代码分离 </a></li><li class="sidebar-item__anchor" title="动态表达式 "><a class="" href="/migrate/3/#dynamic-expressions">动态表达式 </a></li><li class="sidebar-item__anchor" title="混合使用 ES2015、AMD 和 CommonJS "><a class="" href="/migrate/3/#mixing-es2015-with-amd-and-commonjs">混合使用 ES2015、AMD 和 CommonJS </a></li><li class="sidebar-item__anchor" title="Hints "><a class="" href="/migrate/3/#hints">Hints </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="模版字符串 "><a class="" href="/migrate/3/#template-strings">模版字符串 </a></li><li class="sidebar-item__anchor" title="配置中使用 Promise "><a class="" href="/migrate/3/#configuration-promise">配置中使用 Promise </a></li><li class="sidebar-item__anchor" title="高级 loader 匹配 "><a class="" href="/migrate/3/#advanced-loader-matching">高级 loader 匹配 </a></li><li class="sidebar-item__anchor" title="更多的 CLI 参数项 "><a class="" href="/migrate/3/#more-cli-options">更多的 CLI 参数项 </a></li></ul></li><li class="sidebar-item__anchor" title="Loader 变更 "><a class="" href="/migrate/3/#loader-changes">Loader 变更 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Cacheable "><a class="" href="/migrate/3/#cacheable">Cacheable </a></li><li class="sidebar-item__anchor" title="复杂 options "><a class="" href="/migrate/3/#complex-options">复杂 options </a></li></ul></li></ul></div></div></div></nav><section class="page"><div class="markdown"><h1>从 v4 升级到 v5</h1><div id="md-content"><p>本指南目标是帮助你在使用 webpack 的时候直接迁移到 webpack 5。如果你使用运行 webpack 更底层的工具，请
参考工具有关迁移的指引。</p><h2><span id="preparations"></span>准备工作<a href="#preparations" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>Webpack 5 对 Node.js 的版本要求至少是 10.13.0 (LTS)，因此，如果你还在使用旧版本的 Node.js，请升级它们。</p><h2><span id="upgrade-webpack-and-its-plugins-loaders"></span>升级 webpack 4 及其相关的 plugin/loader<a href="#upgrade-webpack-and-its-plugins-loaders" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><ol><li>升级 <code>webpack</code> 4 至最新的可用版本。</li></ol><ul><li><p>当使用 webpack &gt;= 4 时，升级到最新的 webpack 5 版本无需额外的操作。</p></li><li><p>如果你使用的 webpack 版本小于 4，请查阅 <a href="/migrate/4/">webpack 4 迁移指南</a>。</p></li></ul><ol start="2"><li><p>升级 <code>webpack-cli</code> 到最新的可用版本（如已使用的情况下）</p></li><li><p>升级所有使用到的 plugin 和 loader 为最新的可用版本。</p></li></ol><p>部分 plugin 和 loader 可能会有一个 beta 版本，必须使用它们才能与 webpack 5 兼容。
请确保在升级时阅读每个插件/loader 的发布说明，因为最新版本可能只支持 webpack 5，而在 v4 中会运行失败。在这种情况下，建议升级到支持 webpack 4 的最新版本。</p><h3><span id="make-sure-your-build-has-no-errors-or-warnings"></span>确保你的构建没有错误或警告<a href="#make-sure-your-build-has-no-errors-or-warnings" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>由于升级了 <code>webpack</code>，<code>webpack-cli</code>，plugin 以及 loader 的版本，因此，可能会出现新的错误或警告。在编译过程中请注意是否有弃用警告。</p><p>你可以通过如下方式调用 <code>webpack</code> 来获取堆栈信息中的弃用警告，从而找出是哪个 plugin 或 loader 造成的。</p><pre><code class="hljs language-bash">node --trace-deprecation node_modules/webpack/bin/webpack.js</code></pre><p>由于 webpack 5 移除了所有被废弃的特性，因此，需确保在构建过程中没有 webpack 的弃用警告才能继续。</p><h3><span id="make-sure-to-use-mode"></span>请确保设置了 <code>mode</code><a href="#make-sure-to-use-mode" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>将 mode 设置成 <a href="/configuration/mode/#mode-production"><code>production</code></a> 或 <a href="/configuration/mode/#mode-development"><code>development</code></a> 以确保相应的默认值被设置。</p><h3><span id="update-outdated-options"></span>升级废弃的配置项<a href="#update-outdated-options" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>如有使用以下的配置项，请升级至最新的版本：</p><ul><li><code>optimization.hashedModuleIds: true</code> → <code>optimization.moduleIds: &#x27;hashed&#x27;</code></li><li><code>optimization.namedChunks: true</code> → <code>optimization.chunkIds: &#x27;named&#x27;</code></li><li><code>optimization.namedModules: true</code> → <code>optimization.moduleIds: &#x27;named&#x27;</code></li><li><code>NamedModulesPlugin</code> → <code>optimization.moduleIds: &#x27;named&#x27;</code></li><li><code>NamedChunksPlugin</code> → <code>optimization.chunkIds: &#x27;named&#x27;</code></li><li><code>HashedModuleIdsPlugin</code> → <code>optimization.moduleIds: &#x27;hashed&#x27;</code></li><li><code>optimization.noEmitOnErrors: false</code> → <code>optimization.emitOnErrors: true</code></li><li><code>optimization.occurrenceOrder: true</code> → <code>optimization: { chunkIds: &#x27;total-size&#x27;, moduleIds: &#x27;size&#x27; }</code></li><li><code>optimization.splitChunks.cacheGroups.vendors</code> → <code>optimization.splitChunks.cacheGroups.defaultVendors</code></li><li><code>optimization.splitChunks.cacheGroups.test(module, chunks)</code> → <code>optimization.splitChunks.cacheGroups.test(module, { chunkGraph, moduleGraph })</code></li><li><code>Compilation.entries</code> → <code>Compilation.entryDependencies</code></li><li><code>serve</code> → <code>serve</code> 已被移除，推荐使用 <a href="/configuration/dev-server/"><code>DevServer</code></a></li><li><a href="/configuration/module/#ruleoptions--rulequery"><code>Rule.query</code></a> (从 v3 开始被移除) → <code>Rule.options</code>/<code>UseEntry.options</code></li><li><code>Rule.loaders</code> → <a href="/configuration/module/#ruleuse"><code>Rule.use</code></a></li></ul><h3><span id="test-webpack-5-compatibility"></span>测试 webpack 5 兼容性<a href="#test-webpack-5-compatibility" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>尝试在 webpack 4 的配置中添加如下选项，检查一下构建是否仍然正确的运行。</p><pre><code class="hljs language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  node<span class="token operator">:</span> <span class="token punctuation">{</span>
    Buffer<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    process<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>你必须在升级 webpack 5 的配置时，必须删除这些选项。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>webpack 5 从配置中移除了这些选项，并始终赋值 <code>false</code>。</p></aside><h2><span id="upgrade-webpack-to-5"></span>升级至 webpack 5<a href="#upgrade-webpack-to-5" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在，让我们升级至 webpack 5：</p><ul><li><p>npm: <code>npm install webpack@latest</code></p></li><li><p>Yarn: <code>yarn add webpack@latest</code></p></li></ul><p>如果你之前在升级 webpack 4 时不能将某些插件或者 loader 升级到最新版本，现在不要忘了升级。</p><h3><span id="clean-up-configuration"></span>清理配置<a href="#clean-up-configuration" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><p>请考虑将 <code>optimization.moduleIds</code> 和 <code>optimization.chunkIds</code> 从你 webpack 配置中移除。使用默认值会更合适，因为它们会在 <a href="/configuration/mode/#mode-production"><code>production 模式</code></a> 下支持长效缓存且可以在 <a href="/configuration/mode/#mode-development"><code>development</code> 模式</a>下进行调试。</p></li><li><p>当 webpack 配置中使用了 <code>[hash]</code> 占位符时，请考虑将它改为 <code>[contenthash]</code>。效果一致，但事实证明会更为有效。</p></li><li><p>如果你使用了 Yarn 的 PnP 以及 <code>pnp-webpack-plugin</code> 插件，你可以将其从配置中移除，因为它已被默认支持。</p></li><li><p>如果你使用了带有正则表达式参数的 <code>IgnorePlugin</code>，现已支持传入一个 <code>options</code> 对象：<code>new IgnorePlugin({ resourceRegExp: /regExp/ })</code>。</p></li><li><p>如果你使用了类似于 <code>node.fs: &#x27;empty&#x27;</code>，请使用 <code>resolve.fallback.fs: false</code> 代替。</p></li><li><p>如果你在 webpack 的 Node.js API 中使用了 <code>watch: true</code>，请移除它。无需按编译器的提示设置它，当执行 <code>watch()</code> 时为 <code>true</code>，当执行 <code>run()</code> 的时候为 <code>false</code>。</p></li><li><p>如果你定义了 <code>rules</code>，以使用 <code>raw-loader</code>，<code>url-loader</code> 或 <code>file-loader</code> 来加载资源，请使用 <a href="/guides/asset-modules/">资源模块</a> 替代，因为它们可能在不久的将来被淘汰。</p></li><li><p>如果你将 <code>target</code> 设置为函数，则应将其更新为 <code>false</code>，然后在 <code>plugins</code> 选项中使用该函数。具体示例如下：</p><pre><code class="hljs language-json"><span class="token comment">// for webpack 4</span>
<span class="token punctuation">{</span>
    target<span class="token operator">:</span> WebExtensionTarget(nodeConfig)
<span class="token punctuation">}</span>

<span class="token comment">// for webpack 5</span>
<span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        WebExtensionTarget(nodeConfig)
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></li></ul><p>如果通过 import 使用了 WebAssembly，应遵循以下两点：</p><ul><li>在配置增加 <code>experiments.syncWebAssembly: true</code> 配置，以启用废弃提醒，获得在 webpack 4 中的相同行为。</li><li>在成功升级至 webpack 5 以后，应将 <code>experiments</code> 的值改为 <code>experiments: { asyncWebAssembly: true }</code> 以使用最新规范的 WASM。</li></ul><p>重新考虑 <code>optimization.splitChunks</code> 的配置：</p><ul><li>推荐使用默认配置或使用 <code>optimization.splitChunks: { chunks: &#x27;all&#x27; }</code> 配置。</li><li>当使用自定义配置时，请删除 <code>name: false</code>，并将 <code>name: string | function</code> 替换为 <code>idHint: string | function</code>。</li><li>使用 <code>optimization.splitChunks.cacheGroups: { default: false, vendors: false }</code> 配置可以关闭默认值。但我们不推荐这么做，如果你需要在 webpack 5 中获得与之相同的效果：请将配置改为 <code>optimization.splitChunks.cacheGroups: { default: false, defaultVendors: false }</code>。</li></ul><p>考虑移除的默认值：</p><ul><li>当设置 <code>entry: &#x27;./src/index.js&#x27;</code> 时，你可以省略它，此为默认值。</li><li>当设置 <code>output.path: path.resolve(__dirname, &#x27;dist&#x27;)</code> 时：你可以省略它，此为默认值。</li><li>当设置 <code>output.filename: &#x27;[name].js&#x27;</code> 时：你可以省略它，此为默认值。</li></ul><h3><span id="need-to-support-an-older-browser-like-ie-11"></span>需要旧版浏览器的支持？比如 IE 11？<a href="#need-to-support-an-older-browser-like-ie-11" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><p>如果你在项目中启用了 <a href="https://github.com/browserslist/browserslist">browserslist</a>，webpack 5 将会重用你的 <code>browserslist</code> 配置来决定运行时的代码风格。</p><p>只要确保：</p><ol><li>将 <a href="/configuration/target/#root"><code>target</code></a> 设置为 <code>browserslist</code>，或者移除 <code>target</code> 配置，webpack 会自动将其置为 <code>browserslist</code>。</li><li>在你的 browserslist 配置中添加 <code>IE 11</code>。</li></ol></li><li><p>如未使用 <code>browserslist</code>，webpack 的运行时代码将默认使用 ES2015 语法（例如，箭头函数）来构建一个简洁的 bundles。如果你构建的目标环境并不支持 ES2015 的语法（如 IE 11），你需要设置 <code>target: [&#x27;web&#x27;, &#x27;es5&#x27;]</code> 以使用 ES5 的语法。</p></li><li><p>对于 Node.js 环境来说，构建中引入了对 Node.js 版本的支持，webpack 会自动找出对应版本支持的语法，例如，<code>target: &#x27;node8.6&#x27;</code>。</p></li></ul><h3><span id="cleanup-the-code"></span>清理代码<a href="#cleanup-the-code" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><h4><span id="using-webpack-chunk-name"></span>使用 <code>/* webpackChunkName: &#x27;...&#x27; */</code> 时<a href="#using-webpack-chunk-name" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>请确保你了解其意图：</p><ul><li>此处 chunk 的名称本意是 public 的。</li><li>它不只是用于开发模式的名称。</li><li>webpack 会在 production 以及 development 的模式中使用它对文件进行命名。</li><li>即使不使用 <code>webpackChunkName</code>，webpack 5 也会自动在 <code>development</code> 模式下分配有意义的文件名。</li></ul><h4><span id="using-named-exports-from-json-modules"></span>为 JSON 模块使用具名导出<a href="#using-named-exports-from-json-modules" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>新规范中将不再支持下面这种方式，如此做会发出警告：</p><pre><code class="hljs language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> version <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./package.json&#x27;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>请使用如下方式代替：</p><pre><code class="hljs language-js"><span class="token keyword">import</span> pkg <span class="token keyword">from</span> <span class="token string">&#x27;./package.json&#x27;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4><span id="cleanup-the-build-code"></span>清理构建代码<a href="#cleanup-the-build-code" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><ul><li>当使用 <code>const compiler = webpack(...);</code>，确保在使用完毕后，使用 <code>compiler.close(callback);</code> 关闭编译器。<ul><li>这不适用于自动关闭的 <code>webpack(..., callback)</code>。</li><li>如果你在监听模式下使用 webpack，直到用户结束进程，此为可选。在监听模式下的空闲阶段将被用于执行此工作。</li></ul></li></ul><h3><span id="run-a-single-build-and-follow-advises"></span>运行单个构建并遵循以下建议<a href="#run-a-single-build-and-follow-advises" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>请务必仔细阅读构建时的错误/警告。如未发现相关建议，请创建一个 issue，我们会尽力解决。</p><p>重复以下步骤，直到你至少解决到 Level 3 或 Level 4：</p><ul><li><p>Level 1: <strong>模式（Schema）校验失败</strong>。</p><p>配置选项已更改。应该要有校验失败的信息且附上 <code>BREAKING CHANGE:</code> 提示，或提示应该使用哪个选项。</p></li><li><p>Level 2: <strong>webpack 异常退出并出现错误</strong>。</p><p>错误信息应告诉你哪里需要进行修改。</p></li><li><p>Level 3: <strong>构建错误</strong>。</p><p>错误信息应该要有 <code>BREAKING CHANGE:</code> 提示。</p></li><li><p>Level 4: <strong>构建警告</strong>。</p><p>警告信息应该告诉你哪里需要进行修改。</p></li><li><p>Level 5: <strong>运行时错误</strong>。</p><p>这很棘手，你可能要调试才能找到问题所在。在这里很难给出一个通用的建议。但我们在下面列出了一些关于运行时错误的常见建议：</p><ul><li><code>process</code> 未定义。<ul><li>webpack 5 不再引入 Node.js 变量的 polyfill，在前端代码中应避免使用。</li><li>想支持浏览器的用法？使用 <code>exports</code> 或 <code>imports</code> 中的 package.json 字段，会根据环境不同使用不同的代码。<ul><li>也可以使用 <code>browser</code> 字段来支持旧的 bundlers。</li><li>替代方案。用 <code>typeof process</code> 检查包裹的代码块。请注意，这将对 bundle 大小产生负面影响。</li></ul></li><li>想要使用环境变量，如 <code>process.env.VARIABLE</code>？你需要使用 <code>DefinePlugin</code> 或 <code>EnvironmentPlugin</code> 在配置中定义这些变量。<ul><li>考虑使用 <code>VARIABLE</code> 代替，但需要检查 <code>typeof VARIABLE !== &#x27;undefined&#x27;</code>。<code>process.env</code> 是 Node.js 特有，应避免在前端中使用。</li></ul></li></ul></li><li>404 的 error 将指向含有 <code>auto</code> 的 URL<ul><li>并非所有生态系统工具都已设置好新的 <code>publicPath</code> 的默认值 <code>output.publicPath: &quot;auto&quot;</code><ul><li>使用静态的 <code>output.publicPath: &quot;&quot;</code> 代替。</li></ul></li></ul></li></ul></li><li><p>Level 6: <strong>弃用警告</strong>.</p><p>你可能会收到很多弃用警告，插件需要时间来赶上内核的变化。请将这些弃用上报给插件。这些弃用只是警告，构建仍然可以正常工作，只是会有小瑕疵（比如性能降低）。</p><ul><li>你使用带有 <code>--no-deprecation</code> 选项的 node 运行 webpack，可以隐藏废弃告警，例如：<code>node --no-deprecation node_modules/webpack/bin/webpack.js</code>。但这只能作为临时的解决方案。</li><li>plugin 和 loader 的开发者，应遵循弃用信息中的建议以改进代码。</li></ul></li><li><p>Level 7: <strong>性能问题</strong>.</p><p>一般来说，webpack 5 的性能应该会有所提高，但也存在少数情况性能会变差。</p><p>而在这里，你可以做一些事情来改善这种情况：</p><ul><li>通过 Profile 检查时间耗费在哪里。<ul><li><code>--profile --progress</code> 可以展示一个简单的性能曲线。</li><li><code>node --inspect-brk node_modules/webpack/bin/webpack.js</code> + <a href="chrome://inspect"><code>chrome://inspect</code></a> / <a href="edge://inspect"><code>edge://inspect</code></a>（查看 profiler 选项）。<ul><li>你可以将这些性能文件保存到文件中，并在 issues 中提供它们。</li><li>尝试使用 <code>--no-turbo-inlining</code> 选项，在某些情况下可以获得更好的堆栈信息。</li></ul></li></ul></li><li>在增量构建时，构建模块的世界可以通过使用像 webpack 4 中的不安全缓存来改善：<ul><li><code>module.unsafeCache: true</code></li><li>但这可能会影响处理代码库的一些变化能力。</li></ul></li><li>全量构建<ul><li>与新功能相比，弃用特性的向后兼容层通常性能很差。</li><li>创建许多警告会影响构建性能，即使它们被忽略。</li><li>Source Maps 的代价很昂贵。请在文档中查看 <a href="/configuration/devtool/"><code>devtool</code></a> 选项以比较使用不同选项的代价。</li><li>Anti-Virus（反病毒）保护可能会影响文件系统的访问性能。</li><li>持久缓存可以帮助改善重复性的完整构建。</li><li>Module Federation 允许将应用程序分割成多个较小的构建。</li></ul></li></ul></li></ul><h2><span id="everything-works"></span>所有情况都运行如常？<a href="#everything-works" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>如果你成功地迁移至 webpack 5。请<a href="https://twitter.com/intent/tweet?source=https://webpack.js.org/migrate/5/&amp;text=I%20just%20migrated%20to%20webpack%205%20using%20its%20migration%20guide!%20&amp;via=webpack&amp;hashtags=webpack,webpack5">发推 @ 我们</a>。</p><h2><span id="it-is-not-working"></span>运行异常？<a href="#it-is-not-working" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>创建一个 <a href="https://github.com/webpack/webpack/issues/new?template=Bug_report.md">issue</a> 并告诉我们在迁移过程中你遇到的问题。</p><h2><span id="something-missing-in-this-guide"></span>发现本指南中缺失的东西？<a href="#something-missing-in-this-guide" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>请提交 <a href="https://github.com/webpack/webpack.js.org/edit/master/src/content/migrate/5.mdx">Pull Request</a> 以帮助其他开发者更好地使用该指南。</p><h2><span id="changes-to-internals"></span>内核的改变<a href="#changes-to-internals" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>如果你对内核感兴趣，此处会列出 webpack 内核相关的变更，如：添加类型，代码重构和方法重命名等。但这些变化并不会作为迁移通用案例的一部份。</p><ul><li><code>Module.nameForCondition</code>，<code>Module.updateCacheModule</code> 以及 <code>Module.chunkCondition</code> 不再可选。</li></ul><h3><span id="getoptions-method-for-loaders"></span>loader 的 getOptions 方法<a href="#getoptions-method-for-loaders" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>Webpack 5 发布后，在 loader 的上下文中，会带有内置的 <a href="/api/loaders/#thisgetoptionsschema"><code>this.getOptions</code></a> 方法。这对于那些使用之前推荐 <a href="https://github.com/webpack/schema-utils">schema-utils</a> 中的 <code>getOptions</code> 方法的 loader 而言，这是一个重大更新：</p><ul><li><code>this.getOptions</code> 自 webpack 5 起支持使用</li><li>它支持将 JSON 作为查询字符串，而不仅仅是 JSON5：如 <code>?{arg:true}</code> → <code>?{&quot;arg&quot;:true}</code>。在相应的 loader 文档中，应推荐使用 JSON 并不推荐使用 JSON5。</li><li><a href="https://github.com/webpack/loader-utils"><code>loader-utils</code></a> 拥有解析查询字符串的特定行为（如 <code>true</code>，<code>false</code> 以及 <code>null</code> 不会被解析成 <code>string</code> 而是原始类型的值）。这对于新的内置 <code>this.getOptions</code> 方法来说，不再适用，它使用 Node 原生的 <a href="https://nodejs.org/api/querystring.html"><code>querystring</code></a> 方法进行解析。此时，需在 loader 中使用 <code>this.getOptions</code> 获取配置选项之后，根据情况添加自定义行为。</li><li>模式(Schema) 参数对新的 <code>this.getOptions</code> 方法而言是可选的，但我们强烈建议给你的 loader 选项添加模式校验。模式中的 <code>title</code> 字段，可用于自定义校验的错误信息，比如 <code>&quot;title&quot;: &quot;My Loader ooooptions&quot;</code> 会在这种方式展示错误信息：<code>Invalid ooooptions object. My Loader has been initialised using an ooooptions object that does not match the API schema. - ooooptions.foo.bar.baz should be a string.</code>。</li></ul></div><div class="print:hidden mt-20"><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline" href="https://github.com/docschina/webpack.js.org/edit/cn/src/content/migrate/5.mdx">编辑此页</a><span class="mx-5 text-black font-bold dark:text-white">·</span><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline">打印文档</a></div><div class="adjacent-links print:hidden"><div class="adjacent-links__prev"><div>« Previous</div><a class="adjacent-links__link" href="/migrate/">Migrate</a></div><div class="adjacent-links__next"><div class="adjacent-links__label--next">Next »</div><a class="adjacent-links__link" href="/migrate/4/">To v4 from v3</a></div></div><div class="contributors__section"><h3 class="!font-sans !font-normal">3<!-- --> <!-- -->位译者</h3><div class="translators"><div class="translators__list"><a class="translator" href="https://github.com/lcxfs1991"><img alt="lcxfs1991" src="/icon-square-small-slack.9281492bb267314634b4.png"/><span class="translator__name"> <!-- -->lcxfs1991</span></a><a class="translator" href="https://github.com/QC-L"><img alt="QC-L" src="/icon-square-small-slack.9281492bb267314634b4.png"/><span class="translator__name"> <!-- -->QC-L</span></a><a class="translator" href="https://github.com/jacob-lcs"><img alt="jacob-lcs" src="/icon-square-small-slack.9281492bb267314634b4.png"/><span class="translator__name"> <!-- -->jacob-lcs</span></a></div></div></div><div data-testid="contributors" class="print:hidden"><h2 class="!font-sans !font-normal">10<!-- --> <!-- -->位贡献者</h2><div><div class="grid gap-[10px] lg:gap-[15px] grid-cols-contributors"><a href="https://github.com/sokra"><img width="45" height="45" alt="sokra" title="sokra" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/salemhilal"><img width="45" height="45" alt="salemhilal" title="salemhilal" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/keichinger"><img width="45" height="45" alt="keichinger" title="keichinger" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/EugeneHlushko"><img width="45" height="45" alt="EugeneHlushko" title="EugeneHlushko" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/MattGoldwater"><img width="45" height="45" alt="MattGoldwater" title="MattGoldwater" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/rramaa"><img width="45" height="45" alt="rramaa" title="rramaa" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/chenxsan"><img width="45" height="45" alt="chenxsan" title="chenxsan" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/jamesgeorge007"><img width="45" height="45" alt="jamesgeorge007" title="jamesgeorge007" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/getsnoopy"><img width="45" height="45" alt="getsnoopy" title="getsnoopy" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/yevhen-logosha"><img width="45" height="45" alt="yevhen-logosha" title="yevhen-logosha" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a></div></div></div></div></section></div><footer class="footer"><div class="container footer__inner"><section class="footer__left"><a class="footer__link" href="/guides/getting-started/">快速开始</a><a class="footer__link" href="/comparison/">对比</a><a href="https://privacy-policy.openjsf.org/" target="_blank" rel="noopener noreferrer" class="footer__link">Privacy Policy</a></section><section class="footer__middle"><a class="footer__icon" href="/"><img src="/icon-square-small.85ba630cf0c5f29ae3e3.svg" alt="webpack icon" width="35" height="35"/></a></section><section class="footer__right"><a href="https://webpack.threadless.com/" target="_blank" rel="noopener noreferrer" class="footer__link">周边</a><a class="footer__link" href="/awesome-webpack/">Awesome webpack</a><a class="footer__link" href="/glossary/">术语</a><a class="footer__link" href="/branding/">品牌</a><a href="https://gitter.im/webpack/webpack" target="_blank" rel="noopener noreferrer" class="footer__link">Gitter</a><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener noreferrer" class="footer__link">更新日志</a><a class="footer__link footer__license" href="/license"><img alt="Creative Commons License" src="/cc.ab77d813bf219c6e34ff.svg" width="25" height="25"/><img alt="Creative Commons License" src="/by.1360bb2e6d1fc28cdd9e.svg" width="25" height="25"/></a></section></div></footer></div></div><script src="/vendor.e1b5428810fcee6f940d.js"></script><script src="/index.f98a96cfcda5bf188d38.js"></script><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?39edd8e76884f07399be96cd422c9af3";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script></body>