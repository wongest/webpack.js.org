"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5773],{5773:function(e,a,t){t.r(a),t(7378);var n=t(2682),s=["components"];function p(){return p=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},p.apply(this,arguments)}var o=("Badge",function(e){return console.warn("Component `%s` was not imported, exported, or provided by MDXProvider as global scope","Badge"),(0,n.kt)(n.kt.Fragment,null,e.children)});function r(e){var a=e.components,t=function(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},p=Object.keys(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}(e,s);return(0,n.kt)("wrapper",p({components:a},t),(0,n.kt)("p",null,"loader 本质上是导出为函数的 JavaScript 模块。",(0,n.kt)("a",{href:"https://github.com/webpack/loader-runner",parentName:"p"},"loader runner")," 会调用此函数，然后将上一个 loader 产生的结果或者资源文件传入进去。函数中的 ",(0,n.kt)("inlineCode",{parentName:"p"},"this")," 作为上下文会被 webpack 填充，并且 ",(0,n.kt)("a",{href:"https://github.com/webpack/loader-runner",parentName:"p"},"loader runner")," 中包含一些实用的方法，比如可以使 loader 调用方式变为异步，或者获取 query 参数。"),(0,n.kt)("p",null,"起始 loader 只有一个入参：资源文件的内容。compiler 预期得到最后一个 loader 产生的处理结果。这个处理结果应该为 ",(0,n.kt)("inlineCode",{parentName:"p"},"String")," 或者 ",(0,n.kt)("inlineCode",{parentName:"p"},"Buffer"),"（能够被转换为 string）类型，代表了模块的 JavaScript 源码。另外，还可以传递一个可选的 SourceMap 结果（格式为 JSON 对象）。"),(0,n.kt)("p",null,"如果是单个处理结果，可以在 ",(0,n.kt)("a",{href:"#synchronous-loaders",parentName:"p"},"同步模式")," 中直接返回。如果有多个处理结果，则必须调用 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.callback()"),"。在 ",(0,n.kt)("a",{href:"#asynchronous-loaders",parentName:"p"},"异步模式")," 中，必须调用 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.async()")," 来告知 ",(0,n.kt)("a",{href:"https://github.com/webpack/loader-runner",parentName:"p"},"loader runner")," 等待异步结果，它会返回 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.callback()")," 回调函数。随后 loader 必须返回 ",(0,n.kt)("inlineCode",{parentName:"p"},"undefined")," 并且调用该回调函数。"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,n.kt)("span",{className:"token comment",parentName:"code"},"/**\n *\n * @param {string|Buffer} content 源文件的内容\n * @param {object} [map] 可以被 https://github.com/mozilla/source-map 使用的 SourceMap 数据\n * @param {any} [meta] meta 数据，可以是任何内容\n */"),"\n",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"webpackLoader"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," meta"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// 你的 webpack loader 代码"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"examples",parentName:"h2"}),"示例",(0,n.kt)("a",{href:"#examples","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"以下部分提供了不同类型的 loader 的一些基本示例。注意，",(0,n.kt)("inlineCode",{parentName:"p"},"map")," 和 ",(0,n.kt)("inlineCode",{parentName:"p"},"meta")," 参数是可选的，查看下面的 ",(0,n.kt)("a",{href:"#thiscallback",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"this.callback")),"。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"synchronous-loaders",parentName:"h3"}),"同步 Loaders",(0,n.kt)("a",{href:"#synchronous-loaders","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"无论是 ",(0,n.kt)("inlineCode",{parentName:"p"},"return")," 还是 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.callback")," 都可以同步地返回转换后的 ",(0,n.kt)("inlineCode",{parentName:"p"},"content")," 值："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"sync-loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," meta"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someSyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"this.callback")," 方法则更灵活，因为它允许传递多个参数，而不仅仅是 ",(0,n.kt)("inlineCode",{parentName:"p"},"content"),"。"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"sync-loader-with-multiple-results.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," meta"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"null"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someSyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," meta",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";")," ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// 当调用 callback() 函数时，总是返回 undefined"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"asynchronous-loaders",parentName:"h3"}),"异步 Loaders",(0,n.kt)("a",{href:"#asynchronous-loaders","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"对于异步 loader，使用 ",(0,n.kt)("a",{href:"#thisasync",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"this.async"))," 来获取 ",(0,n.kt)("inlineCode",{parentName:"p"},"callback")," 函数："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"async-loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," meta"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"var")," callback ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"async"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someAsyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"err",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," result"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"null"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," result",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," meta",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"async-loader-with-multiple-results.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," map",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," meta"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"var")," callback ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"async"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someAsyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"err",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," result",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," sourceMaps",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," meta"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"null"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," result",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," sourceMaps",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," meta",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"loader 最初被设计为可以在同步 loader pipelines（如 Node.js ，使用 ",(0,n.kt)("a",{href:"https://github.com/webpack/enhanced-require",parentName:"p"},"enhanced-require"),")，",(0,n.kt)("em",{parentName:"p"},"以及")," 在异步 pipelines（如 webpack）中运行。然而，由于同步计算过于耗时，在 Node.js 这样的单线程环境下进行此操作并不是好的方案，我们建议尽可能地使你的 loader 异步化。但如果计算量很小，同步 loader 也是可以的。")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"raw-loader",parentName:"h3"}),'"Raw" Loader',(0,n.kt)("a",{href:"#raw-loader","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"默认情况下，资源文件会被转化为 UTF-8 字符串，然后传给 loader。通过设置 ",(0,n.kt)("inlineCode",{parentName:"p"},"raw")," 为 ",(0,n.kt)("inlineCode",{parentName:"p"},"true"),"，loader 可以接收原始的 ",(0,n.kt)("inlineCode",{parentName:"p"},"Buffer"),"。每一个 loader 都可以用 ",(0,n.kt)("inlineCode",{parentName:"p"},"String")," 或者 ",(0,n.kt)("inlineCode",{parentName:"p"},"Buffer")," 的形式传递它的处理结果。complier 将会把它们在 loader 之间相互转换。"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"raw-loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token function",parentName:"code"},"assert"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"instanceof")," ",(0,n.kt)("span",{className:"token class-name",parentName:"code"},"Buffer"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someSyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// 返回值也可以是一个 `Buffer`"),"\n  ",(0,n.kt)("span",{className:"token comment",parentName:"code"},'// 即使不是 "raw"，loader 也没问题'),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\nmodule",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"raw ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token boolean",parentName:"code"},"true"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"pitching-loader",parentName:"h3"}),"Pitching Loader",(0,n.kt)("a",{href:"#pitching-loader","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"loader ",(0,n.kt)("strong",{parentName:"p"},"总是")," 从右到左被调用。有些情况下，loader 只关心 request 后面的 ",(0,n.kt)("strong",{parentName:"p"},"元数据(metadata)"),"，并且忽略前一个 loader 的结果。在实际（从右到左）执行 loader 之前，会先 ",(0,n.kt)("strong",{parentName:"p"},"从左到右")," 调用 loader 上的 ",(0,n.kt)("inlineCode",{parentName:"p"},"pitch")," 方法。"),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"loader 可以通过 request 添加或者禁用内联前缀，这将影响到 pitch 和执行的顺序。更多详情请查阅 ",(0,n.kt)("a",{href:"/configuration/module/#ruleenforce",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"Rule.enforce")),"。")),(0,n.kt)("p",null,"对于以下 ",(0,n.kt)("a",{href:"/configuration/module/#ruleuse",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"use"))," 配置："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"//..."),"\n  module",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    rules",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n      ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n        ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"//..."),"\n        use",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,n.kt)("span",{className:"token string",parentName:"code"},"'a-loader'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'b-loader'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'c-loader'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"将会发生这些步骤："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-diff",parentName:"pre"},"|- a-loader `pitch`\n",(0,n.kt)("span",{className:"token unchanged",parentName:"code"},(0,n.kt)("span",{className:"token prefix unchanged",parentName:"span"}," "),(0,n.kt)("span",{className:"token line",parentName:"span"}," |- b-loader `pitch`\n"),(0,n.kt)("span",{className:"token prefix unchanged",parentName:"span"}," "),(0,n.kt)("span",{className:"token line",parentName:"span"},"   |- c-loader `pitch`\n"),(0,n.kt)("span",{className:"token prefix unchanged",parentName:"span"}," "),(0,n.kt)("span",{className:"token line",parentName:"span"},"     |- requested module is picked up as a dependency\n"),(0,n.kt)("span",{className:"token prefix unchanged",parentName:"span"}," "),(0,n.kt)("span",{className:"token line",parentName:"span"},"   |- c-loader normal execution\n"),(0,n.kt)("span",{className:"token prefix unchanged",parentName:"span"}," "),(0,n.kt)("span",{className:"token line",parentName:"span"}," |- b-loader normal execution\n")),"|- a-loader normal execution")),(0,n.kt)("p",null,'那么，为什么 loader 可以利用 "pitching" 阶段呢？'),(0,n.kt)("p",null,"首先，传递给 ",(0,n.kt)("inlineCode",{parentName:"p"},"pitch")," 方法的 ",(0,n.kt)("inlineCode",{parentName:"p"},"data"),"，在执行阶段也会暴露在 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.data")," 之下，并且可以用于在循环时，捕获并共享前面的信息。"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someSyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"data",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"value",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\nmodule",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"pitch")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"remainingRequest",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," precedingRequest",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," data"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  data",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"value ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token number",parentName:"code"},"42"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"其次，如果某个 loader 在 ",(0,n.kt)("inlineCode",{parentName:"p"},"pitch")," 方法中给出一个结果，那么这个过程会回过身来，并跳过剩下的 loader。在我们上面的例子中，如果 ",(0,n.kt)("inlineCode",{parentName:"p"},"b-loader")," 的 ",(0,n.kt)("inlineCode",{parentName:"p"},"pitch")," 方法返回了一些东西："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token function",parentName:"code"},"someSyncOperation"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\nmodule",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"pitch")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"remainingRequest",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," precedingRequest",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},",")," data"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token function",parentName:"code"},"someCondition"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"\n      ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'module.exports = require('")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"+"),"\n      ",(0,n.kt)("span",{className:"token constant",parentName:"code"},"JSON"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"stringify"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'-!'")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"+")," remainingRequest",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"+"),"\n      ",(0,n.kt)("span",{className:"token string",parentName:"code"},"');'"),"\n    ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"上面的步骤将被缩短为："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-diff",parentName:"pre"},"|- a-loader `pitch`\n",(0,n.kt)("span",{className:"token unchanged",parentName:"code"},(0,n.kt)("span",{className:"token prefix unchanged",parentName:"span"}," "),(0,n.kt)("span",{className:"token line",parentName:"span"}," |- b-loader `pitch` returns a module\n")),"|- a-loader normal execution")),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"the-loader-context",parentName:"h2"}),"The Loader Context",(0,n.kt)("a",{href:"#the-loader-context","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"loader context 表示在 loader 内使用 ",(0,n.kt)("inlineCode",{parentName:"p"},"this")," 可以访问的一些方法或属性。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"example-for-the-loader-context",parentName:"h3"}),"loader 上下文示例",(0,n.kt)("a",{href:"#example-for-the-loader-context","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"下面提供一个例子，将使用 require 进行调用："),(0,n.kt)("p",null,"在 ",(0,n.kt)("inlineCode",{parentName:"p"},"/abc/file.js")," 中："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"require"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'./loader1?xyz!loader2!./resource?rrr'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisaddcontextdependency",parentName:"h3"}),"this.addContextDependency",(0,n.kt)("a",{href:"#thisaddcontextdependency","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"addContextDependency"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"directory",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"添加目录作为 loader 结果的依赖。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisadddependency",parentName:"h3"}),"this.addDependency",(0,n.kt)("a",{href:"#thisadddependency","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"addDependency"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"file",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\n",(0,n.kt)("span",{className:"token function",parentName:"code"},"dependency"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"file",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// shortcut"))),(0,n.kt)("p",null,"添加一个文件作为产生 loader 结果的依赖，使它们的任何变化可以被监听到。例如，",(0,n.kt)("a",{href:"https://github.com/webpack-contrib/sass-loader",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"sass-loader")),", ",(0,n.kt)("a",{href:"https://github.com/webpack-contrib/less-loader",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"less-loader"))," 就使用了这个技巧，当它发现无论何时导入的 ",(0,n.kt)("inlineCode",{parentName:"p"},"css")," 文件发生变化时就会重新编译。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisaddmissingdependency",parentName:"h3"}),"this.addMissingDependency",(0,n.kt)("a",{href:"#thisaddmissingdependency","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"addMissingDependency"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"file",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"添加一个不存在的文件作为 loader 结果的依赖项，以使它们可监听。类似于 ",(0,n.kt)("inlineCode",{parentName:"p"},"addDependency"),"，但是会在正确附加观察者之前处理在编译期间文件的创建。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisasync",parentName:"h3"}),"this.async",(0,n.kt)("a",{href:"#thisasync","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"告诉 ",(0,n.kt)("a",{href:"https://github.com/webpack/loader-runner",parentName:"p"},"loader-runner")," 这个 loader 将会异步地回调。返回 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.callback"),"。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thiscacheable",parentName:"h3"}),"this.cacheable",(0,n.kt)("a",{href:"#thiscacheable","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"设置是否可缓存标志的函数："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"cacheable"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"flag ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token boolean",parentName:"code"},"true"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"boolean"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"默认情况下，loader 的处理结果会被标记为可缓存。调用这个方法然后传入 ",(0,n.kt)("inlineCode",{parentName:"p"},"false"),"，可以关闭 loader 处理结果的缓存能力。"),(0,n.kt)("p",null,"一个可缓存的 loader 在输入和相关依赖没有变化时，必须返回相同的结果。这意味着 loader 除了 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.addDependency")," 里指定的以外，不应该有其它任何外部依赖。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thiscallback",parentName:"h3"}),"this.callback",(0,n.kt)("a",{href:"#thiscallback","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"可以同步或者异步调用的并返回多个结果的函数。预期的参数是："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-ts",parentName:"pre"},(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"\n  err",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," Error ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"|")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"null"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  content",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"|")," Buffer",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  sourceMap",(0,n.kt)("span",{className:"token operator",parentName:"code"},"?"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," SourceMap",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  meta",(0,n.kt)("span",{className:"token operator",parentName:"code"},"?"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"any"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"第一个参数必须是 ",(0,n.kt)("inlineCode",{parentName:"li"},"Error")," 或者 ",(0,n.kt)("inlineCode",{parentName:"li"},"null")),(0,n.kt)("li",{parentName:"ol"},"第二个参数是一个 ",(0,n.kt)("inlineCode",{parentName:"li"},"string")," 或者 ",(0,n.kt)("a",{href:"https://nodejs.org/api/buffer.html",parentName:"li"},(0,n.kt)("inlineCode",{parentName:"a"},"Buffer")),"。"),(0,n.kt)("li",{parentName:"ol"},"可选的：第三个参数必须是一个可以被 ",(0,n.kt)("a",{href:"https://github.com/mozilla/source-map",parentName:"li"},"this module")," 解析的 source map。"),(0,n.kt)("li",{parentName:"ol"},"可选的：第四个参数，会被 webpack 忽略，可以是任何东西（例如一些元数据）。")),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"如果希望在 loader 之间共享公共的 AST，可以将抽象语法树 AST（例如 ",(0,n.kt)("a",{href:"https://github.com/estree/estree",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"ESTree")),"）作为第四个参数（",(0,n.kt)("inlineCode",{parentName:"p"},"meta"),"）传递，以加快构建时间。")),(0,n.kt)("p",null,"如果这个函数被调用的话，你应该返回 undefined 从而避免含糊的 loader 结果。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thiscleardependencies",parentName:"h3"}),"this.clearDependencies",(0,n.kt)("a",{href:"#thiscleardependencies","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"clearDependencies"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"移除 loader 结果的所有依赖，甚至自己和其它 loader 的初始依赖。考虑使用 ",(0,n.kt)("inlineCode",{parentName:"p"},"pitch"),"。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thiscontext",parentName:"h3"}),"this.context",(0,n.kt)("a",{href:"#thiscontext","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"模块所在的目录")," 可以用作解析其他模块成员的上下文。"),(0,n.kt)("p",null,"在我们的 ",(0,n.kt)("a",{href:"#example-for-the-loader-context",parentName:"p"},"例子")," 中：因为 ",(0,n.kt)("inlineCode",{parentName:"p"},"resource.js")," 在这个目录中，这个属性的值为 ",(0,n.kt)("inlineCode",{parentName:"p"},"/abc")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisdata",parentName:"h3"}),"this.data",(0,n.kt)("a",{href:"#thisdata","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"在 pitch 阶段和 normal 阶段之间共享的 data 对象。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisemiterror",parentName:"h3"}),"this.emitError",(0,n.kt)("a",{href:"#thisemiterror","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"emitError"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"error",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," Error",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"emit 一个错误，也可以在输出中显示。"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-bash",parentName:"pre"},"ERROR ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"in")," ./src/lib.js ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"./src/loader.js",(0,n.kt)("span",{className:"token operator",parentName:"code"},"!"),"./src/lib.js",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\nModule Error ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"from ./src/loader.js",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),":\nHere is an Error",(0,n.kt)("span",{className:"token operator",parentName:"code"},"!"),"\n @ ./src/index.js ",(0,n.kt)("span",{className:"token number",parentName:"code"},"1"),":0-25")),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"与抛出错误中断运行不同，它不会中断当前模块的编译过程。")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisemitfile",parentName:"h3"}),"this.emitFile",(0,n.kt)("a",{href:"#thisemitfile","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"emitFile"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"name",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," content",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," Buffer",(0,n.kt)("span",{className:"token operator",parentName:"code"},"|"),(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," sourceMap",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),(0,n.kt)("span",{className:"token operator",parentName:"code"},"..."),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"产生一个文件。这是 webpack 特有的。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisemitwarning",parentName:"h3"}),"this.emitWarning",(0,n.kt)("a",{href:"#thisemitwarning","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"emitWarning"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"warning",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," Error",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"发出一个警告，在输出中显示如下："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-bash",parentName:"pre"},"WARNING ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"in")," ./src/lib.js ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"./src/loader.js",(0,n.kt)("span",{className:"token operator",parentName:"code"},"!"),"./src/lib.js",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\nModule Warning ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"from ./src/loader.js",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),":\nHere is a Warning",(0,n.kt)("span",{className:"token operator",parentName:"code"},"!"),"\n @ ./src/index.js ",(0,n.kt)("span",{className:"token number",parentName:"code"},"1"),":0-25")),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"请注意，如果 ",(0,n.kt)("inlineCode",{parentName:"p"},"stats.warnings")," 设置为 ",(0,n.kt)("inlineCode",{parentName:"p"},"false"),"，警告信息将不会显示。或者其他一些省略设置被用做 ",(0,n.kt)("inlineCode",{parentName:"p"},"status"),"，例如 ",(0,n.kt)("inlineCode",{parentName:"p"},"none")," 或者 ",(0,n.kt)("inlineCode",{parentName:"p"},"errors-only"),"。")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisfs",parentName:"h3"}),"this.fs",(0,n.kt)("a",{href:"#thisfs","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"用于访问 compilation 的 inputFileSystem 属性。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisgetoptionsschema",parentName:"h3"}),"this.getOptions(schema)",(0,n.kt)("a",{href:"#thisgetoptionsschema","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"提取给定的 loader 选项，接受一个可选的 JSON schema 作为参数"),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"从 webpack 5 开始，",(0,n.kt)("inlineCode",{parentName:"p"},"this.getOptions")," 可以获取到 loader 上下文对象。它用来替代来自 ",(0,n.kt)("a",{href:"https://github.com/webpack/loader-utils#getoptions",parentName:"p"},"loader-utils")," 中的 ",(0,n.kt)("inlineCode",{parentName:"p"},"getOptions")," 方法。")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisgetresolve",parentName:"h3"}),"this.getResolve",(0,n.kt)("a",{href:"#thisgetresolve","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"getResolve"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"options",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ResolveOptions",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," resolve\n\n",(0,n.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"context",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," result",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\n",(0,n.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"context",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"Promise"),(0,n.kt)("span",{className:"token operator",parentName:"code"},"<"),(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token operator",parentName:"code"},">"))),(0,n.kt)("p",null,"创建一个类似于 ",(0,n.kt)("a",{href:"#thisresolve",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"this.resolve"))," 的解析函数。"),(0,n.kt)("p",null,"在 webpack ",(0,n.kt)("a",{href:"/configuration/resolve/#resolve",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"resolve")," 选项")," 下的任意配置项都是可能的。他们会被合并进 ",(0,n.kt)("inlineCode",{parentName:"p"},"resolve")," 配置项中。请注意，",(0,n.kt)("inlineCode",{parentName:"p"},'"..."')," 可以在数组中使用，用于拓展 ",(0,n.kt)("inlineCode",{parentName:"p"},"resolve")," 配置项的值。例如：",(0,n.kt)("inlineCode",{parentName:"p"},'{ extensions: [".sass", "..."] }'),"。"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"options.dependencyType")," 是一个额外的配置。它允许我们指定依赖类型，用于从 ",(0,n.kt)("inlineCode",{parentName:"p"},"resolve")," 配置项中解析 ",(0,n.kt)("inlineCode",{parentName:"p"},"byDependency"),"。"),(0,n.kt)("p",null,"解析操作的所有依赖项都会自动作为依赖项添加到当前模块中。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thishot",parentName:"h3"}),"this.hot",(0,n.kt)("a",{href:"#thishot","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"loaders 的 HMR（模块热替换）相关信息。"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  console",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"log"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"hot",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";")," ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// true if HMR is enabled via --hot flag or webpack configuration"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisimportmodule",parentName:"h3"}),"this.importModule",(0,n.kt)("a",{href:"#thisimportmodule","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)(o,{text:"5.32.0+",mdxType:"Badge"}),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"this.importModule(request, options, [callback]): Promise")),(0,n.kt)("p",null,"一种可以选择的轻量级解决方案，用于子编译器在构建时编译和执行请求。"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"request"),": 加载模块的请求字符串"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"options"),":",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"layer"),"：指定该模块放置/编译的层"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"publicPath"),"：用于构建模块的公共路径"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"callback"),"：一个可选的 Node.js 风格的回调，返回模块的 exports 或 ESM 的命名空间对象。如果没有提供回调，",(0,n.kt)("inlineCode",{parentName:"li"},"importModule"),"将返回一个 Promise。")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"webpack.config.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  module",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    rules",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n      ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n        test",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token regex",parentName:"code"},"/stylesheet\\.js$/i"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        use",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,n.kt)("span",{className:"token string",parentName:"code"},"'./a-pitching-loader.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        type",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'asset/source'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// 我们将 type 设置为 'asset/source'，其会返回一个字符串。"),"\n      ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"a-pitching-loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},"exports",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"pitch")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"async")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"remaining"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"const")," result ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"await")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"importModule"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"resourcePath ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"+")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'.webpack[javascript/auto]'")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"+")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'!=!'")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"+")," remaining\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," result",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"default ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"||")," result",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"src/stylesheet.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,n.kt)("span",{className:"token keyword",parentName:"code"},"import")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{")," green",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," red ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'./colors.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"default")," ",(0,n.kt)("span",{className:"token template-string",parentName:"code"},(0,n.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,n.kt)("span",{className:"token string",parentName:"span"},"body { background: "),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),"red",(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token string",parentName:"span"},"; color: "),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),"green",(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token string",parentName:"span"},"; }"),(0,n.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"src/colors.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,n.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"const")," red ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'#f00'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"const")," green ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'#0f0'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"src/index.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,n.kt)("span",{className:"token keyword",parentName:"code"},"import")," stylesheet ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'./stylesheet.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// stylesheet 在构建时会成为一个字符串：`body { background: #f00; color: #0f0; }`。"))),(0,n.kt)("p",null,"在上面的例子中你可能会注意到一些东西："),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"我们有一个 ",(0,n.kt)("a",{href:"#pitching-loader",parentName:"li"},"pitching loader"),"，"),(0,n.kt)("li",{parentName:"ol"},"我们在 pitching loader 中使用 ",(0,n.kt)("inlineCode",{parentName:"li"},"!=!")," 语法来为请求设置 ",(0,n.kt)("a",{href:"#inline-matchresource",parentName:"li"},"matchResource"),"，例如，我们将使用 ",(0,n.kt)("inlineCode",{parentName:"li"},"this.resourcePath + '.webpack[javascript/auto]'")," 而不是原始资源匹配 ",(0,n.kt)("a",{href:"/configuration/module/#modulerules",parentName:"li"},(0,n.kt)("inlineCode",{parentName:"a"},"module.rules")),"，"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},".webpack[javascript/auto]")," 是 ",(0,n.kt)("inlineCode",{parentName:"li"},".webpack[type]")," 模式的伪拓展，当没有指定其他模块类型时，我们使用它指定一个默认 ",(0,n.kt)("a",{href:"/configuration/module/#ruletype",parentName:"li"},"模块类型"),"，它通常和 ",(0,n.kt)("inlineCode",{parentName:"li"},"!=!")," 语法一起使用。")),(0,n.kt)("p",null,"注意，上面的示例是一个简化的示例，你可以查看 ",(0,n.kt)("a",{href:"https://github.com/webpack/webpack/tree/master/test/configCases/loader-import-module/css",parentName:"p"},"webpack 仓库的完整示例"),"。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisloaderindex",parentName:"h3"}),"this.loaderIndex",(0,n.kt)("a",{href:"#thisloaderindex","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"当前 loader 在 loader 数组中的索引。"),(0,n.kt)("p",null,"在",(0,n.kt)("a",{href:"#example-for-the-loader-context",parentName:"p"},"示例"),"中：loader1 中得到：",(0,n.kt)("inlineCode",{parentName:"p"},"0"),"，loader2 中得到：",(0,n.kt)("inlineCode",{parentName:"p"},"1")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisloadmodule",parentName:"h3"}),"this.loadModule",(0,n.kt)("a",{href:"#thisloadmodule","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"loadModule"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," sourceMap",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"module"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"解析给定的 request 到模块，应用所有配置的 loader，并且在回调函数中传入生成的 source、sourceMap 和模块实例（通常是 ",(0,n.kt)("a",{href:"https://github.com/webpack/webpack/blob/master/lib/NormalModule.js",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"NormalModule"))," 的一个实例）。如果你需要获取其他模块的源代码来生成结果的话，你可以使用这个函数。"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"this.loadModule")," 在 loader 上下文中默认使用 CommonJS 来解析规则。用一个合适的 ",(0,n.kt)("inlineCode",{parentName:"p"},"dependencyType")," 使用 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.getResolve"),"。例如，在使用不同的语义之前使用 ",(0,n.kt)("inlineCode",{parentName:"p"},"'esm'"),"、",(0,n.kt)("inlineCode",{parentName:"p"},"'commonjs'")," 或者一个自定义的。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisloaders",parentName:"h3"}),"this.loaders",(0,n.kt)("a",{href:"#thisloaders","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"所有 loader 组成的数组。它在 pitch 阶段的时候是可以写入的。"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-ts",parentName:"pre"},"loaders ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," path",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," query",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"module"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"))),(0,n.kt)("p",null,"在此",(0,n.kt)("a",{href:"#example-for-the-loader-context",parentName:"p"},"示例"),"中："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'/abc/loader1.js?xyz'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    path",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'/abc/loader1.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    query",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'?xyz'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    module",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),"Function",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'/abc/node_modules/loader2/index.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    path",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'/abc/node_modules/loader2/index.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    query",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"''"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    module",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),"Function",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thismode",parentName:"h3"}),"this.mode",(0,n.kt)("a",{href:"#thismode","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"当 webpack 运行时读取 ",(0,n.kt)("a",{href:"/configuration/mode/",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"mode"))," 的值"),(0,n.kt)("p",null,"可能的值为：",(0,n.kt)("inlineCode",{parentName:"p"},"'production'"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"'development'"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"'none'")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisquery",parentName:"h3"}),"this.query",(0,n.kt)("a",{href:"#thisquery","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"如果这个 loader 配置了 ",(0,n.kt)("a",{href:"/configuration/module/#useentry",parentName:"li"},(0,n.kt)("inlineCode",{parentName:"a"},"options"))," 对象的话，this 就指向这个对象。"),(0,n.kt)("li",{parentName:"ol"},"如果 loader 中没有 ",(0,n.kt)("inlineCode",{parentName:"li"},"options"),"，而是以 query 字符串作为参数调用时，this.query 就是一个以 ",(0,n.kt)("inlineCode",{parentName:"li"},"?")," 开头的字符串。")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisrequest",parentName:"h3"}),"this.request",(0,n.kt)("a",{href:"#thisrequest","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"被解析出来的 request 字符串。"),(0,n.kt)("p",null,"在我们的",(0,n.kt)("a",{href:"#example-for-the-loader-context",parentName:"p"},"示例"),"中：",(0,n.kt)("inlineCode",{parentName:"p"},"'/abc/loader1.js?xyz!/abc/node_modules/loader2/index.js!/abc/resource.js?rrr'")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisresolve",parentName:"h3"}),"this.resolve",(0,n.kt)("a",{href:"#thisresolve","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-typescript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"context",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," request",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," result",(0,n.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,n.kt)("span",{className:"token builtin",parentName:"code"},"string"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"))),(0,n.kt)("p",null,"像 require 表达式一样解析一个 request。"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"context")," 必须是一个目录的绝对路径。此目录用作解析的起始位置。"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"request")," 是要被解析的 request。通常情况下，像 ",(0,n.kt)("inlineCode",{parentName:"li"},"./relative")," 的相对请求或者像 ",(0,n.kt)("inlineCode",{parentName:"li"},"module/path")," 的模块请求会被使用，但是像 ",(0,n.kt)("inlineCode",{parentName:"li"},"/some/path")," 也有可能被当做 request。"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"callback")," 是一个给出解析路径的 Node.js 风格的回调函数。")),(0,n.kt)("p",null,"解析操作的所有依赖项都会自动作为依赖项添加到当前模块中。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisresource",parentName:"h3"}),"this.resource",(0,n.kt)("a",{href:"#thisresource","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"request 中的资源部分，包括 query 参数。"),(0,n.kt)("p",null,"在",(0,n.kt)("a",{href:"#example-for-the-loader-context",parentName:"p"},"示例"),"中：",(0,n.kt)("inlineCode",{parentName:"p"},"'/abc/resource.js?rrr'")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisresourcepath",parentName:"h3"}),"this.resourcePath",(0,n.kt)("a",{href:"#thisresourcepath","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"资源文件的路径。"),(0,n.kt)("p",null,"在【示例](#example-for-the-loader-context)中：",(0,n.kt)("inlineCode",{parentName:"p"},"'/abc/resource.js'")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisresourcequery",parentName:"h3"}),"this.resourceQuery",(0,n.kt)("a",{href:"#thisresourcequery","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"资源的 query 参数。"),(0,n.kt)("p",null,"在",(0,n.kt)("a",{href:"#example-for-the-loader-context",parentName:"p"},"示例"),"中：",(0,n.kt)("inlineCode",{parentName:"p"},"'?rrr'")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisrootcontext",parentName:"h3"}),"this.rootContext",(0,n.kt)("a",{href:"#thisrootcontext","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"从 webpack 4 开始，原先的 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.options.context")," 被改为 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.rootContext"),"。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thissourcemap",parentName:"h3"}),"this.sourceMap",(0,n.kt)("a",{href:"#thissourcemap","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"是否应该生成一个 source map。因为生成 source map 可能会非常耗时，你应该确认 source map 确实需要。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thistarget",parentName:"h3"}),"this.target",(0,n.kt)("a",{href:"#thistarget","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"compilation 的目标。从配置选项中传递。"),(0,n.kt)("p",null,"示例：'",(0,n.kt)("inlineCode",{parentName:"p"},"web'"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"'node'")),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisutils",parentName:"h3"}),"this.utils",(0,n.kt)("a",{href:"#thisutils","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)(o,{text:"5.27.0+",mdxType:"Badge"}),(0,n.kt)("p",null,"可以访问 ",(0,n.kt)("inlineCode",{parentName:"p"},"contextify")," 与 ",(0,n.kt)("inlineCode",{parentName:"p"},"absolutify")," 功能。"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"contextify"),": 返回一个新的请求字符串，尽可能避免使用绝对路径。"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"absolutify"),": 尽可能使用相对路径返回一个新的请求字符串。")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"my-sync-loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-js",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"content"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"utils",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"contextify"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"context",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"utils",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"absolutify"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"context",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'./index.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"utils",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"absolutify"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"context",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),"resourcePath",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"// …"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," content",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisversion",parentName:"h3"}),"this.version",(0,n.kt)("a",{href:"#thisversion","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"loader API 的版本号")," 目前是 ",(0,n.kt)("inlineCode",{parentName:"p"},"2"),"。这对于向后兼容性有一些用处。通过这个版本号，你可以自定义逻辑或者降级处理。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thiswebpack",parentName:"h3"}),"this.webpack",(0,n.kt)("a",{href:"#thiswebpack","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"如果是由 webpack 编译的，这个布尔值会被设置为 true。"),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"loader 最初被设计为可以同时当 Babel transform 用。如果你编写了一个 loader 可以同时兼容二者，那么可以使用这个属性了解是否存在可用的 loaderContext 和 webpack 特性。")),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"webpack-specific-properties",parentName:"h2"}),"Webpack 特有属性",(0,n.kt)("a",{href:"#webpack-specific-properties","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"loader 接口提供所有模块的相关信息。然而，在极少数情况下，你可能需要访问 compiler api 本身。"),(0,n.kt)("aside",{className:"warning"},(0,n.kt)("h6",{className:"warning__prefix",parentName:"aside"},"警告"),(0,n.kt)("p",{parentName:"aside"},"请注意，使用这些 webpack 特定的属性会对 loader 的兼容性产生负面影响。")),(0,n.kt)("p",null,"因此，你应该把它们作为最后的手段。使用它们将降低 loader 的可移植性。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"this_compilation",parentName:"h3"}),"this._compilation",(0,n.kt)("a",{href:"#this_compilation","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"用于访问 webpack 的当前 Compilation 对象。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"this_compiler",parentName:"h3"}),"this._compiler",(0,n.kt)("a",{href:"#this_compiler","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"用于访问 webpack 的当前 Compiler 对象。"),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"deprecated-context-properties",parentName:"h2"}),"过时的上下文属性",(0,n.kt)("a",{href:"#deprecated-context-properties","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"由于我们计划将这些属性从上下文中移除，因此不鼓励使用这些属性。它们仍然列在这里，以备参考。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisdebug",parentName:"h3"}),"this.debug",(0,n.kt)("a",{href:"#thisdebug","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"一个布尔值，当处于 debug 模式时为 true。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisinputvalue",parentName:"h3"}),"this.inputValue",(0,n.kt)("a",{href:"#thisinputvalue","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"从上一个 loader 那里传递过来的值。如果你会以模块的方式处理输入参数，建议预先读入这个变量（为了性能因素）。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisminimize",parentName:"h3"}),"this.minimize",(0,n.kt)("a",{href:"#thisminimize","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"决定处理结果是否应该被压缩。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"thisvalue",parentName:"h3"}),"this.value",(0,n.kt)("a",{href:"#thisvalue","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"向下一个 loader 传值。如果你知道了作为模块执行后的结果，请在这里赋值（以元素数组的形式）。"),(0,n.kt)("h3",null,(0,n.kt)("span",{id:"this_module",parentName:"h3"}),"this._module",(0,n.kt)("a",{href:"#this_module","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"一种 hack 写法。用于访问当前加载的 Module 对象。"),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"error-reporting",parentName:"h2"}),"错误报告",(0,n.kt)("a",{href:"#error-reporting","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"您可以通过以下方式从 loader 内部报告错误："),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"使用 ",(0,n.kt)("a",{href:"/api/loaders/#thisemiterror",parentName:"li"},"this.emitError"),". 将在不中断模块编译的情况下报告错误。"),(0,n.kt)("li",{parentName:"ul"},"使用 ",(0,n.kt)("inlineCode",{parentName:"li"},"throw"),"（或其他未捕获的意外异常）。loader 运行时引发错误将导致当前模块编译失败。"),(0,n.kt)("li",{parentName:"ul"},"使用 ",(0,n.kt)("inlineCode",{parentName:"li"},"callback"),"（异步模式）。向回调传递错误也会导致模块编译失败。")),(0,n.kt)("p",null,"示例："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"./src/index.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},(0,n.kt)("span",{className:"token function",parentName:"code"},"require"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'./loader!./lib'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"从 loader 当中抛出错误："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"./src/loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"throw")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"new")," ",(0,n.kt)("span",{className:"token class-name",parentName:"code"},"Error"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'This is a Fatal Error!'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"或者在异步模式下，传入一个错误给 callback："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"./src/loader.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"const")," callback ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"async"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token comment",parentName:"code"},"//..."),"\n  ",(0,n.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token keyword",parentName:"code"},"new")," ",(0,n.kt)("span",{className:"token class-name",parentName:"code"},"Error"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'This is a Fatal Error!'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"这个模块将获取像下面的 bundle："),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-text",parentName:"pre"},'/***/ "./src/loader.js!./src/lib.js":\n/*!************************************!*\\\n  !*** ./src/loader.js!./src/lib.js ***!\n  \\************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nthrow new Error("Module build failed (from ./src/loader.js):\\nError: This is a Fatal Error!\\n    at Object.module.exports (/workspace/src/loader.js:3:9)");\n\n/***/ })\n')),(0,n.kt)("p",null,"然后构建输出结果将显示错误，与 ",(0,n.kt)("inlineCode",{parentName:"p"},"this.emitError")," 相似:"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-bash",parentName:"pre"},"ERROR ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"in")," ./src/lib.js ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"./src/loader.js",(0,n.kt)("span",{className:"token operator",parentName:"code"},"!"),"./src/lib.js",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\nModule build failed ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"from ./src/loader.js",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),":\nError: This is a Fatal Error",(0,n.kt)("span",{className:"token operator",parentName:"code"},"!"),"\n    at Object.module.exports ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"/workspace/src/loader.js:2:9",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\n @ ./src/index.js ",(0,n.kt)("span",{className:"token number",parentName:"code"},"1"),":0-25")),(0,n.kt)("p",null,"如下所示，不仅有错误消息，还提供了有关所涉及的 loader 和模块的详细信息："),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"模块路径：",(0,n.kt)("inlineCode",{parentName:"li"},"ERROR in ./src/lib.js")),(0,n.kt)("li",{parentName:"ul"},"request 字符串：",(0,n.kt)("inlineCode",{parentName:"li"},"(./src/loader.js!./src/lib.js)")),(0,n.kt)("li",{parentName:"ul"},"loader 路径：",(0,n.kt)("inlineCode",{parentName:"li"},"(from ./src/loader.js)")),(0,n.kt)("li",{parentName:"ul"},"调用路径：",(0,n.kt)("inlineCode",{parentName:"li"},"@ ./src/index.js 1:0-25"))),(0,n.kt)("aside",{className:"warning"},(0,n.kt)("h6",{className:"warning__prefix",parentName:"aside"},"警告"),(0,n.kt)("p",{parentName:"aside"},"从 webpack 4.12 开始，loader 路径将在报错信息中显示。")),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"所有的报错和警告信息将被记录到 ",(0,n.kt)("inlineCode",{parentName:"p"},"stats")," 当中。详情请查看 ",(0,n.kt)("a",{href:"/api/stats/#errors-and-warnings",parentName:"p"},"Stats Data"),"。")),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"inline-matchresource",parentName:"h2"}),"Inline matchResource",(0,n.kt)("a",{href:"#inline-matchresource","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"在 webpack v4 中引入了一种新的内联请求语法。前缀为 ",(0,n.kt)("inlineCode",{parentName:"p"},"<match-resource>!=!")," 将为此请求设置 ",(0,n.kt)("inlineCode",{parentName:"p"},"matchResource"),"。"),(0,n.kt)("aside",{className:"warning"},(0,n.kt)("h6",{className:"warning__prefix",parentName:"aside"},"警告"),(0,n.kt)("p",{parentName:"aside"},"不建议在应用程序代码中使用此语法。\n内联请求语法仅用于 loader 生成的代码。\n不遵循此建议将使您的代码不遵循 webpack 标准和规范。")),(0,n.kt)("aside",{className:"tip"},(0,n.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,n.kt)("p",{parentName:"aside"},"相对的 ",(0,n.kt)("inlineCode",{parentName:"p"},"matchResource")," 将相对包含模块的当前上下文进行解析。")),(0,n.kt)("p",null,"当 ",(0,n.kt)("inlineCode",{parentName:"p"},"matchResource")," 被设置时，它将会被用作匹配 ",(0,n.kt)("a",{href:"/configuration/module/#modulerules",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"module.rules"))," 而不是源文件。如果需要对资源应用进一步的 loader，或者需要更改模块类型，这可能会很有用。 它也显示在统计数据中，用于匹配 ",(0,n.kt)("a",{href:"/configuration/module/#ruleissuer",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"Rule.issuer"))," 和 ",(0,n.kt)("a",{href:"/plugins/split-chunks-plugin/#splitchunkscachegroupscachegrouptest",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"test")," in ",(0,n.kt)("inlineCode",{parentName:"a"},"splitChunks")),"。"),(0,n.kt)("p",null,"示例："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"file.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},(0,n.kt)("span",{className:"token comment",parentName:"code"},"/* STYLE: body { background: red; } */"),"\nconsole",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"log"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'yep'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"loader 可以将文件转换为以下文件，并使用 ",(0,n.kt)("inlineCode",{parentName:"p"},"matchResource")," 应用用户指定的 CSS 处理规则："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"file.js")," (transformed by loader)"),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},(0,n.kt)("span",{className:"token keyword",parentName:"code"},"import")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"'./file.js.css!=!extract-style-loader/getStyles!./file.js'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\nconsole",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"log"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'yep'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,"这将会向 ",(0,n.kt)("inlineCode",{parentName:"p"},"extract-style-loader/getStyles!./file.js")," 中添加一个依赖，并将结果视为 ",(0,n.kt)("inlineCode",{parentName:"p"},"file.js.css"),"。因为 ",(0,n.kt)("a",{href:"/configuration/module/#modulerules",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"module.rules"))," 有一条匹配 ",(0,n.kt)("inlineCode",{parentName:"p"},"/\\.css$/")," 的规则，并且将会应用到依赖中。"),(0,n.kt)("p",null,"这个 loader 就像是这样："),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"extract-style-loader/index.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},(0,n.kt)("span",{className:"token keyword",parentName:"code"},"const")," getStylesLoader ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," require",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token string",parentName:"code"},"'./getStyles'"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\nmodule",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token constant",parentName:"code"},"STYLES_REGEXP"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"test"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),"source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    source ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"replace"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token constant",parentName:"code"},"STYLES_REGEXP"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,n.kt)("span",{className:"token string",parentName:"code"},"''"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,n.kt)("span",{className:"token template-string",parentName:"code"},(0,n.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,n.kt)("span",{className:"token string",parentName:"span"},"import "),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),(0,n.kt)("span",{className:"token constant",parentName:"span"},"JSON"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),(0,n.kt)("span",{className:"token function",parentName:"span"},"stringify"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"("),"\n      ",(0,n.kt)("span",{className:"token keyword",parentName:"span"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),"utils",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),(0,n.kt)("span",{className:"token function",parentName:"span"},"contextify"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"("),"\n        ",(0,n.kt)("span",{className:"token keyword",parentName:"span"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),"context ",(0,n.kt)("span",{className:"token operator",parentName:"span"},"||")," ",(0,n.kt)("span",{className:"token keyword",parentName:"span"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),"rootContext",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},","),"\n        ",(0,n.kt)("span",{className:"token template-string",parentName:"span"},(0,n.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),(0,n.kt)("span",{className:"token keyword",parentName:"span"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),"resource",(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token string",parentName:"span"},".css!=!"),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),"getStylesLoader",(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token string",parentName:"span"},"!"),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),(0,n.kt)("span",{className:"token keyword",parentName:"span"},"this"),(0,n.kt)("span",{className:"token punctuation",parentName:"span"},"."),"remainingRequest",(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),"\n      ",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},")"),"\n    ",(0,n.kt)("span",{className:"token punctuation",parentName:"span"},")"),(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token string",parentName:"span"},";"),(0,n.kt)("span",{className:"token interpolation",parentName:"span"},(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),"source",(0,n.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,n.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"extract-style-loader/getStyles.js")),(0,n.kt)("pre",null,(0,n.kt)("code",{className:"hljs language-javascript",parentName:"pre"},"module",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"const")," match ",(0,n.kt)("span",{className:"token operator",parentName:"code"},"=")," source",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,n.kt)("span",{className:"token function",parentName:"code"},"match"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,n.kt)("span",{className:"token constant",parentName:"code"},"STYLES_REGEXP"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,n.kt)("span",{className:"token keyword",parentName:"code"},"return")," match",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,n.kt)("span",{className:"token number",parentName:"code"},"0"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,n.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,n.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,n.kt)("h2",null,(0,n.kt)("span",{id:"logging",parentName:"h2"}),"Logging",(0,n.kt)("a",{href:"#logging","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,n.kt)("span",{className:"header-link",parentName:"a"}))),(0,n.kt)("p",null,"自 webpack 4.37 发布以来，Logging API 就可用了。当 ",(0,n.kt)("a",{href:"/configuration/stats/#statslogging",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"stats configuration"))," 或者 ",(0,n.kt)("a",{href:"/configuration/other-options/#infrastructurelogging",parentName:"p"},(0,n.kt)("inlineCode",{parentName:"a"},"infrastructure logging"))," 中启用 ",(0,n.kt)("inlineCode",{parentName:"p"},"logging")," 时，loader 可以记录消息，这些消息将以相应的日志格式（stats，infrastructure）打印出来。"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Loaders 最好使用 ",(0,n.kt)("inlineCode",{parentName:"li"},"this.getLogger()")," 进行日志记录，这是指向 ",(0,n.kt)("inlineCode",{parentName:"li"},"compilation.getLogger()")," 具有 loader 路径和已处理的文件。这种日志记录被存储到 Stats 中并相应地格式化。它可以被 webpack 用户过滤和导出。"),(0,n.kt)("li",{parentName:"ul"},"Loaders 可以使用 ",(0,n.kt)("inlineCode",{parentName:"li"},"this.getLogger('name')")," 获取具有子名称的独立记录器。仍会添加 loader 路径和已处理的文件。"),(0,n.kt)("li",{parentName:"ul"},"Loaders 可以使用特殊的回退逻辑来检测日志支持 ",(0,n.kt)("inlineCode",{parentName:"li"},"this.getLogger() ? this.getLogger() : console"),"。在使用不支持 ",(0,n.kt)("inlineCode",{parentName:"li"},"getLogger")," 方法的旧 webpack 版本时提供回退方法。")))}r.isMDXComponent=!0,a.default=r}}]);