<!DOCTYPE html><html lang="zh-cmn-Hans"><head><title data-rh="true">Combined printable page | webpack 中文文档</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="theme-color" content="#2B3A42"/><meta data-rh="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-rh="true" name="robots" content="noindex,nofollow"/><meta data-rh="true" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:site_name" content="webpack"/><meta data-rh="true" property="og:type" content="website"/><meta data-rh="true" property="og:title" content="Combined printable page | webpack 中文文档"/><meta data-rh="true" property="og:description" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:image" content="https://webpack.js.org/icon-pwa-512x512.d3dae4189855b3a72ff9.png"/><meta data-rh="true" property="twitter:card" content="summary"/><meta data-rh="true" property="twitter:site" content="@webpack"/><meta data-rh="true" property="twitter:creator" content="@webpack"/><meta data-rh="true" property="twitter:domain" content="https://webpack.js.org/"/><meta data-rh="true" name="keywords" content="webpack5, webpack, webpack 中文文档, webpack 官方中文, webpack 5 官方中文, 印记中文, docschina, docschina.org, webpack.docschina.org, doc.react-china.org, nodejs.cn, vue.docschina.org, babel.docschina.org, parceljs.docschina.org, rollup.docschina.org, koajs.docschina.org"/><meta data-rh="true" name="mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-status-bar-style" content="black"/><meta data-rh="true" name="apple-mobile-web-app-title" content="webpack"/><meta data-rh="true" name="msapplication-TileImage" content="/icon_150x150.png"/><meta data-rh="true" name="msapplication-TileColor" content="#465e69"/><link data-rh="true" rel="icon" type="image/x-icon" href="/favicon.f326220248556af65f41.ico"/><link data-rh="true" rel="manifest" href="/manifest.json"/><link data-rh="true" rel="canonical" href="https://webpack.docschina.org/guides/printable/"/><link data-rh="true" rel="icon" sizes="192x192" href="/icon_192x192.png"/><link data-rh="true" rel="icon" sizes="512x512" href="/icon_512x512.png"/><link data-rh="true" rel="apple-touch-icon" href="/icon_180x180.png"/><link data-rh="true" rel="mask-icon" href="/logo-on-white-bg.47eff95f9c01c5972f6f.svg" color="#465e69"/><link rel="stylesheet" href=/index.c114afea0778b47a418a.css /><link rel="stylesheet" href=/9517.acfe42251eae743e4e22.css /></head><body><div id="root"><div class="site"><div class="site__header"><header class="bg-blue-800 dark:bg-gray-900"><div class="flex items-center py-10 px-[16px] justify-between md:px-[24px] md:max-w-[1024px] md:mx-auto md:justify-start"><button class="bg-transparent border-none md:hidden"><svg viewBox="-62 138 25 25" width="20" height="20" class="fill-current text-white"><path fill="currentColor" d="M-60.2 140.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8M-60.2 148.7h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8M-60.2 157.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8"></path></svg></button><a class="md:mr-auto" href="/"><img class="logo" src="/site-logo.1fcab817090e78435061.svg" alt="webpack logo" width="122" height="35"/></a><nav class="hidden md:inline-grid md:grid-flow-col md:gap-x-[18px]"><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/concepts/">中文文档</a><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/contribute/">参与贡献</a><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/blog/">博客</a><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200">印记中文</a><a href="https://github.com/webpack/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on GitHub"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 6.8 9.5c.5 0 .7-.2.7-.5v-1.7C6.7 20 6.1 18 6.1 18c-.4-1.2-1-1.5-1-1.5-1-.6 0-.6 0-.6 1 0 1.5 1 1.5 1 .9 1.6 2.4 1.1 3 .9 0-.7.3-1.1.6-1.4-2.2-.2-4.6-1-4.6-4.9 0-1.1.4-2 1-2.7 0-.3-.4-1.3.2-2.7 0 0 .8-.2 2.7 1a9.4 9.4 0 0 1 5 0c2-1.2 2.8-1 2.8-1 .5 1.4.1 2.4 0 2.7.7.7 1 1.6 1 2.7 0 3.8-2.3 4.7-4.5 5 .4.2.7.8.7 1.8V21c0 .3.2.6.7.5 4-1.3 6.8-5 6.8-9.5A10 10 0 0 0 12 2"></path></svg></a><a href="https://twitter.com/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" aria-hidden="true" fill="currentColor" width="16"><path d="M28 6.937c-.957.425-1.985.711-3.064.84a5.343 5.343 0 0 0 2.345-2.951 10.696 10.696 0 0 1-3.388 1.295 5.334 5.334 0 0 0-9.089 4.864A15.143 15.143 0 0 1 3.809 5.411a5.321 5.321 0 0 0-.721 2.683 5.33 5.33 0 0 0 2.372 4.439 5.323 5.323 0 0 1-2.416-.667v.067a5.335 5.335 0 0 0 4.279 5.23 5.336 5.336 0 0 1-2.409.092 5.34 5.34 0 0 0 4.983 3.705 10.699 10.699 0 0 1-6.625 2.284c-.43 0-.855-.025-1.273-.075a15.102 15.102 0 0 0 8.177 2.396c9.812 0 15.176-8.128 15.176-15.177 0-.231-.005-.461-.015-.69A10.855 10.855 0 0 0 28 6.937z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on StackOverflow"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M17.4 20.2v-5.4h1.8V22H3v-7.2h1.8v5.4zM6.8 14.3l.3-1.7 8.8 1.8-.3 1.8zm1.1-4.2.8-1.6 8.1 3.8-.7 1.6zm2.3-4 1.1-1.4 7 5.8-1.2 1.4L10 6m4.7-4L20 9l-1.4 1-5.4-7 1.4-1m-8 16.5v-1.8h9v1.8z"></path></svg></a><nav class="dropdown "><button aria-haspopup="true" aria-expanded="false" aria-label="Select language"><svg viewBox="0 0 610 560" xmlns="http://www.w3.org/2000/svg" class="dropdown__language text-gray-100 hover:text-blue-200 transition-colors duration-200"><path d="m304.8 99.2-162.5-57.3v353.6l162.5-52.6z"></path><path d="m300.9 99 168.7-57.3v353.6l-168.7-52.5zm-200.7 358.4 200.7-66.9v-291.5l-200.7 66.9z" fill="currentColor"></path><path d="m392.4 461.8 28.4 46.8 15-43.5zm-223.9-262.3c-1.1-1 1.4 8.6 4.8 12 6.1 6.1 10.8 6.9 13.3 7 5.6.2 12.5-1.4 16.5-3.1s10.9-5.2 13.5-10.4c.6-1.1 2.1-3 1.1-7.5-.7-3.5-3-4.8-5.7-4.6s-11 2.4-15 3.6-12.2 3.7-15.8 4.5-11.5-.3-12.7-1.5zm101.2 114.8c-1.6-.6-34.3-14.1-38.9-16.4a368 368 0 0 0 -17.5-7.5c12.3-19 20.1-33.4 21.2-35.6 1.9-4 15-29.5 15.3-31.1s.7-7.5.4-8.9-5.1 1.3-11.6 3.5-18.9 10.2-23.7 11.2-20.1 6.8-28 9.4c-7.8 2.6-22.7 7.1-28.8 8.8-6.1 1.6-11.4 1.8-14.9 2.8 0 0 .5 4.8 1.4 6.2s4.1 5 7.9 5.9c3.8 1 10 .6 12.8-.1s7.7-3.1 8.4-4.1c.7-1.1-.3-4.3.8-5.3s16.1-4.5 21.7-6.2 27.2-9.2 30.1-8.8a916 916 0 0 1 -23.9 47.7 821 821 0 0 1 -45 63.3c-5.3 6-18 21.5-22.4 25 1.1.3 9-.4 10.4-1.3 8.9-5.5 23.8-24.1 28.6-29.7a489.1 489.1 0 0 0 36.7-49.4c1.9.8 17.6 13.6 21.7 16.4a293 293 0 0 0 23.7 13.3c3.5 1.5 16.9 7.7 17.5 5.6.7-1.8-2.3-14.1-3.9-14.7z"></path><path clip-rule="evenodd" d="m194.1 484.7a204.9 204.9 0 0 0 30.7 14.5 233.6 233.6 0 0 0 46.4 12c.5 0 16 1.9 19.2 1.9h15.7c6.1-.5 11.8-.9 17.9-1.7 4.9-.7 10.3-1.6 15.5-2.8 3.8-.9 7.8-1.7 11.7-3 3.7-1 7.8-2.4 11.8-3.8l8.2-3.1c2.3-1 5.1-2.3 7.7-3.3a243 243 0 0 0 19.2-10c2.3-1.2 7.5-5.2 10.3-5.2 3.1 0 5.2 2.8 5.2 5.2 0 5.1-6.8 6.6-9.9 8.9-3.3 2.3-7.3 4-10.8 5.9-7 3.7-14.1 6.8-20.9 9.4a251 251 0 0 1 -27.3 8.5c-3.3.7-6.6 1.6-9.9 2.1-1.7.3-19.9 3.1-24.9 3.1h-23a293.9 293.9 0 0 1 -35.1-5.2 196 196 0 0 1 -33.1-10.3c-12-4.5-24.6-10.5-36.4-18.3-2.1-1.4-2.3-2.8-2.3-4.4a5 5 0 0 1 5.1-5.1c2.4.1 8 4.2 9 4.7zm101.4-98.1-189.9 63.2v-280.1l189.9-63.2zm10.6-288.3v292.7a6 6 0 0 1 -1.2 2.6c-.3.5-1 1.2-1.6 1.4a14621 14621 0 0 1 -203.1 67.6c-2.1 0-4-1.4-5.1-3.7 0-.2-.2-.3-.2-.7v-292.8c.3-.9.5-2.1 1.2-2.8 1.4-1.9 3.8-2.3 5.4-2.8 3-1 196.1-65.8 198.9-65.8 1.9 0 5.7 1.2 5.7 4.3z" fill-rule="evenodd"></path><path clip-rule="evenodd" d="m464.3 388-158-49.1v-236l158-53.7zm10.6-345.8v352.4c-.2 4-3 5.7-5.6 5.7-2.3 0-18.6-5.6-21.4-6.4l-65.8-20.4-14.6-4.7-12.9-4c-18.6-5.7-37.6-11.5-56.3-17.8-.7-.2-2.4-2.6-2.4-3.1v-246.1c.3-.9.7-1.9 1.6-2.6 1.4-1.6 61.1-21.4 84.7-29.3 6.3-2.3 84.8-29.3 87.3-29.3 3 .1 5.4 2.3 5.4 5.6z" fill-rule="evenodd"></path><path d="m515 461.8-211.1-67.3.9-292.8 210.2 66.9z"></path><path clip-rule="evenodd" d="m408.6 232.5-20.7 50.1 38.1 11.5zm-12.4-47.2 27.2 8.2 49.5 178.6-27.9-8.5-10-36.7-57.7-17.5-12.4 29.9-27.9-8.5z" fill="currentColor" fill-rule="evenodd"></path></svg><i aria-hidden="true" class="dropdown__arrow"></i></button><div class="dropdown__list "><ul><li><a href="https://webpack.js.org/guides/printable/" class="px-5 block"><span>English</span></a></li><li><a href="https://webpack.docschina.org/guides/printable/" class="px-5 block"><span lang="zh">中文</span></a></li><li><a href="https://webpack.kr/guides/printable/" class="px-5 block"><span lang="ko">한국어</span></a></li></ul></div></nav></nav><div class="inline-flex items-center ml-[18px]"><button aria-label="Switch to dark theme" class="bg-transparent border-none cursor-pointer text-[16px] p-0 inline-flex items-center text-gray-100 hover:text-blue-200 transition-colors duration-200" data-testid="hello-darkness"><svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18.1406C11.6016 18.1406 11.2782 18.464 11.2782 18.8624V21.0281C11.2782 21.4265 11.6016 21.7499 12 21.7499C12.3985 21.7499 12.7219 21.4265 12.7219 21.0281V18.8624C12.7219 18.464 12.3985 18.1406 12 18.1406V18.1406Z" fill="currentColor"></path><path d="M12 2.25006C11.6016 2.25006 11.2782 2.5735 11.2782 2.97194V5.13756C11.2782 5.536 11.6016 5.85944 12 5.85944C12.3985 5.85944 12.7219 5.536 12.7219 5.13756V2.97194C12.7219 2.5735 12.3985 2.25006 12 2.25006V2.25006Z" fill="currentColor"></path><path d="M5.85936 12C5.85936 11.6015 5.53592 11.2781 5.13749 11.2781H2.97186C2.57342 11.2781 2.24999 11.6015 2.24999 12C2.24999 12.3984 2.57342 12.7218 2.97186 12.7218H5.13749C5.53592 12.7218 5.85936 12.3984 5.85936 12V12Z" fill="currentColor"></path><path d="M21.0281 11.2781H18.8625C18.4641 11.2781 18.1406 11.6015 18.1406 12C18.1406 12.3984 18.4641 12.7218 18.8625 12.7218H21.0281C21.4266 12.7218 21.75 12.3984 21.75 12C21.75 11.6015 21.4266 11.2781 21.0281 11.2781V11.2781Z" fill="currentColor"></path><path d="M7.14841 16.1298C6.95622 16.1298 6.77341 16.2048 6.63747 16.3407L5.10466 17.8735C4.96872 18.0094 4.89372 18.1923 4.89372 18.3844C4.89372 18.5766 4.96872 18.7594 5.10466 18.8954C5.2406 19.0313 5.42341 19.1063 5.6156 19.1063C5.80779 19.1063 5.9906 19.0313 6.12654 18.8954L7.65935 17.3626C7.9406 17.0813 7.9406 16.6219 7.65935 16.3407C7.52341 16.2048 7.3406 16.1298 7.14841 16.1298V16.1298Z" fill="currentColor"></path><path d="M16.8516 7.87036C17.0437 7.87036 17.2266 7.79536 17.3625 7.65942L18.8953 6.12661C19.0312 5.99067 19.1062 5.80786 19.1062 5.61567C19.1062 5.42349 19.0312 5.24067 18.8953 5.10474C18.7594 4.9688 18.5766 4.8938 18.3844 4.8938C18.1922 4.8938 18.0094 4.9688 17.8734 5.10474L16.3406 6.63755C16.2047 6.77349 16.1297 6.9563 16.1297 7.14849C16.1297 7.34067 16.2047 7.52349 16.3406 7.65942C16.4766 7.79536 16.6594 7.87036 16.8516 7.87036V7.87036Z" fill="currentColor"></path><path d="M6.12654 5.10474C5.9906 4.9688 5.80779 4.8938 5.6156 4.8938C5.42341 4.8938 5.2406 4.9688 5.10466 5.10474C4.96872 5.24067 4.89372 5.42349 4.89372 5.61567C4.89372 5.80786 4.96872 5.99067 5.10466 6.12661L6.63747 7.65942C6.77341 7.79536 6.95622 7.87036 7.14841 7.87036C7.3406 7.87036 7.52341 7.79536 7.65935 7.65942C7.79529 7.52349 7.87029 7.34067 7.87029 7.14849C7.87029 6.9563 7.79529 6.77349 7.65935 6.63755L6.12654 5.10474V5.10474Z" fill="currentColor"></path><path d="M17.3625 16.3407C17.2266 16.2048 17.0437 16.1298 16.8516 16.1298C16.6594 16.1298 16.4766 16.2048 16.3406 16.3407C16.0594 16.6219 16.0594 17.0813 16.3406 17.3626L17.8734 18.8954C18.0094 19.0313 18.1922 19.1063 18.3844 19.1063C18.5766 19.1063 18.7594 19.0313 18.8953 18.8954C19.0312 18.7594 19.1062 18.5766 19.1062 18.3844C19.1062 18.1923 19.0312 18.0094 18.8953 17.8735L17.3625 16.3407V16.3407Z" fill="currentColor"></path><path d="M12 7.5C9.52031 7.5 7.5 9.52031 7.5 12C7.5 14.4797 9.52031 16.5 12 16.5C14.4797 16.5 16.5 14.4797 16.5 12C16.5 9.52031 14.4797 7.5 12 7.5Z" fill="currentColor"></path></svg></button><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="bg-gray-100 dark:bg-gray-800 hidden md:block"><div class="md:max-w-[1024px] md:mx-auto md:grid md:grid-flow-col md:justify-end md:gap-x-[20px] md:px-[24px]" data-testid="sub-navigation"><a title="api" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/api/">API</a><a title="概念" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/concepts/">概念</a><a title="配置" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/configuration/">配置</a><a title="指南" aria-current="page" class="!text-black dark:!text-white text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/guides/">指南</a><a title="loader" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/loaders/">loader</a><a title="迁移" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/migrate/">迁移</a><a title="plugin" class="text-blue-400 py-5 text-sm capitalize hover:text-black dark:hover:text-white" href="/plugins/">plugin</a></div></div></header></div><div class="container site__content"><div class="sponsors"><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="sponsors__content"><img class="sponsors__img__docschina" src="/docschina-logo.59f03f74b3c450856c01.png"/><div class="sponsors__content-cont">翻译/文档内容有任何问题，请联系我们</div></a></div><nav class="sidebar site__sidebar"><div class="sidebar__inner"><div class="relative z-0 bg-white dark:bg-gray-100 "><select class="text-gray-600 text-14 px-5 py-5 appearance-none box-border border border-gray-200 border-solid flex-col flex w-full rounded-none bg-transparent bg-none"><option selected="" value="5">Webpack 5</option><option value="4">Webpack 4</option></select><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="absolute right-5 top-5 fill-current text-gray-300 z-[-1]" width="20" height="20"><path d="M4.5 7.5c.5-.4 1-.4 1.6 0l3.9 3.8 4-3.8c.4-.4 1-.4 1.5 0 .4.5.4 1.2 0 1.7l-4.7 4.5a1 1 0 0 1-1.6 0L4.5 9.2c-.4-.5-.4-1.2 0-1.7z"></path></svg></div><div class="sidebar-item sidebar-item--disabled`"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title sidebar-link__print" href="/guides/printable/" rel="nofollow noopener noreferrer" alt="Print" title="Print" target="_blank">Print Section<img src="/icon-print.d4d2cfa27f8b9a98e34a.svg" width="27" height="20" alt="Printer Icon"/></a></div><div><div class="sidebar-item  sidebar-item--disabled"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title" href="/guides/">指南</a></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/getting-started/">起步</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="基础设置 "><a class="" href="/guides/getting-started/#basic-setup">基础设置 </a></li><li class="sidebar-item__anchor" title="创建一个 bundle "><a class="" href="/guides/getting-started/#creating-a-bundle">创建一个 bundle </a></li><li class="sidebar-item__anchor" title="模块 "><a class="" href="/guides/getting-started/#modules">模块 </a></li><li class="sidebar-item__anchor" title="使用配置文件 "><a class="" href="/guides/getting-started/#using-a-configuration">使用配置文件 </a></li><li class="sidebar-item__anchor" title="npm scripts "><a class="" href="/guides/getting-started/#npm-scripts">npm scripts </a></li><li class="sidebar-item__anchor" title="总结 "><a class="" href="/guides/getting-started/#conclusion">总结 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/asset-management/">管理资源</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="设置 "><a class="" href="/guides/asset-management/#setup">设置 </a></li><li class="sidebar-item__anchor" title="加载 CSS "><a class="" href="/guides/asset-management/#loading-css">加载 CSS </a></li><li class="sidebar-item__anchor" title="加载图像 "><a class="" href="/guides/asset-management/#loading-images">加载图像 </a></li><li class="sidebar-item__anchor" title="加载字体 "><a class="" href="/guides/asset-management/#loading-fonts">加载字体 </a></li><li class="sidebar-item__anchor" title="加载数据 "><a class="" href="/guides/asset-management/#loading-data">加载数据 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="自定义 JSON 模块解析器 "><a class="" href="/guides/asset-management/#customize-parser-of-json-modules">自定义 JSON 模块解析器 </a></li></ul></li><li class="sidebar-item__anchor" title="全局资源 "><a class="" href="/guides/asset-management/#global-assets">全局资源 </a></li><li class="sidebar-item__anchor" title="回退处理 "><a class="" href="/guides/asset-management/#wrapping-up">回退处理 </a></li><li class="sidebar-item__anchor" title="下篇指南 "><a class="" href="/guides/asset-management/#next-guide">下篇指南 </a></li><li class="sidebar-item__anchor" title="延伸阅读 "><a class="" href="/guides/asset-management/#further-reading">延伸阅读 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/output-management/">管理输出</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="预先准备 "><a class="" href="/guides/output-management/#preparation">预先准备 </a></li><li class="sidebar-item__anchor" title="设置 HtmlWebpackPlugin "><a class="" href="/guides/output-management/#setting-up-htmlwebpackplugin">设置 HtmlWebpackPlugin </a></li><li class="sidebar-item__anchor" title="清理 /dist 文件夹 "><a class="" href="/guides/output-management/#cleaning-up-the-dist-folder">清理 /dist 文件夹 </a></li><li class="sidebar-item__anchor" title="manifest "><a class="" href="/guides/output-management/#the-manifest">manifest </a></li><li class="sidebar-item__anchor" title="总结 "><a class="" href="/guides/output-management/#conclusion">总结 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/development/">开发环境</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="使用 source map "><a class="" href="/guides/development/#using-source-maps">使用 source map </a></li><li class="sidebar-item__anchor" title="选择一个开发工具 "><a class="" href="/guides/development/#choosing-a-development-tool">选择一个开发工具 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="使用观察模式 "><a class="" href="/guides/development/#using-watch-mode">使用观察模式 </a></li><li class="sidebar-item__anchor" title="使用 webpack-dev-server "><a class="" href="/guides/development/#using-webpack-dev-server">使用 webpack-dev-server </a></li><li class="sidebar-item__anchor" title="使用 webpack-dev-middleware "><a class="" href="/guides/development/#using-webpack-dev-middleware">使用 webpack-dev-middleware </a></li></ul></li><li class="sidebar-item__anchor" title="调整文本编辑器 "><a class="" href="/guides/development/#adjusting-your-text-editor">调整文本编辑器 </a></li><li class="sidebar-item__anchor" title="总结 "><a class="" href="/guides/development/#conclusion">总结 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/code-splitting/">代码分离</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="入口起点 "><a class="" href="/guides/code-splitting/#entry-points">入口起点 </a></li><li class="sidebar-item__anchor" title="防止重复 "><a class="" href="/guides/code-splitting/#prevent-duplication">防止重复 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="入口依赖 "><a class="" href="/guides/code-splitting/#entry-dependencies">入口依赖 </a></li><li class="sidebar-item__anchor" title="SplitChunksPlugin "><a class="" href="/guides/code-splitting/#splitchunksplugin">SplitChunksPlugin </a></li></ul></li><li class="sidebar-item__anchor" title="动态导入 "><a class="" href="/guides/code-splitting/#dynamic-imports">动态导入 </a></li><li class="sidebar-item__anchor" title="预获取/预加载模块 "><a class="" href="/guides/code-splitting/#prefetchingpreloading-modules">预获取/预加载模块 </a></li><li class="sidebar-item__anchor" title="分析 bundle "><a class="" href="/guides/code-splitting/#bundle-analysis">分析 bundle </a></li><li class="sidebar-item__anchor" title="下一步 "><a class="" href="/guides/code-splitting/#next-steps">下一步 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/caching/">缓存</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="输出文件的文件名 "><a class="" href="/guides/caching/#output-filenames">输出文件的文件名 </a></li><li class="sidebar-item__anchor" title="提取引导模板 "><a class="" href="/guides/caching/#extracting-boilerplate">提取引导模板 </a></li><li class="sidebar-item__anchor" title="模块标识符 "><a class="" href="/guides/caching/#module-identifiers">模块标识符 </a></li><li class="sidebar-item__anchor" title="总结 "><a class="" href="/guides/caching/#conclusion">总结 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/author-libraries/">创建库</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="创建一个库 "><a class="" href="/guides/author-libraries/#authoring-a-library">创建一个库 </a></li><li class="sidebar-item__anchor" title="webpack 配置 "><a class="" href="/guides/author-libraries/#webpack-configuration">webpack 配置 </a></li><li class="sidebar-item__anchor" title="暴露库 "><a class="" href="/guides/author-libraries/#expose-the-library">暴露库 </a></li><li class="sidebar-item__anchor" title="外部化 lodash "><a class="" href="/guides/author-libraries/#externalize-lodash">外部化 lodash </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="外部化的限制 "><a class="" href="/guides/author-libraries/#external-limitations">外部化的限制 </a></li></ul></li><li class="sidebar-item__anchor" title="最终步骤 "><a class="" href="/guides/author-libraries/#final-steps">最终步骤 </a></li></ul></div></div><div><div class="sidebar-item  sidebar-item--disabled"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title" href="/guides/environment-variables/">环境变量</a></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/build-performance/">构建性能</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="通用环境 "><a class="" href="/guides/build-performance/#general">通用环境 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="更新到最新版本 "><a class="" href="/guides/build-performance/#stay-up-to-date">更新到最新版本 </a></li><li class="sidebar-item__anchor" title="loader "><a class="" href="/guides/build-performance/#loaders">loader </a></li><li class="sidebar-item__anchor" title="引导（bootstrap） "><a class="" href="/guides/build-performance/#bootstrap">引导（bootstrap） </a></li><li class="sidebar-item__anchor" title="解析 "><a class="" href="/guides/build-performance/#resolving">解析 </a></li><li class="sidebar-item__anchor" title="dll "><a class="" href="/guides/build-performance/#dlls">dll </a></li><li class="sidebar-item__anchor" title="小即是快 "><a class="" href="/guides/build-performance/#smaller--faster">小即是快 </a></li><li class="sidebar-item__anchor" title="worker 池 "><a class="" href="/guides/build-performance/#worker-pool">worker 池 </a></li><li class="sidebar-item__anchor" title="持久化缓存 "><a class="" href="/guides/build-performance/#persistent-cache">持久化缓存 </a></li><li class="sidebar-item__anchor" title="自定义 plugin/loader "><a class="" href="/guides/build-performance/#custom-pluginsloaders">自定义 plugin/loader </a></li><li class="sidebar-item__anchor" title="Progress 插件 "><a class="" href="/guides/build-performance/#progress-plugin">Progress 插件 </a></li></ul></li><li class="sidebar-item__anchor" title="开发环境 "><a class="" href="/guides/build-performance/#development">开发环境 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="增量编译 "><a class="" href="/guides/build-performance/#incremental-builds">增量编译 </a></li><li class="sidebar-item__anchor" title="在内存中编译 "><a class="" href="/guides/build-performance/#compile-in-memory">在内存中编译 </a></li><li class="sidebar-item__anchor" title="加速 stats.toJson "><a class="" href="/guides/build-performance/#statstojson-speed">加速 stats.toJson </a></li><li class="sidebar-item__anchor" title="devtool "><a class="" href="/guides/build-performance/#devtool">devtool </a></li><li class="sidebar-item__anchor" title="避免使用在生产环境下才会用到的工具 "><a class="" href="/guides/build-performance/#avoid-production-specific-tooling">避免使用在生产环境下才会用到的工具 </a></li><li class="sidebar-item__anchor" title="最小化入口 chunk "><a class="" href="/guides/build-performance/#minimal-entry-chunk">最小化入口 chunk </a></li><li class="sidebar-item__anchor" title="避免额外的优化步骤 "><a class="" href="/guides/build-performance/#avoid-extra-optimization-steps">避免额外的优化步骤 </a></li><li class="sidebar-item__anchor" title="输出结果不携带路径信息 "><a class="" href="/guides/build-performance/#output-without-path-info">输出结果不携带路径信息 </a></li><li class="sidebar-item__anchor" title="Node.js 版本 8.9.10-9.11.1 "><a class="" href="/guides/build-performance/#nodejs-versions-8910-9111">Node.js 版本 8.9.10-9.11.1 </a></li><li class="sidebar-item__anchor" title="TypeScript loader "><a class="" href="/guides/build-performance/#typescript-loader">TypeScript loader </a></li></ul></li><li class="sidebar-item__anchor" title="生产环境 "><a class="" href="/guides/build-performance/#production">生产环境 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="source map "><a class="" href="/guides/build-performance/#source-maps">source map </a></li></ul></li><li class="sidebar-item__anchor" title="工具相关问题 "><a class="" href="/guides/build-performance/#specific-tooling-issues">工具相关问题 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="babel "><a class="" href="/guides/build-performance/#babel">babel </a></li><li class="sidebar-item__anchor" title="TypeScript "><a class="" href="/guides/build-performance/#typescript">TypeScript </a></li><li class="sidebar-item__anchor" title="sass "><a class="" href="/guides/build-performance/#sass">sass </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/csp/">内容安全策略（CSP）</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="示例 "><a class="" href="/guides/csp/#examples">示例 </a></li><li class="sidebar-item__anchor" title="启用 CSP "><a class="" href="/guides/csp/#enabling-csp">启用 CSP </a></li><li class="sidebar-item__anchor" title="信任类型 "><a class="" href="/guides/csp/#trustedtypes">信任类型 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/development-vagrant/">使用 Vagrant 在虚拟机运行开发环境</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="配置项目 "><a class="" href="/guides/development-vagrant/#configuring-the-project">配置项目 </a></li><li class="sidebar-item__anchor" title="启动服务器 "><a class="" href="/guides/development-vagrant/#running-the-server">启动服务器 </a></li><li class="sidebar-item__anchor" title="配合 nginx 的高级用法 "><a class="" href="/guides/development-vagrant/#advanced-usage-with-nginx">配合 nginx 的高级用法 </a></li><li class="sidebar-item__anchor" title="总结 "><a class="" href="/guides/development-vagrant/#conclusion">总结 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/dependency-management/">依赖管理</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="带表达式的 require 语句 "><a class="" href="/guides/dependency-management/#require-with-expression">带表达式的 require 语句 </a></li><li class="sidebar-item__anchor" title="require.context "><a class="" href="/guides/dependency-management/#requirecontext">require.context </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="上下文模块 API "><a class="" href="/guides/dependency-management/#context-module-api">上下文模块 API </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/installation/">安装</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="前提条件 "><a class="" href="/guides/installation/#prerequisites">前提条件 </a></li><li class="sidebar-item__anchor" title="本地安装 "><a class="" href="/guides/installation/#local-installation">本地安装 </a></li><li class="sidebar-item__anchor" title="全局安装 "><a class="" href="/guides/installation/#global-installation">全局安装 </a></li><li class="sidebar-item__anchor" title="最新体验版本 "><a class="" href="/guides/installation/#bleeding-edge">最新体验版本 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/hot-module-replacement/">模块热替换</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="启用 HMR "><a class="" href="/guides/hot-module-replacement/#enabling-hmr">启用 HMR </a></li><li class="sidebar-item__anchor" title="通过 Node.js API 启用 HMR "><a class="" href="/guides/hot-module-replacement/#via-the-nodejs-api">通过 Node.js API 启用 HMR </a></li><li class="sidebar-item__anchor" title="问题 "><a class="" href="/guides/hot-module-replacement/#gotchas">问题 </a></li><li class="sidebar-item__anchor" title="HMR 加载样式 "><a class="" href="/guides/hot-module-replacement/#hmr-with-stylesheets">HMR 加载样式 </a></li><li class="sidebar-item__anchor" title="其他代码和框架 "><a class="" href="/guides/hot-module-replacement/#other-code-and-frameworks">其他代码和框架 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/tree-shaking/">Tree Shaking</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="添加一个通用模块 "><a class="" href="/guides/tree-shaking/#add-a-utility">添加一个通用模块 </a></li><li class="sidebar-item__anchor" title="将文件标记为无副作用（side-effect-free） "><a class="" href="/guides/tree-shaking/#mark-the-file-as-side-effect-free">将文件标记为无副作用（side-effect-free） </a></li><li class="sidebar-item__anchor" title="解释 tree shaking 和 sideEffects "><a class="" href="/guides/tree-shaking/#clarifying-tree-shaking-and-sideeffects">解释 tree shaking 和 sideEffects </a></li><li class="sidebar-item__anchor" title="将函数调用标记为无副作用 "><a class="" href="/guides/tree-shaking/#mark-a-function-call-as-side-effect-free">将函数调用标记为无副作用 </a></li><li class="sidebar-item__anchor" title="压缩输出结果 "><a class="" href="/guides/tree-shaking/#minify-the-output">压缩输出结果 </a></li><li class="sidebar-item__anchor" title="总结 "><a class="" href="/guides/tree-shaking/#conclusion">总结 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/production/">生产环境</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="配置 "><a class="" href="/guides/production/#setup">配置 </a></li><li class="sidebar-item__anchor" title="NPM Scripts "><a class="" href="/guides/production/#npm-scripts">NPM Scripts </a></li><li class="sidebar-item__anchor" title="指定 mode "><a class="" href="/guides/production/#specify-the-mode">指定 mode </a></li><li class="sidebar-item__anchor" title="压缩(Minification) "><a class="" href="/guides/production/#minification">压缩(Minification) </a></li><li class="sidebar-item__anchor" title="源码映射(Source Mapping) "><a class="" href="/guides/production/#source-mapping">源码映射(Source Mapping) </a></li><li class="sidebar-item__anchor" title="压缩 CSS "><a class="" href="/guides/production/#minimize-css">压缩 CSS </a></li><li class="sidebar-item__anchor" title="CLI 替代选项 "><a class="" href="/guides/production/#cli-alternatives">CLI 替代选项 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/lazy-loading/">懒加载</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="示例 "><a class="" href="/guides/lazy-loading/#example">示例 </a></li><li class="sidebar-item__anchor" title="框架 "><a class="" href="/guides/lazy-loading/#frameworks">框架 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/ecma-script-modules/">ECMAScript 模块</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="导出 "><a class="" href="/guides/ecma-script-modules/#exporting">导出 </a></li><li class="sidebar-item__anchor" title="导入 "><a class="" href="/guides/ecma-script-modules/#importing">导入 </a></li><li class="sidebar-item__anchor" title="将模块标记为 ESM "><a class="" href="/guides/ecma-script-modules/#flagging-modules-as-esm">将模块标记为 ESM </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/shimming/">Shimming 预置依赖</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Shimming 预置全局变量 "><a class="" href="/guides/shimming/#shimming-globals">Shimming 预置全局变量 </a></li><li class="sidebar-item__anchor" title="细粒度 Shimming "><a class="" href="/guides/shimming/#granular-shimming">细粒度 Shimming </a></li><li class="sidebar-item__anchor" title="全局 Exports "><a class="" href="/guides/shimming/#global-exports">全局 Exports </a></li><li class="sidebar-item__anchor" title="加载 Polyfills "><a class="" href="/guides/shimming/#loading-polyfills">加载 Polyfills </a></li><li class="sidebar-item__anchor" title="进一步优化 "><a class="" href="/guides/shimming/#further-optimizations">进一步优化 </a></li><li class="sidebar-item__anchor" title="Node 内置 "><a class="" href="/guides/shimming/#node-built-ins">Node 内置 </a></li><li class="sidebar-item__anchor" title="其他工具 "><a class="" href="/guides/shimming/#other-utilities">其他工具 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/typescript/">TypeScript</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="基础配置 "><a class="" href="/guides/typescript/#basic-setup">基础配置 </a></li><li class="sidebar-item__anchor" title="loader "><a class="" href="/guides/typescript/#loader">loader </a></li><li class="sidebar-item__anchor" title="source map "><a class="" href="/guides/typescript/#source-maps">source map </a></li><li class="sidebar-item__anchor" title="客户端类型 "><a class="" href="/guides/typescript/#client-types">客户端类型 </a></li><li class="sidebar-item__anchor" title="使用第三方库 "><a class="" href="/guides/typescript/#using-third-party-libraries">使用第三方库 </a></li><li class="sidebar-item__anchor" title="导入其他资源 "><a class="" href="/guides/typescript/#importing-other-assets">导入其他资源 </a></li><li class="sidebar-item__anchor" title="构建性能 "><a class="" href="/guides/typescript/#build-performance">构建性能 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/web-workers/">Web Workers</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="语法 "><a class="" href="/guides/web-workers/#syntax">语法 </a></li><li class="sidebar-item__anchor" title="示例 "><a class="" href="/guides/web-workers/#example">示例 </a></li><li class="sidebar-item__anchor" title="Node.js "><a class="" href="/guides/web-workers/#nodejs">Node.js </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/progressive-web-application/">渐进式网络应用程序</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="现在，我们并没有运行在离线环境下 "><a class="" href="/guides/progressive-web-application/#we-dont-work-offline-now">现在，我们并没有运行在离线环境下 </a></li><li class="sidebar-item__anchor" title="添加 Workbox "><a class="" href="/guides/progressive-web-application/#adding-workbox">添加 Workbox </a></li><li class="sidebar-item__anchor" title="注册 Service Worker "><a class="" href="/guides/progressive-web-application/#registering-our-service-worker">注册 Service Worker </a></li><li class="sidebar-item__anchor" title="结论 "><a class="" href="/guides/progressive-web-application/#conclusion">结论 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/public-path/">公共路径</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="示例 "><a class="" href="/guides/public-path/#use-cases">示例 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="基于环境设置 "><a class="" href="/guides/public-path/#environment-based">基于环境设置 </a></li><li class="sidebar-item__anchor" title="在运行时设置 "><a class="" href="/guides/public-path/#on-the-fly">在运行时设置 </a></li><li class="sidebar-item__anchor" title="Automatic publicPath $#automaticpublicPath$"><a class="" href="/guides/public-path/#Automatic-publicPath-automaticpublicPath">Automatic publicPath $#automaticpublicPath$</a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/integrations/">集成</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="NPM Scripts "><a class="" href="/guides/integrations/#npm-scripts">NPM Scripts </a></li><li class="sidebar-item__anchor" title="Grunt "><a class="" href="/guides/integrations/#grunt">Grunt </a></li><li class="sidebar-item__anchor" title="Gulp "><a class="" href="/guides/integrations/#gulp">Gulp </a></li><li class="sidebar-item__anchor" title="Mocha "><a class="" href="/guides/integrations/#mocha">Mocha </a></li><li class="sidebar-item__anchor" title="Karma "><a class="" href="/guides/integrations/#karma">Karma </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/asset-modules/">资源模块</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Resource 资源 "><a class="" href="/guides/asset-modules/#resource-assets">Resource 资源 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="自定义输出文件名 "><a class="" href="/guides/asset-modules/#custom-output-filename">自定义输出文件名 </a></li></ul></li><li class="sidebar-item__anchor" title="inline 资源(inlining asset) "><a class="" href="/guides/asset-modules/#inlining-assets">inline 资源(inlining asset) </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="自定义 data URI 生成器 "><a class="" href="/guides/asset-modules/#custom-data-uri-generator">自定义 data URI 生成器 </a></li></ul></li><li class="sidebar-item__anchor" title="source 资源(source asset) "><a class="" href="/guides/asset-modules/#source-assets">source 资源(source asset) </a></li><li class="sidebar-item__anchor" title="URL 资源 "><a class="" href="/guides/asset-modules/#url-assets">URL 资源 </a></li><li class="sidebar-item__anchor" title="通用资源类型 "><a class="" href="/guides/asset-modules/#general-asset-type">通用资源类型 </a></li><li class="sidebar-item__anchor" title="变更内联 loader 的语法 "><a class="" href="/guides/asset-modules/#replacing-inline-loader-syntax">变更内联 loader 的语法 </a></li><li class="sidebar-item__anchor" title="Disable emitting assets"><a class="" href="/guides/asset-modules/#Disable-emitting-assets">Disable emitting assets</a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/entry-advanced/">entry 高级用法</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="每个入口使用多种文件类型 "><a class="" href="/guides/entry-advanced/#multiple-file-types-per-entry">每个入口使用多种文件类型 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/guides/package-exports/">Package exports</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="General syntax"><a class="" href="/guides/package-exports/#General-syntax">General syntax</a></li><li class="sidebar-item__anchor" title="Alternatives"><a class="" href="/guides/package-exports/#Alternatives">Alternatives</a></li><li class="sidebar-item__anchor" title="Conditional syntax"><a class="" href="/guides/package-exports/#Conditional-syntax">Conditional syntax</a></li><li class="sidebar-item__anchor" title="Abbreviation"><a class="" href="/guides/package-exports/#Abbreviation">Abbreviation</a></li><li class="sidebar-item__anchor" title="Notes about ordering"><a class="" href="/guides/package-exports/#Notes-about-ordering">Notes about ordering</a></li><li class="sidebar-item__anchor" title="Support"><a class="" href="/guides/package-exports/#Support">Support</a></li><li class="sidebar-item__anchor" title="Conditions"><a class="" href="/guides/package-exports/#Conditions">Conditions</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Reference syntax"><a class="" href="/guides/package-exports/#Reference-syntax">Reference syntax</a></li><li class="sidebar-item__anchor" title="Optimizations"><a class="" href="/guides/package-exports/#Optimizations">Optimizations</a></li><li class="sidebar-item__anchor" title="Target environment"><a class="" href="/guides/package-exports/#Target-environment">Target environment</a></li><li class="sidebar-item__anchor" title="Conditions: Preprocessor and runtimes"><a class="" href="/guides/package-exports/#Conditions-Preprocessor-and-runtimes">Conditions: Preprocessor and runtimes</a></li><li class="sidebar-item__anchor" title="Conditions: Custom"><a class="" href="/guides/package-exports/#Conditions-Custom">Conditions: Custom</a></li></ul></li><li class="sidebar-item__anchor" title="Common patterns"><a class="" href="/guides/package-exports/#Common-patterns">Common patterns</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Target environment independent packages"><a class="" href="/guides/package-exports/#Target-environment-independent-packages">Target environment independent packages</a></li><li class="sidebar-item__anchor" title="Providing devtools or production optimizations"><a class="" href="/guides/package-exports/#Providing-devtools-or-production-optimizations">Providing devtools or production optimizations</a></li><li class="sidebar-item__anchor" title="Providing different versions depending on target environment"><a class="" href="/guides/package-exports/#Providing-different-versions-depending-on-target-environment">Providing different versions depending on target environment</a></li><li class="sidebar-item__anchor" title="Combining patterns"><a class="" href="/guides/package-exports/#Combining-patterns">Combining patterns</a></li></ul></li><li class="sidebar-item__anchor" title="Guidelines"><a class="" href="/guides/package-exports/#Guidelines">Guidelines</a></li></ul></div></div></div></nav><section class="page"><div class="markdown"><h1>Printable</h1><div id="md-content"><h1><span id="指南"></span>指南<a href="#%E6%8C%87%E5%8D%97" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>指南章节用于理解和掌握 webpack 提供的各种工具和特性。首先是带你 <a href="/guides/getting-started/">起步</a> 的指引。</p><p>指南章节会逐步带你由浅入深。本章节更多是作为一个切入点，阅读完成后会更加容易深入 <a href="/configuration">配置</a> 文档中。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>指南中运行 webpack 后显示的输出可能与新版本的输出略有不同。这是意料之中的事情。只要 bundle 看起来接近并且运行正常那就没有问题。如果遇到在新版本中示例无法良好运行，请 <a href="https://github.com/webpack/webpack.js.org/issues/new/choose">创建 issue</a>，我们将尽力解决版本差异。</p></aside><h1><span id="起步"></span>起步<a href="#%E8%B5%B7%E6%AD%A5" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>webpack 用于编译 JavaScript 模块。一旦完成 <a href="/guides/installation">安装</a> 就可以通过 webpack <a href="/api/cli">CLI</a> 或 <a href="/api/node">API</a> 与其配合交互。如果还不熟悉 webpack，请阅读 <a href="/concepts">核心概念</a> 和 <a href="/comparison">对比</a> 了解为什么是使用 webpack 而非社区中的其他工具。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>运行 webpack 5 的 Node.js 最低版本是 10.13.0（LTS）。</p></aside><aside class="preview"><h6 class="preview__prefix">live preview</h6><p>Check out this guide live on StackBlitz.</p><a href="https://stackblitz.com/github/webpack/webpack.js.org/tree/master/examples/getting-started?terminal=" target="_blank" rel="noopener noreferrer"><img src="/open-in-stackblitz-button.5857815e117b5952651d.svg" alt="Open in StackBlitz"/></a></aside><h2><span id="basic-setup"></span>基础设置<a href="#basic-setup" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>首先创建进入一个目录并初始化 npm，然后 <a href="/guides/installation#local-installation">在本地安装 webpack</a>，接着安装 <a href="https://github.com/webpack/webpack-cli"><code>webpack-cli</code></a>（此工具用于在命令行中运行 webpack）：</p><pre><code class="hljs language-bash"><span class="token function">mkdir</span> webpack-demo
<span class="token builtin class-name">cd</span> webpack-demo
<span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli --save-dev</code></pre><p>整篇指南将使用 <code>diff</code> 代码块展示对目录、文件和代码所做的修改。例如：</p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 这是需要复制到代码的新的一行
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> 这是需要从代码中移除的一行
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> 这是不需要调整的一行</span></span></code></pre><p>现在创建以下目录结构、文件和内容：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- index.html
</span><span class="token prefix inserted">+</span><span class="token line"> |- /src
</span><span class="token prefix inserted">+</span><span class="token line">   |- index.js</span></span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">function</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 执行这一行需要引入 lodash（目前通过 script 脚本引入）</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;Hello&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#x27; &#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>index.html</strong></p><pre><code class="hljs language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>起步<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/lodash@4.17.20<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./src/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre><p>还需要调整 <code>package.json</code> 文件以确保安装包是私有的，并移除 <code>main</code> 入口，这可以防止意外发布代码。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>推荐阅读 <a href="https://docs.npmjs.com/files/package.json">npm 文档</a> 以了解有关 <code>package.json</code> 内在机制的更多信息。</p></aside><p><strong>package.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  &quot;main&quot;: &quot;index.js&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;private&quot;: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;MIT&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.38.1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.7.2&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>在此示例中，<code>&lt;script&gt;</code> 标签之间存在隐式依赖关系。在 <code>index.js</code> 文件执行之前，还需要在页面中先引入 <code>lodash</code>。<code>index.js</code> 并未显式声明需要 <code>lodash</code>，而是假定推测已经存在一个全局变量 <code>_</code>。</p><p>使用这种方式管理 JavaScript 项目存在一些问题：</p><ul><li>无法直接体现脚本的执行依赖于外部库。</li><li>如果依赖不存在，或者引入顺序错误，应用程序将无法正常运行。</li><li>如果依赖被引入但是并没有使用，浏览器将被迫下载无用代码。</li></ul><p>试试使用 webpack 管理这些脚本。</p><h2><span id="creating-a-bundle"></span>创建一个 bundle<a href="#creating-a-bundle" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>首先稍微调整下目录结构，创建 <code>./dist</code> 文件夹用于存放分发（distribution）代码，而 <code>./src</code> 文件夹仍存放源代码。源代码是指用于书写和编辑的代码；分发代码是指在构建过程中，经过最小化和优化后产生的输出结果，分发代码最终将在浏览器中加载。调整后的目录结构如下：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- /dist
</span><span class="token prefix inserted">+</span><span class="token line">   |- index.html
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- index.html
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>尽管 <code>index.html</code> 目前处于 <code>dist</code> 目录下，但它是手动创建的。指南的 <a href="/guides/output-management/#setting-up-htmlwebpackplugin">后续章节</a> 会介绍如何生成 <code>index.html</code> 而非手动编辑它。通过这样的方式便可安全地清空 <code>dist</code> 目录并重新生成目录中的所有文件。</p></aside><p>在本地安装 <code>lodash</code> 以在 <code>index.js</code> 中打包它：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save lodash</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>安装一个将被打包到生产环境 bundle 的包时，应该使用 <code>npm install --save</code>；而安装一个用于开发环境的包时（例如代码检查工具、测试库等），应该使用 <code>npm install --save-dev</code>。请查看 <a href="https://docs.npmjs.com/cli/install">npm 文档</a> 以了解更多相关信息。</p></aside><p>现在在脚本中导入 <code>lodash</code>：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import _ from &#x27;lodash&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // 执行这一行需要引入 lodash（目前通过 script 脚本引入）
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  // lodash 现在使用 import 引入
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>现在将打包所有脚本，因此需要更新 <code>index.html</code> 文件。由于现在是通过 <code>import</code> 引入 lodash，所以应将 lodash <code>&lt;script&gt;</code> 删除；然后修改另一个 <code>&lt;script&gt;</code> 标签来加载 bundle，而不是原始的 <code>./src</code> 文件：</p><p><strong>dist/index.html</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;title&gt;起步&lt;/title&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;https://unpkg.com/lodash@4.17.20&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;./src/index.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;</span></span></code></pre><p>在此设置中 <code>index.js</code> 显式要求引入的 <code>lodash</code> 必须存在，然后将它绑定为 <code>_</code>（没有全局作用域污染）。webpack 能够利用模块生命的依赖信息构建依赖图，然后使用图生成一个优化过的 bundle，并能保证以正确顺序执行。</p><p>换言之，执行 <code>npx webpack</code> 会将脚本 <code>src/index.js</code> 作为 <a href="/concepts/entry-points">入口起点</a>，也会生成 <code>dist/main.js</code> 作为 <a href="/concepts/output">输出</a>。Node 8.2/npm 5.2.0 及以上版本提供的 <code>npx</code> 命令，可以运行在最初安装的 webpack 包中的 webpack 二进制文件（即 <code>./node_modules/.bin/webpack</code>）：</p><pre><code class="hljs language-bash">$ npx webpack
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset main.js <span class="token number">69.3</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">1000</span> bytes <span class="token number">5</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1851</span> ms</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>输出可能会稍有不同，但是只要构建成功，那么就可以放心继续。</p></aside><p>在浏览器中打开 <code>dist</code> 目录下的 <code>index.html</code>，如果一切正常就能看到以下文本：<code>&#x27;Hello webpack&#x27;</code>。</p><h2><span id="modules"></span>模块<a href="#modules" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>尽管大多数浏览器还无法支持在 <a href="https://babeljs.io/learn-es2015/">ES2015</a> 中已经标准化的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import"><code>import</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/export"><code>export</code></a>，但 webpack 能够提供开箱即用般的支持。</p><p>事实上，webpack 会将代码转译以便可以在旧版本浏览器中执行。检查 <code>dist/main.js</code> 你可以看到 webpack 具体是如何工作的，这是独创精巧的设计！除了 <code>import</code> 和 <code>export</code>，webpack 还能够很好地支持多种其他模块语法，查看 <a href="/api/module-methods">模块 API</a> 以了解更多相关信息。</p><p>注意，webpack 不会更改代码中除 <code>import</code> 和 <code>export</code> 语句以外的部分。如果正在使用其它 <a href="http://es6-features.org/">ES2015 特性</a>，请确保 webpack 的 <a href="/concepts/loaders/">loader 系统</a> 中使用了像 <a href="https://babel.docschina.org/">Babel</a> 一样的 <a href="/loaders/#transpiling">转译器</a>。</p><h2><span id="using-a-configuration"></span>使用配置文件<a href="#using-a-configuration" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>webpack v4 无须任何配置即可运行，然而大多数项目会需要很复杂的设置，因此 webpack 仍然支持 <a href="/concepts/configuration">配置文件</a>，这比在终端中手动输入大量命令更加高效。接下来创建一个 webpack 配置文件：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- webpack.config.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js</span></span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&#x27;main.js&#x27;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>现在，让我们通过新的配置文件再次执行构建：</p><pre><code class="hljs language-bash">$ npx webpack --config webpack.config.js
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset main.js <span class="token number">69.3</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">1000</span> bytes <span class="token number">5</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1934</span> ms</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果 <code>webpack.config.js</code> 存在，则 <code>webpack</code> 命令将默认选择使用它。此处使用 <code>--config</code> 选项只是表明可以传递任何名称的配置文件。这对于需要拆分成多个文件的复杂配置是非常有用的。</p></aside><p>比起 CLI 这种简单直接的使用方式，配置文件更加灵活。开发者可以在配置文件中指定 loader 规则、插件、resolve 选项，以及许多其他增强功能。请查看 <a href="/configuration">配置文档</a> 以了解更多相关信息。</p><h2><span id="npm-scripts"></span>npm scripts<a href="#npm-scripts" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>考虑到使用 CLI 这种方式运行本地 webpack 副本不是特别方便，可以在 package.json 文件中添加 <a href="https://docs.npmjs.com/misc/scripts">npm script</a> 以设置一个快捷方式：</p><p><strong>package.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix inserted">+</span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>现在可以使用 <code>npm run build</code> 命令替代之前使用的 <code>npx</code> 命令。注意，使用 npm <code>scripts</code> 便可以像使用 <code>npx</code> 那样通过模块名引用本地安装的 npm 包。这是大多数基于 npm 的项目遵循的标准，因为它允许所有贡献者使用同一组通用脚本。</p><p>运行以下命令看看脚本别名是否正常运行：</p><pre><code class="hljs language-bash">$ <span class="token function">npm</span> run build

<span class="token punctuation">..</span>.

<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset main.js <span class="token number">69.3</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">1000</span> bytes <span class="token number">5</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1940</span> ms</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>可以通过在 <code>npm run build</code> 命令与参数之间添加两个连接符的方式向 webpack 传递自定义参数，例如：<code>npm run build -- --color</code>。</p></aside><h2><span id="conclusion"></span>总结<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在已经有了一个基础构建配置，可以移至下一指南——<a href="/guides/asset-management"><code>资源管理</code></a>，以了解如何通过 webpack 管理诸如图像、图标等资源。此刻你的项目目录看起来应该如下：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- main.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- index.html
</span></span>|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span>|- /node_modules</code></pre><aside class="warning"><h6 class="warning__prefix">警告</h6><p>不要使用 webpack 编译不可信的代码。它可能会在计算机，远程服务器或者在 web 应用程序使用者的浏览器中执行恶意代码。</p></aside><p>如果想要了解 webpack 设计思想，可以查看 <a href="/concepts">基本概念</a> 和 <a href="/configuration">配置</a> 页面。此外也能够在 <a href="/api">API</a> 章节深入了解 webpack 提供的各种接口。</p><h1><span id="管理资源"></span>管理资源<a href="#%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>如果是从一开始就沿用指南的示例，现在应该有一个可以显示“Hello webpack”的小项目。接下来尝试混合一些图像之类的其他资源，看看 webpack 如何处理。</p><p>在 webpack 出现之前，前端开发人员会使用 <a href="https://gruntjs.com/">grunt</a> 和 <a href="https://gulpjs.com/">gulp</a> 等工具处理资源，并将它们从 <code>/src</code> 文件夹移动到 <code>/dist</code> 或 <code>/build</code> 目录中。JavaScript 模块也遵循同样的方式。但是，像 webpack 这样的工具将 <strong>动态打包</strong> 所有依赖并创建所谓的 <a href="/concepts/dependency-graph">依赖图</a>。这是极好的创举，因为现在每个模块都可以 <strong>明确表述它自身的依赖</strong>，以避免打包未使用的模块。</p><p>webpack 最出色的功能之一就是除了引入 JavaScript，还可以通过 loader 或内置的 <a href="/guides/asset-modules/">资源模块</a> <strong>引入任何其他类型的文件</strong>。换言之，以上列出的那些 JavaScript 的优点（例如显式依赖），同样可以用来构建 web 站点或 web 应用程序中的所有非 JavaScript 内容。让我们从 CSS 开始起步，或许你可能已经熟悉了下面这些设置。</p><h2><span id="setup"></span>设置<a href="#setup" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在开始前对项目做一个小的修改：</p><p><strong>dist/index.html</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;title&gt;起步&lt;/title&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;title&gt;管理资源&lt;/title&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;</span></span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: &#x27;main.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><h2><span id="loading-css"></span>加载 CSS<a href="#loading-css" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>要想在 JavaScript 模块中导入 CSS 文件，需要安装 <a href="/loaders/style-loader">style-loader</a> 和 <a href="/loaders/css-loader">css-loader</a>，并在 <a href="/configuration/module"><code>module</code> 配置</a> 中添加这些 loader：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev style-loader css-loader</code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  module: {
</span><span class="token prefix inserted">+</span><span class="token line">    rules: [
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">    ],
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>module loader 可以链式调用。链中的每个 loader 都将对资源进行转换，不过链会逆序执行。第一个 loader 将其结果（被转换后的资源）传递给下一个 loader，依此类推。最后，webpack 期望链中的最后的 loader 返回 JavaScript。</p><p>请确保 loader 的先后顺序：<a href="/loaders/style-loader"><code>&#x27;style-loader&#x27;</code></a> 在前，而 <a href="/loaders/css-loader"><code>&#x27;css-loader&#x27;</code></a> 在后。如果不遵守此约定，webpack 可能会抛出错误。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>webpack 根据正则表达式确定应该查找哪些文件，并将其提供给指定的 loader。在此示例中，所有以 <code>.css</code> 结尾的文件，都将被提供给 <code>style-loader</code> 和 <code>css-loader</code>。</p></aside><p>这些配置可以帮助在依赖于此样式的 JavaScript 文件中 <code>import &#x27;./style.css&#x27;</code>。现在，在此模块执行过程中，含有 CSS 字符串的 <code>&lt;style&gt;</code> 标签，将被插入到 HTML 文件的 <code>&lt;head&gt;</code> 中。</p><p>让我们来试试！现在在项目中添加一个新的 <code>style.css</code> 文件，并将其导入到 <code>index.js</code> 中：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- style.css
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>src/style.css</strong></p><pre><code class="hljs language-css"><span class="token selector">.hello</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from &#x27;lodash&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import &#x27;./style.css&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // lodash 现在使用 import 引入。
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  element.classList.add(&#x27;hello&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>然后运行构建命令：</p><pre><code class="hljs language-bash">$ <span class="token function">npm</span> run build

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset bundle.js <span class="token number">72.6</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">1000</span> bytes <span class="token number">5</span> modules
orphan modules <span class="token number">326</span> bytes <span class="token punctuation">[</span>orphan<span class="token punctuation">]</span> <span class="token number">1</span> module
cacheable modules <span class="token number">539</span> KiB
  modules by path ./node_modules/ <span class="token number">538</span> KiB
    ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js <span class="token number">6.67</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./node_modules/css-loader/dist/runtime/api.js <span class="token number">1.57</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  modules by path ./src/ <span class="token number">965</span> bytes
    ./src/index.js + <span class="token number">1</span> modules <span class="token number">639</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./node_modules/css-loader/dist/cjs.js<span class="token operator">!</span>./src/style.css <span class="token number">326</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">2231</span> ms</code></pre><p>再次在浏览器中打开 <code>dist/index.html</code>，应该看到 <code>Hello webpack</code> 现在的样式是红色。请检查页面（不要查看页面源代码，它不会显示结果，因为 <code>&lt;style&gt;</code> 标签是由 JavaScript 动态创建的）并查看页面的 head 标签以观察 webpack 做了什么。可以发现，head 标签包含了原本不存在的 style 块元素，也就是在 <code>index.js</code> 中导入的 CSS 文件中的样式。</p><p>注意，在多数情况下也可以 <a href="/plugins/mini-css-extract-plugin/#minimizing-for-production">压缩 CSS</a> 以便在生产环境中节省加载时间。最重要的是，现有的 loader 可以支持任何可以想到的 CSS 样式 —— <a href="/loaders/postcss-loader">postcss</a>、<a href="/loaders/sass-loader">sass</a> 和 <a href="/loaders/less-loader">less</a> 等。</p><h2><span id="loading-images"></span>加载图像<a href="#loading-images" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>假如现在正在下载 CSS，但是像背景图片和图标这样的图像应该如何处理呢？webpack5 可以使用内置的 <a href="/guides/asset-modules/">资源模块</a> 轻松地将这些内容混入系统中：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>现在 <code>import MyImage from &#x27;./my-image.png&#x27;</code> 将会处理图像，将其添加到 <code>output</code> 目录，并且 <code>MyImage</code> 变量将包含该图像在处理后的最终的 url。如前所示，在使用 <a href="/loaders/css-loader">css-loader</a> 时，处理 CSS 中的 <code>url(&#x27;./my-image.png&#x27;)</code> 也会发生类似过程。loader 会识别这是一个本地文件，并将 <code>&#x27;./my-image.png&#x27;</code> 路径替换为 <code>output</code> 目录中图像的最终路径。而 <a href="/loaders/html-loader">html-loader</a> 也以相同方式处理 <code>&lt;img src=&quot;./my-image.png&quot; /&gt;</code>。</p><p>试试向项目中添加一个图像，并观察它是如何工作的：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- icon.png
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- style.css
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import &#x27;./style.css&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import Icon from &#x27;./icon.png&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // lodash 现在使用 import 引入。
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">  element.classList.add(&#x27;hello&#x27;);
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  // 将图像添加到已经存在的 div 中。
</span><span class="token prefix inserted">+</span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix inserted">+</span><span class="token line">  myIcon.src = Icon;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">  element.appendChild(myIcon);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p><strong>src/style.css</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">.hello {
</span><span class="token prefix unchanged"> </span><span class="token line">  color: red;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  background: url(&#x27;./icon.png&#x27;);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>重新构建并再次打开 <code>index.html</code> 文件：</p><pre><code class="hljs language-bash">$ <span class="token function">npm</span> run build

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
assets by status <span class="token number">9.88</span> KiB <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">1</span> asset
asset bundle.js <span class="token number">73.4</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">1.82</span> KiB <span class="token number">6</span> modules
orphan modules <span class="token number">326</span> bytes <span class="token punctuation">[</span>orphan<span class="token punctuation">]</span> <span class="token number">1</span> module
cacheable modules <span class="token number">540</span> KiB <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">9.88</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span>
  modules by path ./node_modules/ <span class="token number">539</span> KiB
    modules by path ./node_modules/css-loader/dist/runtime/*.js <span class="token number">2.38</span> KiB
      ./node_modules/css-loader/dist/runtime/api.js <span class="token number">1.57</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
      ./node_modules/css-loader/dist/runtime/getUrl.js <span class="token number">830</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js <span class="token number">6.67</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  modules by path ./src/ <span class="token number">1.45</span> KiB <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">9.88</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span>
    ./src/index.js + <span class="token number">1</span> modules <span class="token number">794</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./src/icon.png <span class="token number">42</span> bytes <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">9.88</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./node_modules/css-loader/dist/cjs.js<span class="token operator">!</span>./src/style.css <span class="token number">648</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1972</span> ms</code></pre><p>如果一切顺利，现在应该看到图标成为了重复的背景图，并且 <code>Hello webpack</code> 文本旁边出现了 <code>img</code> 元素。检查此元素将看到实际的文件名已更改为像 <code>29822eaa871e8eadeaa4.png</code> 一样的名称。这意味着 webpack 在 <code>src</code> 文件夹中找到了我们的文件，并对其进行了处理！</p><h2><span id="loading-fonts"></span>加载字体<a href="#loading-fonts" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>使用资源模块可以接收并加载任何文件，然后将其输出到构建目录。换言之，我们可以将它们用于任何类型的文件，也包括字体文件。更新 <code>webpack.config.js</code> 以处理字体文件：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>在项目中添加一些字体文件：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- my-font.woff
</span><span class="token prefix inserted">+</span><span class="token line">   |- my-font.woff2
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- icon.png
</span><span class="token prefix unchanged"> </span><span class="token line">   |- style.css
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p>配置好 loader 并将字体文件放在合适的位置后，可以通过 <code>@font-face</code> 声明将其混合。本地的 <code>url(...)</code> 指令会被 webpack 获取并处理，就像处理图片一样：</p><p><strong>src/style.css</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">@font-face {
</span><span class="token prefix inserted">+</span><span class="token line">  font-family: &#x27;MyFont&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">  src: url(&#x27;./my-font.woff2&#x27;) format(&#x27;woff2&#x27;),
</span><span class="token prefix inserted">+</span><span class="token line">    url(&#x27;./my-font.woff&#x27;) format(&#x27;woff&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">  font-weight: 600;
</span><span class="token prefix inserted">+</span><span class="token line">  font-style: normal;
</span><span class="token prefix inserted">+</span><span class="token line">}
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">.hello {
</span><span class="token prefix unchanged"> </span><span class="token line">  color: red;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  font-family: &#x27;MyFont&#x27;;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  background: url(&#x27;./icon.png&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>现在重新构建试试，看看 webpack 是否处理了字体：</p><pre><code class="hljs language-bash">$ <span class="token function">npm</span> run build

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
assets by status <span class="token number">9.88</span> KiB <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">1</span> asset
assets by info <span class="token number">33.2</span> KiB <span class="token punctuation">[</span>immutable<span class="token punctuation">]</span>
  asset 55055dbfc7c6a83f60ba.woff <span class="token number">18.8</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>immutable<span class="token punctuation">]</span> <span class="token punctuation">[</span>from: src/my-font.woff<span class="token punctuation">]</span> <span class="token punctuation">(</span>auxiliary name: main<span class="token punctuation">)</span>
  asset 8f717b802eaab4d7fb94.woff2 <span class="token number">14.5</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>immutable<span class="token punctuation">]</span> <span class="token punctuation">[</span>from: src/my-font.woff2<span class="token punctuation">]</span> <span class="token punctuation">(</span>auxiliary name: main<span class="token punctuation">)</span>
asset bundle.js <span class="token number">73.7</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">1.82</span> KiB <span class="token number">6</span> modules
orphan modules <span class="token number">326</span> bytes <span class="token punctuation">[</span>orphan<span class="token punctuation">]</span> <span class="token number">1</span> module
cacheable modules <span class="token number">541</span> KiB <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">43.1</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span>
  javascript modules <span class="token number">541</span> KiB
    modules by path ./node_modules/ <span class="token number">539</span> KiB
      modules by path ./node_modules/css-loader/dist/runtime/*.js <span class="token number">2.38</span> KiB <span class="token number">2</span> modules
      ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
      ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js <span class="token number">6.67</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    modules by path ./src/ <span class="token number">1.98</span> KiB
      ./src/index.js + <span class="token number">1</span> modules <span class="token number">794</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
      ./node_modules/css-loader/dist/cjs.js<span class="token operator">!</span>./src/style.css <span class="token number">1.21</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  asset modules <span class="token number">126</span> bytes <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">43.1</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span>
    ./src/icon.png <span class="token number">42</span> bytes <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">9.88</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./src/my-font.woff2 <span class="token number">42</span> bytes <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">14.5</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
    ./src/my-font.woff <span class="token number">42</span> bytes <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">18.8</span> KiB <span class="token punctuation">(</span>asset<span class="token punctuation">)</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">2142</span> ms</code></pre><p>重新打开 <code>dist/index.html</code> 观察 <code>Hello webpack</code> 文本是否换上了新的字体。如果一切顺利，应该能看到已经发生了变化。</p><h2><span id="loading-data"></span>加载数据<a href="#loading-data" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>此外，可以加载的有用资源还有数据，如 JSON 文件、CSV、TSV 和 XML。与 NodeJS 类似，对 JSON 的支持实际上也是内置的，即 <code>import Data from &#x27;./data.json&#x27;</code> 默认将正常运行。可以使用 <a href="https://github.com/theplatapi/csv-loader">csv-loader</a> 和 <a href="https://github.com/gisikw/xml-loader">xml-loader</a> 导入 CSV、TSV 与 XML。接下来试试加载这三类文件：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev csv-loader xml-loader</code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.(csv|tsv)$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        use: [&#x27;csv-loader&#x27;],
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.xml$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        use: [&#x27;xml-loader&#x27;],
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>在项目中添加一些数据文件：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- data.xml
</span><span class="token prefix inserted">+</span><span class="token line">   |- data.csv
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- my-font.woff
</span><span class="token prefix unchanged"> </span><span class="token line">   |- my-font.woff2
</span><span class="token prefix unchanged"> </span><span class="token line">   |- icon.png
</span><span class="token prefix unchanged"> </span><span class="token line">   |- style.css
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>src/data.xml</strong></p><pre><code class="hljs language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">&gt;</span></span>Mary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">&gt;</span></span>John<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">&gt;</span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>Call Cindy on Tuesday<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">&gt;</span></span></code></pre><p><strong>src/data.csv</strong></p><pre><code class="hljs language-csv">to,from,heading,body
Mary,John,Reminder,Call Cindy on Tuesday
Zoe,Bill,Reminder,Buy orange juice
Autumn,Lindsey,Letter,I miss you
</code></pre><p>现在可以导入这四种类型的数据（JSON, CSV, TSV, XML）中的任何一种了，所导入的 <code>Data</code> 变量，将包含可直接使用的已解析的 JSON：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import &#x27;./style.css&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import Icon from &#x27;./icon.png&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import Data from &#x27;./data.xml&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">import Notes from &#x27;./data.csv&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // lodash 现在使用 import 引入
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">  element.classList.add(&#x27;hello&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // 将图像添加到已经存在的 div 中。
</span><span class="token prefix unchanged"> </span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix unchanged"> </span><span class="token line">  myIcon.src = Icon;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.appendChild(myIcon);
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  console.log(Data);
</span><span class="token prefix inserted">+</span><span class="token line">  console.log(Notes);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>重新执行 <code>npm run build</code> 命令，然后打开 <code>dist/index.html</code>。在开发者工具中的控制台应该能够看到成功打印了导入的数据！</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>在使用 <a href="https://github.com/d3">d3</a> 等工具实现某些数据可视化时，这个功能极其有用。这将帮助不用在运行时发送请求获取和解析数据，而是在构建过程中将其提前加载到模块中，以便浏览器加载模块后，可以直接访问解析过的数据。</p></aside><aside class="warning"><h6 class="warning__prefix">警告</h6><p>只有在使用 JSON 模块默认导出时会没有警告。</p></aside><pre><code class="hljs language-javascript"><span class="token comment">// 没有警告</span>
<span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">&#x27;./data.json&#x27;</span><span class="token punctuation">;</span>

<span class="token comment">// 显示警告，规范不允许这样做。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./data.json&#x27;</span><span class="token punctuation">;</span></code></pre><h3><span id="customize-parser-of-json-modules"></span>自定义 JSON 模块解析器<a href="#customize-parser-of-json-modules" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>通过使用 <a href="/configuration/module/#ruleparserparse">自定义解析器</a> 替代特定的 webpack loader，可以将任何 <code>toml</code>、<code>yaml</code> 或 <code>json5</code> 文件作为 JSON 模块导入。</p><p>假设 <code>src</code> 文件夹下有 <code>data.toml</code>、<code>data.yaml</code> 以及 <code>data.json5</code> 文件：</p><p><strong>src/data.toml</strong></p><pre><code class="hljs language-toml">title = &quot;TOML Example&quot;

[owner]
name = &quot;Tom Preston-Werner&quot;
organization = &quot;GitHub&quot;
bio = &quot;GitHub Cofounder &amp; CEO\nLikes tater tots and beer.&quot;
dob = 1979-05-27T07:32:00Z
</code></pre><p><strong>src/data.yaml</strong></p><pre><code class="hljs language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> YAML Example
<span class="token key atrule">owner</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> Tom Preston<span class="token punctuation">-</span>Werner
  <span class="token key atrule">organization</span><span class="token punctuation">:</span> GitHub
  <span class="token key atrule">bio</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    GitHub Cofounder &amp; CEO
    Likes tater tots and beer.
  <span class="token key atrule">dob</span><span class="token punctuation">:</span> <span class="token datetime number">1979-05-27T07:32:00.000Z</span></code></pre><p><strong>src/data.json5</strong></p><pre><code class="hljs language-json5">{
  // comment
  title: &#x27;JSON5 Example&#x27;,
  owner: {
    name: &#x27;Tom Preston-Werner&#x27;,
    organization: &#x27;GitHub&#x27;,
    bio: &#x27;GitHub Cofounder &amp; CEO\n\
Likes tater tots and beer.&#x27;,
    dob: &#x27;1979-05-27T07:32:00.000Z&#x27;,
  },
}
</code></pre><p>首先安装 <code>toml</code>，<code>yamljs</code> 和 <code>json5</code> 对应的包：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> toml yamljs json5 --save-dev</code></pre><p>并在 webpack 中配置它们：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const toml = require(&#x27;toml&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">const yaml = require(&#x27;yamljs&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">const json5 = require(&#x27;json5&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(csv|tsv)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: [&#x27;csv-loader&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.xml$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: [&#x27;xml-loader&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.toml$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: &#x27;json&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">        parser: {
</span><span class="token prefix inserted">+</span><span class="token line">          parse: toml.parse,
</span><span class="token prefix inserted">+</span><span class="token line">        },
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.yaml$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: &#x27;json&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">        parser: {
</span><span class="token prefix inserted">+</span><span class="token line">          parse: yaml.parse,
</span><span class="token prefix inserted">+</span><span class="token line">        },
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.json5$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: &#x27;json&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">        parser: {
</span><span class="token prefix inserted">+</span><span class="token line">          parse: json5.parse,
</span><span class="token prefix inserted">+</span><span class="token line">        },
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import &#x27;./style.css&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import Icon from &#x27;./icon.png&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import Data from &#x27;./data.xml&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">import Notes from &#x27;./data.csv&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import toml from &#x27;./data.toml&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">import yaml from &#x27;./data.yaml&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">import json from &#x27;./data.json5&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">console.log(toml.title); // 输出 `TOML Example`
</span><span class="token prefix inserted">+</span><span class="token line">console.log(toml.owner.name); // 输出 `Tom Preston-Werner`
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">console.log(yaml.title); // 输出 `YAML Example`
</span><span class="token prefix inserted">+</span><span class="token line">console.log(yaml.owner.name); // 输出 `Tom Preston-Werner`
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">console.log(json.title); // 输出 `JSON5 Example`
</span><span class="token prefix inserted">+</span><span class="token line">console.log(json.owner.name); // 输出 `Tom Preston-Werner`
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // lodash 现在使用 import 引入。
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">  element.classList.add(&#x27;hello&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // 将图像添加到已经存在的 div 中。
</span><span class="token prefix unchanged"> </span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix unchanged"> </span><span class="token line">  myIcon.src = Icon;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.appendChild(myIcon);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  console.log(Data);
</span><span class="token prefix unchanged"> </span><span class="token line">  console.log(Notes);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>重新执行 <code>npm run build</code> 命令，然后打开 <code>dist/index.html</code> 就应该能够看到导入的数据会被打印到控制台上！</p><h2><span id="global-assets"></span>全局资源<a href="#global-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>上述所有内容中最出色之处在于，以这种方式加载资源，可以以更直观的方式将模块和资源组合在一起。无需依赖于含有全部资源的 <code>/assets</code> 目录，而是将资源与代码组合在一起使用。例如，类似这样的结构会非常有用：</p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- /assets
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |– /components
</span><span class="token prefix inserted">+</span><span class="token line"> |  |– /my-component
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– index.jsx
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– index.css
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– icon.svg
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– img.png</span></span></code></pre><p>这种配置方式会使代码更具备可移植性，因为现有的集中放置的方式会让紧密耦合所有资源。假如想在另一个项目中使用 <code>/my-component</code>，只需将其复制或移动到 <code>/components</code> 目录下。只要你已经安装过全部 <strong>外部依赖</strong> ，并且 <strong>已经在配置中定义过相同的 loader</strong> ，那么项目应该能够良好运行。</p><p>但是，假如只能被局限在旧有开发方式，或者有一些在多个组件（视图、模板、模块等）之间共享的资源，仍然可以将这些资源存储在一个基本目录中，甚至配合 <a href="/configuration/resolve/#resolvealias">alias</a> 可以更方便使用 <code>import</code> 导入。</p><h2><span id="wrapping-up"></span>回退处理<a href="#wrapping-up" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在下篇指南中无需使用本指南中所有用到的资源，因此需要进行一些清理工作，以便为下篇指南 <a href="/guides/output-management/">管理输出</a> 做好准备：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   |- data.csv
</span><span class="token prefix deleted">-</span><span class="token line">   |- data.json5
</span><span class="token prefix deleted">-</span><span class="token line">   |- data.toml
</span><span class="token prefix deleted">-</span><span class="token line">   |- data.xml
</span><span class="token prefix deleted">-</span><span class="token line">   |- data.yaml
</span><span class="token prefix deleted">-</span><span class="token line">   |- icon.png
</span><span class="token prefix deleted">-</span><span class="token line">   |- my-font.woff
</span><span class="token prefix deleted">-</span><span class="token line">   |- my-font.woff2
</span><span class="token prefix deleted">-</span><span class="token line">   |- style.css
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">const toml = require(&#x27;toml&#x27;);
</span><span class="token prefix deleted">-</span><span class="token line">const yaml = require(&#x27;yamljs&#x27;);
</span><span class="token prefix deleted">-</span><span class="token line">const json5 = require(&#x27;json5&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  module: {
</span><span class="token prefix deleted">-</span><span class="token line">    rules: [
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        type: &#x27;asset/resource&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.(csv|tsv)$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        use: [&#x27;csv-loader&#x27;],
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.xml$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        use: [&#x27;xml-loader&#x27;],
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.toml$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        type: &#x27;json&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">        parser: {
</span><span class="token prefix deleted">-</span><span class="token line">          parse: toml.parse,
</span><span class="token prefix deleted">-</span><span class="token line">        },
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.yaml$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        type: &#x27;json&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">        parser: {
</span><span class="token prefix deleted">-</span><span class="token line">          parse: yaml.parse,
</span><span class="token prefix deleted">-</span><span class="token line">        },
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">      {
</span><span class="token prefix deleted">-</span><span class="token line">        test: /\.json5$/i,
</span><span class="token prefix deleted">-</span><span class="token line">        type: &#x27;json&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">        parser: {
</span><span class="token prefix deleted">-</span><span class="token line">          parse: json5.parse,
</span><span class="token prefix deleted">-</span><span class="token line">        },
</span><span class="token prefix deleted">-</span><span class="token line">      },
</span><span class="token prefix deleted">-</span><span class="token line">    ],
</span><span class="token prefix deleted">-</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from &#x27;lodash&#x27;;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import &#x27;./style.css&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">import Icon from &#x27;./icon.png&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">import Data from &#x27;./data.xml&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">import Notes from &#x27;./data.csv&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">import toml from &#x27;./data.toml&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">import yaml from &#x27;./data.yaml&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">import json from &#x27;./data.json5&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">console.log(toml.title); // 输出 `TOML Example`
</span><span class="token prefix deleted">-</span><span class="token line">console.log(toml.owner.name); // 输出 `Tom Preston-Werner`
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">console.log(yaml.title); // 输出 `YAML Example`
</span><span class="token prefix deleted">-</span><span class="token line">console.log(yaml.owner.name); // 输出 `Tom Preston-Werner`
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">console.log(json.title); // 输出 `JSON5 Example`
</span><span class="token prefix deleted">-</span><span class="token line">console.log(json.owner.name); // 输出 `Tom Preston-Werner`
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // lodash 现在使用 import 引入。
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  element.classList.add(&#x27;hello&#x27;);
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">  // 将图像添加到已经存在的 div 中。
</span><span class="token prefix deleted">-</span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix deleted">-</span><span class="token line">  myIcon.src = Icon;
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">  element.appendChild(myIcon);
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">  console.log(Data);
</span><span class="token prefix deleted">-</span><span class="token line">  console.log(Notes);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>并移除之前添加的依赖：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> uninstall css-loader csv-loader json5 style-loader toml xml-loader yamljs</code></pre><h2><span id="next-guide"></span>下篇指南<a href="#next-guide" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>我们将继续移步到 <a href="/guides/output-management/">管理输出</a>。</p><h2><span id="further-reading"></span>延伸阅读<a href="#further-reading" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><ul><li>SurviveJS 额外介绍了 <a href="https://survivejs.com/webpack/loading/fonts/">字体加载</a>。</li></ul><h1><span id="管理输出"></span>管理输出<a href="#%E7%AE%A1%E7%90%86%E8%BE%93%E5%87%BA" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <a href="/guides/asset-management"><code>管理资源</code></a> 指南中的代码示例。</p></aside><p>目前为止，都是在 <code>index.html</code> 文件中手动引入所有资源，然而随着应用程序的不断增长，一旦开始 <a href="/guides/caching">使用哈希值进行文件命名</a> 并输出 <a href="/guides/code-splitting">多个 bundle</a>，手动管理 <code>index.html</code> 文件将变得困难。使用一些插件可以更容易管理这个过程。</p><h2><span id="preparation"></span>预先准备<a href="#preparation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>首先调整一下项目结构：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- print.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p>在 <code>src/print.js</code> 文件中添加一些逻辑：</p><p><strong>src/print.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">printMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;I get called from print.js!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>并在 <code>src/index.js</code> 文件中使用这个函数：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from &#x27;lodash&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import printMe from &#x27;./print.js&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  const btn = document.createElement(&#x27;button&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  btn.innerHTML = &#x27;Click me and check the console!&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">  btn.onclick = printMe;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">  element.appendChild(btn);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>更新 <code>dist/index.html</code> 文件，为 webpack 分离入口文件做准备：</p><p><strong>dist/index.html</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;title&gt;管理资源&lt;/title&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;title&gt;管理输出&lt;/title&gt;
</span><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;./print.bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;./index.bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;</span></span></code></pre><p>接下来调整配置：在 entry 添加 <code>src/print.js</code> 作为新的入口起点（命名为 <code>print</code>），然后修改 output 使得能够根据入口起点定义的名称动态生成 bundle 名称：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  entry: {
</span><span class="token prefix inserted">+</span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: &#x27;bundle.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>执行 <code>npm run build</code> 将看到输出如下：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset index.bundle.js <span class="token number">69.5</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span> <span class="token number">1</span> related asset
asset print.bundle.js <span class="token number">316</span> bytes <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: print<span class="token punctuation">)</span>
runtime modules <span class="token number">1.36</span> KiB <span class="token number">7</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">406</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/print.js <span class="token number">83</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1996</span> ms</code></pre><p>可以看到，webpack 将会生成 <code>print.bundle.js</code> 与 <code>index.bundle.js</code> 文件，即与在 <code>index.html</code> 文件中指定的文件名称相对应。试试在浏览器中打开 <code>index.html</code>，看看点击按钮时会发生什么。</p><p>如果更改入口起点的名称，或者添加一个新的入口起点，那么会在构建时重新命名生成的 bundle，而 <code>index.html</code> 仍然在引用旧的名称。使用 <a href="/plugins/html-webpack-plugin"><code>HtmlWebpackPlugin</code></a> 插件可以解决这个问题。</p><h2><span id="setting-up-htmlwebpackplugin"></span>设置 HtmlWebpackPlugin<a href="#setting-up-htmlwebpackplugin" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>安装插件并且调整 <code>webpack.config.js</code> 文件：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev html-webpack-plugin</code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix inserted">+</span><span class="token line">      title: &#x27;管理输出&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    }),
</span><span class="token prefix inserted">+</span><span class="token line">  ],
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>需要注意，在执行构建之前，虽然在 <code>dist/</code> 文件夹已经有了自定义的 <code>index.html</code> 文件，但是 <code>HtmlWebpackPlugin</code> 插件仍然会默认生成 <code>index.html</code> 文件，即使用新生成的 <code>index.html</code> 文件替换原有文件。观察执行 <code>npm run build</code> 后会发生什么：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset index.bundle.js <span class="token number">69.5</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span> <span class="token number">1</span> related asset
asset print.bundle.js <span class="token number">316</span> bytes <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: print<span class="token punctuation">)</span>
asset index.html <span class="token number">253</span> bytes <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
runtime modules <span class="token number">1.36</span> KiB <span class="token number">7</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">406</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/print.js <span class="token number">83</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">2189</span> ms</code></pre><p>代码编辑器中打开 <code>index.html</code> 会发现 <code>HtmlWebpackPlugin</code> 创建了一个全新的文件，而所有的 bundle 都已自动添加到其中。</p><p>参阅 <a href="https://github.com/jantimon/html-webpack-plugin"><code>HtmlWebpackPlugin</code></a> 仓库源码以了解 <code>HtmlWebpackPlugin</code> 插件提供的全部功能。</p><h2><span id="cleaning-up-the-dist-folder"></span>清理 <code>/dist</code> 文件夹<a href="#cleaning-up-the-dist-folder" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>可能已经注意到，由于遗留了之前的指南的代码示例，<code>/dist</code> 文件夹已经变得相当杂乱。webpack 生成文件并将其默认放置在 <code>/dist</code> 文件夹中，但是它不会追踪哪些文件是实际在项目中需要的。</p><p>通常比较推荐的做法是在每次构建前清理 <code>/dist</code> 文件夹，那么构建后就只会存在将要用到的文件。可以使用 <a href="/configuration/output/#outputclean"><code>output.clean</code></a> 配置选项实现这个需求。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: &#x27;Output Management&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    clean: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>再次执行 <code>npm run build</code> 后检查 <code>/dist</code> 文件夹。如果一切顺利，现在只会看到构建后生成的文件，而没有旧文件！</p><h2><span id="the-manifest"></span>manifest<a href="#the-manifest" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>你可能会对 webpack 和 webpack 插件似乎“知道”应该生成哪些文件感兴趣。webpack 通过 manifest 追踪所有模块到输出的 bundle 之间的映射。了解 manifest 将会帮助了解如何以其他方式控制 webpack <a href="/configuration/output"><code>输出</code></a>。</p><p><a href="https://github.com/shellscape/webpack-manifest-plugin"><code>WebpackManifestPlugin</code></a> 插件可以将 manifest 数据提取为 json 文件。</p><p>参阅 <a href="/concepts/manifest">manifest</a> 概念页面以深入了解如何在项目中使用此插件，同时 <a href="/guides/caching">缓存</a> 指南介绍了其与长效缓存之间的关系。</p><h2><span id="conclusion"></span>总结<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在已经了解如何向 HTML 动态添加 bundle，接下来继续深入 <a href="/guides/development">开发环境</a> 指南。如果想要深入更多相关高级话题，那么推荐前往 <a href="/guides/code-splitting">代码分离</a> 指南。</p><h1><span id="开发环境"></span>开发环境<a href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <a href="/guides/output-management">管理输出</a> 指南中的代码示例。</p></aside><p>如果已经阅读过之前的指南，那么应该对 webpack 的基础知识有了扎实的理解。在我们继续之前，先来看看如何设置开发环境，使我们的开发体验变得更轻松一些。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>本指南中的工具 <strong>仅用于开发环境</strong>，请 <strong>不要</strong> 在生产环境中使用它们！</p></aside><p>首先将 <a href="/configuration/mode/#mode-development"><code>mode</code> 设置为 <code>&#x27;development&#x27;</code></a>，并将 <code>title</code> 修改为 <code>&#x27;Development&#x27;</code>。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  mode: &#x27;development&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      title: &#x27;Output Management&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      title: &#x27;Development&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">    clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><h2><span id="using-source-maps"></span>使用 source map<a href="#using-source-maps" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>当 webpack 打包源代码时，可能会很难追踪到错误和警告在源代码中的原始位置。例如，如果将三个源文件（<code>a.js</code>，<code>b.js</code> 和 <code>c.js</code>）打包到一个 bundle（<code>bundle.js</code>）中，而其中一个源文件包含错误，那么堆栈跟踪就会直接指向到 <code>bundle.js</code>，却无法准确知道错误来自于哪个源文件，所以这种提示通常无法提供太多帮助。</p><p>为了更容易地追踪错误与警告在源代码中的原始位置，JavaScript 提供了 <a href="http://blog.teamtreehouse.com/introduction-source-maps">source map</a> 功能，可以帮助将编译后的代码映射回原始源代码。source map 会直接告诉开发者错误来源于哪一个源代码。</p><p>source map 有许多 <a href="/configuration/devtool">可用选项</a>，请务必仔细阅读它们，以便根据需要进行配置。</p><p>本指南将使用有助于解释说明示例意图的 <code>inline-source-map</code> 选项（不要在生产环境中使用它）：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  devtool: &#x27;inline-source-map&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: &#x27;Development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">    clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>现在让我们来试试：在 <code>print.js</code> 文件中故意编写有问题的代码：</p><p><strong>src/print.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">export default function printMe() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  console.log(&#x27;我被 print.js 调用了！&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  cosnole.log(&#x27;我被 print.js 调用了！&#x27;);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>运行 <code>npm run build</code>，编译如下：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset index.bundle.js <span class="token number">1.38</span> MiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
asset print.bundle.js <span class="token number">6.25</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: print<span class="token punctuation">)</span>
asset index.html <span class="token number">272</span> bytes <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
runtime modules <span class="token number">1.9</span> KiB <span class="token number">9</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">406</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/print.js <span class="token number">83</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">706</span> ms</code></pre><p>现在，在浏览器中打开生成的 <code>index.html</code> 文件，点击按钮后控制台将会报错。错误信息应该如下：</p><pre><code class="hljs language-bash">Uncaught ReferenceError: cosnole is not defined
   at HTMLButtonElement.printMe <span class="token punctuation">(</span>print.js:2<span class="token punctuation">)</span></code></pre><p>可以看到，此错误包含有发生错误的文件（<code>print.js</code>）和行号（2）的引用。这将帮助确切知道所要解决问题的位置。</p><h2><span id="choosing-a-development-tool"></span>选择一个开发工具<a href="#choosing-a-development-tool" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><aside class="warning"><h6 class="warning__prefix">警告</h6><p>某些文本编辑器具有安全写入（safe write）功能，可能会干扰下面介绍的一些工具。参阅 <a href="#adjusting-your-text-editor">调整文本编辑器</a> 以解决这些问题。</p></aside><p>每次编译代码都需要手动运行 <code>npm run build</code> 会显得很麻烦。</p><p>webpack 提供了几种可选方式帮助在代码发生变化后自动编译代码：</p><ol><li>webpack 的 <a href="/configuration/watch/#watch">观察模式</a></li><li><a href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a></li><li><a href="https://github.com/webpack/webpack-dev-middleware">webpack-dev-middleware</a></li></ol><p>在多数场景中可能会使用 <code>webpack-dev-server</code>，但是不妨探讨一下以上的所有选项。</p><h3><span id="using-watch-mode"></span>使用观察模式<a href="#using-watch-mode" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>可以指示 webpack “观察”依赖图中所有文件的更改。如果其中一个文件被更新，代码将被自动重新编译，所以不必再去手动运行整个构建。</p><p>像下面这样添加一个用于启动 webpack 观察模式的 npm scripts：</p><p><strong>package.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;watch&quot;: &quot;webpack --watch&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;html-webpack-plugin&quot;: &quot;^4.5.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>在命令行中运行 <code>npm run watch</code>，然后就会看到 webpack 是如何编译代码的。
编译完成后会发现它并没有退出命令行，这是因为该脚本当前还在观察你的文件。</p><p>现在，在 webpack 仍在观察文件的同时，移除之前故意加入的错误：</p><p><strong>src/print.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">export default function printMe() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  cosnole.log(&#x27;我被 print.js 调用了！&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  console.log(&#x27;我被 print.js 调用了！&#x27;);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>现在，保存文件并检查窗口，应该可以看到 webpack 已经自动地重新编译修改后的模块！</p><p>观察模式唯一的缺点是需要手动刷新浏览器才能看到修改后的实际效果。实现 <code>webpack-dev-server</code> 将能够自动刷新浏览器！</p><h3><span id="using-webpack-dev-server"></span>使用 webpack-dev-server<a href="#using-webpack-dev-server" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p><code>webpack-dev-server</code> 提供了一个能够实时重新加载的基本的 web server。安装依赖如下：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-dev-server</code></pre><p>接下来修改配置文件，告诉 dev server 应从什么位置开始查找文件：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  devtool: &#x27;inline-source-map&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  devServer: {
</span><span class="token prefix inserted">+</span><span class="token line">    static: &#x27;./dist&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: &#x27;Development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">    clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">    runtimeChunk: &#x27;single&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>以上配置告知 <code>webpack-dev-server</code> 将 <code>dist</code> 目录下的文件作为可访问资源部署在 <code>localhost:8080</code>。。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>由于在这个示例中单个 HTML 页面有多个入口，所以添加了 <code>optimization.runtimeChunk: &#x27;single&#x27;</code> 配置，否则可能会遇到 <a href="https://bundlers.tooling.report/code-splitting/multi-entry/">这个问题</a>。参阅 <a href="/guides/code-splitting/">代码分离</a> 章节了解更多细节。</p></aside><aside class="tip"><h6 class="tip__prefix">提示</h6><p><code>webpack-dev-server</code> 会将在 <a href="/configuration/output/#outputpath"><code>output.path</code></a> 中定义的目录中的 bundle 文件作为可访问资源部署在 server 中，即文件可以通过 <code>http://[devServer.host]:[devServer.port]/[output.publicPath]/[output.filename]</code> 进行访问。</p></aside><aside class="warning"><h6 class="warning__prefix">警告</h6><p><code>webpack-dev-server</code> 在编译之后不会写入任何输出文件，而是将 bundle 文件保留在内存中，然后将它们作为可访问资源部署在 server 中，就像是挂载在 server 根路径上的真实文件一样。如果页面希望在不同路径中找到 bundle 文件，可以修改 dev server 配置中的 <a href="/configuration/dev-server/#devserverdevmiddleware"><code>devMiddleware.publicPath</code></a> 选项。</p></aside><p>添加一个可以直接运行 dev server 的 script：</p><p><strong>package.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;watch&quot;: &quot;webpack --watch&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;start&quot;: &quot;webpack serve --open&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;html-webpack-plugin&quot;: &quot;^4.5.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-dev-server&quot;: &quot;^3.11.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>现在，在命令行中运行 <code>npm start</code>，会看到浏览器自动加载页面。更改任何源文件并保存它们，web server 将在编译代码后自动重新加载。试试看！</p><p><code>webpack-dev-server</code> 具有许多可配置的选项。参阅 <a href="/configuration/dev-server">配置文档</a> 以了解更多配置选项。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>现在 server 正在运行，也许你想试试 <a href="/guides/hot-module-replacement">模块热替换</a>！</p></aside><h3><span id="using-webpack-dev-middleware"></span>使用 webpack-dev-middleware<a href="#using-webpack-dev-middleware" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p><code>webpack-dev-middleware</code> 是一个包装器，它可以把 webpack 处理过的文件发送到 server。这是 <code>webpack-dev-server</code> 内部的原理，但是它也可以作为一个单独的包使用，以便根据需求进行更多自定义设置。下面是一个 <code>webpack-dev-middleware</code> 配合 <code>express</code> server 的示例。</p><p>首先，安装 <code>express</code> 和  <code>webpack-dev-middleware</code>：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev express webpack-dev-middleware</code></pre><p>现在调整 webpack 配置文件，以确保能够正确启用中间件：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  devtool: &#x27;inline-source-map&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">    static: &#x27;./dist&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: &#x27;Development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">    clean: true,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    publicPath: &#x27;/&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>在 server 脚本使用 <code>publicPath</code>，以确保文件资源能够作为可访问资源正确部署在 <code>http://localhost:3000</code> 下，稍后我们会指定端口号。接下来是设置自定义 <code>express</code> server：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- server.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- print.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>server.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;express&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-dev-middleware&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./webpack.config.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 告知 express 使用 webpack-dev-middleware，</span>
<span class="token comment">// 以及将 webpack.config.js 配置文件作为基础配置。</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将文件 serve 到 port 3000。</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Example app listening on port 3000!\n&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>现在添加 npm script 以便更方便地运行 server：</p><p><strong>package.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;watch&quot;: &quot;webpack --watch&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;start&quot;: &quot;webpack serve --open&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;server&quot;: &quot;node server.js&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;express&quot;: &quot;^4.17.1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;html-webpack-plugin&quot;: &quot;^4.5.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-dev-middleware&quot;: &quot;^4.0.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-dev-server&quot;: &quot;^3.11.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}</span></span></code></pre><p>在终端执行 <code>npm run server</code>，将会有类似如下信息输出：</p><pre><code class="hljs language-bash">Example app listening on port <span class="token number">3000</span><span class="token operator">!</span>
<span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> asset index.bundle.js <span class="token number">1.38</span> MiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> asset print.bundle.js <span class="token number">6.25</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: print<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> asset index.html <span class="token number">274</span> bytes <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> runtime modules <span class="token number">1.9</span> KiB <span class="token number">9</span> modules
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> cacheable modules <span class="token number">530</span> KiB
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>   ./src/index.js <span class="token number">406</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>   ./src/print.js <span class="token number">83</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>   ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">709</span> ms
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> Compiled successfully.
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> Compiling<span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> assets by status <span class="token number">1.38</span> MiB <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">2</span> assets
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> cached modules <span class="token number">530</span> KiB <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">1.9</span> KiB <span class="token punctuation">(</span>runtime<span class="token punctuation">)</span> <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">12</span> modules
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">19</span> ms
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> Compiled successfully.</code></pre><p>打开浏览器，访问 <code>http://localhost:3000</code>，应该看到 webpack 应用程序已经运行！</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>参阅 <a href="/guides/hot-module-replacement/">模块热替换</a> 指南了解更多关于模块热替换的运行机制。</p></aside><h2><span id="adjusting-your-text-editor"></span>调整文本编辑器<a href="#adjusting-your-text-editor" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>使用自动编译代码时，可能会在保存文件时遇到一些问题。某些编辑器具有安全写入功能，会影响重新编译。</p><p>查看以下列表以在常见编辑器中禁用此功能：</p><ul><li><strong>Sublime Text 3</strong>：在用户偏好中添加 <code>atomic_save: &#x27;false&#x27;</code>。</li><li><strong>JetBrains IDE（如 WebStorm）</strong>：在 <code>Preferences &gt; Appearance &amp; Behavior &gt; System Settings</code> 中取消选中使用安全写入。</li><li><strong>Vim</strong>：在设置中增加 <code>:set backupcopy=yes</code>。</li></ul><h2><span id="conclusion"></span>总结<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在已经学会了如何自动编译代码，并运行一个简单的开发环境 server。查看下一个指南学习 <a href="/guides/code-splitting/">代码分离</a> 吧！</p><h1><span id="代码分离"></span>代码分离<a href="#%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <a href="/guides/getting-started">起步</a> 中的示例代码。请确保你已熟悉这些指南中提供的示例以及 <a href="/guides/output-management/">管理输出</a> 章节。</p></aside><p>代码分离是 webpack 中最引人注目的特性之一。此特性能够把代码分离到不同的 bundle 中，然后便能按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle、控制资源加载优先级，如果使用合理，会极大减小加载时间。</p><p>常用的代码分离方法有三种：</p><ul><li><strong>入口起点</strong>：使用 <a href="/configuration/entry-context"><code>entry</code></a> 配置手动地分离代码。</li><li><strong>防止重复</strong>：使用 <a href="/configuration/entry-context/#dependencies">入口依赖</a> 或者 <a href="/plugins/split-chunks-plugin"><code>SplitChunksPlugin</code></a> 去重和分离 chunk。</li><li><strong>动态导入</strong>：通过模块的内联函数调用分离代码。</li></ul><h2><span id="entry-points"></span>入口起点<a href="#entry-points" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>这是迄今为止最简单直观的实现代码分离的方式。不过，这种方式手动配置较多，并有一些隐患。不过，我们将会介绍如何解决这些隐患。先来看看如何从 main bundle 中分离另一个模块：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- another-module.js
</span></span>|- /node_modules</code></pre><p><strong>another-module.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">&#x27;lodash&#x27;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;Another&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;module&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;loaded!&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#x27; &#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  entry: {
</span><span class="token prefix inserted">+</span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    another: &#x27;./src/another-module.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: &#x27;main.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>构建后结果如下：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset index.bundle.js <span class="token number">553</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
asset another.bundle.js <span class="token number">553</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: another<span class="token punctuation">)</span>
runtime modules <span class="token number">2.49</span> KiB <span class="token number">12</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/another-module.js <span class="token number">84</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">245</span> ms</code></pre><p>正如前面所提及，这种方式存在一些隐患：</p><ul><li>如果入口 chunk 之间包含一些重复的模块，那么这些重复模块会被引入到各个 bundle 中。</li><li>这种方法不够灵活，并且不能动态地拆分应用程序逻辑中的核心代码。</li></ul><p>以上两点中，第一点所对应的问题已经在我们上面的实例中体现出来了。除了 <code>./src/another-module.js</code>，我们也曾在 <code>./src/index.js</code> 中引入过 <code>lodash</code>，这就导致了重复引用。下一章节会介绍如何移除重复的模块。</p><h2><span id="prevent-duplication"></span>防止重复<a href="#prevent-duplication" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><h3><span id="entry-dependencies"></span>入口依赖<a href="#entry-dependencies" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>在配置文件中配置 <a href="/configuration/entry-context/#dependencies"><code>dependOn</code></a> 选项，以在多个 chunk 之间共享模块：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">    another: &#x27;./src/another-module.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    index: {
</span><span class="token prefix inserted">+</span><span class="token line">      import: &#x27;./src/index.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      dependOn: &#x27;shared&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    },
</span><span class="token prefix inserted">+</span><span class="token line">    another: {
</span><span class="token prefix inserted">+</span><span class="token line">      import: &#x27;./src/another-module.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      dependOn: &#x27;shared&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    },
</span><span class="token prefix inserted">+</span><span class="token line">    shared: &#x27;lodash&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>如果想要在一个 HTML 页面上使用多个入口起点，还需设置 <code>optimization.runtimeChunk: &#x27;single&#x27;</code>，否则会遇到 <a href="https://bundlers.tooling.report/code-splitting/multi-entry/">此处</a> 所述的麻烦。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: {
</span><span class="token prefix unchanged"> </span><span class="token line">      import: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      dependOn: &#x27;shared&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    },
</span><span class="token prefix unchanged"> </span><span class="token line">    another: {
</span><span class="token prefix unchanged"> </span><span class="token line">      import: &#x27;./src/another-module.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      dependOn: &#x27;shared&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    },
</span><span class="token prefix unchanged"> </span><span class="token line">    shared: &#x27;lodash&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">    runtimeChunk: &#x27;single&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>构建结果如下：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset shared.bundle.js <span class="token number">549</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: shared<span class="token punctuation">)</span>
asset runtime.bundle.js <span class="token number">7.79</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: runtime<span class="token punctuation">)</span>
asset index.bundle.js <span class="token number">1.77</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
asset another.bundle.js <span class="token number">1.65</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: another<span class="token punctuation">)</span>
Entrypoint index <span class="token number">1.77</span> KiB <span class="token operator">=</span> index.bundle.js
Entrypoint another <span class="token number">1.65</span> KiB <span class="token operator">=</span> another.bundle.js
Entrypoint shared <span class="token number">557</span> KiB <span class="token operator">=</span> runtime.bundle.js <span class="token number">7.79</span> KiB shared.bundle.js <span class="token number">549</span> KiB
runtime modules <span class="token number">3.76</span> KiB <span class="token number">7</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/another-module.js <span class="token number">84</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">249</span> ms</code></pre><p>可以看到，除了 <code>shared.bundle.js</code>，<code>index.bundle.js</code> 和 <code>another.bundle.js</code> 之外，还生成了一个 <code>runtime.bundle.js</code> 文件。</p><p>尽管 webpack 允许每个页面使用多个入口起点，但在可能的情况下，应该避免使用多个入口起点，而使用具有多个导入的单个入口起点：<code>entry: { page: [&#x27;./analytics&#x27;, &#x27;./app&#x27;] }</code>。这样可以获得更好的优化效果，并在使用异步脚本标签时保证执行顺序一致。</p><h3><span id="splitchunksplugin"></span>SplitChunksPlugin<a href="#splitchunksplugin" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p><a href="/plugins/split-chunks-plugin"><code>SplitChunksPlugin</code></a> 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。让我们使用这个插件去除之前示例中重复的 <code>lodash</code> 模块：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">     index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     another: &#x27;./src/another-module.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">     splitChunks: {
</span><span class="token prefix inserted">+</span><span class="token line">       chunks: &#x27;all&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>使用 <a href="/plugins/split-chunks-plugin/#optimizationsplitchunks"><code>optimization.splitChunks</code></a> 配置选项后构建，将会发现 <code>index.bundle.js</code> 和 <code>another.bundle.js</code> 已经移除了重复的依赖模块。从插件将 <code>lodash</code> 分离到单独的 chunk，并且将其从 main bundle 中移除，减轻了 bundle 大小。执行 <code>npm run build</code> 查看效果：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>id hint: vendors<span class="token punctuation">)</span>
asset index.bundle.js <span class="token number">8.92</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
asset another.bundle.js <span class="token number">8.8</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: another<span class="token punctuation">)</span>
Entrypoint index <span class="token number">558</span> KiB <span class="token operator">=</span> vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB index.bundle.js <span class="token number">8.92</span> KiB
Entrypoint another <span class="token number">558</span> KiB <span class="token operator">=</span> vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB another.bundle.js <span class="token number">8.8</span> KiB
runtime modules <span class="token number">7.64</span> KiB <span class="token number">14</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/another-module.js <span class="token number">84</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">241</span> ms</code></pre><p>以下是由社区提供，对代码分离很有帮助的 plugin 和 loader：</p><ul><li><a href="/plugins/mini-css-extract-plugin"><code>mini-css-extract-plugin</code></a>：用于将 CSS 从主应用程序中分离。</li></ul><h2><span id="dynamic-imports"></span>动态导入<a href="#dynamic-imports" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>webpack 提供了两个类似的技术实现动态代码分离。第一种，也是推荐选择的方式，是使用符合 <a href="https://github.com/tc39/proposal-dynamic-import">ECMAScript 提案</a> 的 <a href="/api/module-methods/#import"><code>import()</code> 语法</a> 实现动态导入。第二种则是 webpack 的遗留功能，使用 webpack 特定的 <a href="/api/module-methods/#requireensure"><code>require.ensure</code></a>。让我们先尝试使用第一种。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>调用 <code>import()</code> 会在内部使用 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a>。因此如果在旧版本浏览器中（如 IE 11）使用 <code>import()</code>，需要使用一个 polyfill 库（例如 <a href="https://github.com/stefanpenner/es6-promise">es6-promise</a> 或 <a href="https://github.com/taylorhakes/promise-polyfill">promise-polyfill</a>）shim <code>Promise</code>。</p></aside><p>在我们开始之前，先从上述示例的配置中移除多余的 <a href="/concepts/entry-points/"><code>entry</code></a> 和 <a href="/plugins/split-chunks-plugin/#optimizationsplitchunks"><code>optimization.splitChunks</code></a>，因为接下来的演示中并不需要它们：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: &#x27;development&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    another: &#x27;./src/another-module.js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  optimization: {
</span><span class="token prefix deleted">-</span><span class="token line">    splitChunks: {
</span><span class="token prefix deleted">-</span><span class="token line">      chunks: &#x27;all&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">    },
</span><span class="token prefix deleted">-</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>我们将更新我们的项目，移除现在未使用的文件：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- another-module.js
</span></span>|- /node_modules</code></pre><p>现在，我们不再静态导入 <code>lodash</code>，而是通过动态导入来分离出一个 chunk：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import _ from &#x27;lodash&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">function component() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">function getComponent() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // lodash 现在使用 import 引入
</span><span class="token prefix deleted">-</span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  return import(&#x27;lodash&#x27;)
</span><span class="token prefix inserted">+</span><span class="token line">    .then(({ default: _ }) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">      const element = document.createElement(&#x27;div&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">      element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  return element;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      return element;
</span><span class="token prefix inserted">+</span><span class="token line">    })
</span><span class="token prefix inserted">+</span><span class="token line">    .catch((error) =&gt; &#x27;An error occurred while loading the component&#x27;);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">getComponent().then((component) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">  document.body.appendChild(component);
</span><span class="token prefix inserted">+</span><span class="token line">});</span></span></code></pre><p>需要 <code>default</code> 的原因是自 webpack 4 之后，在导入 CommonJS 模块时，将不再解析为 <code>module.exports</code> 的值，而是创建一个人工命名空间对象来表示此 CommonJS 模块。参阅 <a href="https://medium.com/webpack/webpack-4-import-and-commonjs-d619d626b655">webpack 4: import() and CommonJs</a> 以了解更多有关信息。</p><p>试试构建最新的代码，看看 <code>lodash</code> 是否会分离到一个单独的 bundle：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>id hint: vendors<span class="token punctuation">)</span>
asset index.bundle.js <span class="token number">13.5</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
runtime modules <span class="token number">7.37</span> KiB <span class="token number">11</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">434</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">268</span> ms</code></pre><p>由于 <code>import()</code> 会返回 promise，因此它可以和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"><code>async</code> 函数</a> 一起使用。下面是使用 <code>async</code> 简化后的代码：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">function getComponent() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">async function getComponent() {
</span><span class="token prefix inserted">+</span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">  const { default: _ } = await import(&#x27;lodash&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  return import(&#x27;lodash&#x27;)
</span><span class="token prefix deleted">-</span><span class="token line">    .then(({ default: _ }) =&gt; {
</span><span class="token prefix deleted">-</span><span class="token line">      const element = document.createElement(&#x27;div&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">      return element;
</span><span class="token prefix deleted">-</span><span class="token line">    })
</span><span class="token prefix deleted">-</span><span class="token line">    .catch((error) =&gt; &#x27;An error occurred while loading the component&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  return element;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">getComponent().then((component) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">  document.body.appendChild(component);
</span><span class="token prefix unchanged"> </span><span class="token line">});</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>在稍后示例中，当需要根据计算后的变量导入特定模块时，可以通过向 <code>import()</code> 传入一个 <a href="/api/module-methods/#dynamic-expressions-in-import">动态表达式</a> 实现。</p></aside><h2><span id="prefetchingpreloading-modules"></span>预获取/预加载模块<a href="#prefetchingpreloading-modules" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>Webpack v4.6.0+ 增加了对预获取和预加载的支持。</p><p>声明 <code>import</code> 时使用下列内置指令可以让 webpack 输出“Resource Hint”告知浏览器：</p><ul><li><strong>预获取（prefetch）</strong>：将来某些导航下可能需要的资源</li><li><strong>预加载（preload）</strong>：当前导航下可能需要资源</li></ul><p>试想一下下面的场景：现在有一个 <code>HomePage</code> 组件，该组件内部渲染了一个 <code>LoginButton</code> 组件，点击后按钮后可以按需加载 <code>LoginModal</code> 组件。</p><p><strong>LoginButton.js</strong></p><pre><code class="hljs language-js"><span class="token comment">//...</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">&#x27;./path/to/LoginModal.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面的代码在构建时会生成 <code>&lt;link rel=&quot;prefetch&quot; href=&quot;login-modal-chunk.js&quot;&gt;</code> 并追加到页面头部，指示浏览器在闲置时间预获取 <code>login-modal-chunk.js</code> 文件。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>只要父 chunk 完成加载，webpack 就会添加预获取提示。</p></aside><p>与预获取指令相比，预加载指令有许多不同之处：</p><ul><li>预加载 chunk 会在父 chunk 加载时以并行方式开始加载；而预获取 chunk 会在父 chunk 加载结束后开始加载。</li><li>预加载 chunk 具有中等优先级，并会立即下载；而预获取 chunk 则在浏览器闲置时下载。</li><li>预加载 chunk 会在父 chunk 中立即请求，用于当下时刻；而预获取 chunk 则用于未来的某个时刻。</li><li>浏览器支持程度不同。</li></ul><p>下面这个简单的预加载示例中，有一个 <code>Component</code>，依赖于一个较大的库，所以应该将其分离到一个独立的 chunk 中。</p><p>假想这里的图表组件 <code>ChartComponent</code> 组件需要依赖一个体积巨大的 <code>ChartingLibrary</code> 库。它会在渲染时显示一个 <code>LoadingIndicator</code> 组件，然后立即按需导入 <code>ChartingLibrary</code>：</p><p><strong>ChartComponent.js</strong></p><pre><code class="hljs language-js"><span class="token comment">//...</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">&#x27;ChartingLibrary&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在页面中使用 <code>ChartComponent</code> 时会在请求 <code>ChartComponent.js</code> 的同时通过 <code>&lt;link rel=&quot;preload&quot;&gt;</code> 请求 <code>charting-library-chunk</code>。假定 page-chunk 体积比 <code>charting-library-chunk</code> 更小，也更快地被加载完成，那么当 <code>charting-library-chunk</code> 加载完成后，页面会首先显示 <code>LoadingIndicator</code>；当 <code>charting-library-chunk</code> 请求完成后，<code>LoadingIndicator</code> 组件才会消失。这将会使得加载时间能够更短一点，因为只进行单次往返，而不是两次往返，尤其是在高延迟环境下。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>不正确地使用 <code>webpackPreload</code> 会有损性能，请谨慎使用。</p></aside><p>有时需要自己控制预加载。例如，任何动态导入的预加载都可以通过异步脚本完成。这在流式服务器端渲染的情况下很有用。</p><pre><code class="hljs language-js"><span class="token keyword">const</span> <span class="token function-variable function">lazyComp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#x27;DynamicComponent&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在发生错误时做一些处理</span>
    <span class="token comment">// 例如可以在网络错误的情况下重试请求</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果在 webpack 开始加载该脚本之前脚本加载失败（如果该脚本不在页面上，webpack 只是创建一个 script 标签来加载其代码），则该 catch 处理程序将不会启动，直到 <a href="/configuration/output/#outputchunkloadtimeout">chunkLoadTimeout</a> 未通过。此行为可能是意料之外的。但这是可以解释的 —— webpack 不能抛出任何错误，因为 webpack 不知道那个脚本失败了。webpack 将在错误发生后立即将 onerror 处理脚本添加到 script 中。</p><p>可以通过添加自己的 onerror 处理脚本避免上述问题，这能够帮助在错误发生时移除该脚本</p><pre><code class="hljs language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://example.com/dist/dynamicComponent.js<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">async</span>
  <span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.remove()<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre><p>这种情况下错误脚本将被删除，而 webpack 将创建自己的脚本，并且任何错误都将被处理而没有任何超时。</p><h2><span id="bundle-analysis"></span>分析 bundle<a href="#bundle-analysis" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>一旦开始分离代码，一件很有帮助的事情是，分析输出结果来检查模块在何处结束。<a href="https://github.com/webpack/analyse">官方分析工具</a> 是一个不错的开始。还有一些其他社区支持的可选项：</p><ul><li><a href="https://alexkuz.github.io/webpack-chart/">webpack-chart</a>：webpack stats 可交互饼图。</li><li><a href="https://chrisbateman.github.io/webpack-visualizer/">webpack-visualizer</a>：分析并可视化 bundle，检查哪些模块占用空间，哪些可能是重复使用的。</li><li><a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack-bundle-analyzer</a>：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。</li><li><a href="https://webpack.jakoblind.no/optimize">webpack bundle optimize helper</a>：这个工具会分析 bundle，并提供可操作的改进措施，以减少 bundle 的大小。</li><li><a href="https://github.com/bundle-stats/bundle-stats">bundle-stats</a>：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。</li></ul><h2><span id="next-steps"></span>下一步<a href="#next-steps" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>接下来，参阅 <a href="/guides/lazy-loading/">懒加载</a> 了解如何在真实的应用程序中使用 <code>import()</code>，以及参阅 <a href="/guides/caching/">缓存</a> 了解如何有效地进行代码分离。</p><h1><span id="缓存"></span>缓存<a href="#%E7%BC%93%E5%AD%98" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <a href="/guides/getting-started">起步</a>、<a href="/guides/output-management">管理输出</a> 和 <a href="/guides/code-splitting">代码分离</a> 中的代码示例。</p></aside><p>接下来继续使用 webpack 打包模块化应用程序。webpack 会在打包后生成可部署的 <code>/dist</code> 目录，并将打包后的内容放在此目录。一旦 <code>/dist</code> 目录中的内容部署到服务器上，客户端（通常是浏览器）就能够访问此服务器以获取站点及其资源。由于获取服务器资源是比较耗费时间的操作，因此浏览器使用了一种名为 <a href="https://en.wikipedia.org/wiki/Cache_(computing)">缓存</a> 的技术。命中缓存可以降低网络流量，使网站加载速度更快。然而，如果在部署资源的最新版本时没有更改资源的文件名，浏览器可能会认为它没有被更新，从而使用它的缓存版本。由于缓存的存在，当需要获取新的代码时，就会显得很棘手。</p><p>这篇指南的重点在于通过必要配置确保 webpack 编译生成的文件能够被客户端缓存；当文件内容变化后，客户端又能够请求到新的文件。</p><h2><span id="output-filenames"></span>输出文件的文件名<a href="#output-filenames" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>更改 <code>output.filename</code> 中的 <a href="/configuration/output/#outputfilename">substitutions</a> 以定义输出文件的名称。webpack 提供了一种称为 <strong>可替换模板字符串（substitution）</strong> 的方式，通过带括号字符串来模板化文件名。其中，<code>[contenthash]</code> 将根据资源内容创建唯一哈希值。当资源内容发生变化时，<code>[contenthash]</code> 也会发生变化。</p><p>这里使用 <a href="/guides/getting-started">起步</a> 中的示例和 <a href="/guides/output-management">管理输出</a> 中的 <code>plugins</code> 插件作为项目基础，所以不必手动维护 <code>index.html</code> 文件：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span>|- /node_modules</code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       title: &#x27;Output Management&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       title: &#x27;Caching&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     filename: &#x27;bundle.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     filename: &#x27;[name].[contenthash].js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>调整配置后构建脚本，将会看到像下面一样的输出：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                       Asset       Size  Chunks                    Chunk Names
main.7e2c49a622975ebd9b7e.js     <span class="token number">544</span> kB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  main
                  index.html  <span class="token number">197</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.</code></pre><p>可以发现 bundle 的名称是其内容通过哈希的映射。也许会认为，如果不修改原始文件直接再次运行构建，文件名将保持不变。然而事实并非如此，试试再次构建脚本：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                       Asset       Size  Chunks                    Chunk Names
main.205199ab45963f6a62ec.js     <span class="token number">544</span> kB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  main
                  index.html  <span class="token number">197</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.</code></pre><p>再次执行构建后发现，尽管没有修改原始文件，bundle 的名称仍然发生了修改。这是因为 webpack 在入口 chunk 中包含了某些引导模板（boilerplate），特别是 runtime 和 manifest。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>输出可能会因当前的 webpack 版本而稍有差异。与旧版本相比，新版本未必持有同样的哈希机制，但我们仍然建议采取以下步骤以确保安全。</p></aside><h2><span id="extracting-boilerplate"></span>提取引导模板<a href="#extracting-boilerplate" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>正如在 <a href="/guides/code-splitting">代码分离</a> 中所学到的，<a href="/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> 插件可以用于将模块分离到单独的 bundle 中。webpack 还提供了一个优化功能，可以使用 <a href="/configuration/optimization/#optimizationruntimechunk"><code>optimization.runtimeChunk</code></a> 选项将 runtime 代码拆分为一个单独的 chunk。将其设置为 <code>single</code> 以便为所有 chunk 创建一个 runtime bundle：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">     title: &#x27;Caching&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].[contenthash].js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">     runtimeChunk: &#x27;single&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>更改配置后再次构建，查看提取出来的 <code>runtime</code> bundle：</p><pre><code class="hljs language-bash">Hash: 82c9c385607b2150fab2
Version: webpack <span class="token number">4.12</span>.0
Time: 3027ms
                          Asset       Size  Chunks             Chunk Names
runtime.cc17ae2a94ec771e9221.js   <span class="token number">1.42</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
   main.e81de2cf758ada72f306.js   <span class="token number">69.5</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
                     index.html  <span class="token number">275</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">497</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">489</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">309</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
    + <span class="token number">1</span> hidden module</code></pre><p>由于像 <code>lodash</code> 或 <code>react</code> 这样的第三方库很少像本地源代码一样频繁修改，因此通常推荐将第三方库提取到单独的 <code>vendor</code> chunk 中。这一步将减少客户端对服务器的请求，同时保证自身代码与服务器一致。可以通过使用 <a href="/plugins/split-chunks-plugin/#split-chunks-example-2">SplitChunksPlugin 示例 2</a> 中演示的 <a href="/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> 插件的 <a href="/plugins/split-chunks-plugin/#splitchunkscachegroups"><code>cacheGroups</code></a> 选项来实现。试试在 <code>optimization.splitChunks</code> 添加如下 <code>cacheGroups</code> 参数并执行构建：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">     title: &#x27;Caching&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].[contenthash].js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   optimization: {
</span><span class="token prefix unchanged"> </span><span class="token line">     runtimeChunk: &#x27;single&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     splitChunks: {
</span><span class="token prefix inserted">+</span><span class="token line">       cacheGroups: {
</span><span class="token prefix inserted">+</span><span class="token line">         vendor: {
</span><span class="token prefix inserted">+</span><span class="token line">           test: /[\\/]node_modules[\\/]/,
</span><span class="token prefix inserted">+</span><span class="token line">           name: &#x27;vendors&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">           chunks: &#x27;all&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">         },
</span><span class="token prefix inserted">+</span><span class="token line">       },
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>再次构建，然后查看新的 <code>vendor</code> bundle：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                          Asset       Size  Chunks             Chunk Names
runtime.cc17ae2a94ec771e9221.js   <span class="token number">1.42</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
vendors.a42c3ca0d742766d7a28.js   <span class="token number">69.4</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors
   main.abf44fedb7d11d4312d7.js  <span class="token number">240</span> bytes       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
                     index.html  <span class="token number">353</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.</code></pre><p>现在，可以看到 <code>main</code> 不再含有来自 <code>node_modules</code> 目录的 <code>vendor</code> 代码，并且体积减少到 <code>240 bytes</code>！</p><h2><span id="module-identifiers"></span>模块标识符<a href="#module-identifiers" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在项目中再添加一个模块 <code>print.js</code>：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- print.js
</span></span>|- /node_modules</code></pre><p><strong>print.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> export default function print(text) {
</span><span class="token prefix inserted">+</span><span class="token line">   console.log(text);
</span><span class="token prefix inserted">+</span><span class="token line"> };</span></span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import Print from &#x27;./print&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // lodash 现在使用 import 引入
</span><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.onclick = Print.bind(null, &#x27;Hello webpack!&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());</span></span></code></pre><p>通常我们会期望，当再次执行构建后，只有 <code>main</code> bundle 的哈希值会发生变化，然而……</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                           Asset       Size  Chunks                    Chunk Names
  runtime.1400d5af64fc1b7b3a45.js    <span class="token number">5.85</span> kB      <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         runtime
  vendor.a7561fb0e9a071baadb9.js     <span class="token number">541</span> kB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  vendor
    main.b746e3eb72875af2caa9.js    <span class="token number">1.22</span> kB       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         main
                      index.html  <span class="token number">352</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.</code></pre><p>可以发现，三个文件的哈希值都发生了变化。这是因为每个 <a href="/api/module-variables/#moduleid-commonjs"><code>module.id</code></a> 会默认基于解析顺序增加。换言之，当解析顺序发生变化，ID 也会随之改变。简要概括便是：</p><ul><li><code>main</code> bundle 会随着自身的新增内容的修改而发生变化。</li><li><code>vendor</code> bundle 会随着自身的 <code>module.id</code> 的变化而发生变化。</li><li><code>manifest</code> runtime 会因为现在包含一个新模块的引用而发生变化。</li></ul><p>上面的第一点与最后一点都是符合预期的行为，而 <code>vendor</code> 的哈希值发生变化是我们要修复的。试试将 <a href="/configuration/optimization/#optimizationmoduleids"><code>optimization.moduleIds</code></a> 设置为 <code>&#x27;deterministic&#x27;</code>：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: &#x27;Caching&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].[contenthash].js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   optimization: {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     moduleIds: &#x27;deterministic&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     runtimeChunk: &#x27;single&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     splitChunks: {
</span><span class="token prefix unchanged"> </span><span class="token line">       cacheGroups: {
</span><span class="token prefix unchanged"> </span><span class="token line">         vendor: {
</span><span class="token prefix unchanged"> </span><span class="token line">           test: /[\\/]node_modules[\\/]/,
</span><span class="token prefix unchanged"> </span><span class="token line">           name: &#x27;vendors&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">           chunks: &#x27;all&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">         },
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>现在，不论是否添加任何新的本地依赖，对于前后两次构建，<code>vendor</code> 的哈希值都应保持一致：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                          Asset       Size  Chunks             Chunk Names
   main.216e852f60c8829c2289.js  <span class="token number">340</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
vendors.55e79e5927a639d21a1b.js   <span class="token number">69.5</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors
runtime.725a1a51ede5ae0cfde0.js   <span class="token number">1.42</span> KiB       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
                     index.html  <span class="token number">353</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> runtime.725a1a51ede5ae0cfde0.js vendors.55e79e5927a639d21a1b.js main.216e852f60c8829c2289.js
<span class="token punctuation">..</span>.</code></pre><p>接下来修改 <code>src/index.js</code> 临时移除额外的依赖：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import Print from &#x27;./print&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> // import Print from &#x27;./print&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // lodash 现在使用 import 引入
</span><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   element.onclick = Print.bind(null, &#x27;Hello webpack!&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   // element.onclick = Print.bind(null, &#x27;Hello webpack!&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());</span></span></code></pre><p>最后，再次执行构建：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                          Asset       Size  Chunks             Chunk Names
   main.ad717f2466ce655fff5c.js  <span class="token number">274</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
vendors.55e79e5927a639d21a1b.js   <span class="token number">69.5</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors
runtime.725a1a51ede5ae0cfde0.js   <span class="token number">1.42</span> KiB       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
                     index.html  <span class="token number">353</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> runtime.725a1a51ede5ae0cfde0.js vendors.55e79e5927a639d21a1b.js main.ad717f2466ce655fff5c.js
<span class="token punctuation">..</span>.</code></pre><p>可以看到，在这两次构建中，<code>vendor</code> bundle 的文件名称都是 <code>55e79e5927a639d21a1b</code>。</p><h2><span id="conclusion"></span>总结<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>缓存可能很复杂，但是从应用程序或站点用户可以获得的收益来看，这值得付出努力。想要了解更多信息，请查看下面 <strong>延伸阅读</strong> 部分。</p><h1><span id="创建库"></span>创建库<a href="#%E5%88%9B%E5%BB%BA%E5%BA%93" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>除了打包应用程序，webpack 还可以打包 JavaScript 库。以下指南适用于希望简化打包策略的库作者。</p><h2><span id="authoring-a-library"></span>创建一个库<a href="#authoring-a-library" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>假设正在编写一个名为 <code>webpack-numbers</code> 的库，用于将数字 1 到 5 转换为文本表示，反之亦然，例如将 2 转换为 &#x27;two&#x27;。</p><p>基本的项目结构应该与下面类似：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  |- webpack.config.js
</span><span class="token prefix inserted">+</span><span class="token line">  |- package.json
</span><span class="token prefix inserted">+</span><span class="token line">  |- /src
</span><span class="token prefix inserted">+</span><span class="token line">    |- index.js
</span><span class="token prefix inserted">+</span><span class="token line">    |- ref.json</span></span></code></pre><p>使用 npm 初始化项目，然后安装 <code>webpack</code>、<code>webpack-cli</code> 与 <code>lodash</code>：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack webpack-cli lodash</code></pre><p>注意：由于不需要将 <code>lodash</code> 一同打包到库中，因此应该将其安装为 <code>devDependencies</code> 而非 <code>dependencies</code>，否则库体积会变得很大。</p><p><strong>src/ref.json</strong></p><pre><code class="hljs language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;One&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Two&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Three&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Four&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Five&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Zero&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">&#x27;lodash&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> numRef <span class="token keyword">from</span> <span class="token string">&#x27;./ref.json&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">numToWord</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    numRef<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">accum<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> ref<span class="token punctuation">.</span>num <span class="token operator">===</span> num <span class="token operator">?</span> ref<span class="token punctuation">.</span>word <span class="token operator">:</span> accum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;&#x27;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    numRef<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">accum<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> ref<span class="token punctuation">.</span>word <span class="token operator">===</span> word <span class="token operator">&amp;&amp;</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> ref<span class="token punctuation">.</span>num <span class="token operator">:</span> accum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h2><span id="webpack-configuration"></span>webpack 配置<a href="#webpack-configuration" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>从如下 webpack 基本配置开始：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&#x27;webpack-numbers.js&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>上述配置告诉 webpack 将 <code>src/index.js</code> 打包到 <code>dist/webpack-numbers.js</code> 中。</p><h2><span id="expose-the-library"></span>暴露库<a href="#expose-the-library" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>到目前为止，一切都应该与打包应用程序一样，但是打包库有一个不同的地方——需要通过 <a href="/configuration/output/#outputlibrary"><code>output.library</code></a> 配置项暴露从入口起点导出的内容。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;webpack-numbers.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     library: &quot;webpackNumbers&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>我们将入口暴露为 <code>webpackNumbers</code>，这样用户就可以通过脚本标签使用它：</p><pre><code class="hljs language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://example.org/webpack-numbers.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span>webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">&#x27;Five&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre><p>然而它只能通过被脚本标签引用而发挥作用，而不能运行在 CommonJS、AMD、Node.js 等环境中。</p><p>作为一个库作者，我们希望它能够兼容不同的环境。换言之，用户应该能够通过以下方式使用打包后的库：</p><ul><li><p><strong>在 CommonJS 模块中导入</strong>：</p><pre><code class="hljs language-js"><span class="token keyword">const</span> webpackNumbers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-numbers&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ……</span>
webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">&#x27;Two&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p><strong>在 AMD 模块中导入</strong>：</p><pre><code class="hljs language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;webpackNumbers&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">webpackNumbers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ……</span>
  webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">&#x27;Two&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p><strong>使用脚本标签</strong>：</p><pre><code class="hljs language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://example.org/webpack-numbers.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// ……</span>
    <span class="token comment">// 全局变量</span>
    webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">&#x27;Five&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 属性处于 window 对象中</span>
    window<span class="token punctuation">.</span>webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">&#x27;Five&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ……</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre></li></ul><p>接下来更新 <code>output.library</code> 配置项，将其 <code>type</code> 设置为 <a href="/configuration/output/#type-umd"><code>&#x27;umd&#x27;</code></a>：</p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;webpack-numbers.js&#x27;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    library: &#x27;webpackNumbers&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    library: {
</span><span class="token prefix inserted">+</span><span class="token line">      name: &#x27;webpackNumbers&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      type: &#x27;umd&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>现在 webpack 将打包它，使其可以通过 CommonJS、AMD 模块以及脚本标签使用。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>请注意，<code>library</code> 选项与 <code>entry</code> 配置项绑定。对于绝大多数的库，指定一个入口就已经足够了。尽管可能存在 <a href="https://github.com/webpack/webpack/tree/master/examples/multi-part-library">multi-part library</a>，但通过作为单个入口起点的 <a href="https://stackoverflow.com/questions/34072598/es6-exporting-importing-in-index-file">index 脚本</a> 暴露部分导出会更简单。<strong>不推荐</strong> 使用数组作为 <code>entry</code>。</p></aside><h2><span id="externalize-lodash"></span>外部化 lodash<a href="#externalize-lodash" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在，如果执行 <code>webpack</code>，你会发现创建了一个体积相当大的文件。查看文件可以发现 lodash 也被打包到代码中。在这种场景中，我们更倾向于把 <code>lodash</code> 当作 <code>peerDependency</code>，即使用者应该已经自行安装过 <code>lodash</code>，这样便可以放弃控制此外部库，将控制权让给使用此库的开发者。</p><p>使用 <code>externals</code> 配置即可实现上述目标：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;webpack-numbers.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     library: {
</span><span class="token prefix unchanged"> </span><span class="token line">       name: &quot;webpackNumbers&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: &quot;umd&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   externals: {
</span><span class="token prefix inserted">+</span><span class="token line">     lodash: {
</span><span class="token prefix inserted">+</span><span class="token line">       commonjs: &#x27;lodash&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">       commonjs2: &#x27;lodash&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">       amd: &#x27;lodash&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">       root: &#x27;_&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>上面的配置意味着这个库需要一个名为 <code>lodash</code> 的依赖，这个依赖在开发者环境中必须存在且可用。</p><h3><span id="external-limitations"></span>外部化的限制<a href="#external-limitations" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>对于想要实现从一个依赖中调用多个文件的那些库：</p><pre><code class="hljs language-js"><span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">&#x27;library/one&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">B</span> <span class="token keyword">from</span> <span class="token string">&#x27;library/two&#x27;</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span></code></pre><p>无法通过在 <code>externals</code> 中指定整个 <code>library</code> 的方式将它们从 bundle 中排除，而是需要逐个或者使用正则表达式排除它们。</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  externals<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#x27;library/one&#x27;</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;library/two&#x27;</span><span class="token punctuation">,</span>
    <span class="token comment">// 匹配以 &quot;library/&quot; 开始的所有依赖</span>
    <span class="token operator">/</span><span class="token operator">^</span>library\<span class="token regex">/.+$/</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2><span id="final-steps"></span>最终步骤<a href="#final-steps" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>遵循 <a href="/guides/production">生产环境</a> 指南中提到的步骤优化生产环境下的输出结果。那么此时还需要生成 bundle 的文件路径，并将其添加到 <code>package.json</code> 中的 <code>main</code> 字段中。</p><p><strong>package.json</strong></p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/webpack-numbers.js&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span></code></pre><p>或者也可以按照这个 <a href="https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md#typical-usage">指南</a> 将其添加为标准模块：</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/index.js&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span></code></pre><p>此处的键 <code>main</code> 是参照 <a href="https://docs.npmjs.com/files/package.json#main"><code>package.json</code> 标准</a>，而 <code>module</code> 是参照 <a href="https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md">这个</a> <a href="https://github.com/rollup/rollup/wiki/pkg.module">提案</a>，此提案允许 JavaScript 生态系统升级使用 ES2015 模块，而不会破坏向后兼容性。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p><code>module</code> 属性应指向一个使用 ES2015 模块语法的脚本，但不包括浏览器或 Node.js 尚不支持的其他语法特性。这使得 webpack 本身就可以解析模块语法，如果用户只用到库的某些部分，则允许通过 <a href="https://webpack.docschina.org/guides/tree-shaking/">tree shaking</a> 打包更轻量的包。</p></aside><p>现在便可以 <a href="https://docs.npmjs.com/getting-started/publishing-npm-packages">将其发布为一个 npm 包</a>，并且在 <a href="https://unpkg.com/#/">unpkg.com</a> 找到它，并分发给用户。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>建议使用 <a href="/plugins/mini-css-extract-plugin"><code>MiniCssExtractPlugin</code></a> 暴露与库关联的样式表，然后用户可以像使用其他样式表一样使用和加载这些样式表。</p></aside><h1><span id="环境变量"></span>环境变量<a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>想要消除 <code>webpack.config.js</code> 在 <a href="/guides/development">开发环境</a> 和 <a href="/guides/production">生产环境</a> 之间的差异，你可能需要环境变量(environment variable)。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>webpack 环境变量，与操作系统中的 <code>bash</code> 和 <code>CMD.exe</code> 这些 shell <a href="https://en.wikipedia.org/wiki/Environment_variable">环境变量</a> 不同。</p></aside><p>webpack 命令行 <a href="/api/cli/#environment-options">环境配置</a> 的 <code>--env</code> 参数，可以允许你传入任意数量的环境变量。而在 <code>webpack.config.js</code> 中可以访问到这些环境变量。例如，<code>--env production</code> 或 <code>--env goal=local</code>。</p><pre><code class="hljs language-bash">npx webpack --env <span class="token assign-left variable">goal</span><span class="token operator">=</span>local --env production --progress</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果设置 <code>env</code> 变量，却没有赋值，<code>--env production</code> 默认表示将 <code>env.production</code> 设置为 <code>true</code>。还有许多其他可以使用的语法。更多详细信息，请查看 <a href="/api/cli/#environment-options">webpack CLI</a> 文档。</p></aside><p>对于我们的 webpack 配置，有一个必须要修改之处。通常，<code>module.exports</code> 指向配置对象。要使用 <code>env</code> 变量，你必须将 <code>module.exports</code> 转换成一个函数：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use env.&lt;YOUR VARIABLE&gt; here:</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Goal: &#x27;</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>goal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;local&#x27;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Production: &#x27;</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&#x27;bundle.js&#x27;</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>webpack CLI 提供一些你可以在 webpack 配置中访问的<a href="/api/cli/#cli-environment-variables">内建环境变量</a>。</p></aside><h1><span id="构建性能"></span>构建性能<a href="#%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>本指南包含一些改进构建/编译性能的实用技巧。</p><hr/><h2><span id="general"></span>通用环境<a href="#general" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>无论是在 <a href="/guides/development">开发环境</a> 还是在 <a href="/guides/production">生产环境</a> 下运行构建脚本，以下最佳实践都会有所帮助。</p><h3><span id="stay-up-to-date"></span>更新到最新版本<a href="#stay-up-to-date" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>使用最新的 webpack 版本。我们会一直坚持进行性能优化。webpack 的最新稳定版本是：</p><p><a href="https://github.com/webpack/webpack/releases"><img src="https://img.shields.io/github/package-json/v/webpack/webpack.svg?label=webpack&amp;style=flat-square&amp;maxAge=3600" alt="latest webpack version"/></a></p><p>将 <strong>Node.js</strong> 与 package 管理工具（例如 <code>npm</code> 或者 <code>yarn</code>）更新到最新版本均有助于提高性能。较新的版本能够建立更高效的模块树并提高解析速度。</p><h3><span id="loaders"></span>loader<a href="#loaders" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>将 loader 应用于最少数量的必要模块。反例：</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">&#x27;babel-loader&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>使用 <code>include</code> 字段将 loader 应用在实际需要将其转换的模块：</p><pre><code class="hljs language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;src&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">&#x27;babel-loader&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3><span id="bootstrap"></span>引导（bootstrap）<a href="#bootstrap" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>每个额外的 loader/plugin 都有其启动时间。尽量少地使用工具。</p><h3><span id="resolving"></span>解析<a href="#resolving" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>以下步骤可以提高解析速度：</p><ul><li>减少 <code>resolve.modules</code>, <code>resolve.extensions</code>, <code>resolve.mainFiles</code>, <code>resolve.descriptionFiles</code> 中条目数量，因为他们会增加文件系统调用的次数。</li><li>如果不使用 symlinks（例如 <code>npm link</code> 或者 <code>yarn link</code>），可以设置 <code>resolve.symlinks: false</code>。</li><li>如果使用自定义解析插件规则，并且没有指定上下文，可以设置 <code>resolve.cacheWithContext: false</code>。</li></ul><h3><span id="dlls"></span>dll<a href="#dlls" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>使用 <code>DllPlugin</code> 为更改不频繁的代码生成单独的编译结果。尽管这增加了构建过程的复杂度，但是可以提高应用程序的编译速度。</p><h3><span id="smaller--faster"></span>小即是快<a href="#smaller--faster" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>减少编译结果的整体大小以提高构建性能。尽量保持 chunk 体积小。</p><ul><li>使用数量更少/体积更小的库</li><li>在多页面应用程序中使用 <code>SplitChunksPlugin</code>。</li><li>在多页面应用程序中使用 <code>SplitChunksPlugin</code>，并开启 <code>async</code> 模式。</li><li>移除未使用的代码。</li><li>只编译当前正在开发的那些代码。</li></ul><h3><span id="worker-pool"></span>worker 池<a href="#worker-pool" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p><code>thread-loader</code> 可以将非常消耗资源的 loader 分流给 worker 池。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>由于 Node.js 运行时与 loader 都有启动开销，尽量不要使用太多 worker，尝试最小化 worker 与主进程之间的模块传输。进程间通讯非常消耗资源。</p></aside><h3><span id="persistent-cache"></span>持久化缓存<a href="#persistent-cache" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>在 webpack 配置中使用 <a href="/configuration/cache"><code>cache</code></a> 选项。使用 <code>package.json</code> 中的 <code>&quot;postinstall&quot;</code> 清除缓存目录。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>我们支持使用 yarn PnP v3 <a href="https://yarnpkg.com/features/pnp"><code>yarn 2 berry</code></a> 进行持久缓存。</p></aside><h3><span id="custom-pluginsloaders"></span>自定义 plugin/loader<a href="#custom-pluginsloaders" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>请在使用自定义 plugin/loader 前对其进行概要分析以免在此处引入性能问题。</p><h3><span id="progress-plugin"></span>Progress 插件<a href="#progress-plugin" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>将 <code>ProgressPlugin</code> 从 webpack 中删除可以缩短构建时间。请注意，<code>ProgressPlugin</code> 可能不会为快速构建提供太多价值，因此请权衡利弊再使用。</p><hr/><h2><span id="development"></span>开发环境<a href="#development" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>以下步骤在开发环境中特别有帮助。</p><h3><span id="incremental-builds"></span>增量编译<a href="#incremental-builds" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>使用 webpack 的观察模式，而非使用其他工具观察文件、调用 webpack。内置的观察模式会记录时间戳并将此信息传递给编译以使缓存失效。</p><p>在某些配置环境中，观察模式会回退到轮询模式。监听过量文件会导致 CPU 大量负载。此时可以使用 <code>watchOptions.poll</code> 增加轮询的间隔时间。</p><h3><span id="compile-in-memory"></span>在内存中编译<a href="#compile-in-memory" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>使用下面几个工具实现在内存中（而不是写入磁盘）编译并部署可访问资源以提高性能：</p><ul><li><code>webpack-dev-server</code></li><li><code>webpack-hot-middleware</code></li><li><code>webpack-dev-middleware</code></li></ul><h3><span id="statstojson-speed"></span>加速 stats.toJson<a href="#statstojson-speed" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>webpack 4 默认使用 <code>stats.toJson()</code> 输出大量数据。但是除非在增量步骤中做必要的统计，否则请避免获取 <code>stats</code> 对象的部分内容。<code>webpack-dev-server</code> 在 v3.1.3 以后的版本，包含一个重要的性能修复，即最小化每个增量构建步骤中会从 <code>stats</code> 对象获取的数据量。</p><h3><span id="devtool"></span>devtool<a href="#devtool" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>不同的 <code>devtool</code> 设置会导致性能差异。</p><ul><li><code>&quot;eval&quot;</code> 具有最好的性能，但并不能帮助转译代码。</li><li>如果能接受稍差一些的映射质量，可以使用 <code>cheap-source-map</code> 变体配置提高性能。</li><li>使用 <code>eval-source-map</code> 变体配置进行增量编译。</li></ul><aside class="tip"><h6 class="tip__prefix">提示</h6><p>在大多数情况下，最佳选择是 <code>eval-cheap-module-source-map</code>。</p></aside><h3><span id="avoid-production-specific-tooling"></span>避免使用在生产环境下才会用到的工具<a href="#avoid-production-specific-tooling" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>某些工具、插件与 loader 都只用于生产环境。例如，在开发环境下使用 <code>TerserPlugin</code> 压缩和破坏代码是没有意义的。通常应该在开发环境下排除以下工具：</p><ul><li><code>TerserPlugin</code></li><li><code>[fullhash]</code>/<code>[chunkhash]</code>/<code>[contenthash]</code></li><li><code>AggressiveSplittingPlugin</code></li><li><code>AggressiveMergingPlugin</code></li><li><code>ModuleConcatenationPlugin</code></li></ul><h3><span id="minimal-entry-chunk"></span>最小化入口 chunk<a href="#minimal-entry-chunk" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>webpack 只会在文件系统中输出已经更新的 chunk。对于某些配置选项（HMR, <code>output.chunkFilename</code> 中的 <code>[name]</code>/<code>[chunkhash]/[contenthash]</code>，<code>[fullhash]</code>）而言，除了已更新的 chunk 之外，入口 chunk 也会失效。</p><p>尽量在生成入口 chunk 时减小其体积以提高性能。下面的配置为运行时代码创建了一个额外的 chunk，所以它的生成代价较低：</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    runtimeChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3><span id="avoid-extra-optimization-steps"></span>避免额外的优化步骤<a href="#avoid-extra-optimization-steps" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>webpack 通过执行额外的算法任务优化输出结果的体积和加载的性能。这些优化适用于小型代码库，但是在大型代码库中却非常耗费性能：</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    removeAvailableModules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    removeEmptyChunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    splitChunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3><span id="output-without-path-info"></span>输出结果不携带路径信息<a href="#output-without-path-info" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>webpack 会在输出的 bundle 中生成路径信息。然而，在打包数千个模块的项目中，这会带来垃圾回收性能的压力。在 <code>options.output.pathinfo</code> 设置中关闭它：</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    pathinfo<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3><span id="nodejs-versions-8910-9111"></span>Node.js 版本 8.9.10-9.11.1<a href="#nodejs-versions-8910-9111" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>Node.js v8.9.10 - v9.11.1 中的 ES2015 <code>Map</code> 和 <code>Set</code> 实现，存在 <a href="https://github.com/nodejs/node/issues/19769">性能回退</a>。webpack 大量地使用这些数据结构，因此这些回退也会影响编译时间。</p><p>之前和之后的 Node.js 版本不受影响。</p><h3><span id="typescript-loader"></span>TypeScript loader<a href="#typescript-loader" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>向 loader 传入 <code>transpileOnly</code> 选项，以缩短使用 <code>ts-loader</code> 时的构建时间。使用此选项会关闭类型检查。如果要再次开启类型检查，请使用 <a href="https://www.npmjs.com/package/fork-ts-checker-webpack-plugin"><code>ForkTsCheckerWebpackPlugin</code></a>。使用此插件会将检查过程移至单独的进程，这样可以加快 TypeScript 的类型检查和 ESLint 插入的速度。</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  test<span class="token operator">:</span> <span class="token regex">/\.tsx?$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&#x27;ts-loader&#x27;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        transpileOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>这是一个关于 <code>ts-loader</code> <a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/fork-ts-checker-webpack-plugin">完整示例</a> 的 GitHub 仓库。</p></aside><hr/><h2><span id="production"></span>生产环境<a href="#production" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>以下步骤在生产环境中特别有帮助。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p><strong>不要为了很小的性能收益，牺牲应用程序的质量</strong>！注意，在大多数情况下，优化代码质量比构建性能更重要。</p></aside><h3><span id="source-maps"></span>source map<a href="#source-maps" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>source map 相当消耗资源，请确保真的需要它们。</p><hr/><h2><span id="specific-tooling-issues"></span>工具相关问题<a href="#specific-tooling-issues" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>下列工具存在某些可能会降低构建性能的问题：</p><h3><span id="babel"></span>babel<a href="#babel" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li>最小化项目中的 preset/plugin 数量。</li></ul><h3><span id="typescript"></span>TypeScript<a href="#typescript" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li>在单独的进程中使用 <code>fork-ts-checker-webpack-plugin</code> 进行类型检查。</li><li>配置 loader 跳过类型检查。</li><li>使用 <code>ts-loader</code> 时，设置 <code>happyPackMode: true</code> 或 <code>transpileOnly: true</code>。</li></ul><h3><span id="sass"></span>sass<a href="#sass" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><code>node-sass</code> 中存在 bug，会阻塞 Node.js 线程池中的线程。当使用 <code>thread-loader</code> 时，需要设置 <code>workerParallelJobs: 2</code>。</li></ul><h1><span id="内容安全策略CSP"></span>内容安全策略（CSP）<a href="#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5CSP" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>webpack 能够为其加载的所有脚本添加 <code>nonce</code>，即一次性随机数。在入口文件中设置一个 <code>__webpack_nonce__</code> 变量以激活此功能。然后为每个唯一的页面视图生成和提供一个唯一的基于哈希的 <code>nonce</code>。这就是为什么应该在入口文件中指定 <code>__webpack_nonce__</code> 而非在配置中指定的原因。请注意，<code>__webpack_nonce__</code> 应该是一个 base64 编码的字符串。</p><h2><span id="examples"></span>示例<a href="#examples" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在入口文件中：</p><pre><code class="hljs language-js"><span class="token comment">// ...</span>
__webpack_nonce__ <span class="token operator">=</span> <span class="token string">&#x27;c29tZSBjb29sIHN0cmluZyB3aWxsIHBvcCB1cCAxMjM=&#x27;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span></code></pre><h2><span id="enabling-csp"></span>启用 CSP<a href="#enabling-csp" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>注意，默认情况下不启用 CSP。需要与文档一同发送相应的 <code>CSP</code> 响应头 <code>&lt;Content-Security-Policy</code> 或元标签 <code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; ...&gt;</code> 以告知浏览器需要启用 CSP。以下是一个包含 CDN 白名单 URL 的 CSP 头部示例：</p><pre><code class="hljs language-html">Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;self&#x27;
https://trusted.cdn.com;</code></pre><p>参阅页面底部的 <strong>延伸阅读</strong> 以了解更多关于 CSP 与 <code>nonce</code> 属性的信息。</p><h2><span id="trustedtypes"></span>信任类型<a href="#trustedtypes" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>只需遵守 CSP <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/require-trusted-types-for"><code>require-trusted-types-for</code></a> 指令的限制，webpack 便能够使用信任类型加载动态构建的脚本。参阅 <a href="/configuration/output/#outputtrustedtypes"><code>output.trustedTypes</code></a> 配置项了解更多。</p><h1><span id="使用-Vagrant-在虚拟机运行开发环境"></span>使用 Vagrant 在虚拟机运行开发环境<a href="#%E4%BD%BF%E7%94%A8-Vagrant-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%90%E8%A1%8C%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>如果正在开发一个更加高级的项目，并且需要使用 <a href="https://www.vagrantup.com/">Vagrant</a> 在虚拟机上运行开发环境，那可能会需要在虚拟机中运行 webpack。</p><h2><span id="configuring-the-project"></span>配置项目<a href="#configuring-the-project" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>首先，确保 <code>Vagrantfile</code> 拥有一个静态 IP。</p><pre><code class="hljs language-ruby"><span class="token constant">Vagrant</span><span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token symbol">:private_network</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">&quot;10.10.10.61&quot;</span>
<span class="token keyword">end</span></code></pre><p>然后，在项目中安装 <code>webpack</code>、<code>webpack-cli</code>、<code>@webpack-cli/serve</code> 和 <code>webpack-dev-server</code>：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack webpack-cli @webpack-cli/serve webpack-dev-server</code></pre><p>创建 <code>webpack.config.js</code> 配置文件，下面的示例代码可以作为起步的最简配置：</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">&#x27;./app.js&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>然后，创建一个 <code>index.html</code> 文件。其中的 <code>script</code> 标签应当指向 bundle。如果没有在配置中指定 <code>output.filename</code>，其默认值为 <code>bundle.js</code>。</p><pre><code class="hljs language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/bundle.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Hey!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre><p>注意，还需要创建一个 <code>app.js</code> 文件。</p><h2><span id="running-the-server"></span>启动服务器<a href="#running-the-server" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在启动服务器：</p><pre><code class="hljs language-bash">webpack serve --host <span class="token number">0.0</span>.0.0 --client-web-socket-url ws://10.10.10.61:8080/ws --watch-options-poll</code></pre><p>由于默认只允许从 localhost 访问服务器，所以需要修改 <code>--host</code> 参数，以允许在我们的宿主 PC 上访问。</p><p><code>webpack-dev-server</code> 会在包中引入一个脚本，此脚本连接到 WebSocket，这样可以在任何文件修改时，触发重新加载应用程序。
<code>--client-web-socket-url</code> 标志可以确保脚本知道从哪里查找 WebSocket。默认情况下，服务器会使用 <code>8080</code> 端口，因此也需要在这里指定。</p><p><code>--watch-options-poll</code> 可以确保 webpack 能够检测到文件更改。webpack 默认会监听文件系统触发的相关事件，但是 VirtualBox 使用默认配置会有许多问题。</p><p>现在服务器应该能够通过 <code>http://10.10.10.61:8080</code> 访问了。修改 <code>app.js</code>，应用程序就会实时重新加载。</p><h2><span id="advanced-usage-with-nginx"></span>配合 nginx 的高级用法<a href="#advanced-usage-with-nginx" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>为了更好的模拟类生产环境，可以使用 nginx 来代理 <code>webpack-dev-server</code>。</p><p>在 nginx 配置文件中，加入下面代码：</p><pre><code class="hljs language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">error_page</span> <span class="token number">502</span> @start<span class="token operator">-</span>webpack<span class="token operator">-</span>dev<span class="token operator">-</span><span class="token keyword">server</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> @start<span class="token operator">-</span>webpack<span class="token operator">-</span>dev<span class="token operator">-</span><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">502</span> <span class="token string">&quot;Please start the webpack-dev-server first.&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><code>proxy_set_header</code> 这几行配置很重要，因为它们能够使 WebSocket 正常运行。</p><p>然后 <code>webpack-dev-server</code> 启动命令可以修改为：</p><pre><code class="hljs language-bash">webpack serve --client-web-socket-url ws://10.10.10.61:8080/ws --watch-options-poll</code></pre><p>现在只能通过 <code>127.0.0.1</code> 访问服务，不过这并不影响，因为 ngnix 已经能够支持 PC 电脑访问到服务器。</p><h2><span id="conclusion"></span>总结<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>我们能够从静态 IP 访问 VagrantBox，然后使 <code>webpack-dev-server</code> 可以公开访问，以便浏览器可以访问到它。最后解决了 VirtualBox 不发送到文件系统事件的常见问题，此问题会导致服务器无法重新加载文件更改。</p><h1><span id="依赖管理"></span>依赖管理<a href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<blockquote><p>es6 modules</p></blockquote><blockquote><p>commonjs</p></blockquote><blockquote><p>amd</p></blockquote><h2><span id="require-with-expression"></span>带表达式的 require 语句<a href="#require-with-expression" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>如果 require 中含有表达式，由于编译时并不清楚 <strong>具体</strong> 导入了哪个模块，因此会创建一个上下文。</p><p>参考接下来的例子：假设现在有包含 <code>.ejs</code> 文件的如下目录结构：</p><pre><code class="hljs language-bash">example_directory
│
└───template
│   │   table.ejs
│   │   table-row.ejs
│   │
│   └───directory
│       │   another.ejs</code></pre><p>当下面的 <code>require()</code> 调用被评估解析时：</p><pre><code class="hljs language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./template/&#x27;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#x27;.ejs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>webpack 解析会 <code>require()</code> 调用，然后提取出如下一些信息：</p><pre><code class="hljs language-code">Directory: ./template
Regular expression: /^.*\.ejs$/
</code></pre><p><strong>上下文模块</strong></p><p>并且会创建一个上下文模块。它包含 <strong>对该目录下所有模块</strong> 的引用，可以使用匹配正则表达式的请求来导入这些模块。上下文模块中存在一个映射，该映射用于将请求转换为模块 ID。</p><p>示例映射:</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;./table.ejs&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  <span class="token property">&quot;./table-row.ejs&quot;</span><span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">,</span>
  <span class="token property">&quot;./directory/another.ejs&quot;</span><span class="token operator">:</span> <span class="token number">44</span>
<span class="token punctuation">}</span></code></pre><p>此上下文模块还包含一些访问此映射对象的运行时逻辑。</p><p>这意味着 webpack 能够支持动态导入，但会导致所有可能用到的模块都包含在 bundle 中。</p><h2><span id="requirecontext"></span>require.context<a href="#requirecontext" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>可以通过 <code>require.context()</code> 函数实现自定义上下文。</p><p>可以给这个函数传入三个参数：要搜索的目录、是否还搜索其子目录，匹配文件的正则表达式。</p><p>webpack 会在构建中解析代码中的 <code>require.context()</code> 。</p><p>语法如下：</p><pre><code class="hljs language-javascript">require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span>
  directory<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>useSubdirectories <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>regExp <span class="token operator">=</span> <span class="token regex">/^\.\/.*$/</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token string">&#x27;sync&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>示例：</p><pre><code class="hljs language-javascript">require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&#x27;./test&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token regex">/\.test\.js$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个上下文，其中文件直接来自 test 目录，require 包含的表达式以 `.test.js` 结尾。</span></code></pre><pre><code class="hljs language-javascript">require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&#x27;../&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\.stories\.js$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个上下文，其中文件来自父文件夹及其所有子级文件夹，require 包含的表达式以 `.stories.js` 结尾。</span></code></pre><aside class="warning"><h6 class="warning__prefix">警告</h6><p>传递给 <code>require.context</code> 的参数必须是字面量！</p></aside><h3><span id="context-module-api"></span>上下文模块 API<a href="#context-module-api" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>上下文模块会导出一个接收一个参数 request 的 require 函数。</p><p>此导出函数有三个属性：<code>resolve</code>，<code>keys</code> 与 <code>id</code>。</p><ul><li><code>resolve</code> 是一个函数，它返回 request 被解析后得到的模块 id。</li><li><code>keys</code> 也是一个函数，它返回一个数组，由所有可能被此上下文模块处理的请求组成。</li></ul><p>如果想引入一个文件夹下面的所有文件，或者引入能匹配一个正则表达式的所有文件，这个功能就会很有帮助，例如：</p><pre><code class="hljs language-javascript"><span class="token keyword">function</span> <span class="token function">importAll</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">importAll</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&#x27;../components/&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\.js$/</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre><code class="hljs language-javascript"><span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">importAll</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">importAll</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&#x27;../components/&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\.js$/</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 构建时所有被导入的模块都会被填充到缓存对象中。</span></code></pre><ul><li><code>id</code> 是上下文模块的模块 id. 它可能在使用 <code>module.hot.accept</code> 时会用到。</li></ul><h1><span id="安装"></span>安装<a href="#%E5%AE%89%E8%A3%85" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>本指南介绍了安装 webpack 的各种方法。</p><h2><span id="prerequisites"></span>前提条件<a href="#prerequisites" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在开始之前，请确保安装了 <a href="https://nodejs.org/en/">Node.js</a> 的最新版本。使用 Node.js 最新的长期支持版本(LTS - Long Term Support)，是理想的起步。
使用旧版本，你可能遇到各种问题，因为它们可能缺少 webpack 功能，
或者缺少相关 package。</p><h2><span id="local-installation"></span>本地安装<a href="#local-installation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>最新的 webpack 正式版本是：</p><p><a href="https://github.com/webpack/webpack/releases"><img src="https://img.shields.io/npm/v/webpack.svg?label=webpack&amp;style=flat-square&amp;maxAge=3600" alt="GitHub release"/></a></p><p>要安装最新版本或特定版本，请运行以下命令之一：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack
<span class="token comment"># 或指定版本</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack@<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>是否使用 <code>--save-dev</code> 取决于你的应用场景。假设你仅使用 webpack 进行构建操作，那么建议你在安装时使用 <code>--save-dev</code> 选项，因为可能你不需要在生产环境上使用 webpack。如果需要应用于生产环境，请忽略 <code>--save-dev</code> 选项。</p></aside><p>如果你使用 webpack v4+ 版本，并且想要在命令行中调用 <code>webpack</code>，你还需要安装 <a href="/api/cli/">CLI</a>。</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-cli</code></pre><p>对于大多数项目，我们建议本地安装。这可以在引入重大更新(breaking change)版本时，更容易分别升级项目。
通常会通过运行一个或多个 <a href="https://docs.npmjs.com/misc/scripts">npm scripts</a> 以在本地 <code>node_modules</code> 目录中查找安装的 webpack，
来运行 webpack：</p><pre><code class="hljs language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.config.js&quot;</span>
<span class="token punctuation">}</span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>想要运行本地安装的 webpack，你可以通过 <code>node_modules/.bin/webpack</code> 来访问它的二进制版本。另外，如果你使用的是 npm v5.2.0 或更高版本，则可以运行 <code>npx webpack</code> 来执行。</p></aside><h2><span id="global-installation"></span>全局安装<a href="#global-installation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>通过以下 NPM 安装方式，可以使 <code>webpack</code> 在全局环境下可用：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --global webpack</code></pre><aside class="warning"><h6 class="warning__prefix">警告</h6><p><strong>不推荐</strong> 全局安装 webpack。这会将你项目中的 webpack 锁定到指定版本，并且在使用不同的 webpack 版本的项目中，
可能会导致构建失败。</p></aside><h2><span id="bleeding-edge"></span>最新体验版本<a href="#bleeding-edge" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>如果你热衷于使用最新版本的 webpack，你可以使用以下命令安装 beta 版本，
或者直接从 webpack 的仓库中安装：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack@next
<span class="token comment"># 或特定的 tag/分支</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack/webpack<span class="token comment">#&lt;tagname/branchname&gt;</span></code></pre><aside class="warning"><h6 class="warning__prefix">警告</h6><p>安装这些最新体验版本时要小心！它们可能仍然包含 bug，因此不应该用于生产环境。</p></aside><h1><span id="模块热替换"></span>模块热替换<a href="#%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <a href="/guides/development">开发环境</a> 指南中的代码示例。</p></aside><p>模块热替换（HMR）是 webpack 提供的最有用的功能之一。它能帮助在运行时不完全刷新页面的情况下更新所有类型的模块。本页面重点介绍 <strong>如何使用</strong>，而 <a href="/concepts/hot-module-replacement">概念</a> 页面提供了更多关于它的工作原理以及为什么它有用的细节。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p><strong>HMR</strong> 不适用于生产环境，而应当用于开发环境。
参阅 <a href="/guides/production">生产环境</a> 指南以了解更多详细信息。</p></aside><h2><span id="enabling-hmr"></span>启用 HMR<a href="#enabling-hmr" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>此功能可以很大程度提高生产效率。我们要做的就是更新 <a href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a> 配置，
然后使用 webpack 内置的 HMR 插件。我们还要删除掉 <code>print.js</code> 的入口起点，
因为现在已经在 <code>index.js</code> 模块中引用了它。</p><p>从 <code>webpack-dev-server</code> v4.0.0 开始，模块热替换是默认开启的。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果在技术选型中使用的是 <code>webpack-dev-middleware</code> 而非 <code>webpack-dev-server</code>，请使用 <a href="https://github.com/webpack-contrib/webpack-hot-middleware"><code>webpack-hot-middleware</code></a> 依赖以在自定义服务器或应用程序上启用 HMR。</p></aside><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">      app: &#x27;./src/index.js&#x27;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      print: &#x27;./src/print.js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   devtool: &#x27;inline-source-map&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">     static: &#x27;./dist&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     hot: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: &#x27;Hot Module Replacement&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>也可以为 HMR 提供入口起点：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const webpack = require(&quot;webpack&quot;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">      app: &#x27;./src/index.js&#x27;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      print: &#x27;./src/print.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      // 模块热替换的运行时代码
</span><span class="token prefix inserted">+</span><span class="token line">      hot: &#x27;webpack/hot/dev-server.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      // 用于 web 套接字传输、热重载逻辑的 web server 客户端
</span><span class="token prefix inserted">+</span><span class="token line">      client: &#x27;webpack-dev-server/client/index.js?hot=true&amp;live-reload=true&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   devtool: &#x27;inline-source-map&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">     static: &#x27;./dist&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     // 用于 web 套接字传输、热重载逻辑的 web server 客户端
</span><span class="token prefix inserted">+</span><span class="token line">     hot: false,
</span><span class="token prefix inserted">+</span><span class="token line">     client: false,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: &#x27;Hot Module Replacement&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     // 模块热替换的插件
</span><span class="token prefix inserted">+</span><span class="token line">     new webpack.HotModuleReplacementPlugin(),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>可以通过以下命令修改 <a href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a> 的配置：<code>webpack serve --hot-only</code>。</p></aside><p>现在修改 <code>index.js</code> 文件，以便检测到 <code>print.js</code> 内部发生更改时告诉 webpack 接受更新的模块。</p><p><strong>index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from &#x27;./print.js&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">   const btn = document.createElement(&#x27;button&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   btn.innerHTML = &#x27;Click me and check the console!&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">   btn.onclick = printMe;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.appendChild(btn);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> if (module.hot) {
</span><span class="token prefix inserted">+</span><span class="token line">   module.hot.accept(&#x27;./print.js&#x27;, function() {
</span><span class="token prefix inserted">+</span><span class="token line">     console.log(&#x27;Accepting the updated printMe module!&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">     printMe();
</span><span class="token prefix inserted">+</span><span class="token line">   })
</span><span class="token prefix inserted">+</span><span class="token line"> }</span></span></code></pre><p>更改 <code>print.js</code> 中 <code>console.log</code> 的输出内容，你将会在浏览器中看到如下的输出
（不要担心现在 <code>button.onclick = printMe()</code> 的输出，我们稍后也会更新该部分）。</p><p><strong>print.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> export default function printMe() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   console.log(&#x27;我在 print.js 中被调用了！&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   console.log(&#x27;正在更新 print.js……&#x27;);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }</span></span></code></pre><p><strong>console</strong></p><pre><code class="hljs language-diff">[HMR] Waiting for update signal from WDS...
main.js:4395 [WDS] Hot Module Replacement enabled.
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 2main.js:4395 [WDS] App updated. Recompiling...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4395 [WDS] App hot update...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4330 [HMR] Checking for updates on the server...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:10024 Accepting the updated printMe module!
</span><span class="token prefix inserted">+</span><span class="token line"> 0.4b8ee77….hot-update.js:10 正在更新 print.js……
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4330 [HMR] Updated modules:
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4330 [HMR]  - 20</span></span></code></pre><h2><span id="via-the-nodejs-api"></span>通过 Node.js API 启用 HMR<a href="#via-the-nodejs-api" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在 Node.js API 中使用 webpack dev server 时，不要将 dev server 选项放在 webpack 配置对象中。而是在创建时，
将其作为第二个参数传递。例如：</p><p><code>new WebpackDevServer(options, compiler)</code></p><p>想要启用 HMR，还需要修改 webpack 配置对象，使其包含 HMR 入口起点。这是关于如何使用的一个基本示例：</p><p><strong>dev-server.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;html-webpack-plugin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackDevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-dev-server&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 模块热替换的运行时代码</span>
    <span class="token string">&#x27;webpack/hot/dev-server.js&#x27;</span><span class="token punctuation">,</span>
    <span class="token comment">// 用于 web 套接字传输、热重载逻辑的 web server 客户端</span>
    <span class="token string">&#x27;webpack-dev-server/client/index.js?hot=true&amp;live-reload=true&#x27;</span><span class="token punctuation">,</span>
    <span class="token comment">// 你的入口起点</span>
    <span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&#x27;inline-source-map&#x27;</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 模块热替换的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&#x27;Hot Module Replacement&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&#x27;[name].bundle.js&#x27;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    clean<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 由于手动添加了 `hot` 与 `client` 参数，其将被禁用</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webpackDevServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hot<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;dev server 正在运行&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>参阅 <a href="/api/webpack-dev-server/"><code>webpack-dev-server</code> 的 Node.js API 的完整文档</a> 以了解更多。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果正在使用 <a href="/guides/development#using-webpack-dev-middleware"><code>webpack-dev-middleware</code></a>，可以通过 <a href="https://github.com/webpack-contrib/webpack-hot-middleware"><code>webpack-hot-middleware</code></a> 依赖在自定义 dev server 中启用 HMR。</p></aside><h2><span id="gotchas"></span>问题<a href="#gotchas" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>模块热替换可能比较难以掌握。为了说明这一点，我们回到刚才的示例中。如果继续点击示例页面上的按钮
会发现控制台仍在打印旧的 <code>printMe</code> 函数。</p><p>这是因为按钮的 <code>onclick</code> 事件处理函数仍然绑定在旧的 <code>printMe</code> 函数上。</p><p>为了让 HMR 正常工作，我们需要更新代码，使用 <code>module.hot.accept</code> 将其绑定到新的 <code>printMe</code> 函数上：</p><p><strong>index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from &#x27;./print.js&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">   const btn = document.createElement(&#x27;button&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   btn.innerHTML = &#x27;Click me and check the console!&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">   btn.onclick = printMe;  // onclick 事件仍然绑定着原本的 printMe 函数
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.appendChild(btn);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> let element = component(); // 存储 element，以在 print.js 修改时重新渲染
</span><span class="token prefix inserted">+</span><span class="token line"> document.body.appendChild(element);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> if (module.hot) {
</span><span class="token prefix unchanged"> </span><span class="token line">   module.hot.accept(&#x27;./print.js&#x27;, function() {
</span><span class="token prefix unchanged"> </span><span class="token line">     console.log(&#x27;正在接受更新后的 printMe 模块！&#x27;);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     printMe();
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     document.body.removeChild(element);
</span><span class="token prefix inserted">+</span><span class="token line">     element = component(); // 重新渲染 &quot;component&quot;，以便更新 click 事件处理函数
</span><span class="token prefix inserted">+</span><span class="token line">     document.body.appendChild(element);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   })
</span><span class="token prefix unchanged"> </span><span class="token line"> }</span></span></code></pre><p>这仅仅是一个示例，还有很多让人易于犯错的情况。
幸运的是，有很多 loader（下面会提到一些）可以使得模块热替换变得更加容易。</p><h2><span id="hmr-with-stylesheets"></span>HMR 加载样式<a href="#hmr-with-stylesheets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>借助 <code>style-loader</code> 后，使用模块热替换加载 CSS 实际上极其简单。此 loader 在幕后使用了 <code>module.hot.accept</code>，在 CSS 依赖模块更新之后，会将其修补到 <code>&lt;style&gt;</code> 标签中。</p><p>首先使用以下命令安装两个 loader ：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev style-loader css-loader</code></pre><p>然后更新配置文件，使用这两个 loader。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">     app: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   devtool: &#x27;inline-source-map&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">     static: &#x27;./dist&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     hot: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   module: {
</span><span class="token prefix inserted">+</span><span class="token line">     rules: [
</span><span class="token prefix inserted">+</span><span class="token line">       {
</span><span class="token prefix inserted">+</span><span class="token line">         test: /\.css$/,
</span><span class="token prefix inserted">+</span><span class="token line">         use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],
</span><span class="token prefix inserted">+</span><span class="token line">       },
</span><span class="token prefix inserted">+</span><span class="token line">     ],
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: &#x27;Hot Module Replacement&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>热加载样式表也可以通过将它们引入一个模块来实现：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> | - package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> | - webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> | - /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   | - bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line"> | - /src
</span><span class="token prefix unchanged"> </span><span class="token line">   | - index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   | - print.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   | - styles.css</span></span></code></pre><p><strong>styles.css</strong></p><pre><code class="hljs language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><strong>index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from &#x27;./print.js&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import &#x27;./styles.css&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">   const btn = document.createElement(&#x27;button&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   btn.innerHTML = &#x27;Click me and check the console!&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line">   btn.onclick = printMe;  // onclick 事件仍然绑定着原本的 printMe 函数
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.appendChild(btn);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> let element = component();
</span><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(element);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> if (module.hot) {
</span><span class="token prefix unchanged"> </span><span class="token line">   module.hot.accept(&#x27;./print.js&#x27;, function() {
</span><span class="token prefix unchanged"> </span><span class="token line">     console.log(&#x27;正在接受更新后的 printMe 模块！&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">     document.body.removeChild(element);
</span><span class="token prefix unchanged"> </span><span class="token line">     element = component(); // 重新渲染 component 以更新点击事件处理程序
</span><span class="token prefix unchanged"> </span><span class="token line">     document.body.appendChild(element);
</span><span class="token prefix unchanged"> </span><span class="token line">   })
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre><p>将 <code>body</code> 的 style 改为 <code>background: red;</code>，你应该可以立即看到页面的背景颜色随之更改，而无需完全刷新。</p><p><strong>styles.css</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> body {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   background: blue;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   background: red;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }</span></span></code></pre><h2><span id="other-code-and-frameworks"></span>其他代码和框架<a href="#other-code-and-frameworks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>社区还提供许多其他 loader 和示例，可以使 HMR 与各种框架和库平滑地进行交互……</p><ul><li><a href="https://github.com/gaearon/react-hot-loader">React Hot Loader</a>：实时调整 react 组件。</li><li><a href="https://github.com/vuejs/vue-loader">Vue Loader</a>：此 loader 支持 vue 组件的 HMR，提供开箱即用体验。</li><li><a href="https://github.com/klazuka/elm-hot-webpack-loader">Elm Hot webpack Loader</a>：支持 Elm 编程语言的 HMR。</li><li><a href="https://github.com/gdi2290/angular-hmr">Angular HMR</a>：没有必要使用 loader！直接修改 NgModule 主文件就够了，它可以完全控制 HMR API。</li><li><a href="https://github.com/sveltejs/svelte-loader">Svelte Loader</a>：此 loader 开箱即用地支持 Svelte 组件的热更新。</li></ul><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果你知道任何其他 loader 或 plugin，能够有助于或增强模块热替换，请提交一个 pull request 以添加到此列表中！</p></aside><h1><span id="Tree-Shaking"></span>Tree Shaking<a href="#Tree-Shaking" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p><strong>tree shaking</strong> 是一个术语，通常用于描述移除 JavaScript 上下文中的死代码。它依赖于 ES2015 模块语法的 <a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure">静态结构</a> 特性，例如 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import"><code>import</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/export"><code>export</code></a>。这个术语和概念实际上是由 ES2015 模块捆绑器 <a href="https://github.com/rollup/rollup">rollup</a> 普及起来的。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>译注：死代码（dead code）是指程序中一段已经不会被执行的代码，通常是因为重构、优化或者逻辑错误导致的。这些代码可能是之前版本的遗留物，或者某些条件下永远不会被执行的代码。</p></aside><p>webpack 2 正式版本内置支持 ES2015 模块（也叫做 <strong>harmony module</strong>）与对未使用模块的检测能力。webpack 4 正式版本扩展了此检测能力：通过 <code>package.json</code> 的 <code>&quot;sideEffects&quot;</code> 属性作为标记，向编译器提供提示，表明项目中的哪些文件是纯正的 ES2015 模块，由此可以安全地删除文件中未使用的部分。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继承自 <a href="/guides/getting-started">起步</a> 指南。如果你尚未阅读该指南，请先行阅读。</p></aside><h2><span id="add-a-utility"></span>添加一个通用模块<a href="#add-a-utility" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在项目中添加一个新的通用模块文件 <code>src/math.js</code>，并导出两个函数：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- index.html
</span></span>|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- math.js
</span></span>|- /node_modules</code></pre><p><strong>src/math.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>需要将 <code>mode</code> 配置设置为 <a href="/configuration/mode/#mode-development">development</a>，以确定 bundle 不会被压缩：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> mode: &#x27;development&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line"> optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">   usedExports: true,
</span><span class="token prefix inserted">+</span><span class="token line"> },
</span></span>};</code></pre><p>配置完这些后，更新入口脚本，使用其中一个新方法，同时为了简化示例将 <code>lodash</code> 删除：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import { cube } from &#x27;./math.js&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const element = document.createElement(&#x27;pre&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   // lodash 现在使用 import 引入
</span><span class="token prefix deleted">-</span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.innerHTML = [
</span><span class="token prefix inserted">+</span><span class="token line">     &#x27;你好 webpack！&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">     &#x27;5 的立方等于 &#x27; + cube(5)
</span><span class="token prefix inserted">+</span><span class="token line">   ].join(&#x27;\n\n&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());</span></span></code></pre><p>注意，我们 <strong>没有从 <code>src/math.js</code> 模块中 <code>import</code> 另外一个 <code>square</code> 方法</strong>。这个没有引用的函数就是所谓的 <strong>死代码</strong>，即应当删除掉未被引用的 <code>export</code>。现在运行 npm script <code>npm run build</code>，并查看输出的 bundle：</p><p><strong>dist/bundle.js（大约在 90 到 100 行）</strong></p><pre><code class="hljs language-js"><span class="token comment">/* 1 */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span>
  <span class="token comment">/* unused harmony export square */</span>
  <span class="token comment">/* harmony export (immutable) */</span> __webpack_exports__<span class="token punctuation">[</span><span class="token string">&#x27;a&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cube<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>译注，如果使用的是更新的 webpack 版本，输出的 bundle 可能与示例不一致。可以检索相关关键字查看。</p></aside><p>注意看上方的 <code>unused harmony export square</code> 注释。仔细观察下面的代码会发现尽管没有引用 <code>square</code>，但它仍然被包含在 bundle 中。我们将在后面的章节解决这个问题。</p><h2><span id="mark-the-file-as-side-effect-free"></span>将文件标记为无副作用（side-effect-free）<a href="#mark-the-file-as-side-effect-free" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在一个纯粹的 ES 模块世界中，很容易识别出哪些文件有副作用。然而，我们的项目无法达到这种纯度，所以，此时有必要提示 webpack 编译器哪些代码是纯粹的。</p><p>通过 package.json 的 <code>&quot;sideEffects&quot;</code> 属性即可实现此目的。</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre><p>如果所有代码都不包含副作用，我们就可以简单地将该属性标记为 <code>false</code> 以告知 webpack 可以安全地删除未使用的导出内容。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>副作用（effect 或者 side effect）指在导入时会执行特殊行为的代码，而不是仅仅暴露一个或多个导出内容。polyfill 就是一个例子，尽管其通常不提供导出，但是会影响全局作用域，因此 polyfill 将被视为一个副作用。</p></aside><p>如果某些代码确实存在一些副作用，可以将 <code>sideEffects</code> 指定为一个数组：</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/some-side-effectful-file.js&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>此数组支持简单的 glob 模式匹配相关文件。其内部使用的是 <a href="https://github.com/fitzgen/glob-to-regexp">glob-to-regexp</a>（支持：<code>*</code>，<code>**</code>，<code>{a,b}</code>，<code>[a-z]</code>）。如果匹配模式为 <code>*.css</code>，且不包含 <code>/</code>，将被视为 <code>**/*.css</code>。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>注意，所有导入文件都会受到 tree shaking 的影响。这意味着，如果在项目中使用类似 <code>css-loader</code> 的东西并导入了一个 CSS 文件，则需要将其添加到副作用列表中表示其存在副作用，以免在生产模式中无意中将它删除：</p></aside><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/some-side-effectful-file.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>最后，还可以在 <a href="/configuration/module/#modulerules"><code>module.rules</code> 配置选项</a> 中设置 <code>&quot;sideEffects&quot;</code>。</p><h2><span id="clarifying-tree-shaking-and-sideeffects"></span>解释 tree shaking 和 <code>sideEffects</code><a href="#clarifying-tree-shaking-and-sideeffects" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><a href="/configuration/optimization/#optimizationsideeffects"><code>sideEffects</code></a> 和 <a href="/configuration/optimization/#optimizationusedexports"><code>usedExports</code></a>（更多地被称为 tree shaking）是两种不同的优化方式。</p><p><strong><code>sideEffects</code> 更为有效</strong> 是因为它允许跳过整个模块/文件和整个文件子树。</p><p><code>usedExports</code> 依赖于 <a href="https://github.com/terser-js/terser">terser</a> 检测语句中的副作用。它是一个 JavaScript 任务而且不像 <code>sideEffects</code> 一样简单直接。并且由于规范认为副作用需要被评估，因此它不能跳过子树/依赖项。尽管导出函数能正常运行，但 React 的高阶组件在这种情况下会出问题。</p><p>让我们来看一个例子：</p><pre><code class="hljs language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@shopify/polaris&#x27;</span><span class="token punctuation">;</span></code></pre><p>打包前的文件版本看起来是这样的：</p><pre><code class="hljs language-javascript"><span class="token keyword">import</span> hoistStatics <span class="token keyword">from</span> <span class="token string">&#x27;hoist-non-react-statics&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token parameter">_ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _final <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>
    <span class="token keyword">var</span> _len <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span> objs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>_len<span class="token punctuation">)</span><span class="token punctuation">,</span> _key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    _key <span class="token operator">&lt;</span> _len<span class="token punctuation">;</span>
    _key<span class="token operator">++</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    objs<span class="token punctuation">[</span>_key<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>_key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> _i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> _objs <span class="token operator">=</span> objs<span class="token punctuation">;</span> _i <span class="token operator">&lt;</span> _objs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> _i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> _objs<span class="token punctuation">[</span>_i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">mergeRecursively</span><span class="token punctuation">(</span>_final<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> _final<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">withAppProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">addProvider</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> WithProvider <span class="token operator">=</span>
      <span class="token comment">/*#__PURE__*/</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_React$Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">return</span> WithProvider<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span><span class="token punctuation">;</span>

    WithProvider<span class="token punctuation">.</span>contextTypes <span class="token operator">=</span> WrappedComponent<span class="token punctuation">.</span>contextTypes
      <span class="token operator">?</span> <span class="token function">merge</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">.</span>contextTypes<span class="token punctuation">,</span> polarisAppProviderContextTypes<span class="token punctuation">)</span>
      <span class="token operator">:</span> polarisAppProviderContextTypes<span class="token punctuation">;</span>
    <span class="token keyword">var</span> FinalComponent <span class="token operator">=</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span>WithProvider<span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> FinalComponent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> Button$<span class="token number">1</span> <span class="token operator">=</span> <span class="token function">withAppProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...,</span>
  Button$<span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>当 <code>Button</code> 没有被使用时，删除 <code>export { Button$1 };</code> 并保留其余所有代码会让代码变得更加高效。所以问题是：“这段代码是否有任何副作用，是否可以安全删除？”这很难说，尤其是因为这行代码 <code>withAppProvider()(Button)</code>。在这行代码中，<code>withAppProvider</code> 被调用了，并且其返回值（译注：请注意，<code>withAppProvider</code> 的返回值是一个函数）也被调用了。那么当执行 <code>withAppProvider</code> 及其返回值时，调用 <code>merge</code> 与 <code>hoistStatics</code> 会有任何副作用吗？读取 <code>WrappedComponent.contextTypes</code>（Getter）或向 <code>WithProvider.contextTypes</code>（Setter）赋值时会有任何副作用吗？</p><p>实际上，<code>usedExports</code> 依赖的 terser 就尝试去解决这些问题，但在许多情况下它仍然不确定函数的调用是否有副作用。但这并不意味着 terser 会由于无法解决这些问题而运作得不好。根本原因在于像 JavaScript 这类动态语言中很难可靠确定这一点。</p><p>但我们可以通过 <code>/*#__PURE__*/</code> 注释来帮助 terser。这个注释的作用是标记此语句没有副作用。这样一个简单的改变就能够 tree-shake 下面的代码了：</p><pre><code class="hljs language-javascript"><span class="token keyword">var</span> Button$<span class="token number">1</span> <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> <span class="token function">withAppProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这将允许删除这段代码。但是除此之外，引入的内容可能仍然存在副作用的问题，因此需要对其进入评估。</p><p>为了解决这个问题，我们需要在 <code>package.json</code> 中添加 <a href="/guides/tree-shaking/#mark-the-file-as-side-effect-free"><code>&quot;sideEffects&quot;</code></a> 属性。</p><p>它与 <code>/*#__PURE__*/</code> 类似，但是作用于模块层面，而非代码语句的层面。<code>&quot;sideEffects&quot;</code> 属性的意思是：“如果没有使用被标记为无副作用的模块的直接导出，那么捆绑器会跳过对此模块的副作用评估”。</p><p>考虑 <code>Shopify Polaris</code> 的例子，原有的模块如下：</p><p><strong>index.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">import</span> <span class="token string">&#x27;./configure&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#x27;./types&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#x27;./components&#x27;</span><span class="token punctuation">;</span></code></pre><p><strong>components/index.js</strong></p><pre><code class="hljs language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> Breadcrumbs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./Breadcrumbs&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> Button<span class="token punctuation">,</span> buttonFrom<span class="token punctuation">,</span> buttonsFrom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./Button&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> ButtonGroup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./ButtonGroup&#x27;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span></code></pre><p><strong>package.json</strong></p><pre><code class="hljs language-json"><span class="token comment">// ...</span>
<span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;**/*.css&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;**/*.scss&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./esnext/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./esnext/configure.js&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">// ...</span></code></pre><p>代码 <code>import { Button } from &quot;@shopify/polaris&quot;;</code> 存在以下可能：</p><ul><li>导入它：导入并包含该模块，分析评估它并继续进行依赖分析</li><li>跳过它：不导入它，不分析评估它但会继续进行依赖分析</li><li>排除它：不导入它，不评估且不做依赖分析</li></ul><p>以下是每个匹配到的资源的情况：</p><ul><li><code>index.js</code>：没有直接的导出被使用，但被标记为有副作用 → 导入它</li><li><code>configure.js</code>：没有导出被使用，但被标记为有副作用 → 导入它</li><li><code>types/index.js</code>：没有导出被使用，没有被标记为有副作用 → 排除它</li><li><code>components/index.js</code>：没有导出被使用，没有被标记为有副作用，但重新导出的导出内容被使用了 → 跳过它</li><li><code>components/Breadcrumbs.js</code>：没有导出被使用，没有被标记为有副作用 → 排除它。这也会排除所有如同 <code>components/Breadcrumbs.css</code> 的依赖，尽管它们都被标记为有副作用。</li><li><code>components/Button.js</code>：直接的导出被使用，没有被标记为有副作用 → 导入它</li><li><code>components/Button.css</code>：没有导出被使用，但被标记为有副作用 → 导入它</li></ul><p>在这种情况下，只有 4 个模块被导入到 bundle 中：</p><ul><li>基本为空的 <code>index.js</code></li><li><code>configure.js</code></li><li><code>components/Button.js</code></li><li><code>components/Button.css</code></li></ul><p>在这次的优化后，其它的优化项目都可以应用。例如：从 <code>Button.js</code> 导出的 <code>buttonFrom</code> 和 <code>buttonsFrom</code> 也没有被使用。<code>usedExports</code> 优化会捡起这些代码而且 terser 能够从 bundle 中将这些语句摘除。</p><p>由于模块合并也会生效，所以这 4 个模块与入口模块（也可能有更多的依赖）会被合并。<strong><code>index.js</code> 最终没有生成代码</strong>。</p><h2><span id="mark-a-function-call-as-side-effect-free"></span>将函数调用标记为无副作用<a href="#mark-a-function-call-as-side-effect-free" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>通过 <code>/*#__PURE__*/</code> 注释可以告诉 webpack 某个函数调用无副作用。它可以被放到函数调用之前，用来标记此函数调用是无副作用的。传入函数的参数无法被刚才的注释所标记，需要单独对每一个参数进行标记。如果一个没被使用的变量定义的初始值被认为是无副作用的，它会被标记为死代码，不会被执行且会被压缩工具清除掉。当 <a href="/configuration/optimization/#optimizationinnergraph"><code>optimization.innerGraph</code></a> 被设置成 <code>true</code> 时这个行为将被启用。</p><p><strong>file.js</strong></p><pre><code class="hljs language-javascript"><span class="token comment">/*#__PURE__*/</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2><span id="minify-the-output"></span>压缩输出结果<a href="#minify-the-output" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>通过 <code>import</code> 和 <code>export</code> 语法，我们已经找出需要删除的死代码，然而，不仅仅是要找出，还应在 bundle 中删除它们。为此，我们需要将 <code>mode</code> 配置选项设置为 <a href="/configuration/mode/#mode-production"><code>production</code></a>。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> mode: &#x27;development&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line"> optimization: {
</span><span class="token prefix deleted">-</span><span class="token line">   usedExports: true,
</span><span class="token prefix deleted">-</span><span class="token line"> }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> mode: &#x27;production&#x27;,
</span></span>};</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>注意，也可以在命令行接口中使用 <code>--optimize-minimize</code> 标记启用 <code>TerserPlugin</code>。</p></aside><p>准备就绪后运行命令 <code>npm run build</code>，看看输出结果有没有发生改变。</p><p>你发现 <code>dist/bundle.js</code> 中的差异了吗？现在整个 bundle 都已经被压缩和混淆破坏，但是如果仔细观察，则不会看到引入了 <code>square</code> 函数，但能看到 <code>cube</code> 函数的破坏版本（<code>function r(e){return e*e*e}n.a=r</code>）。现在通过代码压缩与 tree shaking，我们的 bundle 缩小了几个字节！虽然在这个特定示例中，可能看起来没有减少很多，但是，在有着复杂依赖树的大型应用程序上运行 tree shaking 时，会对 bundle 产生显著的体积优化。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>在使用 tree shaking 时必须有 <a href="/plugins/module-concatenation-plugin">ModuleConcatenationPlugin</a> 的支持，可以通过设置配置项 <code>mode: &quot;production&quot;</code> 启用它。如果没有这么做，那么需要手动引入 <a href="/plugins/module-concatenation-plugin">ModuleConcatenationPlugin</a>。</p></aside><h2><span id="conclusion"></span>总结<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>我们学到为了利用 <strong>tree shaking</strong> 的优势，必须：</p><ul><li>使用 ES2015 模块语法（即 <code>import</code> 和 <code>export</code>）；</li><li>确保没有编译器将 ES2015 模块语法转换为 CommonJS（顺带一提，这是现在常用的 <code>@babel/preset-env</code> 的默认行为，请参阅 <a href="https://babeljs.io/docs/en/babel-preset-env#modules">文档</a> 以了解更多信息）。</li><li>在项目的 <code>package.json</code> 文件中添加 <code>&quot;sideEffects&quot;</code> 属性。</li><li>使用 <code>mode</code> 为 <code>&quot;production&quot;</code> 的配置项以启用 <a href="/concepts/#mode">更多优化项</a>，包括压缩代码与 tree shaking。</li></ul><p>你可以将应用程序想象成一棵树。绿色表示实际用到的源码和库，是树上活的树叶。灰色表示未引用代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动（shake）这棵树，使它们落下。</p><p>如果你对优化输出很感兴趣，请进入到下个指南，来了解 <a href="/guides/production">生产环境</a> 构建的详细细节。</p><h1><span id="生产环境"></span>生产环境<a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>在本指南中，我们将深入一些最佳实践和工具，将站点或应用程序构建到生产环境中。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>以下示例来源于 <a href="/guides/tree-shaking">tree shaking</a> 和 <a href="/guides/development">开发环境</a>。在继续之前，请确保你已经熟悉这些指南中所介绍的概念/配置。</p></aside><h2><span id="setup"></span>配置<a href="#setup" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><strong>development(开发环境)</strong> 和 <strong>production(生产环境)</strong> 这两个环境下的构建目标存在着巨大差异。在<strong>开发环境</strong>中，我们需要：强大的 source map 和一个有着 live reloading(实时重新加载) 或 hot module replacement(模块热替换) 能力的 localhost server。而<strong>生产环境</strong>目标则转移至其他方面，关注点在于压缩 bundle、更轻量的 source map、资源优化等，通过这些优化方式改善加载时间。由于要遵循逻辑分离，我们通常建议为每个环境编写<strong>彼此独立的 webpack 配置</strong>。</p><p>虽然，以上我们将 <em>生产环境</em> 和 <em>开发环境</em> 做了细微区分，但是，请注意，我们还是会遵循不重复原则(Don&#x27;t repeat yourself - DRY)，保留一个 &quot;common(通用)&quot; 配置。为了将这些配置合并在一起，我们将使用一个名为 <a href="https://github.com/survivejs/webpack-merge"><code>webpack-merge</code></a> 的工具。此工具会引用 &quot;common&quot; 配置，因此我们不必再在环境特定(environment-specific)的配置中编写重复代码。</p><p>我们先从安装 <code>webpack-merge</code> 开始，并将之前指南中已经成型的那些代码进行分离：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-merge</code></pre><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- webpack.config.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- webpack.common.js
</span><span class="token prefix inserted">+</span><span class="token line"> |- webpack.dev.js
</span><span class="token prefix inserted">+</span><span class="token line"> |- webpack.prod.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- math.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>webpack.common.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> module.exports = {
</span><span class="token prefix inserted">+</span><span class="token line">   entry: {
</span><span class="token prefix inserted">+</span><span class="token line">     app: &#x27;./src/index.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line">   plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix inserted">+</span><span class="token line">       title: &#x27;Production&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">     }),
</span><span class="token prefix inserted">+</span><span class="token line">   ],
</span><span class="token prefix inserted">+</span><span class="token line">   output: {
</span><span class="token prefix inserted">+</span><span class="token line">     filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix inserted">+</span><span class="token line">     clean: true,
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line"> };</span></span></code></pre><p><strong>webpack.dev.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const { merge } = require(&#x27;webpack-merge&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line"> const common = require(&#x27;./webpack.common.js&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> module.exports = merge(common, {
</span><span class="token prefix inserted">+</span><span class="token line">   mode: &#x27;development&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">   devtool: &#x27;inline-source-map&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">   devServer: {
</span><span class="token prefix inserted">+</span><span class="token line">     static: &#x27;./dist&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line"> });</span></span></code></pre><p><strong>webpack.prod.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const { merge } = require(&#x27;webpack-merge&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line"> const common = require(&#x27;./webpack.common.js&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> module.exports = merge(common, {
</span><span class="token prefix inserted">+</span><span class="token line">   mode: &#x27;production&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line"> });</span></span></code></pre><p>现在，在 <code>webpack.common.js</code> 中，我们设置了 <code>entry</code> 和 <code>output</code> 配置，并且在其中引入这两个环境公用的全部插件。在 <code>webpack.dev.js</code> 中，我们将 <code>mode</code> 设置为 <code>development</code>，并且为此环境添加了推荐的 <code>devtool</code>（强大的 source map）和 <code>devServer</code> 配置。最后，在 <code>webpack.prod.js</code> 中，我们将 <code>mode</code> 设置为 <code>production</code>，其中会引入之前在 <a href="/guides/tree-shaking">tree shaking</a> 指南中介绍过的 <code>TerserPlugin</code>。</p><p>注意，在环境特定的配置中使用 <code>merge()</code> 功能，可以很方便地引用 <code>webpack.dev.js</code> 和 <code>webpack.prod.js</code> 中公用的 common 配置。<code>webpack-merge</code> 工具提供了各种 merge(合并) 高级功能，但是在我们的用例中，无需用到这些功能。</p><h2><span id="npm-scripts"></span>NPM Scripts<a href="#npm-scripts" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>现在，我们把 <code>scripts</code> 重新指向到新配置。让 <code>npm start</code> script 中 <code>webpack-dev-server</code>, 使用 <code>webpack.dev.js</code>, 而让 <code>npm run build</code> script 使用 <code>webpack.prod.js</code>:</p><p><strong>package.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;name&quot;: &quot;development&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;main&quot;: &quot;src/index.js&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;scripts&quot;: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     &quot;start&quot;: &quot;webpack serve --open&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     &quot;start&quot;: &quot;webpack serve --open --config webpack.dev.js&quot;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     &quot;build&quot;: &quot;webpack&quot;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     &quot;build&quot;: &quot;webpack --config webpack.prod.js&quot;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;css-loader&quot;: &quot;^0.28.4&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;csv-loader&quot;: &quot;^2.1.1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;express&quot;: &quot;^4.15.3&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;file-loader&quot;: &quot;^0.11.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;html-webpack-plugin&quot;: &quot;^2.29.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;style-loader&quot;: &quot;^0.18.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;webpack&quot;: &quot;^4.30.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;webpack-dev-middleware&quot;: &quot;^1.12.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;webpack-dev-server&quot;: &quot;^2.9.1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;webpack-merge&quot;: &quot;^4.1.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;xml-loader&quot;: &quot;^1.2.1&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line"> }</span></span></code></pre><p>随便运行下这些脚本，然后查看输出结果的变化，然后我们会继续添加一些生产环境配置。</p><h2><span id="specify-the-mode"></span>指定 mode<a href="#specify-the-mode" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>许多 library 通过与 <code>process.env.NODE_ENV</code> 环境变量关联，以决定 library 中应该引用哪些内容。例如，当<code>process.env.NODE_ENV</code> 没有被设置为 <code>&#x27;production&#x27;</code> 时，某些 library 为了使调试变得容易，可能会添加额外的 log(日志记录) 和 test(测试) 功能。并且，在使用 <code>process.env.NODE_ENV === &#x27;production&#x27;</code> 时，一些 library 可能针对具体用户的环境，删除或添加一些重要代码，以进行代码执行方面的优化。从 webpack v4 开始, 指定 <a href="/configuration/mode/"><code>mode</code></a> 会自动地配置 <a href="/plugins/define-plugin"><code>DefinePlugin</code></a>：</p><p><strong>webpack.prod.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const { merge } = require(&#x27;webpack-merge&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const common = require(&#x27;./webpack.common.js&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = merge(common, {
</span><span class="token prefix unchanged"> </span><span class="token line">   mode: &#x27;production&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> });</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>技术上讲，<code>NODE_ENV</code> 是一个由 Node.js 暴露给执行脚本的系统环境变量。通常用于决定在开发环境与生产环境(dev-vs-prod)下，server tools(服务期工具)、build scripts(构建脚本) 和 client-side libraries(客户端库) 的行为。然而，与预期相反，在构建脚本 <code>webpack.config.js</code> 中 <code>process.env.NODE_ENV</code> 并没有被设置为 <code>&quot;production&quot;</code>，请查看 <a href="https://github.com/webpack/webpack/issues/2537">#2537</a>。因此，在 webpack 配置文件中，<code>process.env.NODE_ENV === &#x27;production&#x27; ? &#x27;[name].[contenthash].bundle.js&#x27; : &#x27;[name].bundle.js&#x27;</code> 这样的条件语句，无法按照预期运行。</p></aside><p>如果你正在使用像 <a href="https://react.docchina.org/"><code>react</code></a> 这样的 library，那么在添加此 DefinePlugin 插件后，你应该看到 bundle 大小显著下降。还要注意，任何位于 <code>/src</code> 的本地代码都可以关联到 process.env.NODE_ENV 环境变量，所以以下检查也是有效的：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import { cube } from &#x27;./math.js&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> if (process.env.NODE_ENV !== &#x27;production&#x27;) {
</span><span class="token prefix inserted">+</span><span class="token line">   console.log(&#x27;Looks like we are in development mode!&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;pre&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = [
</span><span class="token prefix unchanged"> </span><span class="token line">     &#x27;Hello webpack!&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &#x27;5 cubed is equal to &#x27; + cube(5)
</span><span class="token prefix unchanged"> </span><span class="token line">   ].join(&#x27;\n\n&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());</span></span></code></pre><h2><span id="minification"></span>压缩(Minification)<a href="#minification" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>Webpack v4+ will minify your code by default in <a href="/configuration/mode/#mode-production"><code>production mode</code></a>.</p><p>注意，虽然生产环境下默认使用 <a href="/plugins/terser-webpack-plugin"><code>TerserPlugin</code></a> ，并且也是代码压缩方面比较好的选择，但是还有一些其他可选择项。以下有几个同样很受欢迎的插件：</p><ul><li><a href="https://github.com/webpack-contrib/closure-webpack-plugin"><code>ClosureWebpackPlugin</code></a></li></ul><p>如果决定尝试一些其他压缩插件，确保新插件也会按照 <a href="/guides/tree-shaking">tree shake</a> 指南中所陈述的具有删除未引用代码(dead code)的能力，并将它作为 <a href="/configuration/optimization/#optimizationminimizer"><code>optimization.minimizer</code></a>。</p><h2><span id="source-mapping"></span>源码映射(Source Mapping)<a href="#source-mapping" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>我们鼓励你在生产环境中启用 source map，因为它们对 debug(调试源码) 和运行 benchmark tests(基准测试) 很有帮助。虽然有着如此强大的功能，然而还是应该针对生产环境用途，选择一个可以快速构建的推荐配置（更多选项请查看 <a href="/configuration/devtool"><code>devtool</code></a>）。对于本指南，我们将在 <strong>生产环境</strong> 中使用 <code>source-map</code> 选项，而不是我们在开发环境中用到的 <code>inline-source-map</code>：</p><p><strong>webpack.prod.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const { merge } = require(&#x27;webpack-merge&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const common = require(&#x27;./webpack.common.js&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = merge(common, {
</span><span class="token prefix unchanged"> </span><span class="token line">   mode: &#x27;production&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   devtool: &#x27;source-map&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> });</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>避免在生产中使用 <code>inline-***</code> 和 <code>eval-***</code>，因为它们会增加 bundle 体积大小，并降低整体性能。</p></aside><h2><span id="minimize-css"></span>压缩 CSS<a href="#minimize-css" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>将生产环境下的 CSS 进行压缩会非常重要，请查看 <a href="/plugins/mini-css-extract-plugin/#minimizing-for-production">在生产环境下压缩</a> 章节。</p><h2><span id="cli-alternatives"></span>CLI 替代选项<a href="#cli-alternatives" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>上述许多选项都可以通过命令行参数进行设置。例如，<a href="/configuration/optimization/#optimizationminimize"><code>optimize-minimize</code></a> 可以使用 <code>--optimization-minimize</code> 进行设置，<a href="/configuration/mode/"><code>mode</code></a> 可以使用 <code>--mode</code> 进行设置。运行 <code>npx webpack --help=verbose</code> 可以查看所有关于 CLI 的可用参数。</p><p>虽然这种简写方式很有用处，但我们还是建议通过 webpack 配置文件的方式进行使用，这样可以提高可配置能力。</p><h1><span id="懒加载"></span>懒加载<a href="#%E6%87%92%E5%8A%A0%E8%BD%BD" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继承自<a href="/guides/code-splitting">代码分离</a>。如果你尚未阅读该指南，请先行阅读。</p></aside><p>懒加载或者按需加载，是一种很好的优化网页或应用的方式。这种方式实际上是先把你的代码在一些逻辑断点处分离开，然后在一些代码块中完成某些操作后，立即引用或即将引用另外一些新的代码块。这样加快了应用的初始加载速度，减轻了它的总体体积，因为某些代码块可能永远不会被加载。</p><h2><span id="example"></span>示例<a href="#example" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>我们在<a href="/guides/code-splitting#dynamic-imports">代码分离</a>中的例子基础上，进一步做些调整来说明这个概念。那里的代码确实会在脚本运行的时候产生一个分离的代码块 <code>lodash.bundle.js</code> ，在技术概念上“懒加载”它。问题是加载这个包并不需要用户的交互 - 意思是每次加载页面的时候都会请求它。这样做并没有对我们有很多帮助，还会对性能产生负面影响。</p><p>我们试试不同的做法。我们增加一个交互，当用户点击按钮的时候用 console 打印一些文字。但是会等到第一次交互的时候再加载那个代码块（<code>print.js</code>）。为此，我们返回到代码分离的例子中，把 <code>lodash</code> 放到主代码块中，重新运行 <em>代码分离</em> 中的代码 <a href="/guides/code-splitting#dynamic-imports">final <em>Dynamic Imports</em> example</a>。</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- print.js
</span></span>|- /node_modules</code></pre><p><strong>src/print.js</strong></p><pre><code class="hljs language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token string">&#x27;The print.js module has loaded! See the network tab in dev tools...&#x27;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Button Clicked: Here\&#x27;s &quot;some text&quot;!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> async function getComponent() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> function component() {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   const _ = await import(/* webpackChunkName: &quot;lodash&quot; */ &#x27;lodash&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const button = document.createElement(&#x27;button&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">   const br = document.createElement(&#x27;br&#x27;);
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   button.innerHTML = &#x27;Click me and look at the console!&#x27;;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.appendChild(br);
</span><span class="token prefix inserted">+</span><span class="token line">   element.appendChild(button);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">   // Note that because a network request is involved, some indication
</span><span class="token prefix inserted">+</span><span class="token line">   // of loading would need to be shown in a production-level site/app.
</span><span class="token prefix inserted">+</span><span class="token line">   button.onclick = e =&gt; import(/* webpackChunkName: &quot;print&quot; */ &#x27;./print&#x27;).then(module =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">     const print = module.default;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">     print();
</span><span class="token prefix inserted">+</span><span class="token line">   });
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> getComponent().then(component =&gt; {
</span><span class="token prefix deleted">-</span><span class="token line">   document.body.appendChild(component);
</span><span class="token prefix deleted">-</span><span class="token line"> });
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> document.body.appendChild(component());</span></span></code></pre><aside class="warning"><h6 class="warning__prefix">警告</h6><p>注意当调用 ES6 模块的 <code>import()</code> 方法（引入模块）时，必须指向模块的 <code>.default</code> 值，因为它才是 promise 被处理后返回的实际的 <code>module</code> 对象。</p></aside><p>现在运行 webpack 来验证一下我们的懒加载功能：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
          Asset       Size  Chunks                    Chunk Names
print.bundle.js  <span class="token number">417</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         print
index.bundle.js     <span class="token number">548</span> kB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  index
     index.html  <span class="token number">189</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.</code></pre><h2><span id="frameworks"></span>框架<a href="#frameworks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>许多框架和类库对于如何用它们自己的方式来实现（懒加载）都有自己的建议。这里有一些例子：</p><ul><li>React: <a href="https://reactjs.org/docs/code-splitting.html">Code Splitting and Lazy Loading</a></li><li>Vue: <a href="https://vuedose.tips/tips/dynamic-imports-in-vue-js-for-better-performance/">Dynamic Imports in Vue.js for better performance</a></li><li>Angular: <a href="https://angular.io/guide/router#milestone-6-asynchronous-routing">Lazy Loading route configuration</a> and <a href="https://medium.com/@var_bin/angularjs-webpack-lazyload-bb7977f390dd">AngularJS + webpack = lazyLoad</a></li></ul><h1><span id="ECMAScript-模块"></span>ECMAScript 模块<a href="#ECMAScript-%E6%A8%A1%E5%9D%97" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>ECMAScript 模块（ESM）是在 Web 中使用模块的<a href="https://tc39.github.io/ecma262/#sec-modules">规范</a>。
所有现代浏览器均支持此功能，同时也是在 Web 中编写模块化代码的推荐方式。</p><p>webpack 支持处理 ECMAScript 模块以优化它们。</p><h2><span id="exporting"></span>导出<a href="#exporting" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>关键字 <code>export</code> 允许将 ESM 中的内容暴露给其他模块:</p><pre><code class="hljs language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CONSTANT</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">let</span> variable <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token comment">// 对外暴露的变量为只读</span>
<span class="token comment">// 无法从外部修改</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;fun&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token keyword">extends</span> <span class="token class-name">Super</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;method&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> other<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> other <span class="token keyword">as</span> c <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token function">more</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2><span id="importing"></span>导入<a href="#importing" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>关键字 <code>import</code> 允许从其他模块获取引用到 ESM 中:</p><pre><code class="hljs language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CONSTANT</span><span class="token punctuation">,</span> variable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./module.js&#x27;</span><span class="token punctuation">;</span>
<span class="token comment">// 导入由其他模块导出的“绑定”</span>
<span class="token comment">// 这些绑定是动态的. 这里并非获取到了值的副本</span>
<span class="token comment">// 而是当将要访问“variable”时</span>
<span class="token comment">// 再从导入的模块中获取当前值</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module <span class="token keyword">from</span> <span class="token string">&#x27;./module.js&#x27;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 导入包含所有导出内容的“命名空间对象”</span>

<span class="token keyword">import</span> theDefaultValue <span class="token keyword">from</span> <span class="token string">&#x27;./module.js&#x27;</span><span class="token punctuation">;</span>
<span class="token comment">// 导入 `default` 导出的快捷方式</span></code></pre><h2><span id="flagging-modules-as-esm"></span>将模块标记为 ESM<a href="#flagging-modules-as-esm" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>默认情况下，webpack 将自动检测文件是 ESM 还是其他模块系统。</p><p>Node.js 通过设置 <code>package.json</code> 中的属性来显式设置文件模块类型。
在 package.json 中设置 <code>&quot;type&quot;: &quot;module&quot;</code> 会强制 package.json 下的所有文件使用 ECMAScript 模块。
设置 <code>&quot;type&quot;: &quot;commonjs&quot;</code> 将会强制使用 CommonJS 模块。</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
<span class="token punctuation">}</span></code></pre><p>除此之外，文件还可以通过使用 <code>.mjs</code> 或 <code>.cjs</code> 扩展名来设置模块类型。 <code>.mjs</code> 将它们强制置为 ESM，<code>.cjs</code> 将它们强制置为 CommonJs。</p><p>在使用 <code>text/javascript</code> 或 <code>application/javascript</code> mime type 的 DataURI 中，也将使用 ESM。</p><p>除了模块格式外，将模块标记为 ESM 还会影响解析逻辑，操作逻辑和模块中的可用符号。</p><p>导入模块在 ESM 中更为严格，导入相对路径的模块必须包含文件名和文件扩展名（例如 <code>*.js</code> 或者 <code>*.mjs</code>），除非你设置了 <a href="/configuration/module/#resolve-fully-specified"><code>fullySpecified=false</code></a>。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>依旧支持导入包，例如 <code>import &quot;lodash&quot;</code> .</p></aside><p>non-ESM 仅能导入 <code>default</code> 导出的模块，不支持命名导出的模块。</p><p>CommonJs 语法不可用: <code>require</code>, <code>module</code>, <code>exports</code>, <code>__filename</code>, <code>__dirname</code>.</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>HMR 使用 <a href="/api/module-variables/#importmetawebpackHot"><code>import.meta.webpackHot</code></a> 代替 <a href="/api/module-variables/#modulehot-webpack-specific"><code>module.hot</code></a>。</p></aside><h1><span id="Shimming-预置依赖"></span>Shimming 预置依赖<a href="#Shimming-%E9%A2%84%E7%BD%AE%E4%BE%9D%E8%B5%96" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p><code>webpack</code> compiler 能够识别遵循 ES2015 模块语法、CommonJS 或 AMD 规范编写的模块。然而，一些 third party(第三方库) 可能会引用一些全局依赖（例如 <code>jQuery</code> 中的 <code>$</code>）。因此这些 library 也可能会创建一些需要导出的全局变量。这些 &quot;broken modules(不符合规范的模块)&quot; 就是 <em>shimming(预置依赖)</em> 发挥作用的地方。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p><strong>我们不推荐使用全局依赖</strong>！webpack 背后的整个理念是使前端开发更加模块化。也就是说，需要编写具有良好的封闭性(well contained)、不依赖于隐含依赖（例如，全局变量）的彼此隔离的模块。请只在必要的时候才使用这些特性。</p></aside><p><em>shim</em> 另外一个极其有用的使用场景就是：当你希望 <a href="https://en.wikipedia.org/wiki/Polyfill_(programming)">polyfill</a> 扩展浏览器能力，来支持到更多用户时。在这种情况下，你可能只是想要将这些 polyfills 提供给需要修补(patch)的浏览器（也就是实现按需加载）。</p><p>下面的文章将向我们展示这两种用例。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>为了方便，本指南继续沿用 <a href="/guides/getting-started">起步</a> 中的代码示例。在继续之前，请确保你已经熟悉这些配置。</p></aside><h2><span id="shimming-globals"></span>Shimming 预置全局变量<a href="#shimming-globals" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>让我们开始第一个 shimming 全局变量的用例。在此之前，先看下我们的项目：</p><p><strong>project</strong></p><pre><code class="hljs language-diff">webpack-demo
|- package.json
|- package-lock.json
|- webpack.config.js
|- /dist
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.html
</span></span>|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span>|- /node_modules</code></pre><p>还记得我们之前用过的 <code>lodash</code> 吗？出于演示目的，例如把这个应用程序中的模块依赖，改为一个全局变量依赖。要实现这些，我们需要使用 <code>ProvidePlugin</code> 插件。</p><p>使用 <a href="/plugins/provide-plugin"><code>ProvidePlugin</code></a> 后，能够在 webpack 编译的每个模块中，通过访问一个变量来获取一个 package。如果 webpack 看到模块中用到这个变量，它将在最终 bundle 中引入给定的 package。让我们先移除 <code>lodash</code> 的 <code>import</code> 语句，改为通过插件提供它：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import _ from &#x27;lodash&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // Lodash, now imported by this script
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const webpack = require(&#x27;webpack&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">    new webpack.ProvidePlugin({
</span><span class="token prefix inserted">+</span><span class="token line">      _: &#x27;lodash&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    }),
</span><span class="token prefix inserted">+</span><span class="token line">  ],
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>我们本质上所做的，就是告诉 webpack……</p><blockquote><p>如果你遇到了至少一处用到 <code>_</code> 变量的模块实例，那请你将 <code>lodash</code> package 引入进来，并将其提供给需要用到它的模块。</p></blockquote><p>运行我们的构建脚本，将会看到同样的输出：</p><pre><code class="hljs language-bash">$ <span class="token function">npm</span> run build

<span class="token punctuation">..</span>

<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset main.js <span class="token number">69.1</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span> <span class="token number">1</span> related asset
runtime modules <span class="token number">344</span> bytes <span class="token number">2</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">191</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">2910</span> ms</code></pre><p>还可以使用 <code>ProvidePlugin</code> 暴露出某个模块中单个导出，通过配置一个“数组路径”（例如 <code>[module, child, ...children?]</code>）实现此功能。所以，我们假想如下，无论 <code>join</code> 方法在何处调用，我们都只会获取到 <code>lodash</code> 中提供的 <code>join</code> 方法。</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  element.innerHTML = join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const webpack = require(&#x27;webpack&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new webpack.ProvidePlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      _: &#x27;lodash&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      join: [&#x27;lodash&#x27;, &#x27;join&#x27;],
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>这样就能很好的与 <a href="/guides/tree-shaking">tree shaking</a> 配合，将 <code>lodash</code> library 中的其余没有用到的导出去除。</p><h2><span id="granular-shimming"></span>细粒度 Shimming<a href="#granular-shimming" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>一些遗留模块依赖的 <code>this</code> 指向的是 <code>window</code> 对象。在接下来的用例中，调整我们的 <code>index.js</code>：</p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   // 假设我们处于 `window` 上下文
</span><span class="token prefix inserted">+</span><span class="token line">   this.alert(&#x27;Hmmm, this probably isn\&#x27;t a great idea...&#x27;)
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p>当模块运行在 CommonJS 上下文中，这将会变成一个问题，也就是说此时的 <code>this</code> 指向的是 <code>module.exports</code>。在这种情况下，你可以通过使用 <a href="/loaders/imports-loader/"><code>imports-loader</code></a> 覆盖 <code>this</code> 指向：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const webpack = require(&#x27;webpack&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  module: {
</span><span class="token prefix inserted">+</span><span class="token line">    rules: [
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: require.resolve(&#x27;./src/index.js&#x27;),
</span><span class="token prefix inserted">+</span><span class="token line">        use: &#x27;imports-loader?wrapper=window&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">    ],
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new webpack.ProvidePlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      join: [&#x27;lodash&#x27;, &#x27;join&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><h2><span id="global-exports"></span>全局 Exports<a href="#global-exports" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>让我们假设，某个 library 创建出一个全局变量，它期望 consumer(使用者) 使用这个变量。为此，我们可以在项目配置中，添加一个小模块来演示说明：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- globals.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>src/globals.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token string">&#x27;blah.txt&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> helpers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;test something&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">parse</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;parse something&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>你可能从来没有在自己的源码中做过这些事情，但是你也许遇到过一个老旧的 library，和上面所展示的代码类似。在这种情况下，我们可以使用 <a href="/loaders/exports-loader/"><code>exports-loader</code></a>，将一个全局变量作为一个普通的模块来导出。例如，为了将 <code>file</code> 导出为 <code>file</code> 以及将 <code>helpers.parse</code> 导出为 <code>parse</code>，做如下调整：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const webpack = require(&#x27;webpack&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: require.resolve(&#x27;./src/index.js&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">        use: &#x27;imports-loader?wrapper=window&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: require.resolve(&#x27;./src/globals.js&#x27;),
</span><span class="token prefix inserted">+</span><span class="token line">        use:
</span><span class="token prefix inserted">+</span><span class="token line">          &#x27;exports-loader?type=commonjs&amp;exports=file,multiple|helpers.parse|parse&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new webpack.ProvidePlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      join: [&#x27;lodash&#x27;, &#x27;join&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>此时，在我们的 entry 入口文件中（即 <code>src/index.js</code>），可以使用 <code>const { file, parse } = require(&#x27;./globals.js&#x27;);</code>，可以保证一切将顺利运行。</p><h2><span id="loading-polyfills"></span>加载 Polyfills<a href="#loading-polyfills" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>目前为止我们所讨论的所有内容都是处理那些遗留的 package，让我们进入到第二个话题：<strong>polyfill</strong>。</p><p>有很多方法来加载 polyfill。例如，想要引入 <a href="https://babel.docschina.org/docs/en/babel-polyfill/"><code>babel-polyfill</code></a> 我们只需如下操作：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save babel-polyfill</code></pre><p>然后，使用 <code>import</code> 将其引入到我们的主 bundle 文件：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import &#x27;babel-polyfill&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // Assume we are in the context of `window`
</span><span class="token prefix unchanged"> </span><span class="token line">  this.alert(&quot;Hmmm, this probably isn&#x27;t a great idea...&quot;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>注意，我们没有将 <code>import</code> 绑定到某个变量。这是因为 polyfill 直接基于自身执行，并且是在基础代码执行之前，这样通过这些预置，我们就可以假定已经具有某些原生功能。</p></aside><p>注意，这种方式优先考虑正确性，而不考虑 bundle 体积大小。为了安全和可靠，polyfill/shim 必须<strong>运行于所有其他代码之前</strong>，而且需要同步加载，或者说，需要在所有 polyfill/shim 加载之后，再去加载所有应用程序代码。
社区中存在许多误解，即现代浏览器“不需要”polyfill，或者 polyfill/shim 仅用于添加缺失功能 - 实际上，它们通常用于<strong>修复损坏实现(repair broken implementation)</strong>，即使是在最现代的浏览器中，也会出现这种情况。
因此，最佳实践仍然是，不加选择地和同步地加载所有 polyfill/shim，尽管这会导致额外的 bundle 体积成本。</p><p>如果你认为自己已经打消这些顾虑，并且希望承受损坏的风险。那么接下来的这件事情，可能是你应该要做的：
我们将会把 <code>import</code> 放入一个新文件，并加入 <a href="https://github.com/github/fetch"><code>whatwg-fetch</code></a> polyfill：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save whatwg-fetch</code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import &#x27;babel-polyfill&#x27;;
</span><span class="token prefix deleted">-</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // Assume we are in the context of `window`
</span><span class="token prefix unchanged"> </span><span class="token line">  this.alert(&quot;Hmmm, this probably isn&#x27;t a great idea...&quot;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());</span></span></code></pre><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- globals.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- polyfills.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>src/polyfills.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">import</span> <span class="token string">&#x27;babel-polyfill&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;whatwg-fetch&#x27;</span><span class="token punctuation">;</span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line">const webpack = require(&#x27;webpack&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  entry: &#x27;./src/index.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  entry: {
</span><span class="token prefix inserted">+</span><span class="token line">    polyfills: &#x27;./src/polyfills&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">    index: &#x27;./src/index.js&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: &#x27;main.js&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: &#x27;[name].bundle.js&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: require.resolve(&#x27;./src/index.js&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">        use: &#x27;imports-loader?wrapper=window&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: require.resolve(&#x27;./src/globals.js&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">        use:
</span><span class="token prefix unchanged"> </span><span class="token line">          &#x27;exports-loader?type=commonjs&amp;exports[]=file&amp;exports[]=multiple|helpers.parse|parse&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new webpack.ProvidePlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      join: [&#x27;lodash&#x27;, &#x27;join&#x27;],
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">};</span></span></code></pre><p>如上配置之后，我们可以在代码中添加一些逻辑，有条件地加载新的 <code>polyfills.bundle.js</code> 文件。根据需要支持的技术和浏览器来决定是否加载。我们将做一些简单的试验，来确定是否需要引入这些 polyfill：</p><p><strong>dist/index.html</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;title&gt;Getting Started&lt;/title&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script&gt;
</span><span class="token prefix inserted">+</span><span class="token line">      const modernBrowser = &#x27;fetch&#x27; in window &amp;&amp; &#x27;assign&#x27; in Object;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">      if (!modernBrowser) {
</span><span class="token prefix inserted">+</span><span class="token line">        const scriptElement = document.createElement(&#x27;script&#x27;);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">        scriptElement.async = false;
</span><span class="token prefix inserted">+</span><span class="token line">        scriptElement.src = &#x27;/polyfills.bundle.js&#x27;;
</span><span class="token prefix inserted">+</span><span class="token line">        document.head.appendChild(scriptElement);
</span><span class="token prefix inserted">+</span><span class="token line">      }
</span><span class="token prefix inserted">+</span><span class="token line">    &lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;index.bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;</span></span></code></pre><p>现在，在 entry 入口文件中，可以通过 <code>fetch</code> 获取一些数据：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // Assume we are in the context of `window`
</span><span class="token prefix unchanged"> </span><span class="token line">  this.alert(&quot;Hmmm, this probably isn&#x27;t a great idea...&quot;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">fetch(&#x27;https://jsonplaceholder.typicode.com/users&#x27;)
</span><span class="token prefix inserted">+</span><span class="token line">  .then((response) =&gt; response.json())
</span><span class="token prefix inserted">+</span><span class="token line">  .then((json) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">    console.log(
</span><span class="token prefix inserted">+</span><span class="token line">      &quot;We retrieved some data! AND we&#x27;re confident it will work on a variety of browser distributions.&quot;
</span><span class="token prefix inserted">+</span><span class="token line">    );
</span><span class="token prefix inserted">+</span><span class="token line">    console.log(json);
</span><span class="token prefix inserted">+</span><span class="token line">  })
</span><span class="token prefix inserted">+</span><span class="token line">  .catch((error) =&gt;
</span><span class="token prefix inserted">+</span><span class="token line">    console.error(&#x27;Something went wrong when fetching this data: &#x27;, error)
</span><span class="token prefix inserted">+</span><span class="token line">  );</span></span></code></pre><p>执行构建脚本，可以看到，浏览器发送了额外的 <code>polyfills.bundle.js</code> 文件请求，然后所有代码顺利执行。注意，以上的这些设定可能还会有所改进，这里我们向你提供一个很棒的想法：将 polyfill 提供给需要引入它的用户。</p><h2><span id="further-optimizations"></span>进一步优化<a href="#further-optimizations" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><code>babel-preset-env</code> package 通过 <a href="https://github.com/browserslist/browserslist">browserslist</a> 来转译那些你浏览器中不支持的特性。这个 preset 使用 <a href="https://babel.docschina.org/docs/en/babel-preset-env#usebuiltins"><code>useBuiltIns</code></a> 选项，默认值是 <code>false</code>，这种方式可以将全局 <code>babel-polyfill</code> 导入，改进为更细粒度的 <code>import</code> 格式：</p><pre><code class="hljs language-js"><span class="token keyword">import</span> <span class="token string">&#x27;core-js/modules/es7.string.pad-start&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;core-js/modules/es7.string.pad-end&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;core-js/modules/web.timers&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;core-js/modules/web.immediate&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;core-js/modules/web.dom.iterable&#x27;</span><span class="token punctuation">;</span></code></pre><p>See <a href="https://babeljs.io/docs/en/babel-preset-env">the babel-preset-env documentation</a> for more information.</p><h2><span id="node-built-ins"></span>Node 内置<a href="#node-built-ins" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>像 <code>process</code> 这种 Node 内置模块，能直接根据配置文件进行正确的 polyfill，而不需要任何特定的 loader 或者 plugin。查看 <a href="/configuration/node">node</a> 配置页面获取更多信息。</p><h2><span id="other-utilities"></span>其他工具<a href="#other-utilities" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>还有一些其他的工具，也能够帮助我们处理这些遗留模块。</p><p>如果这些遗留模块没有 AMD/CommonJS 版本，但你也想将他们加入 <code>dist</code> 文件，则可以使用 <a href="/configuration/module/#modulenoparse"><code>noParse</code></a> 来标识出这个模块。这样就能使 webpack 将引入这些模块，但是不进行转化(parse)，以及不解析(resolve) <code>require()</code> 和 <code>import</code> 语句。这种用法还会提高构建性能。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>任何需要 AST 的功能（例如 <code>ProvidePlugin</code>）都不起作用。</p></aside><p>最后，一些模块支持多种 <a href="/concepts/modules">模块格式</a>，例如一个混合有 AMD、CommonJS 和 legacy(遗留) 的模块。在大多数这样的模块中，会首先检查 <code>define</code>，然后使用一些怪异代码导出一些属性。在这些情况下，可以通过 <a href="/loaders/imports-loader/"><code>imports-loader</code></a> 设置 <code>additionalCode=var%20define%20=%20false;</code> 来强制 CommonJS 路径。</p><hr/><aside class="tip"><h6 class="tip__prefix">提示</h6><p>译者注：shimming 是一个库(library)，它将一个新的 API 引入到一个旧的环境中，而且仅靠旧的环境中已有的手段实现。polyfill 就是一个用在浏览器 API 上的 shimming。我们通常的做法是先检查当前浏览器是否支持某个 API，如果不支持的话就按需加载对应的 polyfill。然后新旧浏览器就都可以使用这个 API 了。</p></aside><h1><span id="TypeScript"></span>TypeScript<a href="#TypeScript" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <strong><a href="/guides/getting-started/">起步</a></strong> 中的代码示例。</p></aside><p><a href="https://www.typescriptlang.org">TypeScript</a> 是 JavaScript 的超集，为其增加了类型系统。TypeScript 可以被编译为普通的 JavaScript 代码。这篇指南将会介绍如何在 webpack 中集成 TypeScript。</p><h2><span id="basic-setup"></span>基础配置<a href="#basic-setup" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>首先，执行以下命令安装 TypeScript 编译器和 loader：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev typescript ts-loader</code></pre><p>现在，我们将修改目录结构和配置文件：</p><p><strong>project</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package-lock.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- tsconfig.json
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- index.ts
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules</span></span></code></pre><p><strong>tsconfig.json</strong></p><p>这里我们添加一个基本的配置以支持 JSX，并将 TypeScript 编译到 ES5……</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>参阅 <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">TypeScript 官方文档</a> 了解更多关于 <code>tsconfig.json</code> 配置选项的信息。</p><p>参阅 <a href="/concepts/configuration/">配置</a> 了解更多关于 webpack 配置的信息。</p><p>现在，配置 webpack 处理 TypeScript：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&#x27;./src/index.ts&#x27;</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.tsx?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token string">&#x27;ts-loader&#x27;</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;.tsx&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;.ts&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;.js&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&#x27;bundle.js&#x27;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>上面的配置将会指定 <code>./src/index.ts</code> 为入口文件，并通过 <code>ts-loader</code> 加载所有 <code>.ts</code> 和 <code>.tsx</code> 文件，并在当前目录 <strong>输出</strong> 一个 <code>bundle.js</code> 文件。</p><p>由于 <code>lodash</code> 没有默认导出，因此现在需要修改 <code>lodash</code> 在 <code>./index.ts</code> 文件中的引入。</p><p><strong>./index.ts</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import * as _ from &#x27;lodash&#x27;;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement(&#x27;div&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());</span></span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果想在 TypeScript 中继续使用像 <code>import _ from &#x27;lodash&#x27;;</code> 的语法，让它被作为一种默认的导入方式，需要在 <strong>tsconfig.json</strong> 中设置 <code>&quot;allowSyntheticDefaultImports&quot; : true</code> 和 <code>&quot;esModuleInterop&quot; : true</code>。这是与 TypeScript 相关的配置，在本文档中提及仅供参考。</p></aside><h2><span id="loader"></span>loader<a href="#loader" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><a href="https://github.com/TypeStrong/ts-loader"><code>ts-loader</code></a></p><p>在本指南中，我们使用 <code>ts-loader</code>，因为它能够很方便地启用额外的 webpack 功能，例如将其他 web 资源导入到项目中。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p><code>ts-loader</code> 使用 TypeScript 编译器 <code>tsc</code>，并依赖于 <code>tsconfig.json</code> 配置。请确保避免将 <a href="https://www.typescriptlang.org/tsconfig#module"><code>module</code></a> 设置为 <code>&quot;CommonJS&quot;</code>，否则 webpack 将无法对代码进行 <a href="/guides/tree-shaking">tree shaking</a>。</p></aside><p>请注意，如果已经使用 <a href="https://github.com/babel/babel-loader"><code>babel-loader</code></a> 转译代码，可以使用 <a href="https://babeljs.io/docs/en/babel-preset-typescript"><code>@babel/preset-typescript</code></a> 以让 Babel 处理 JavaScript 和 TypeScript 文件，而不需要额外使用 loader。请记住，与 <code>ts-loader</code> 相反，底层的 <a href="https://babeljs.io/docs/en/babel-plugin-transform-typescript"><code>@babel/plugin-transform-typescript</code></a> 插件不执行任何类型检查。</p><h2><span id="source-maps"></span>source map<a href="#source-maps" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>参阅 <a href="/guides/development">开发环境</a> 指南了解更多关于 source map 的信息。</p><p>我们需要对 TypeScript 进行配置以启用 source map，从而实现将内联的 source map 输出到编译后的 JavaScript 文件。必须在 TypeScript 配置中添加下面这行：</p><p><strong>tsconfig.json</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;compilerOptions&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;outDir&quot;: &quot;./dist/&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     &quot;sourceMap&quot;: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     &quot;noImplicitAny&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;module&quot;: &quot;commonjs&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;target&quot;: &quot;es5&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;jsx&quot;: &quot;react&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;allowJs&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;moduleResolution&quot;: &quot;node&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line"> }</span></span></code></pre><p>现在，我们需要告诉 webpack 提取这些 source map，并内联到最终的 bundle 中。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: &#x27;./src/index.ts&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   devtool: &#x27;inline-source-map&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   module: {
</span><span class="token prefix unchanged"> </span><span class="token line">     rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">       {
</span><span class="token prefix unchanged"> </span><span class="token line">         test: /\.tsx?$/,
</span><span class="token prefix unchanged"> </span><span class="token line">         use: &#x27;ts-loader&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">         exclude: /node_modules/,
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span><span class="token prefix unchanged"> </span><span class="token line">     ],
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   resolve: {
</span><span class="token prefix unchanged"> </span><span class="token line">     extensions: [ &#x27;.tsx&#x27;, &#x27;.ts&#x27;, &#x27;.js&#x27; ],
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>查看 <a href="/configuration/devtool/">devtool</a> 文档以了解更多信息。</p><h2><span id="client-types"></span>客户端类型<a href="#client-types" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>你可以在 TypeScript 代码中使用 webpack 特定的特性，比如 <a href="/api/module-variables/#importmetawebpack"><code>import.meta.webpack</code></a>。只需要添加 TypeScript <a href="https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html#-reference-types-"><code>reference</code></a> 声明，webpack 便会为它们提供类型支持：</p><pre><code class="hljs language-ts"><span class="token comment">/// &lt;reference types=&quot;webpack/module&quot; /&gt;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>webpack<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有上面的声明的话，TypeScript 会抛出一个错误</span></code></pre><h2><span id="using-third-party-libraries"></span>使用第三方库<a href="#using-third-party-libraries" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在从 npm 安装第三方库时，一定要记得同时安装此库的类型声明文件。你可以从 <a href="https://microsoft.github.io/TypeSearch/">TypeSearch</a> 中找到并安装这些第三方库的类型声明文件。</p><p>举个例子，如果想安装 lodash 类型声明文件，可以运行下面的命令：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev @types/lodash</code></pre><p>参与 <a href="https://blogs.msdn.microsoft.com/typescript/2016/06/15/the-future-of-declaration-files/">这篇文章</a> 以了解更多。</p><h2><span id="importing-other-assets"></span>导入其他资源<a href="#importing-other-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>想要在 TypeScript 中使用非代码资源，需要告诉 TypeScript 推断导入资源的类型。在项目里创建一个 <code>custom.d.ts</code> 文件，这个文件用来表示项目中 TypeScript 的自定义类型声明。我们为 <code>.svg</code> 文件设置一个声明：</p><p><strong>custom.d.ts</strong></p><pre><code class="hljs language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#x27;*.svg&#x27;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>在这里我们通过指定任何以 <code>.svg</code> 结尾的导入，将 SVG 声明为一个新的模块，并将模块的 <code>content</code> 定义为 <code>any</code>。我们可以通过将类型定义为字符串，来更加显式地将它声明为一个 url。同样的概念适用于其他资源，包括 CSS，SCSS，以及 JSON 等。</p><h2><span id="build-performance"></span>构建性能<a href="#build-performance" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><aside class="warning"><h6 class="warning__prefix">警告</h6><p>这么做可能会降低构建性能。</p></aside><p>参阅 <a href="/guides/build-performance/">构建性能</a> 以了解更多关于构建性能的信息。</p><h1><span id="Web-Workers"></span>Web Workers<a href="#Web-Workers" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>从 webpack 5 开始，你可以使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">Web Workers</a> 代替 <a href="https://github.com/webpack-contrib/worker-loader"><code>worker-loader</code></a>。</p><h2><span id="syntax"></span>语法<a href="#syntax" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><pre><code class="hljs language-js"><span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&#x27;./worker.js&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>选择这种语法是为了实现不使用 bundler 就可以运行代码，它也可以在浏览器中的原生 ECMAScript 模块中使用。</p><p>请注意，虽然 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker"><code>Worker</code> API</a> 建议 <code>Worker</code> 构造函数接受表示 URL 的字符串脚本，在 webpack 5 中你只能使用 <code>URL</code> 代替。</p><h2><span id="example"></span>示例<a href="#example" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><strong>src/index.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&#x27;./deep-thought.js&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  question<span class="token operator">:</span>
    <span class="token string">&#x27;The Answer to the Ultimate Question of Life, The Universe, and Everything.&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> answer <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>src/deep-thought.js</strong></p><pre><code class="hljs language-js">self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> question <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    answer<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2><span id="nodejs"></span>Node.js<a href="#nodejs" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>Node.js（&gt;= 12.17.0） 也支持类似的语法：</p><pre><code class="hljs language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Worker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;worker_threads&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&#x27;./worker.js&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>请注意，这仅在 ESM 中可用。但不可用于 ComonnJS，无论 webpack 还是 Node.js 均是如此。</p><h1><span id="渐进式网络应用程序"></span>渐进式网络应用程序<a href="#%E6%B8%90%E8%BF%9B%E5%BC%8F%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<aside class="tip"><h6 class="tip__prefix">提示</h6><p>本指南继续沿用 <a href="/guides/output-management">管理输出</a> 中的代码示例。</p></aside><p>渐进式网络应用程序(progressive web application - PWA)，是一种可以提供类似于 native app(原生应用程序) 体验的 web app(网络应用程序)。PWA 可以用来做很多事。其中最重要的是，在**离线(offline)**时应用程序能够继续运行功能。这是通过使用名为 <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Service Workers</a> 的 web 技术来实现的。</p><p>本章将重点介绍，如何为我们的应用程序添加离线体验。我们将使用名为 <a href="https://github.com/GoogleChrome/workbox">Workbox</a> 的 Google 项目来实现此目的，该项目提供的工具可帮助我们更简单地为 web app 提供离线支持。</p><h2><span id="we-dont-work-offline-now"></span>现在，我们并没有运行在离线环境下<a href="#we-dont-work-offline-now" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>到目前为止，我们一直是直接查看本地文件系统的输出结果。通常情况下，真正的用户是通过网络访问 web app；用户的浏览器会与一个提供所需资源（例如，<code>.html</code>, <code>.js</code> 和 <code>.css</code> 文件）的 <strong>server</strong> 通讯。</p><p>我们通过搭建一个拥有更多基础特性的 server 来测试下这种离线体验。这里使用 <a href="https://www.npmjs.com/package/http-server">http-server</a> package：<code>npm install http-server --save-dev</code>。还要修改 <code>package.json</code> 的 <code>scripts</code> 部分，来添加一个 <code>start</code> script：</p><p><strong>package.json</strong></p><pre><code class="hljs language-diff">{
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ...
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;,
</span><span class="token prefix inserted">+</span><span class="token line">    &quot;start&quot;: &quot;http-server dist&quot;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> ...
</span></span>}</code></pre><p>注意：默认情况下，<a href="/configuration/dev-server/">webpack DevServer</a> 会写入到内存。我们需要启用 <a href="/configuration/dev-server/#devserverdevmiddleware">devserverdevmiddleware.writeToDisk</a> 配置项，来让 http-server 处理 <code>./dist</code> 目录中的文件。</p><p>如果你之前没有操作过，先得运行命令 <code>npm run build</code> 来构建你的项目。然后运行命令 <code>npm start</code>。应该产生以下输出：</p><pre><code class="hljs language-bash"><span class="token operator">&gt;</span> http-server dist

Starting up http-server, serving dist
Available on:
  http://xx.x.x.x:8080
  http://127.0.0.1:8080
  http://xxx.xxx.x.x:8080
Hit CTRL-C to stop the server</code></pre><p>如果你打开浏览器访问 <code>http://localhost:8080</code> (即 <code>http://127.0.0.1</code>)，你应该会看到 webpack 应用程序被 serve 到 <code>dist</code> 目录。如果停止 server 然后刷新，则 webpack 应用程序不再可访问。</p><p>这就是我们为实现离线体验所需要的改变。在本章结束时，我们应该要实现的是，停止 server 然后刷新，仍然可以看到应用程序正常运行。</p><h2><span id="adding-workbox"></span>添加 Workbox<a href="#adding-workbox" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>添加 workbox-webpack-plugin 插件，然后调整 <code>webpack.config.js</code> 文件：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> workbox-webpack-plugin --save-dev</code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require(&#x27;path&#x27;);
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const WorkboxPlugin = require(&#x27;workbox-webpack-plugin&#x27;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">     app: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     print: &#x27;./src/print.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       title: &#x27;Output Management&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       title: &#x27;Progressive Web Application&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     new WorkboxPlugin.GenerateSW({
</span><span class="token prefix inserted">+</span><span class="token line">       // 这些选项帮助快速启用 ServiceWorkers
</span><span class="token prefix inserted">+</span><span class="token line">       // 不允许遗留任何“旧的” ServiceWorkers
</span><span class="token prefix inserted">+</span><span class="token line">       clientsClaim: true,
</span><span class="token prefix inserted">+</span><span class="token line">       skipWaiting: true,
</span><span class="token prefix inserted">+</span><span class="token line">     }),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: &#x27;[name].bundle.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, &#x27;dist&#x27;),
</span><span class="token prefix unchanged"> </span><span class="token line">     clean: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };</span></span></code></pre><p>完成这些设置，再次执行 <code>npm run build</code>，看下会发生什么：</p><pre><code class="hljs language-bash"><span class="token punctuation">..</span>.
                  Asset       Size  Chunks                    Chunk Names
          app.bundle.js     <span class="token number">545</span> kB    <span class="token number">0</span>, <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  app
        print.bundle.js    <span class="token number">2.74</span> kB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         print
             index.html  <span class="token number">254</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
precache-manifest.b5ca1c555e832d6fbf9462efd29d27eb.js  <span class="token number">268</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
      service-worker.js       <span class="token number">1</span> kB          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.</code></pre><p>现在你可以看到，生成了两个额外的文件：<code>service-worker.js</code> 和名称冗长的 <code>precache-manifest.b5ca1c555e832d6fbf9462efd29d27eb.js</code>。<code>service-worker.js</code> 是 Service Worker 文件，<code>precache-manifest.b5ca1c555e832d6fbf9462efd29d27eb.js</code> 是 <code>service-worker.js</code> 引用的文件，所以它也可以运行。你本地生成的文件可能会有所不同；但是应该会有一个 <code>service-worker.js</code> 文件。</p><p>所以，值得高兴的是，我们现在已经创建出一个 Service Worker。接下来该做什么？</p><h2><span id="registering-our-service-worker"></span>注册 Service Worker<a href="#registering-our-service-worker" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>接下来我们注册 Service Worker，使其出场并开始表演。通过添加以下注册代码来完成此操作：</p><p><strong>index.js</strong></p><pre><code class="hljs language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from &#x27;lodash&#x27;;
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from &#x27;./print.js&#x27;;
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> if (&#x27;serviceWorker&#x27; in navigator) {
</span><span class="token prefix inserted">+</span><span class="token line">   window.addEventListener(&#x27;load&#x27;, () =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">     navigator.serviceWorker.register(&#x27;/service-worker.js&#x27;).then(registration =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">       console.log(&#x27;SW registered: &#x27;, registration);
</span><span class="token prefix inserted">+</span><span class="token line">     }).catch(registrationError =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">       console.log(&#x27;SW registration failed: &#x27;, registrationError);
</span><span class="token prefix inserted">+</span><span class="token line">     });
</span><span class="token prefix inserted">+</span><span class="token line">   });
</span><span class="token prefix inserted">+</span><span class="token line"> }</span></span></code></pre><p>再次运行 <code>npm run build</code> 来构建包含注册代码版本的应用程序。然后用 <code>npm start</code> 启动服务。访问 <code>http://localhost:8080</code> 并查看 console 控制台。在那里你应该看到：</p><pre><code class="hljs language-bash">SW registered</code></pre><p>现在来进行测试。停止 server 并刷新页面。如果浏览器能够支持 Service Worker，应该可以看到你的应用程序还在正常运行。然而，server 已经<strong>停止</strong> serve 整个 dist 文件夹，此刻是 Service Worker 在进行 serve。</p><h2><span id="conclusion"></span>结论<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>你已经使用 Workbox 项目构建了一个离线应用程序。开始进入将 web app 改造为 PWA 的旅程。你现在可能想要考虑下一步做什么。<a href="https://web.dev/progressive-web-apps/">这里</a>是可以帮助到你解决下一步问题的比较不错的资源。</p><h1><span id="公共路径"></span>公共路径<a href="#%E5%85%AC%E5%85%B1%E8%B7%AF%E5%BE%84" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p><a href="/configuration/output/#outputpublicpath"><code>publicPath</code></a> 配置选项在各种场景中都非常有用。你可以通过它来指定应用程序中所有资源的基础路径。</p><h2><span id="use-cases"></span>示例<a href="#use-cases" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>下面提供一些用于实际应用程序的示例，通过这些示例，此功能显得极其简单。实质上，发送到 <code>output.path</code> 目录的每个文件，都将从 <code>output.publicPath</code> 位置引用。这也包括（通过 <a href="/guides/code-splitting/">代码分离</a> 创建的）子 chunk 和作为依赖图一部分的所有其他资源（例如 image, font 等）。</p><h3><span id="environment-based"></span>基于环境设置<a href="#environment-based" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>在开发环境中，我们通常有一个 <code>assets/</code> 文件夹，它与索引页面位于同一级别。这没太大问题，但是，如果我们将所有静态资源托管至 CDN，然后想在生产环境中使用呢？</p><p>想要解决这个问题，可以直接使用一个有着悠久历史的 environment variable(环境变量)。假设我们有一个变量 <code>ASSET_PATH</code>：</p><pre><code class="hljs language-js"><span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试使用环境变量，否则使用根路径</span>
<span class="token keyword">const</span> <span class="token constant">ASSET_PATH</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ASSET_PATH</span> <span class="token operator">||</span> <span class="token string">&#x27;/&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> <span class="token constant">ASSET_PATH</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 这可以帮助我们在代码中安全地使用环境变量</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&#x27;process.env.ASSET_PATH&#x27;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token constant">ASSET_PATH</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3><span id="on-the-fly"></span>在运行时设置<a href="#on-the-fly" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>另一个可能出现的情况是，需要在运行时设置 <code>publicPath</code>。webpack 暴露了一个名为 <code>__webpack_public_path__</code> 的全局变量。所以在应用程序的 entry point 中，可以直接如下设置：</p><pre><code class="hljs language-js">__webpack_public_path__ <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ASSET_PATH</span><span class="token punctuation">;</span></code></pre><p>这些内容就是你所需要的。由于我们已经在配置中使用了 <code>DefinePlugin</code>，
<code>process.env.ASSET_PATH</code> 将始终都被定义，
因此我们可以安全地使用。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>注意，如果在 entry 文件中使用 ES2015 module import，则会在 import 之后进行 <code>__webpack_public_path__</code> 赋值。在这种情况下，你必须将 public path 赋值移至一个专用模块中，然后将它的 import 语句放置到 entry.js 最上面：</p></aside><pre><code class="hljs language-js"><span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token string">&#x27;./public-path&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;./app&#x27;</span><span class="token punctuation">;</span></code></pre><h3><span id="Automatic-publicPath-automaticpublicPath"></span>Automatic publicPath $#automaticpublicPath$<a href="#Automatic-publicPath-automaticpublicPath" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>有可能你事先不知道 publicPath 是什么，webpack 会自动根据 <a href="/api/module-variables/#importmetaurl"><code>import.meta.url</code></a>、<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/currentScript"><code>document.currentScript</code></a>、<code>script.src</code> 或者 <code>self.location</code> 变量设置 publicPath。你需要做的是将 <a href="/configuration/output/#outputpublicpath"><code>output.publicPath</code></a> 设为 <code>&#x27;auto&#x27;</code>：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> <span class="token string">&#x27;auto&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>请注意在某些情况下不支持 <code>document.currentScript</code>，例如：IE 浏览器，你不得不引入一个 polyfill，例如 <a href="https://github.com/amiller-gh/currentScript-polyfill"><code>currentScript Polyfill</code></a>。</p><h1><span id="集成"></span>集成<a href="#%E9%9B%86%E6%88%90" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>首先，我们要消除一个常见的误解。webpack 是一个模块打包工具(module bundler)（例如，<a href="http://browserify.org/">Browserify</a> 或 <a href="https://brunch.io/">Brunch</a>）。而 <em>不是一个任务执行工具(task runner)</em>（例如，<a href="https://www.gnu.org/software/make/">Make</a>, <a href="https://gruntjs.com/">Grunt</a> 或者 <a href="https://gulpjs.com/">Gulp</a> ）。任务执行工具用来自动化处理常见的开发任务，例如，lint(代码检测)、build(构建)、test(测试)。相比模块打包工具，任务执行工具则聚焦在偏重上层的问题上面。你仍然可以得益于这种用法：使用上层的工具，而将打包部分的问题留给 webpack。</p><p>打包工具帮助你取得准备用于部署的 JavaScript 和 stylesheet，将它们转换为适合浏览器的可用格式。例如，可以通过 <a href="/plugins/terser-webpack-plugin">压缩</a>、<a href="/guides/code-splitting">分离 chunk</a> 和 <a href="/guides/lazy-loading">惰性加载</a> 我们的 JavaScript 来提高性能。打包是 web 开发中最重要的挑战之一，解决此问题可以消除开发过程中的大部分痛点。</p><p>好的消息是，虽然有一些功能重叠，但是如果使用方式正确，任务运行工具和模块打包工具还是能够一起协同工作。本指南提供了关于如何将 webpack 与一些流行的任务运行工具集成在一起的高度概述。</p><h2><span id="npm-scripts"></span>NPM Scripts<a href="#npm-scripts" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>通常 webpack 用户使用 npm <a href="https://docs.npmjs.com/misc/scripts"><code>scripts</code></a> 来作为任务执行工具。这是比较好的开始。然而跨平台支持可能是个问题，但是有几种解决方案。许多用户（但不是大多数用户）直接使用 npm <code>scripts</code> 和各种级别的 webpack 配置和工具。</p><p>因此，虽然 webpack 核心重点是打包，但是可以通过各种扩展，将它用于任务运行工具的常见工作。集成一个单独的工具会增加复杂度，因此在开始前一定要权衡利弊。</p><h2><span id="grunt"></span>Grunt<a href="#grunt" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>对于那些使用 Grunt 的人，我们推荐使用 <a href="https://www.npmjs.com/package/grunt-webpack"><code>grunt-webpack</code></a> package。使用 <code>grunt-webpack</code> 你可以将 webpack 或 <a href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a> 作为一项任务(task)执行，访问 <a href="https://gruntjs.com/api/grunt.template">grunt template tags</a> 中的统计信息，拆分开发和生产配置等等。如果还没有安装 <code>grunt-webpack</code> 和 <code>webpack</code>，请先安装它们：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev grunt-webpack webpack</code></pre><p>然后，注册一个配置并加载任务：</p><p><strong>Gruntfile.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./webpack.config.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">grunt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    webpack<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        stats<span class="token operator">:</span> <span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      prod<span class="token operator">:</span> webpackConfig<span class="token punctuation">,</span>
      dev<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> watch<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> webpackConfig<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">&#x27;grunt-webpack&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>获取更多信息，请查看 <a href="https://github.com/webpack-contrib/grunt-webpack">仓库</a>。</p><h2><span id="gulp"></span>Gulp<a href="#gulp" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在 <a href="https://github.com/shama/webpack-stream"><code>webpack-stream</code></a> package（也称作 <code>gulp-webpack</code>） 的帮助下，可以相当直接地将 Gulp 与 webpack 集成。在这种情况下，不需要单独安装 <code>webpack</code>，因为它是 <code>webpack-stream</code> 直接依赖：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-stream</code></pre><p>只要将 <code>webpack</code> 替换为 <code>require(&#x27;webpack-stream&#x27;)</code>，并传递一个配置：</p><p><strong>gulpfile.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;gulp&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-stream&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&#x27;default&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> gulp
    <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">&#x27;src/entry.js&#x27;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// Any configuration options...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">&#x27;dist/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>获取更多信息，请查看 <a href="https://github.com/shama/webpack-stream">仓库</a>。</p><h2><span id="mocha"></span>Mocha<a href="#mocha" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><a href="https://github.com/zinserjan/mocha-webpack"><code>mocha-webpack</code></a> 可以将 Mocha 与 webpack 完全集成。这个仓库提供了很多关于其优势和劣势的细节，基本上 <code>mocha-webpack</code> 只是一个简单封装，提供与 Mocha 几乎相同的 CLI，并提供各种 webpack 功能，例如改进了 watch mode 和改进了路径分析。这里是一个如何安装并使用它来运行测试套件的示例（在 <code>./test</code> 中找到）：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack mocha mocha-webpack
mocha-webpack <span class="token string">&#x27;test/**/*.js&#x27;</span></code></pre><p>获取更多信息，请查看 <a href="https://github.com/zinserjan/mocha-webpack">仓库</a>。</p><h2><span id="karma"></span>Karma<a href="#karma" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><a href="https://github.com/webpack-contrib/karma-webpack"><code>karma-webpack</code></a> package 允许你使用 webpack 预处理 <a href="https://karma-runner.github.io/1.0/index.html">Karma</a> 中的文件。</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack karma karma-webpack</code></pre><p><strong>karma.conf.js</strong></p><pre><code class="hljs language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    frameworks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    files<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> pattern<span class="token operator">:</span> <span class="token string">&#x27;test/*_test.js&#x27;</span><span class="token punctuation">,</span> watched<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> pattern<span class="token operator">:</span> <span class="token string">&#x27;test/**/*_test.js&#x27;</span><span class="token punctuation">,</span> watched<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    preprocessors<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&#x27;test/*_test.js&#x27;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&#x27;test/**/*_test.js&#x27;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    webpack<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Any custom webpack configuration...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;karma-webpack&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>获取更多信息，请查看 <a href="https://github.com/webpack-contrib/karma-webpack">仓库</a>。</p><h1><span id="Package-exports"></span>Package exports<a href="#Package-exports" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>The <code>exports</code> field in the <code>package.json</code> of a package allows to declare
which module should be used when using module requests like <code>import &quot;package&quot;</code> or <code>import &quot;package/sub/path&quot;</code>.
It replaces the default implementation that returns <code>main</code> field resp. <code>index.js</code> files for <code>&quot;package&quot;</code> and
the file system lookup for <code>&quot;package/sub/path&quot;</code>.</p><p>When the <code>exports</code> field is specified, only these module requests are available.
Any other requests will lead to a ModuleNotFound Error.</p><h2><span id="General-syntax"></span>General syntax<a href="#General-syntax" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>In general the <code>exports</code> field should contain an object
where each properties specifies a sub path of the module request.
For the examples above the following properties could be used:
<code>&quot;.&quot;</code> for <code>import &quot;package&quot;</code> and <code>&quot;./sub/path&quot;</code> for <code>import &quot;package/sub/path&quot;</code>.
Properties ending with a <code>/</code> will forward a request with this prefix to the old file system lookup algorithm.
For properties ending with <code>*</code>, <code>*</code> may take any value and any <code>*</code> in the property value is replaced with the taken value.</p><p>An example:</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./sub/path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./secondary.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./prefix/&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./directory/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./prefix/deep/&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./other-directory/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./other-prefix/*&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./yet-another/*/*.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><table><thead><tr><th>Module request</th><th>Result</th></tr></thead><tbody><tr><td data-th="Module request"><span><code>package</code></span></td><td data-th="Result"><span><code>.../package/main.js</code></span></td></tr><tr><td data-th="Module request"><span><code>package/sub/path</code></span></td><td data-th="Result"><span><code>.../package/secondary.js</code></span></td></tr><tr><td data-th="Module request"><span><code>package/prefix/some/file.js</code></span></td><td data-th="Result"><span><code>.../package/directory/some/file.js</code></span></td></tr><tr><td data-th="Module request"><span><code>package/prefix/deep/file.js</code></span></td><td data-th="Result"><span><code>.../package/other-directory/file.js</code></span></td></tr><tr><td data-th="Module request"><span><code>package/other-prefix/deep/file.js</code></span></td><td data-th="Result"><span><code>.../package/yet-another/deep/file/deep/file.js</code></span></td></tr><tr><td data-th="Module request"><span><code>package/main.js</code></span></td><td data-th="Result"><span>Error</span></td></tr></tbody></table><h2><span id="Alternatives"></span>Alternatives<a href="#Alternatives" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>Instead of providing a single result, the package author may provide a list of results.
In such a scenario this list is tried in order and the first valid result will be used.</p><p>Note: Only the first valid result will be used, not all valid results.</p><p>Example:</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;./things/&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./good-things/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./bad-things/&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Here <code>package/things/apple</code> might be found in <code>.../package/good-things/apple</code> or in <code>.../package/bad-things/apple</code>.</p><h2><span id="Conditional-syntax"></span>Conditional syntax<a href="#Conditional-syntax" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>Instead of providing results directly in the <code>exports</code> field,
the package author may let the module system choose one based on conditions about the environment.</p><p>In this case an object mapping conditions to results should be used.
Conditions are tried in object order.
Conditions that contain invalid results are skipped.
Conditions might be nested to create a logical AND.
The last condition in the object might be the special <code>&quot;default&quot;</code> condition,
which is always matched.</p><p>Example:</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;red&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./stop.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;yellow&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./stop.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;green&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;free&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./drive.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wait.js&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./drive-carefully.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>This translates to something like:</p><pre><code class="hljs language-ts"><span class="token keyword">if</span> <span class="token punctuation">(</span>red <span class="token operator">&amp;&amp;</span> <span class="token function">valid</span><span class="token punctuation">(</span><span class="token string">&#x27;./stop.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#x27;./stop.js&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>yellow <span class="token operator">&amp;&amp;</span> <span class="token function">valid</span><span class="token punctuation">(</span><span class="token string">&#x27;./stop.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#x27;./stop.js&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>green<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>free <span class="token operator">&amp;&amp;</span> <span class="token function">valid</span><span class="token punctuation">(</span><span class="token string">&#x27;./drive.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#x27;./drive.js&#x27;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">valid</span><span class="token punctuation">(</span><span class="token string">&#x27;./wait.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#x27;./wait.js&#x27;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">valid</span><span class="token punctuation">(</span><span class="token string">&#x27;./drive-carefully.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#x27;./drive-carefully.js&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ModuleNotFoundError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The available conditions vary depending on the module system and tool used.</p><h2><span id="Abbreviation"></span>Abbreviation<a href="#Abbreviation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>When only a single entry (<code>&quot;.&quot;</code>) into the package should be supported the <code>{ &quot;.&quot;: ... }</code> object nesting can be omitted:</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.mjs&quot;</span>
<span class="token punctuation">}</span></code></pre><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;red&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./stop.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;green&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./drive.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2><span id="Notes-about-ordering"></span>Notes about ordering<a href="#Notes-about-ordering" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>In an object where each key is a condition, order of properties is significant. Conditions are handled in the order they are specified.</p><p>Example: <code>{ &quot;red&quot;: &quot;./stop.js&quot;, &quot;green&quot;: &quot;./drive.js&quot; }</code> != <code>{ &quot;green&quot;: &quot;./drive.js&quot;, &quot;red&quot;: &quot;./stop.js&quot; }</code> (when both <code>red</code> and <code>green</code> conditions are set, first property will be used)</p><p>In an object where each key is a subpath, order of properties (subpaths) is not significant. More specific paths are preferred over less specific ones.</p><p>Example: <code>{ &quot;./a/&quot;: &quot;./x/&quot;, &quot;./a/b/&quot;: &quot;./y/&quot;, &quot;./a/b/c&quot;: &quot;./z&quot; }</code> == <code>{ &quot;./a/b/c&quot;: &quot;./z&quot;, &quot;./a/b/&quot;: &quot;./y/&quot;, &quot;./a/&quot;: &quot;./x/&quot; }</code> (order will always be: <code>./a/b/c</code> &gt; <code>./a/b/</code> &gt; <code>./a/</code>)</p><p><code>exports</code> field is preferred over other package entry fields like <code>main</code>, <code>module</code>, <code>browser</code> or custom ones.</p><h2><span id="Support"></span>Support<a href="#Support" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><table><thead><tr><th>Feature</th><th>Supported by</th></tr></thead><tbody><tr><td data-th="Feature"><span><code>&quot;.&quot;</code> property</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr</span></td></tr><tr><td data-th="Feature"><span>normal property</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr</span></td></tr><tr><td data-th="Feature"><span>property ending with <code>/</code></span></td><td data-th="Supported by"><span>Node.js<sup>(1)</sup>, webpack, rollup, esinstall<sup>(2)</sup>, wmr<sup>(3)</sup></span></td></tr><tr><td data-th="Feature"><span>property ending with <code>*</code></span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall</span></td></tr><tr><td data-th="Feature"><span>Alternatives</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, <strike>esinstall</strike><sup>(4)</sup></span></td></tr><tr><td data-th="Feature"><span>Abbreviation only path</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr</span></td></tr><tr><td data-th="Feature"><span>Abbreviation only conditions</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr</span></td></tr><tr><td data-th="Feature"><span>Conditional syntax</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr</span></td></tr><tr><td data-th="Feature"><span>Nested conditional syntax</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, wmr<sup>(5)</sup></span></td></tr><tr><td data-th="Feature"><span>Conditions Order</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, wmr<sup>(6)</sup></span></td></tr><tr><td data-th="Feature"><span><code>&quot;default&quot;</code> condition</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr</span></td></tr><tr><td data-th="Feature"><span>Path Order</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup</span></td></tr><tr><td data-th="Feature"><span>Error when not mapped</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall, wmr<sup>(7)</sup></span></td></tr><tr><td data-th="Feature"><span>Error when mixing conditions and paths</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup</span></td></tr></tbody></table><p>(1) deprecated in Node.js, <code>*</code> should be preferred.</p><p>(2) <code>&quot;./&quot;</code> is intentionally ignored as key.</p><p>(3) The property value is ignored and property key is used as target. Effectively only allowing mappings with key and value are identical.</p><p>(4) The syntax is supported, but always the first entry is used, which makes it unusable for any practical use case.</p><p>(5) Fallback to alternative sibling parent conditions is handling incorrectly.</p><p>(6) For the <code>require</code> condition object order is handled incorrectly. This is intentionally as wmr doesn&#x27;t differ between referencing syntax.</p><p>(7) When using <code>&quot;exports&quot;: &quot;./file.js&quot;</code> abbreviation, any request e. g. <code>package/not-existing</code> will resolve to that. When not using the abbreviation, direct file access e. g. <code>package/file.js</code> will not lead to an error.</p><h2><span id="Conditions"></span>Conditions<a href="#Conditions" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><h3><span id="Reference-syntax"></span>Reference syntax<a href="#Reference-syntax" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>One of these conditions is set depending on the syntax used to reference the module:</p><table><thead><tr><th>Condition</th><th>Description</th><th>Supported by</th></tr></thead><tbody><tr><td data-th="Condition"><span><code>import</code></span></td><td data-th="Description"><span>Request is issued from ESM syntax or similar.</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall<sup>(1)</sup>, wmr<sup>(1)</sup></span></td></tr><tr><td data-th="Condition"><span><code>require</code></span></td><td data-th="Description"><span>Request is issued from CommonJs/AMD syntax or similar.</span></td><td data-th="Supported by"><span>Node.js, webpack, rollup, esinstall<sup>(1)</sup>, wmr<sup>(1)</sup></span></td></tr><tr><td data-th="Condition"><span><code>style</code></span></td><td data-th="Description"><span>Request is issued from a stylesheet reference.</span></td><td></td></tr><tr><td data-th="Condition"><span><code>sass</code></span></td><td data-th="Description"><span>Request is issued from a sass stylesheet reference.</span></td><td></td></tr><tr><td data-th="Condition"><span><code>asset</code></span></td><td data-th="Description"><span>Request is issued from a asset reference.</span></td><td></td></tr><tr><td data-th="Condition"><span><code>script</code></span></td><td data-th="Description"><span>Request is issued from a normal script tag without module system.</span></td><td></td></tr></tbody></table><p>These conditions might also be set additionally:</p><table><thead><tr><th>Condition</th><th>Description</th><th>Supported by</th></tr></thead><tbody><tr><td data-th="Condition"><span><code>module</code></span></td><td data-th="Description"><span>All module syntax that allows to reference javascript supports ESM.<br/>(only combined with <code>import</code> or <code>require</code>)</span></td><td data-th="Supported by"><span>webpack, rollup, wmr</span></td></tr><tr><td data-th="Condition"><span><code>esmodules</code></span></td><td data-th="Description"><span>Always set by supported tools.</span></td><td data-th="Supported by"><span>wmr</span></td></tr><tr><td data-th="Condition"><span><code>types</code></span></td><td data-th="Description"><span>Request is issued from typescript that is interested in type declarations.</span></td><td></td></tr></tbody></table><p>(1) <code>import</code> and <code>require</code> are both set independent of referencing syntax. <code>require</code> has always lower priority.</p><h4><span id="import"></span>import<a href="#import" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>The following syntax will set the <code>import</code> condition:</p><ul><li>ESM <code>import</code> declarations in ESM</li><li>JS <code>import()</code> expression</li><li>HTML <code>&lt;script type=&quot;module&quot;&gt;</code> in HTML</li><li>HTML <code>&lt;link rel=&quot;preload/prefetch&quot;&gt;</code> in HTML</li><li>JS <code>new Worker(..., { type: &quot;module&quot; })</code></li><li>WASM <code>import</code> section</li><li>ESM HMR (webpack) <code>import.hot.accept/decline([...])</code></li><li>JS <code>Worklet.addModule</code></li><li>Using javascript as entrypoint</li></ul><h4><span id="require"></span>require<a href="#require" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>The following syntax will set the <code>require</code> condition:</p><ul><li>CommonJs <code>require(...)</code></li><li>AMD <code>define()</code></li><li>AMD <code>require([...])</code></li><li>CommonJs <code>require.resolve()</code></li><li>CommonJs (webpack) <code>require.ensure([...])</code></li><li>CommonJs (webpack) <code>require.context</code></li><li>CommonJs HMR (webpack) <code>module.hot.accept/decline([...])</code></li><li>HTML <code>&lt;script src=&quot;...&quot;&gt;</code></li></ul><h4><span id="style"></span>style<a href="#style" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>The following syntax will set the <code>style</code> condition:</p><ul><li>CSS <code>@import</code></li><li>HTML <code>&lt;link rel=&quot;stylesheet&quot;&gt;</code></li></ul><h4><span id="asset"></span>asset<a href="#asset" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>The following syntax will set the <code>asset</code> condition:</p><ul><li>CSS <code>url()</code></li><li>ESM <code>new URL(..., import.meta.url)</code></li><li>HTML <code>&lt;img src=&quot;...&quot;&gt;</code></li></ul><h4><span id="script"></span>script<a href="#script" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>The following syntax will set the <code>script</code> condition:</p><ul><li>HTML <code>&lt;script src=&quot;...&quot;&gt;</code></li></ul><p><code>script</code> should only be set when no module system is supported.
When the script is preprocessed by a system supporting CommonJs
it should set <code>require</code> instead.</p><p>This condition should be used when looking for a javascript file that can be injected
as script tag in a HTML page without additional preprocessing.</p><h3><span id="Optimizations"></span>Optimizations<a href="#Optimizations" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>The following conditions are set for various optimizations:</p><table><thead><tr><th>Condition</th><th>Description</th><th>Supported by</th></tr></thead><tbody><tr><td data-th="Condition"><span><code>production</code></span></td><td data-th="Description"><span>In a production environment.<br/>No devtooling should be included.</span></td><td data-th="Supported by"><span>webpack</span></td></tr><tr><td data-th="Condition"><span><code>development</code></span></td><td data-th="Description"><span>In a development environment.<br/>Devtooling should be included.</span></td><td data-th="Supported by"><span>webpack</span></td></tr></tbody></table><p>Note: Since <code>production</code> and <code>development</code> is not supported by everyone, no assumption should be made when none of these is set.</p><h3><span id="Target-environment"></span>Target environment<a href="#Target-environment" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>The following conditions are set depending on the target environment:</p><table><thead><tr><th>Condition</th><th>Description</th><th>Supported by</th></tr></thead><tbody><tr><td data-th="Condition"><span><code>browser</code></span></td><td data-th="Description"><span>Code will run in a browser.</span></td><td data-th="Supported by"><span>webpack, esinstall, wmr</span></td></tr><tr><td data-th="Condition"><span><code>electron</code></span></td><td data-th="Description"><span>Code will run in electron.<sup>(1)</sup></span></td><td data-th="Supported by"><span>webpack</span></td></tr><tr><td data-th="Condition"><span><code>worker</code></span></td><td data-th="Description"><span>Code will run in a (Web)Worker.<sup>(1)</sup></span></td><td data-th="Supported by"><span>webpack</span></td></tr><tr><td data-th="Condition"><span><code>worklet</code></span></td><td data-th="Description"><span>Code will run in a Worklet.<sup>(1)</sup></span></td><td data-th="Supported by"><span>-</span></td></tr><tr><td data-th="Condition"><span><code>node</code></span></td><td data-th="Description"><span>Code will run in Node.js.</span></td><td data-th="Supported by"><span>Node.js, webpack, wmr<sup>(2)</sup></span></td></tr><tr><td data-th="Condition"><span><code>deno</code></span></td><td data-th="Description"><span>Code will run in Deno.</span></td><td data-th="Supported by"><span>-</span></td></tr><tr><td data-th="Condition"><span><code>react-native</code></span></td><td data-th="Description"><span>Code will run in react-native.</span></td><td data-th="Supported by"><span>-</span></td></tr></tbody></table><p>(1) <code>electron</code>, <code>worker</code> and <code>worklet</code> comes combined with either <code>node</code> or <code>browser</code>, depending on the context.</p><p>(2) This is set for browser target environment.</p><p>Since there are multiple versions of each environment the following guidelines apply:</p><ul><li><code>node</code>: See <code>engines</code> field for compatibility.</li><li><code>browser</code>: Compatible with current Spec and stage 4 proposals at time of publishing the package. Polyfilling resp. transpiling must be handled on consumer side.<ul><li>Features that are not possible to polyfill or transpile should be used carefully as it limits the possible usage.</li></ul></li><li><code>deno</code>: TBD</li><li><code>react-native</code>: TBD</li></ul><h3><span id="Conditions-Preprocessor-and-runtimes"></span>Conditions: Preprocessor and runtimes<a href="#Conditions-Preprocessor-and-runtimes" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>The following conditions are set depending on which tool preprocesses the source code.</p><table><thead><tr><th>Condition</th><th>Description</th><th>Supported by</th></tr></thead><tbody><tr><td data-th="Condition"><span><code>webpack</code></span></td><td data-th="Description"><span>Processed by webpack.</span></td><td data-th="Supported by"><span>webpack</span></td></tr></tbody></table><p>Sadly there is no <code>node-js</code> condition for Node.js as runtime.
This would simplify creating exceptions for Node.js.</p><h3><span id="Conditions-Custom"></span>Conditions: Custom<a href="#Conditions-Custom" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>The following tools support custom conditions:</p><table><thead><tr><th>Tool</th><th>Supported</th><th>Notes</th></tr></thead><tbody><tr><td data-th="Tool"><span>Node.js</span></td><td data-th="Supported"><span>yes</span></td><td data-th="Notes"><span>Use <a href="https://nodejs.org/api/cli.html#cli_c_condition_conditions_condition"><code>--conditions</code></a> CLI argument.</span></td></tr><tr><td data-th="Tool"><span>webpack</span></td><td data-th="Supported"><span>yes</span></td><td data-th="Notes"><span>Use <a href="/configuration/resolve/#resolveconditionnames"><code>resolve.conditionNames</code></a> configuration option.</span></td></tr><tr><td data-th="Tool"><span>rollup</span></td><td data-th="Supported"><span>yes</span></td><td data-th="Notes"><span>Use <code>exportConditions</code> option for <code>@rollup/plugin-node-resolve</code></span></td></tr><tr><td data-th="Tool"><span>esinstall</span></td><td data-th="Supported"><span>no</span></td><td></td></tr><tr><td data-th="Tool"><span>wmr</span></td><td data-th="Supported"><span>no</span></td><td></td></tr></tbody></table><p>For custom conditions the following naming schema is recommended:</p><p><code>&lt;company-name&gt;:&lt;condition-name&gt;</code></p><p>Examples: <code>example-corp:beta</code>, <code>google:internal</code>.</p><h2><span id="Common-patterns"></span>Common patterns<a href="#Common-patterns" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>All patterns are explained with a single <code>&quot;.&quot;</code> entry into the package, but they can be extended from multiple entries too, by repeating the pattern for each entry.</p><p>These pattern should be used as guide not as strict ruleset.
They can be adapted to the individual packages.</p><p>These pattern are based on the following list of goals/assumptions:</p><ul><li>Packages are rotting.<ul><li>We assume at some point packages are no longer being maintained, but they are continued to be used.</li><li><code>exports</code> should be written to use fallbacks for unknown future cases. <code>default</code> condition can be used for that.</li><li>As the future is unknown we assume an environment similar to browsers and module system similar to ESM.</li></ul></li><li>Not all conditions are supported by every tool.<ul><li>Fallbacks should be used to handled these cases.</li><li>We assume the following fallback make sense in general:<ul><li>ESM &gt; CommonJs</li><li>Production &gt; Development</li><li>Browser &gt; node.js</li></ul></li></ul></li></ul><p>Depending on the package intention maybe something else makes sense and in this case the patterns should be adopted to that. Example: For a command line tool a browser-like future and fallback doesn&#x27;t make a lot of sense, and in this case node.js-like environments and fallbacks should be used instead.</p><p>For complex use cases multiple patterns need to be combined by nesting these conditions.</p><h3><span id="Target-environment-independent-packages"></span>Target environment independent packages<a href="#Target-environment-independent-packages" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>These patterns make sense for packages that do not use environment specific APIs.</p><h4><span id="Providing-only-an-ESM-version"></span>Providing only an ESM version<a href="#Providing-only-an-ESM-version" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
<span class="token punctuation">}</span></code></pre><p>Note: Providing only a ESM comes with restrictions for node.js.
Such a package would only work in Node.js &gt;= 14 and only when using <code>import</code>.
It won&#x27;t work with <code>require()</code>.</p><h4><span id="Providing-CommonJs-and-ESM-version-stateless"></span>Providing CommonJs and ESM version (stateless)<a href="#Providing-CommonJs-and-ESM-version-stateless" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.cjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Most tools get the ESM version.
Node.js is an exception here.
It gets a CommonJs version when using <code>require()</code>.
This will lead to two instances of these package when referencing it with <code>require()</code> and <code>import</code>, but that doesn&#x27;t hurt as the package doesn&#x27;t have state.</p><p>The <code>module</code> condition is used as optimization when preprocessing node-targeted code with a tool that supports ESM for <code>require()</code> (like a bundler, when bundling for Node.js).
For such a tool the exception is skipped.
This is technically optional, but bundlers would include the package source code twice otherwise.</p><p>You can also use the stateless pattern if you are able to isolate your package state in JSON files.
JSON is consumable from CommonJs and ESM without polluting the graph with the other module system.</p><p>Note that here stateless also means class instances are not tested with <code>instanceof</code> as there can be two different classes because of the double module instantiation.</p><h4><span id="Providing-CommonJs-and-ESM-version-stateful"></span>Providing CommonJs and ESM version (stateful)<a href="#Providing-CommonJs-and-ESM-version-stateful" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.cjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre><code class="hljs language-js"><span class="token comment">// wrapper.js</span>
<span class="token keyword">import</span> cjs <span class="token keyword">from</span> <span class="token string">&#x27;./index.cjs&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> cjs<span class="token punctuation">.</span><span class="token constant">A</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">B</span> <span class="token operator">=</span> cjs<span class="token punctuation">.</span><span class="token constant">B</span><span class="token punctuation">;</span></code></pre><p>In a stateful package we must ensure that the package is never instantiated twice.</p><p>This isn&#x27;t a problem for most tools, but Node.js is again an exception here.
For Node.js we always use the CommonJs version and expose named exports in the ESM with a ESM wrapper.</p><p>We use the <code>module</code> condition as optimization again.</p><h4><span id="Providing-only-a-CommonJs-version"></span>Providing only a CommonJs version<a href="#Providing-only-a-CommonJs-version" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
<span class="token punctuation">}</span></code></pre><p>Providing <code>&quot;type&quot;: &quot;commonjs&quot;</code> helps to statically detect CommonJs files.</p><h4><span id="Providing-a-bundled-script-version-for-direct-browser-consumption"></span>Providing a bundled script version for direct browser consumption<a href="#Providing-a-bundled-script-version-for-direct-browser-consumption" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist-bundle.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Note that despite using <code>&quot;type&quot;: &quot;module&quot;</code> and <code>.js</code> for <code>dist-bundle.js</code> this file is not in ESM format.
It should use globals to allow direct consumption as script tag.</p><h3><span id="Providing-devtools-or-production-optimizations"></span>Providing devtools or production optimizations<a href="#Providing-devtools-or-production-optimizations" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>These patterns make sense when a package contains two versions, one for development and one for production.
E. g. the development version could include additional code for better error message or additional warnings.</p><h4><span id="Without-Nodejs-runtime-detection"></span>Without Node.js runtime detection<a href="#Without-Nodejs-runtime-detection" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-with-devtools.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>When the <code>development</code> condition is supported we use the version enhanced for development.
Otherwise, in production or when mode is unknown, we use the optimized version.</p><h4><span id="With-Nodejs-runtime-detection"></span>With Node.js runtime detection<a href="#With-Nodejs-runtime-detection" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-with-devtools.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-process-env.cjs&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre><code class="hljs language-js"><span class="token comment">// wrapper-process-env.cjs</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#x27;development&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./index-optimized.cjs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./index-with-devtools.cjs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>We prefer static detection of production/development mode via the <code>production</code> or <code>development</code> condition.</p><p>Node.js allows to detection production/development mode at runtime via <code>process.env.NODE_ENV</code>, so we use that as fallback in Node.js. Sync conditional importing ESM is not possible and we don&#x27;t want to load the package twice, so we have to use CommonJs for the runtime detection.</p><p>When it&#x27;s not possible to detect mode we fallback to the production version.</p><h3><span id="Providing-different-versions-depending-on-target-environment"></span>Providing different versions depending on target environment<a href="#Providing-different-versions-depending-on-target-environment" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>A fallback environment should be chosen that makes sense for the package to support future environments.
In general a browser-like environment should be assumed.</p><h4><span id="Providing-Nodejs-WebWorker-and-browser-versions"></span>Providing Node.js, WebWorker and browser versions<a href="#Providing-Nodejs-WebWorker-and-browser-versions" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-node.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-worker.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h4><span id="Providing-Nodejs-browser-and-electron-versions"></span>Providing Node.js, browser and electron versions<a href="#Providing-Nodejs-browser-and-electron-versions" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;electron&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-node.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-node.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3><span id="Combining-patterns"></span>Combining patterns<a href="#Combining-patterns" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><h4><span id="Example-1"></span>Example 1<a href="#Example-1" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>This is an example for a package that has optimizations for production and development usage with runtime detection for <code>process.env</code> and also ships a CommonJs and ESM version</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-with-devtools.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-with-devtools.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-with-devtools.cjs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-optimized.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.cjs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-process-env.cjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-with-devtools.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h4><span id="Example-2"></span>Example 2<a href="#Example-2" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>This is an example for a package that supports Node.js, browser and electron, has optimizations for production and development usage with runtime detection for <code>process.env</code> and also ships a CommonJs and ESM version.</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;electron&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-node-with-devtools.js&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-electron-node-with-devtools.js&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-node-with-devtools.cjs&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-node-optimized.js&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-electron-node-optimized.js&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-node-optimized.cjs&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-electron-node-process-env.cjs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-with-devtools.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-optimized.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-electron-optimized.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-node-with-devtools.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-node-with-devtools.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-node-with-devtools.cjs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-node-optimized.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-node-optimized.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-node-optimized.cjs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper-node-process-env.cjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-with-devtools.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index-optimized.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Looks complex, yes. We were already able to reduce some complexity due to a assumption we can make: Only <code>node</code> need a CommonJs version and can detect production/development with <code>process.env</code>.</p><h2><span id="Guidelines"></span>Guidelines<a href="#Guidelines" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><ul><li>Avoid the <code>default</code> export. It&#x27;s handled differently between tooling. Only use named exports.</li><li>Never provide different APIs or semantics for different conditions.</li><li>Write your source code as ESM and transpile to CJS via babel, typescript or similar tools.</li><li>Either use <code>.cjs</code> or <code>type: &quot;commonjs&quot;</code> in package.json to clearly mark source code as CommonJs. This makes it statically detectable for tools if CommonJs or ESM is used. This is important for tools that only support ESM and no CommonJs.</li><li>ESM used in packages support the following types of requests:<ul><li>module requests are supported, pointing to other packages with a package.json.</li><li>relative requests are supported, pointing to other files within the package.<ul><li>They must not point to files outside of the package.</li></ul></li><li><code>data:</code> url requests are supported.</li><li>other absolute or server-relative requests are not supported by default, but they might be supported by some tools or environments.</li></ul></li></ul><h1><span id="entry-高级用法"></span>entry 高级用法<a href="#entry-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<h2><span id="multiple-file-types-per-entry"></span>每个入口使用多种文件类型<a href="#multiple-file-types-per-entry" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在不使用 <code>import</code> 样式文件的应用程序中（预单页应用程序或其他原因），使用一个值数组结构的 <a href="/configuration/entry-context/#entry">entry</a>，并且在其中传入不同类型的文件，可以实现将 CSS 和 JavaScript（和其他）文件分离在不同的 bundle。</p><p>举个例子。我们有一个具有两种页面类型的 PHP 应用程序：home(首页) 和 account(帐户)。home 与应用程序其余部分（account 页面）具有不同的布局和不可共享的 JavaScript。我们想要从应用程序文件中输出 home 页面的 <code>home.js</code> 和 <code>home.css</code>，为 account 页面输出 <code>account.js</code> 和 <code>account.css</code>。</p><p><strong>home.js</strong></p><pre><code class="hljs language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;home page type&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>home.scss</strong></p><pre><code class="hljs language-scss"><span class="token comment">// home page individual styles</span></code></pre><p><strong>account.js</strong></p><pre><code class="hljs language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;account page type&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>account.scss</strong></p><pre><code class="hljs language-scss"><span class="token comment">// account page individual styles</span></code></pre><p>我们将在 <code>production(生产)</code> 模式中使用 <a href="/plugins/mini-css-extract-plugin/"><code>MiniCssExtractPlugin</code></a> 作为 CSS 的一个最佳实践。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mini-css-extract-plugin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    home<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;./home.js&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;./home.scss&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    account<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;./account.js&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;./account.scss&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&#x27;[name].js&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// fallback to style-loader in development</span>
          process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#x27;production&#x27;</span>
            <span class="token operator">?</span> <span class="token string">&#x27;style-loader&#x27;</span>
            <span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token string">&#x27;css-loader&#x27;</span><span class="token punctuation">,</span>
          <span class="token string">&#x27;sass-loader&#x27;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&#x27;[name].css&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>由于我们未指定其他输出路径，因此使用以上配置运行 webpack 将输出到 <code>./dist</code>。<code>./dist</code> 目录下现在包含四个文件：</p><ul><li>home.js</li><li>home.css</li><li>account.js</li><li>account.css</li></ul><h1><span id="资源模块"></span>资源模块<a href="#%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。</p><p>在 webpack 5 之前，通常使用：</p><ul><li><a href="https://v4.webpack.js.org/loaders/raw-loader/"><code>raw-loader</code></a> 将文件导入为字符串</li><li><a href="https://v4.webpack.js.org/loaders/url-loader/"><code>url-loader</code></a> 将文件作为 data URI 内联到 bundle 中</li><li><a href="https://v4.webpack.js.org/loaders/file-loader/"><code>file-loader</code></a> 将文件发送到输出目录</li></ul><p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p><ul><li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。</li><li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。</li><li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。</li><li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 <code>url-loader</code>，并且配置资源体积限制实现。</li></ul><p>当在 webpack 5 中使用旧的 assets loader（如 <code>file-loader</code>/<code>url-loader</code>/<code>raw-loader</code> 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 <code>&#x27;javascript/auto&#x27;</code> 来解决。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">  rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.(png|jpg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">       use: [
</span><span class="token prefix unchanged"> </span><span class="token line">         {
</span><span class="token prefix unchanged"> </span><span class="token line">           loader: &#x27;url-loader&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">           options: {
</span><span class="token prefix unchanged"> </span><span class="token line">             limit: 8192,
</span><span class="token prefix unchanged"> </span><span class="token line">           }
</span><span class="token prefix unchanged"> </span><span class="token line">         },
</span><span class="token prefix unchanged"> </span><span class="token line">       ],
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;javascript/auto&#x27;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">  ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>}</code></pre><p>如需从 asset loader 中排除来自新 URL 处理的 asset，请添加 <code>dependency: { not: [&#x27;url&#x27;] }</code> 到 loader 配置中。</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.(png|jpg|gif)$/i,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       dependency: { not: [&#x27;url&#x27;] },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       use: [
</span><span class="token prefix unchanged"> </span><span class="token line">         {
</span><span class="token prefix unchanged"> </span><span class="token line">           loader: &#x27;url-loader&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">           options: {
</span><span class="token prefix unchanged"> </span><span class="token line">             limit: 8192,
</span><span class="token prefix unchanged"> </span><span class="token line">           },
</span><span class="token prefix unchanged"> </span><span class="token line">         },
</span><span class="token prefix unchanged"> </span><span class="token line">       ],
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>}</code></pre><h2><span id="resource-assets"></span>Resource 资源<a href="#resource-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;)
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> module: {
</span><span class="token prefix inserted">+</span><span class="token line">   rules: [
</span><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.png/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;asset/resource&#x27;
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span><span class="token prefix inserted">+</span><span class="token line">   ]
</span><span class="token prefix inserted">+</span><span class="token line"> },
</span></span>};</code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> mainImage <span class="token keyword">from</span> <span class="token string">&#x27;./images/main.png&#x27;</span><span class="token punctuation">;</span>

img<span class="token punctuation">.</span>src <span class="token operator">=</span> mainImage<span class="token punctuation">;</span> <span class="token comment">// &#x27;/dist/151cfcfa1bd74779aadb.png&#x27;</span></code></pre><p>所有 <code>.png</code> 文件都将被发送到输出目录，并且其路径将被注入到 bundle 中，除此之外，你可以为它们自定义 <a href="/configuration/module/#rulegeneratoroutputpath"><code>outputPath</code></a> 和 <a href="/configuration/module/#rulegeneratorpublichpath"><code>publicPath</code></a> 属性。</p><h3><span id="custom-output-filename"></span>自定义输出文件名<a href="#custom-output-filename" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>默认情况下，<code>asset/resource</code> 模块以 <code>[hash][ext][query]</code> 文件名发送到输出目录。</p><p>可以通过在 webpack 配置中设置 <a href="/configuration/output/#outputassetmodulefilename"><code>output.assetModuleFilename</code></a> 来修改此模板字符串：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   assetModuleFilename: &#x27;images/[hash][ext][query]&#x27;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.png/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: &#x27;asset/resource&#x27;
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};</code></pre><p>另一种自定义输出文件名的方式是，将某些资源发送到指定目录：</p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   assetModuleFilename: &#x27;images/[hash][ext][query]&#x27;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.png/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: &#x27;asset/resource&#x27;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.html/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;asset/resource&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">       generator: {
</span><span class="token prefix inserted">+</span><span class="token line">         filename: &#x27;static/[hash][ext][query]&#x27;
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};</code></pre><p>使用此配置，所有 <code>html</code> 文件都将被发送到输出目录中的 <code>static</code> 目录中。</p><p><code>Rule.generator.filename</code> 与 <a href="/configuration/output/#outputassetmodulefilename"><code>output.assetModuleFilename</code></a> 相同，并且仅适用于 <code>asset</code> 和 <code>asset/resource</code> 模块类型。</p><h2><span id="inlining-assets"></span>inline 资源(inlining asset)<a href="#inlining-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;),
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   assetModuleFilename: &#x27;images/[hash][ext][query]&#x27;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       test: /\.png/,
</span><span class="token prefix deleted">-</span><span class="token line">       type: &#x27;asset/resource&#x27;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\.svg/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;asset/inline&#x27;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     }
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     {
</span><span class="token prefix deleted">-</span><span class="token line">       test: /\.html/,
</span><span class="token prefix deleted">-</span><span class="token line">       type: &#x27;asset/resource&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">       generator: {
</span><span class="token prefix deleted">-</span><span class="token line">         filename: &#x27;static/[hash][ext][query]&#x27;
</span><span class="token prefix deleted">-</span><span class="token line">       }
</span><span class="token prefix deleted">-</span><span class="token line">     }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>};</code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import mainImage from &#x27;./images/main.png&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import metroMap from &#x27;./images/metro.svg&#x27;;
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> img.src = mainImage; // &#x27;/dist/151cfcfa1bd74779aadb.png&#x27;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> block.style.background = `url(${metroMap})`; // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)</span></span></code></pre><p>所有 <code>.svg</code> 文件都将作为 data URI 注入到 bundle 中。</p><h3><span id="custom-data-uri-generator"></span>自定义 data URI 生成器<a href="#custom-data-uri-generator" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>webpack 输出的 data URI，默认是呈现为使用 Base64 算法编码的文件内容。</p><p>如果要使用自定义编码算法，则可以指定一个自定义函数来编码文件内容：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const svgToMiniDataURI = require(&#x27;mini-svg-data-uri&#x27;);
</span></span>
module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;)
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.svg/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: &#x27;asset/inline&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       generator: {
</span><span class="token prefix inserted">+</span><span class="token line">         dataUrl: content =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">           content = content.toString();
</span><span class="token prefix inserted">+</span><span class="token line">           return svgToMiniDataURI(content);
</span><span class="token prefix inserted">+</span><span class="token line">         }
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};</code></pre><p>现在，所有 <code>.svg</code> 文件都将通过 <code>mini-svg-data-uri</code> 包进行编码。</p><h2><span id="source-assets"></span>source 资源(source asset)<a href="#source-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const svgToMiniDataURI = require(&#x27;mini-svg-data-uri&#x27;);
</span></span>
module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;)
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       test: /\.svg/,
</span><span class="token prefix deleted">-</span><span class="token line">       type: &#x27;asset/inline&#x27;,
</span><span class="token prefix deleted">-</span><span class="token line">       generator: {
</span><span class="token prefix deleted">-</span><span class="token line">         dataUrl: content =&gt; {
</span><span class="token prefix deleted">-</span><span class="token line">           content = content.toString();
</span><span class="token prefix deleted">-</span><span class="token line">           return svgToMiniDataURI(content);
</span><span class="token prefix deleted">-</span><span class="token line">         }
</span><span class="token prefix deleted">-</span><span class="token line">       }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\.txt/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;asset/source&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};</code></pre><p><strong>src/example.txt</strong></p><pre><code class="hljs language-text">Hello world
</code></pre><p><strong>src/index.js</strong></p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import metroMap from &#x27;./images/metro.svg&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import exampleText from &#x27;./example.txt&#x27;;
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> block.style.background = `url(${metroMap}); // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> block.textContent = exampleText; // &#x27;Hello world&#x27;</span></span></code></pre><p>所有 <code>.txt</code> 文件将原样注入到 bundle 中。</p><h2><span id="url-assets"></span>URL 资源<a href="#url-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>当使用 <code>new URL(&#x27;./path/to/asset&#x27;, import.meta.url)</code>，webpack 也会创建资源模块。</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> logo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&#x27;./logo.svg&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>根据你配置中 <a href="/configuration/target/"><code>target</code></a> 的不同，webpack 会将上述代码编译成不同结果：</p><pre><code class="hljs language-js"><span class="token comment">// target: web</span>
<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>
  __webpack_public_path__ <span class="token operator">+</span> <span class="token string">&#x27;logo.svg&#x27;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>baseURI <span class="token operator">||</span> self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// target: webworker</span>
<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>__webpack_public_path__ <span class="token operator">+</span> <span class="token string">&#x27;logo.svg&#x27;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// target: node, node-webkit, nwjs, electron-main, electron-renderer, electron-preload, async-node</span>
<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>
  __webpack_public_path__ <span class="token operator">+</span> <span class="token string">&#x27;logo.svg&#x27;</span><span class="token punctuation">,</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;url&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathToFileUrl</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>自 webpack 5.38.0 起，<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">Data URLs</a> 也支持在 <code>new URL()</code> 中使用了：</p><p><strong>src/index.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&#x27;data:,&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>href <span class="token operator">===</span> <span class="token string">&#x27;data:,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">&#x27;data:&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname <span class="token operator">===</span> <span class="token string">&#x27;,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2><span id="general-asset-type"></span>通用资源类型<a href="#general-asset-type" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;)
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\.txt/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;asset&#x27;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};</code></pre><p>现在，webpack 将按照默认条件，自动地在 <code>resource</code> 和 <code>inline</code> 之间进行选择：小于 8kb 的文件，将会视为 <code>inline</code> 模块类型，否则会被视为 <code>resource</code> 模块类型。</p><p>可以通过在 webpack 配置的 module rule 层级中，设置 <a href="/configuration/module/#ruleparserdataurlcondition"><code>Rule.parser.dataUrlCondition.maxSize</code></a> 选项来修改此条件：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-diff">const path = require(&#x27;path&#x27;);

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: &#x27;./src/index.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: &#x27;main.js&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, &#x27;dist&#x27;)
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.txt/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: &#x27;asset&#x27;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       parser: {
</span><span class="token prefix inserted">+</span><span class="token line">         dataUrlCondition: {
</span><span class="token prefix inserted">+</span><span class="token line">           maxSize: 4 * 1024 // 4kb
</span><span class="token prefix inserted">+</span><span class="token line">         }
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};</code></pre><p>还可以 <a href="/configuration/module/#ruleparserdataurlcondition">指定一个函数</a> 来决定是否 inline 模块。</p><h2><span id="replacing-inline-loader-syntax"></span>变更内联 loader 的语法<a href="#replacing-inline-loader-syntax" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在 asset 模块和 webpack 5 之前，可以使用<a href="/concepts/loaders/#inline">内联语法</a>与上述传统的 loader 结合使用。</p><p>现在建议去掉所有的内联 loader 的语法，使用资源查询条件来模仿内联语法的功能。</p><p>示例，将 <code>raw-loader</code> 替换为 <code>asset/source</code> 类型：</p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import myModule from &#x27;raw-loader!my-module&#x27;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import myModule from &#x27;my-module?raw&#x27;;</span></span></code></pre><p>webpack 相关配置：</p><pre><code class="hljs language-diff">module: {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">   // ...
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       resourceQuery: /raw/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: &#x27;asset/source&#x27;,
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },</span></span></code></pre><p>如果你想把原始资源排除在其他 loader 的处理范围以外，请使用使用取反的正则：</p><pre><code class="hljs language-diff">module: {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">   // ...
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.m?js$/,
</span><span class="token prefix inserted">+</span><span class="token line">       resourceQuery: { not: [/raw/] },
</span><span class="token prefix inserted">+</span><span class="token line">       use: [ ... ]
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       resourceQuery: /raw/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: &#x27;asset/source&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },</span></span></code></pre><p>或者使用 <code>oneOf</code> 的规则列表。此处只应用第一个匹配规则：</p><pre><code class="hljs language-diff">module: {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">   // ...
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     { oneOf: [
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       {
</span><span class="token prefix unchanged"> </span><span class="token line">         resourceQuery: /raw/,
</span><span class="token prefix unchanged"> </span><span class="token line">         type: &#x27;asset/source&#x27;,
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       {
</span><span class="token prefix inserted">+</span><span class="token line">         test: /\.m?js$/,
</span><span class="token prefix inserted">+</span><span class="token line">         use: [ ... ]
</span><span class="token prefix inserted">+</span><span class="token line">       },
</span><span class="token prefix inserted">+</span><span class="token line">     ] }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },</span></span></code></pre><h2><span id="Disable-emitting-assets"></span>Disable emitting assets<a href="#Disable-emitting-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>For use cases like Server side rendering, you might want to disable emitting assets, which is feasible with <a href="/configuration/module/#rulegeneratoremit"><code>emit</code></a> option under <code>Rule.generator</code>:</p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.png$/i</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&#x27;asset/resource&#x27;</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          emit<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><div class="print:hidden mt-20"><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline" href="https://github.com/docschina/webpack.js.org/edit/cn/src/content/guides/printable.mdx">编辑此页</a><span class="mx-5 text-black font-bold dark:text-white">·</span><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline">打印文档</a></div><div data-testid="contributors" class="print:hidden"><h2 class="!font-sans !font-normal">1<!-- --> <!-- -->位贡献者</h2><div><div class="grid gap-[10px] lg:gap-[15px] grid-cols-contributors"><a href="https://github.com/webpack"><img width="45" height="45" alt="webpack" title="webpack" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a></div></div></div></div></section></div><footer class="footer"><div class="container footer__inner"><section class="footer__left"><a class="footer__link" href="/guides/getting-started/">快速开始</a><a class="footer__link" href="/comparison/">对比</a><a href="https://privacy-policy.openjsf.org/" target="_blank" rel="noopener noreferrer" class="footer__link">Privacy Policy</a></section><section class="footer__middle"><a class="footer__icon" href="/"><img src="/icon-square-small.85ba630cf0c5f29ae3e3.svg" alt="webpack icon" width="35" height="35"/></a></section><section class="footer__right"><a href="https://webpack.threadless.com/" target="_blank" rel="noopener noreferrer" class="footer__link">周边</a><a class="footer__link" href="/awesome-webpack/">Awesome webpack</a><a class="footer__link" href="/glossary/">术语</a><a class="footer__link" href="/branding/">品牌</a><a href="https://gitter.im/webpack/webpack" target="_blank" rel="noopener noreferrer" class="footer__link">Gitter</a><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener noreferrer" class="footer__link">更新日志</a><a class="footer__link footer__license" href="/license"><img alt="Creative Commons License" src="/cc.ab77d813bf219c6e34ff.svg" width="25" height="25"/><img alt="Creative Commons License" src="/by.1360bb2e6d1fc28cdd9e.svg" width="25" height="25"/></a></section></div></footer></div></div><script>
window.matchMedia('print').addListener(function(mql) {
  if (!mql.matches) {
      window.close();
  }
});
window.print();
</script><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f92e0e48311f635665d2de225751a349";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script></body>