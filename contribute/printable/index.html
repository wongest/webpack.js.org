<!DOCTYPE html><html lang="zh-cmn-Hans"><head><title data-rh="true">Combined printable page | webpack 中文文档</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="theme-color" content="#2B3A42"/><meta data-rh="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-rh="true" name="robots" content="noindex,nofollow"/><meta data-rh="true" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:site_name" content="webpack"/><meta data-rh="true" property="og:type" content="website"/><meta data-rh="true" property="og:title" content="Combined printable page | webpack 中文文档"/><meta data-rh="true" property="og:description" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:image" content="https://webpack.js.org/icon-pwa-512x512.d3dae4189855b3a72ff9.png"/><meta data-rh="true" property="twitter:card" content="summary"/><meta data-rh="true" property="twitter:site" content="@webpack"/><meta data-rh="true" property="twitter:creator" content="@webpack"/><meta data-rh="true" property="twitter:domain" content="https://webpack.js.org/"/><meta data-rh="true" name="keywords" content="webpack5, webpack, webpack 中文文档, webpack 官方中文, webpack 5 官方中文, 印记中文, docschina, docschina.org, webpack.docschina.org, doc.react-china.org, nodejs.cn, vue.docschina.org, babel.docschina.org, parceljs.docschina.org, rollup.docschina.org, koajs.docschina.org"/><meta data-rh="true" name="mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-status-bar-style" content="black"/><meta data-rh="true" name="apple-mobile-web-app-title" content="webpack"/><meta data-rh="true" name="msapplication-TileImage" content="/icon_150x150.png"/><meta data-rh="true" name="msapplication-TileColor" content="#465e69"/><link data-rh="true" rel="icon" type="image/x-icon" href="/favicon.f326220248556af65f41.ico"/><link data-rh="true" rel="manifest" href="/manifest.json"/><link data-rh="true" rel="canonical" href="https://webpack.docschina.org/contribute/printable/"/><link data-rh="true" rel="icon" sizes="192x192" href="/icon_192x192.png"/><link data-rh="true" rel="icon" sizes="512x512" href="/icon_512x512.png"/><link data-rh="true" rel="apple-touch-icon" href="/icon_180x180.png"/><link data-rh="true" rel="mask-icon" href="/logo-on-white-bg.47eff95f9c01c5972f6f.svg" color="#465e69"/><link rel="stylesheet" href=/index.c114afea0778b47a418a.css /><link rel="stylesheet" href=/9517.acfe42251eae743e4e22.css /></head><body><div id="root"><div class="site"><div class="site__header"><header class="bg-blue-800 dark:bg-gray-900"><div class="flex items-center py-10 px-[16px] justify-between md:px-[24px] md:max-w-[1024px] md:mx-auto md:justify-start"><button class="bg-transparent border-none md:hidden"><svg viewBox="-62 138 25 25" width="20" height="20" class="fill-current text-white"><path fill="currentColor" d="M-60.2 140.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8M-60.2 148.7h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8M-60.2 157.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8"></path></svg></button><a class="md:mr-auto" href="/"><img class="logo" src="/site-logo.1fcab817090e78435061.svg" alt="webpack logo" width="122" height="35"/></a><nav class="hidden md:inline-grid md:grid-flow-col md:gap-x-[18px]"><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/concepts/">中文文档</a><a aria-current="page" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200 !text-blue-200" href="/contribute/">参与贡献</a><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/blog/">博客</a><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200">印记中文</a><a href="https://github.com/webpack/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on GitHub"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 6.8 9.5c.5 0 .7-.2.7-.5v-1.7C6.7 20 6.1 18 6.1 18c-.4-1.2-1-1.5-1-1.5-1-.6 0-.6 0-.6 1 0 1.5 1 1.5 1 .9 1.6 2.4 1.1 3 .9 0-.7.3-1.1.6-1.4-2.2-.2-4.6-1-4.6-4.9 0-1.1.4-2 1-2.7 0-.3-.4-1.3.2-2.7 0 0 .8-.2 2.7 1a9.4 9.4 0 0 1 5 0c2-1.2 2.8-1 2.8-1 .5 1.4.1 2.4 0 2.7.7.7 1 1.6 1 2.7 0 3.8-2.3 4.7-4.5 5 .4.2.7.8.7 1.8V21c0 .3.2.6.7.5 4-1.3 6.8-5 6.8-9.5A10 10 0 0 0 12 2"></path></svg></a><a href="https://twitter.com/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" aria-hidden="true" fill="currentColor" width="16"><path d="M28 6.937c-.957.425-1.985.711-3.064.84a5.343 5.343 0 0 0 2.345-2.951 10.696 10.696 0 0 1-3.388 1.295 5.334 5.334 0 0 0-9.089 4.864A15.143 15.143 0 0 1 3.809 5.411a5.321 5.321 0 0 0-.721 2.683 5.33 5.33 0 0 0 2.372 4.439 5.323 5.323 0 0 1-2.416-.667v.067a5.335 5.335 0 0 0 4.279 5.23 5.336 5.336 0 0 1-2.409.092 5.34 5.34 0 0 0 4.983 3.705 10.699 10.699 0 0 1-6.625 2.284c-.43 0-.855-.025-1.273-.075a15.102 15.102 0 0 0 8.177 2.396c9.812 0 15.176-8.128 15.176-15.177 0-.231-.005-.461-.015-.69A10.855 10.855 0 0 0 28 6.937z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on StackOverflow"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M17.4 20.2v-5.4h1.8V22H3v-7.2h1.8v5.4zM6.8 14.3l.3-1.7 8.8 1.8-.3 1.8zm1.1-4.2.8-1.6 8.1 3.8-.7 1.6zm2.3-4 1.1-1.4 7 5.8-1.2 1.4L10 6m4.7-4L20 9l-1.4 1-5.4-7 1.4-1m-8 16.5v-1.8h9v1.8z"></path></svg></a><nav class="dropdown "><button aria-haspopup="true" aria-expanded="false" aria-label="Select language"><svg viewBox="0 0 610 560" xmlns="http://www.w3.org/2000/svg" class="dropdown__language text-gray-100 hover:text-blue-200 transition-colors duration-200"><path d="m304.8 99.2-162.5-57.3v353.6l162.5-52.6z"></path><path d="m300.9 99 168.7-57.3v353.6l-168.7-52.5zm-200.7 358.4 200.7-66.9v-291.5l-200.7 66.9z" fill="currentColor"></path><path d="m392.4 461.8 28.4 46.8 15-43.5zm-223.9-262.3c-1.1-1 1.4 8.6 4.8 12 6.1 6.1 10.8 6.9 13.3 7 5.6.2 12.5-1.4 16.5-3.1s10.9-5.2 13.5-10.4c.6-1.1 2.1-3 1.1-7.5-.7-3.5-3-4.8-5.7-4.6s-11 2.4-15 3.6-12.2 3.7-15.8 4.5-11.5-.3-12.7-1.5zm101.2 114.8c-1.6-.6-34.3-14.1-38.9-16.4a368 368 0 0 0 -17.5-7.5c12.3-19 20.1-33.4 21.2-35.6 1.9-4 15-29.5 15.3-31.1s.7-7.5.4-8.9-5.1 1.3-11.6 3.5-18.9 10.2-23.7 11.2-20.1 6.8-28 9.4c-7.8 2.6-22.7 7.1-28.8 8.8-6.1 1.6-11.4 1.8-14.9 2.8 0 0 .5 4.8 1.4 6.2s4.1 5 7.9 5.9c3.8 1 10 .6 12.8-.1s7.7-3.1 8.4-4.1c.7-1.1-.3-4.3.8-5.3s16.1-4.5 21.7-6.2 27.2-9.2 30.1-8.8a916 916 0 0 1 -23.9 47.7 821 821 0 0 1 -45 63.3c-5.3 6-18 21.5-22.4 25 1.1.3 9-.4 10.4-1.3 8.9-5.5 23.8-24.1 28.6-29.7a489.1 489.1 0 0 0 36.7-49.4c1.9.8 17.6 13.6 21.7 16.4a293 293 0 0 0 23.7 13.3c3.5 1.5 16.9 7.7 17.5 5.6.7-1.8-2.3-14.1-3.9-14.7z"></path><path clip-rule="evenodd" d="m194.1 484.7a204.9 204.9 0 0 0 30.7 14.5 233.6 233.6 0 0 0 46.4 12c.5 0 16 1.9 19.2 1.9h15.7c6.1-.5 11.8-.9 17.9-1.7 4.9-.7 10.3-1.6 15.5-2.8 3.8-.9 7.8-1.7 11.7-3 3.7-1 7.8-2.4 11.8-3.8l8.2-3.1c2.3-1 5.1-2.3 7.7-3.3a243 243 0 0 0 19.2-10c2.3-1.2 7.5-5.2 10.3-5.2 3.1 0 5.2 2.8 5.2 5.2 0 5.1-6.8 6.6-9.9 8.9-3.3 2.3-7.3 4-10.8 5.9-7 3.7-14.1 6.8-20.9 9.4a251 251 0 0 1 -27.3 8.5c-3.3.7-6.6 1.6-9.9 2.1-1.7.3-19.9 3.1-24.9 3.1h-23a293.9 293.9 0 0 1 -35.1-5.2 196 196 0 0 1 -33.1-10.3c-12-4.5-24.6-10.5-36.4-18.3-2.1-1.4-2.3-2.8-2.3-4.4a5 5 0 0 1 5.1-5.1c2.4.1 8 4.2 9 4.7zm101.4-98.1-189.9 63.2v-280.1l189.9-63.2zm10.6-288.3v292.7a6 6 0 0 1 -1.2 2.6c-.3.5-1 1.2-1.6 1.4a14621 14621 0 0 1 -203.1 67.6c-2.1 0-4-1.4-5.1-3.7 0-.2-.2-.3-.2-.7v-292.8c.3-.9.5-2.1 1.2-2.8 1.4-1.9 3.8-2.3 5.4-2.8 3-1 196.1-65.8 198.9-65.8 1.9 0 5.7 1.2 5.7 4.3z" fill-rule="evenodd"></path><path clip-rule="evenodd" d="m464.3 388-158-49.1v-236l158-53.7zm10.6-345.8v352.4c-.2 4-3 5.7-5.6 5.7-2.3 0-18.6-5.6-21.4-6.4l-65.8-20.4-14.6-4.7-12.9-4c-18.6-5.7-37.6-11.5-56.3-17.8-.7-.2-2.4-2.6-2.4-3.1v-246.1c.3-.9.7-1.9 1.6-2.6 1.4-1.6 61.1-21.4 84.7-29.3 6.3-2.3 84.8-29.3 87.3-29.3 3 .1 5.4 2.3 5.4 5.6z" fill-rule="evenodd"></path><path d="m515 461.8-211.1-67.3.9-292.8 210.2 66.9z"></path><path clip-rule="evenodd" d="m408.6 232.5-20.7 50.1 38.1 11.5zm-12.4-47.2 27.2 8.2 49.5 178.6-27.9-8.5-10-36.7-57.7-17.5-12.4 29.9-27.9-8.5z" fill="currentColor" fill-rule="evenodd"></path></svg><i aria-hidden="true" class="dropdown__arrow"></i></button><div class="dropdown__list "><ul><li><a href="https://webpack.js.org/contribute/printable/" class="px-5 block"><span>English</span></a></li><li><a href="https://webpack.docschina.org/contribute/printable/" class="px-5 block"><span lang="zh">中文</span></a></li><li><a href="https://webpack.kr/contribute/printable/" class="px-5 block"><span lang="ko">한국어</span></a></li></ul></div></nav></nav><div class="inline-flex items-center ml-[18px]"><button aria-label="Switch to dark theme" class="bg-transparent border-none cursor-pointer text-[16px] p-0 inline-flex items-center text-gray-100 hover:text-blue-200 transition-colors duration-200" data-testid="hello-darkness"><svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18.1406C11.6016 18.1406 11.2782 18.464 11.2782 18.8624V21.0281C11.2782 21.4265 11.6016 21.7499 12 21.7499C12.3985 21.7499 12.7219 21.4265 12.7219 21.0281V18.8624C12.7219 18.464 12.3985 18.1406 12 18.1406V18.1406Z" fill="currentColor"></path><path d="M12 2.25006C11.6016 2.25006 11.2782 2.5735 11.2782 2.97194V5.13756C11.2782 5.536 11.6016 5.85944 12 5.85944C12.3985 5.85944 12.7219 5.536 12.7219 5.13756V2.97194C12.7219 2.5735 12.3985 2.25006 12 2.25006V2.25006Z" fill="currentColor"></path><path d="M5.85936 12C5.85936 11.6015 5.53592 11.2781 5.13749 11.2781H2.97186C2.57342 11.2781 2.24999 11.6015 2.24999 12C2.24999 12.3984 2.57342 12.7218 2.97186 12.7218H5.13749C5.53592 12.7218 5.85936 12.3984 5.85936 12V12Z" fill="currentColor"></path><path d="M21.0281 11.2781H18.8625C18.4641 11.2781 18.1406 11.6015 18.1406 12C18.1406 12.3984 18.4641 12.7218 18.8625 12.7218H21.0281C21.4266 12.7218 21.75 12.3984 21.75 12C21.75 11.6015 21.4266 11.2781 21.0281 11.2781V11.2781Z" fill="currentColor"></path><path d="M7.14841 16.1298C6.95622 16.1298 6.77341 16.2048 6.63747 16.3407L5.10466 17.8735C4.96872 18.0094 4.89372 18.1923 4.89372 18.3844C4.89372 18.5766 4.96872 18.7594 5.10466 18.8954C5.2406 19.0313 5.42341 19.1063 5.6156 19.1063C5.80779 19.1063 5.9906 19.0313 6.12654 18.8954L7.65935 17.3626C7.9406 17.0813 7.9406 16.6219 7.65935 16.3407C7.52341 16.2048 7.3406 16.1298 7.14841 16.1298V16.1298Z" fill="currentColor"></path><path d="M16.8516 7.87036C17.0437 7.87036 17.2266 7.79536 17.3625 7.65942L18.8953 6.12661C19.0312 5.99067 19.1062 5.80786 19.1062 5.61567C19.1062 5.42349 19.0312 5.24067 18.8953 5.10474C18.7594 4.9688 18.5766 4.8938 18.3844 4.8938C18.1922 4.8938 18.0094 4.9688 17.8734 5.10474L16.3406 6.63755C16.2047 6.77349 16.1297 6.9563 16.1297 7.14849C16.1297 7.34067 16.2047 7.52349 16.3406 7.65942C16.4766 7.79536 16.6594 7.87036 16.8516 7.87036V7.87036Z" fill="currentColor"></path><path d="M6.12654 5.10474C5.9906 4.9688 5.80779 4.8938 5.6156 4.8938C5.42341 4.8938 5.2406 4.9688 5.10466 5.10474C4.96872 5.24067 4.89372 5.42349 4.89372 5.61567C4.89372 5.80786 4.96872 5.99067 5.10466 6.12661L6.63747 7.65942C6.77341 7.79536 6.95622 7.87036 7.14841 7.87036C7.3406 7.87036 7.52341 7.79536 7.65935 7.65942C7.79529 7.52349 7.87029 7.34067 7.87029 7.14849C7.87029 6.9563 7.79529 6.77349 7.65935 6.63755L6.12654 5.10474V5.10474Z" fill="currentColor"></path><path d="M17.3625 16.3407C17.2266 16.2048 17.0437 16.1298 16.8516 16.1298C16.6594 16.1298 16.4766 16.2048 16.3406 16.3407C16.0594 16.6219 16.0594 17.0813 16.3406 17.3626L17.8734 18.8954C18.0094 19.0313 18.1922 19.1063 18.3844 19.1063C18.5766 19.1063 18.7594 19.0313 18.8953 18.8954C19.0312 18.7594 19.1062 18.5766 19.1062 18.3844C19.1062 18.1923 19.0312 18.0094 18.8953 17.8735L17.3625 16.3407V16.3407Z" fill="currentColor"></path><path d="M12 7.5C9.52031 7.5 7.5 9.52031 7.5 12C7.5 14.4797 9.52031 16.5 12 16.5C14.4797 16.5 16.5 14.4797 16.5 12C16.5 9.52031 14.4797 7.5 12 7.5Z" fill="currentColor"></path></svg></button><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></header></div><div class="container site__content"><div class="sponsors"><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="sponsors__content"><img class="sponsors__img__docschina" src="/docschina-logo.59f03f74b3c450856c01.png"/><div class="sponsors__content-cont">翻译/文档内容有任何问题，请联系我们</div></a></div><nav class="sidebar site__sidebar"><div class="sidebar__inner"><div class="relative z-0 bg-white dark:bg-gray-100 "><select class="text-gray-600 text-14 px-5 py-5 appearance-none box-border border border-gray-200 border-solid flex-col flex w-full rounded-none bg-transparent bg-none"><option selected="" value="5">Webpack 5</option><option value="4">Webpack 4</option></select><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="absolute right-5 top-5 fill-current text-gray-300 z-[-1]" width="20" height="20"><path d="M4.5 7.5c.5-.4 1-.4 1.6 0l3.9 3.8 4-3.8c.4-.4 1-.4 1.5 0 .4.5.4 1.2 0 1.7l-4.7 4.5a1 1 0 0 1-1.6 0L4.5 9.2c-.4-.5-.4-1.2 0-1.7z"></path></svg></div><div class="sidebar-item sidebar-item--disabled`"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title sidebar-link__print" href="/contribute/printable/" rel="nofollow noopener noreferrer" alt="Print" title="Print" target="_blank">Print Section<img src="/icon-print.d4d2cfa27f8b9a98e34a.svg" width="27" height="20" alt="Printer Icon"/></a></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/">参与贡献</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="开发人员 "><a aria-current="page" class="active" href="/contribute/#developers">开发人员 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="我如何帮助 webpack？ "><a aria-current="page" class="active" href="/contribute/#how-can-i-help">我如何帮助 webpack？ </a></li><li class="sidebar-item__anchor" title="要求雇主使用 webpack "><a aria-current="page" class="active" href="/contribute/#encouraging-employers">要求雇主使用 webpack </a></li><li class="sidebar-item__anchor" title="贡献代码 "><a aria-current="page" class="active" href="/contribute/#your-contributions">贡献代码 </a></li></ul></li><li class="sidebar-item__anchor" title="管理人员 "><a aria-current="page" class="active" href="/contribute/#executives">管理人员 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="赞助 "><a aria-current="page" class="active" href="/contribute/#sponsorship">赞助 </a></li><li class="sidebar-item__anchor" title="其他人群 "><a aria-current="page" class="active" href="/contribute/#anyone-else">其他人群 </a></li></ul></li><li class="sidebar-item__anchor" title="拉取请求(pull requests) "><a aria-current="page" class="active" href="/contribute/#pull-requests">拉取请求(pull requests) </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/writers-guide/">作者指引</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="步骤 "><a class="" href="/contribute/writers-guide/#process">步骤 </a></li><li class="sidebar-item__anchor" title="YAML 文件顶部信息 "><a class="" href="/contribute/writers-guide/#yaml-frontmatter">YAML 文件顶部信息 </a></li><li class="sidebar-item__anchor" title="文章结构 "><a class="" href="/contribute/writers-guide/#article-structure">文章结构 </a></li><li class="sidebar-item__anchor" title="排版 "><a class="" href="/contribute/writers-guide/#typesetting">排版 </a></li><li class="sidebar-item__anchor" title="格式化 "><a class="" href="/contribute/writers-guide/#formatting">格式化 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="代码 "><a class="" href="/contribute/writers-guide/#code">代码 </a></li><li class="sidebar-item__anchor" title="列表 "><a class="" href="/contribute/writers-guide/#lists">列表 </a></li><li class="sidebar-item__anchor" title="表格 "><a class="" href="/contribute/writers-guide/#tables">表格 </a></li><li class="sidebar-item__anchor" title="配置属性 "><a class="" href="/contribute/writers-guide/#configuration-properties">配置属性 </a></li><li class="sidebar-item__anchor" title="引用 "><a class="" href="/contribute/writers-guide/#quotes">引用 </a></li><li class="sidebar-item__anchor" title="假设与详略 "><a class="" href="/contribute/writers-guide/#assumptions-and-simplicity">假设与详略 </a></li><li class="sidebar-item__anchor" title="配置的默认值和类型 "><a class="" href="/contribute/writers-guide/#configuration-defaults-and-types">配置的默认值和类型 </a></li><li class="sidebar-item__anchor" title="选项 shortlist 及其类型 "><a class="" href="/contribute/writers-guide/#options-shortlists-and-their-typing">选项 shortlist 及其类型 </a></li><li class="sidebar-item__anchor" title="添加链接 "><a class="" href="/contribute/writers-guide/#adding-links">添加链接 </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/writing-a-loader/">编写 loader</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="设置 "><a class="" href="/contribute/writing-a-loader/#setup">设置 </a></li><li class="sidebar-item__anchor" title="简单用法 "><a class="" href="/contribute/writing-a-loader/#simple-usage">简单用法 </a></li><li class="sidebar-item__anchor" title="复杂用法 "><a class="" href="/contribute/writing-a-loader/#complex-usage">复杂用法 </a></li><li class="sidebar-item__anchor" title="用法准则(Guidelines) "><a class="" href="/contribute/writing-a-loader/#guidelines">用法准则(Guidelines) </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="简单(simple) "><a class="" href="/contribute/writing-a-loader/#simple">简单(simple) </a></li><li class="sidebar-item__anchor" title="链式(chaining) "><a class="" href="/contribute/writing-a-loader/#chaining">链式(chaining) </a></li><li class="sidebar-item__anchor" title="模块化(modular) "><a class="" href="/contribute/writing-a-loader/#modular">模块化(modular) </a></li><li class="sidebar-item__anchor" title="无状态(stateless) "><a class="" href="/contribute/writing-a-loader/#stateless">无状态(stateless) </a></li><li class="sidebar-item__anchor" title="loader 工具库(Loader Utilities) "><a class="" href="/contribute/writing-a-loader/#loader-utilities">loader 工具库(Loader Utilities) </a></li><li class="sidebar-item__anchor" title="loader 依赖(loader dependencies) "><a class="" href="/contribute/writing-a-loader/#loader-dependencies">loader 依赖(loader dependencies) </a></li><li class="sidebar-item__anchor" title="模块依赖(module dependencies) "><a class="" href="/contribute/writing-a-loader/#module-dependencies">模块依赖(module dependencies) </a></li><li class="sidebar-item__anchor" title="通用代码(common code) "><a class="" href="/contribute/writing-a-loader/#common-code">通用代码(common code) </a></li><li class="sidebar-item__anchor" title="绝对路径(absolute paths) "><a class="" href="/contribute/writing-a-loader/#absolute-paths">绝对路径(absolute paths) </a></li><li class="sidebar-item__anchor" title="同等依赖(peer dependencies) "><a class="" href="/contribute/writing-a-loader/#peer-dependencies">同等依赖(peer dependencies) </a></li></ul></li><li class="sidebar-item__anchor" title="测试 "><a class="" href="/contribute/writing-a-loader/#testing">测试 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/writing-a-plugin/">自定义插件</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="创建插件 "><a class="" href="/contribute/writing-a-plugin/#creating-a-plugin">创建插件 </a></li><li class="sidebar-item__anchor" title="基本插件架构 "><a class="" href="/contribute/writing-a-plugin/#basic-plugin-architecture">基本插件架构 </a></li><li class="sidebar-item__anchor" title="Compiler 和 Compilation "><a class="" href="/contribute/writing-a-plugin/#compiler-and-compilation">Compiler 和 Compilation </a></li><li class="sidebar-item__anchor" title="异步编译插件 "><a class="" href="/contribute/writing-a-plugin/#async-event-hooks">异步编译插件 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="tapAsync "><a class="" href="/contribute/writing-a-plugin/#tapasync">tapAsync </a></li></ul></li><li class="sidebar-item__anchor" title="示例 "><a class="" href="/contribute/writing-a-plugin/#example">示例 </a></li><li class="sidebar-item__anchor" title="插件的不同类型 "><a class="" href="/contribute/writing-a-plugin/#different-plugin-shapes">插件的不同类型 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Synchronous(同步) Hooks "><a class="" href="/contribute/writing-a-plugin/#synchronous-hooks">Synchronous(同步) Hooks </a></li><li class="sidebar-item__anchor" title="Asynchronous(异步) Hooks "><a class="" href="/contribute/writing-a-plugin/#asynchronous-hooks">Asynchronous(异步) Hooks </a></li><li class="sidebar-item__anchor" title="默认配置 "><a class="" href="/contribute/writing-a-plugin/#configuration-defaults">默认配置 </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/plugin-patterns/">插件模式</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="检索遍历资源、chunk、模块和依赖 "><a class="" href="/contribute/plugin-patterns/#exploring-assets-chunks-modules-and-dependencies">检索遍历资源、chunk、模块和依赖 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="监听观察图的修改 "><a class="" href="/contribute/plugin-patterns/#monitoring-the-watch-graph">监听观察图的修改 </a></li></ul></li><li class="sidebar-item__anchor" title="监听 chunk 的修改 "><a class="" href="/contribute/plugin-patterns/#changed-chunks">监听 chunk 的修改 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/release-process/">发布流程</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="拉取请求（pull request） "><a class="" href="/contribute/release-process/#pull-requests">拉取请求（pull request） </a></li><li class="sidebar-item__anchor" title="发布 "><a class="" href="/contribute/release-process/#releasing">发布 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/debugging/">调试</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Stats "><a class="" href="/contribute/debugging/#stats">Stats </a></li><li class="sidebar-item__anchor" title="DevTools "><a class="" href="/contribute/debugging/#devtools">DevTools </a></li></ul></div></div></div></nav><section class="page"><div class="markdown"><h1>Printable</h1><div id="md-content"><h1><span id="参与贡献"></span>参与贡献<a href="#%E5%8F%82%E4%B8%8E%E8%B4%A1%E7%8C%AE" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>为 webpack 做出贡献的群体，通常热衷于开源项目、关心用户体验和关注软件生态系统，对这些人来说，更具有意义的事情是，获得共同推动着 web 向前发展的成就感。由于我们使用 <a href="https://opencollective.com/webpack">Open Collective</a> 资金模型，公开透明地积累和管理资金，所以我们能够通过贡献人员、依赖项目和核心团队获得支持和资金。想要捐款，只需点击下面的按钮……</p><div align="center"></div><p>但是，投入资金的回报情况如何呢？</p><h2><span id="developers"></span>开发人员<a href="#developers" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>我们希望能为开发人员提供最大程度的愉悦开发体验。开发人员可以通过如下方式为我们提供帮助，例如，贡献丰富有趣的文档、发布 pull request、帮助我们覆盖小众用例，并辅助维护 webpack。</p><h3><span id="how-can-i-help"></span>我如何帮助 webpack？<a href="#how-can-i-help" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>任何人都可以通过以下方式来帮助 webpack：</p><ul><li>要求雇主在项目中使用 webpack。</li><li>帮助我们编写和维护本网站上的内容（请查看<a href="/contribute/writers-guide/">作者指南</a>）。</li><li>向<a href="https://github.com/webpack/webpack">核心仓库</a>贡献代码。</li><li>成为 <a href="https://opencollective.com/webpack#support">open collective</a> 的筹款人员(backer)或赞助人员(sponsor)。</li></ul><h3><span id="encouraging-employers"></span>要求雇主使用 webpack<a href="#encouraging-employers" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>可以要求你的雇主通过使用 webpack 来改进工作流程：webpack 是用于字体、图像、图像优化和 json 的 all-in-one 全特性工具。向他们解释 webpack 试图将代码和资源打包为最小文件体积，从而使网站和应用程序更加快速。</p><h3><span id="your-contributions"></span>贡献代码<a href="#your-contributions" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>向 webpack 贡献代码，并不只是对专属 club 的贡献。你作为开发人员正在为下游项目的整体健康做出贡献。数百个、甚至数千个项目依赖于 webpack，你的贡献将使所有用户的生态系统更加完善。</p><p>本章节的其余部分，是专门针对那些「希望成为我们持续增长社区的一部分」的开发人员编写：</p><ul><li><a href="/contribute/writing-a-loader">编写 loader</a></li><li><a href="/contribute/writing-a-plugin">编写 plugin</a></li><li><a href="/contribute/plugin-patterns">插件模式</a></li><li><a href="/contribute/release-process">发布流程</a></li></ul><h2><span id="executives"></span>管理人员<a href="#executives" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>CTO, VP 和业主也可以向我们提供帮助！</p><p>webpack 是打包代码的全特性工具。它可以在由社区驱动的 plugin 和 loader 的帮助下处理字体、图像、数据等。将你的所有资源交付一个工具进行处理，是非常有效地资源管理方案，这样你或你的团队可以花更少的时间，来确保具有许多移动部件的机器正常工作，并且有更多时间构建你的产品。</p><h3><span id="sponsorship"></span>赞助<a href="#sponsorship" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>除了资金援助外，公司还可以通过以下方式支持 webpack：</p><ul><li>提供不活跃但是参与项目的开发人员。</li><li>为我们改进 CI 和回归测试，提供计算能力(computing power)。</li></ul><p>你还可以鼓励开发人员，向 webpack 生态系统贡献开源的 loader, plugin 和其他工具。最后，如上所述，非常感谢帮助我们添加 CI/CD 基础设施的那些公司。</p><h3><span id="anyone-else"></span>其他人群<a href="#anyone-else" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>对于那些对我们的使命感兴趣的人 - 例如风险投资者、政府机构、数字营销公司等 - 我们真诚希望你能够与我们展开合作，通过 webpack 这个最好的 npm package，改善你的产品！所以请毫不犹豫地向我们提出你需要解决的问题。</p><h2><span id="pull-requests"></span>拉取请求(pull requests)<a href="#pull-requests" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>随着 webpack 的发展，webpack 特性(features)和改动(changes)的文档会同步更新。webpack 集成了自动创建 issue 的机制，在过去几年被证明是行之有效的。
当一个特性被合并后，在我们的仓库(repository)中会创建一个文档要求的 issue ，我们希望该 issue 能及时解决。这意味着有特性，改动和重要改动(breaking changes)等着文档提交、检查、发布。尽管如此，如果 Pull Request 作者 30 天还未完成，我们会把这种 Pull Request 标记为失效(stale)。我们会接管未完成的部分，并完成该任务。
如果 Pull Request 作者把 fork 的仓库的写权限授权给 <a href="https://github.com/orgs/webpack/teams/documentation-team/members">webpack 文档团队</a>，我们将直接提交到你的分支来完成任务。否则，我们不得不自己重头开始，或者委托给有意愿的社区成员。这样你的 Pull Request 就是多余的，可能会被清理程序(cleanup process)关闭。</p><h1><span id="作者指引"></span>作者指引<a href="#%E4%BD%9C%E8%80%85%E6%8C%87%E5%BC%95" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>以下部分包含编辑和格式化本网站内容的所有必需知识。请确保在开始编辑或添加之前，你已经进行过一些研究。有时候最困难的地方在于，确定内容应该在哪和确定它是否存在。</p><h2><span id="process"></span>步骤<a href="#process" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><ol><li>如果文章包含 issue 链接，先查看 issue。</li><li>点击编辑并阐述结构。</li><li>提交 PR 修改。</li></ol><h2><span id="yaml-frontmatter"></span>YAML 文件顶部信息<a href="#yaml-frontmatter" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>每篇文章的顶部都包含一小部分 <a href="https://jekyllrb.com/docs/frontmatter/">YAML Frontmatter</a> 格式的内容：</p><pre><code class="hljs language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">title</span><span class="token punctuation">:</span> 我的文章
<span class="token key atrule">group</span><span class="token punctuation">:</span> 我的小节
<span class="token key atrule">sort</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">contributors</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span>github 用户名<span class="token punctuation">]</span>
<span class="token key atrule">related</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> 相关文章的标题
    <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>相关文章的 url<span class="token punctuation">]</span>
<span class="token punctuation">---</span></code></pre><p>让我们来逐个分析：</p><ul><li><code>title</code>：文章的名称。</li><li><code>group</code>：小节的名称。</li><li><code>sort</code>：这篇文章在此类（或子类）中的顺序（如果存在同类）。</li><li><code>contributors</code>：文章贡献者的 GitHub 用户名列表。</li><li><code>related</code>：任何相关阅读或有用示例。</li></ul><p>请注意，<code>related</code> 将在页面底部生成 <strong>Further Reading</strong> 部分，<code>contributors</code> 将在其下生成 <strong>Contributors</strong> 部分。如果你编辑了一篇文章，并希望获得认可，请不要犹豫，将你的 GitHub 用户名添加到 <code>contributors</code> 列表中。</p><h2><span id="article-structure"></span>文章结构<a href="#article-structure" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><ol><li>简介 —— 一两个段落，以便你了解关于什么和为什么的基本想法。</li><li>概述剩余内容 —— 将如何呈现内容。</li><li>主要内容 —— 讲述你承诺要讲的内容。</li><li>结论 —— 讲述你讲了什么并复述要点。</li></ol><h2><span id="typesetting"></span>排版<a href="#typesetting" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><ul><li>Webpack 作为句子的第一个单词时，W 可以大写。参考 <a href="https://github.com/webpack/media#name">source</a> 以了解更多。</li><li>loader 应当用反引号包裹，并且使用 <a href="https://en.wikipedia.org/w/index.php?title=Kebab_case">kebab-cased</a>：<code>css-loader</code>，<code>ts-loader</code>，……</li><li>plugin 应当用反引号包裹，并且使用 <a href="https://en.wikipedia.org/wiki/Camel_case">camel-cased</a>: <code>BannerPlugin</code>， <code>NpmInstallWebpackPlugin</code>，……</li><li>使用 &quot;webpack 2&quot; 指代特定的 webpack 版本 (<del>&quot;webpack v2&quot;</del>)</li><li>使用 ES5; ES2015, ES2016, …… 指代 ECMAScript 标准 (<del>ES6</del>, <del>ES7</del>)</li></ul><blockquote><p>译者注：中文文档排版规范不必依照于此。</p></blockquote><h2><span id="formatting"></span>格式化<a href="#formatting" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><h3><span id="code"></span>代码<a href="#code" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p><strong>语法：```javascript … ```</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4><span id="quotation"></span>引号<a href="#quotation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>在代码片段和项目文件中使用单引号 (<code>.jsx</code>， <code>.scss</code> 等)：</p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import webpack from &quot;webpack&quot;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import webpack from &#x27;webpack&#x27;;</span></span></code></pre><p>行内反引号也是一样：</p><p><strong>正确</strong></p><p>把值设置为 <code>&#x27;index.md&#x27;</code>……</p><p><strong>错误</strong></p><p>把值设置为 <code>&quot;index.md&quot;</code>……</p><h3><span id="lists"></span>列表<a href="#lists" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li>Boo</li><li>Foo</li><li>Zoo</li></ul><p>列表应该按字母顺序排序。</p><h3><span id="tables"></span>表格<a href="#tables" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><table><thead><tr><th>参数</th><th>解释说明</th><th>输入类型</th><th>默认值</th></tr></thead><tbody><tr><td data-th="参数"><span>--debug</span></td><td data-th="解释说明"><span>把 loader 切换为 debug 模式</span></td><td data-th="输入类型"><span>boolean</span></td><td data-th="默认值"><span>false</span></td></tr><tr><td data-th="参数"><span>--devtool</span></td><td data-th="解释说明"><span>为打包的资源定义 source map 类型</span></td><td data-th="输入类型"><span>string</span></td><td data-th="默认值"><span>-</span></td></tr><tr><td data-th="参数"><span>--progress</span></td><td data-th="解释说明"><span>打印 compilation 的百分比进度</span></td><td data-th="输入类型"><span>boolean</span></td><td data-th="默认值"><span>false</span></td></tr></tbody></table><p>表格也应该按字母顺序排序。</p><h3><span id="configuration-properties"></span>配置属性<a href="#configuration-properties" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p><a href="/configuration">配置</a> 属性，应该按字母顺序排序：</p><ul><li><code>devServer.compress</code></li><li><code>devServer.hot</code></li><li><code>devServer.static</code></li></ul><h3><span id="quotes"></span>引用<a href="#quotes" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><h4><span id="blockquote"></span>引用块<a href="#blockquote" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p><strong>语法：&gt;</strong></p><blockquote><p>这是一个引用块。</p></blockquote><h4><span id="tip"></span>提示<a href="#tip" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p><strong>语法：T&gt;</strong></p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>这是一个提示。</p></aside><p><strong>语法：W&gt;</strong></p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>这是一个警告。</p></aside><p><strong>语法：?&gt;</strong></p><aside class="todo"><h6 class="todo__prefix">TODO</h6><p>这是一个 todo 待办项。</p></aside><h3><span id="assumptions-and-simplicity"></span>假设与详略<a href="#assumptions-and-simplicity" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>写文档时，不要做假设：</p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> 你可能已经知道如何为生产环境优化 bundle ……
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 我们在 [production guide](/guides/production/) 学习过……</span></span></code></pre><p>请不要假设事情简单。避免使用词汇“只是”，“简单地”。</p><pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> 简单地运行命令……
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 运行 `command-name` 命令……</span></span></code></pre><h3><span id="configuration-defaults-and-types"></span>配置的默认值和类型<a href="#configuration-defaults-and-types" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>总是为所有文档选项提供类型和默认值，以保持文档的可读性和良好书写。我们在选项后面加上类型和默认值：</p><p><strong>configuration.example.option</strong></p><p><code>string = &#x27;none&#x27;</code></p><p>这里 <code>= &#x27;none&#x27;</code> 表示指定选项的默认值是 <code>&#x27;none&#x27;</code> 。</p><p><code>string = &#x27;none&#x27;: &#x27;none&#x27; | &#x27;development&#x27; | &#x27;production&#x27;</code></p><p>这里 <code>: &#x27;none&#x27; | &#x27;development&#x27; | &#x27;production&#x27;</code> 枚举所有可能的类型值，本例接受 3 个字符串：<code>&#x27;none&#x27;</code>, <code>&#x27;development&#x27;</code> 和 <code>&#x27;production&#x27;</code>。</p><p>在类型之间使用空格，为指定选项列举所有可用的类型：</p><p><code>string = &#x27;none&#x27;: &#x27;none&#x27; | &#x27;development&#x27; | &#x27;production&#x27;</code> <code>boolean</code></p><p>使用方括号表示数组：</p><p><code>string</code> <code>[string]</code></p><p>如果 <code>数组</code> 允许多种类型，使用英文逗号：</p><p><code>string</code> <code>[string, RegExp, function(arg) =&gt; string]</code></p><p>标记为函数时，如果有参数，应同时把参数列出来：</p><p><code>function (compilation, module, path) =&gt; boolean</code></p><p>这里 <code>(compilation, module, path)</code> 列举指定函数接受的参数，<code>=&gt; boolean</code> 表示函数返回值的类型必须是 <code>boolean</code>。</p><p>标记 Plugin 为可用的选项值类型时，使用 <code>Plugin</code> 的 camel case 标题：</p><p><code>TerserPlugin</code> <code>[TerserPlugin]</code></p><p>这表示选项接受一个或多个 <code>TerserPlugin</code> 实例。</p><p>使用 <code>number</code> 标记为 number ：</p><p><code>number = 15: 5, 15, 30</code></p><p>使用 <code>object</code> 标记为对象：</p><p><code>object = { prop1 string = &#x27;none&#x27;: &#x27;none&#x27; | &#x27;development&#x27; | &#x27;production&#x27;, prop2 boolean = false, prop3 function (module) =&gt; string }</code></p><p>当对象的 key 可以有多个类型时，用 <code>|</code> 列来出。如下例子，<code>prop1</code> 可以是字符串或字符串数组：</p><p><code>object = { prop1 string = &#x27;none&#x27;: &#x27;none&#x27; | &#x27;development&#x27; | &#x27;production&#x27; | [string]}</code></p><p>这样我们可以展示默认值，枚举和其他信息。</p><p>如果对象的 key 是动态的，用户自定义的，用 <code>&lt;key&gt;</code> 来描述：</p><p><code>object = { &lt;key&gt; string }</code></p><h3><span id="options-shortlists-and-their-typing"></span>选项 shortlist 及其类型<a href="#options-shortlists-and-their-typing" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>有时，我们希望描述对象的某些属性，以及列表中的函数。在属性列表直接添加即可：</p><ul><li><code>madeUp</code> (<code>boolean = true</code>): 简短描述</li><li><code>shortText</code> (<code>string = &#x27;i am text&#x27;</code>): 另一个简短描述</li></ul><aside class="warning"><h6 class="warning__prefix">警告</h6><p><code>:</code> 不是必须的。注意属性名，类型和默认值。</p></aside><p><a href="/plugins/eval-source-map-dev-tool-plugin/#options">EvalSourceMapDevToolPlugin 页面的 <code>选项</code> 部分</a> 有一个例子。</p><h3><span id="adding-links"></span>添加链接<a href="#adding-links" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>请使用相对 URL (如 <code>/concepts/mode/</code>) 来链接到自有内容，不要用绝对 URL (如 <code>https://webpack.js.org/concepts/mode/</code>)。</p><h1><span id="编写-loader"></span>编写 loader<a href="#%E7%BC%96%E5%86%99-loader" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>loader 是导出为一个函数的 node 模块。该函数在 loader 转换资源的时候调用。给定的函数将调用 <a href="/api/loaders/">Loader API</a>，并通过 <code>this</code> 上下文访问。</p><h2><span id="setup"></span>设置<a href="#setup" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在深入研究不同 loader 以及他们的用法和例子之前，我们先看三种本地开发测试的方法。</p><p>匹配（test）单个 loader，你可以通过在 rule 对象使用 <code>path.resolve</code> 指定一个本地文件：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;path/to/loader.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token comment">/* ... */</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>匹配（test）多个 loaders，你可以使用 <code>resolveLoader.modules</code> 配置，webpack 将会从这些目录中搜索这些 loaders。例如，如果你的项目中有一个 <code>/loaders</code> 本地目录：</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  resolveLoader<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;node_modules&#x27;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;loaders&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>顺便提一下，如果你已经为 loader 创建了独立的库和包，你可以使用 <a href="https://docs.npmjs.com/cli/link"><code>npm link</code></a> 来将其链接到你要测试的项目。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>你可以用 <a href="https://github.com/webpack-contrib/webpack-defaults"><code>webpack-defaults</code> package</a> 来生成开始编写 loader 必要的样板代码(boilerplate code)。</p></aside><h2><span id="simple-usage"></span>简单用法<a href="#simple-usage" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>当一个 loader 在资源中使用，这个 loader 只能传入一个参数 - 一个包含资源文件内容的字符串。</p><p>同步 loader 可以 <code>return</code> 一个代表已转换模块（transformed module）的单一值。在更复杂的情况下，loader 也可以通过使用 <code>this.callback(err, values...)</code> 函数，返回任意数量的值。错误要么传递给这个 <code>this.callback</code> 函数，要么抛给（thrown in）同步 loader 。</p><p>loader 会返回一个或者两个值。第一个值的类型是 JavaScript 代码的字符串或者 buffer。第二个可选值是 SourceMap，它是个 JavaScript 对象。</p><h2><span id="complex-usage"></span>复杂用法<a href="#complex-usage" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>当链式调用多个 loader 的时候，请记住它们是反方向执行的。取决于数组写法格式，从右向左或者从下向上执行。</p><ul><li>最后的 loader 最早调用，将会传入原始资源（raw resource）内容。</li><li>第一个 loader 最后调用，期望值是传出 JavaScript 和 source map（可选）。</li><li>中间的 loader 执行时，会传入前一个 loader 的结果。</li></ul><p>在下例中，<code>foo-loader</code> 被传入原始资源，<code>bar-loader</code> 将接收 <code>foo-loader</code> 的产出，返回最终转化后的模块和一个 source map（可选）</p><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;bar-loader&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;foo-loader&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2><span id="guidelines"></span>用法准则(Guidelines)<a href="#guidelines" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>编写 loader 时应该遵循以下准则。它们按重要程度排序，有些仅适用于某些场景，请阅读下面详细的章节以获得更多信息。</p><ul><li>保持 <strong>简单</strong> 。</li><li>使用 <strong>链式</strong> 传递。</li><li><strong>模块化</strong> 的输出。</li><li>确保 <strong>无状态</strong> 。</li><li>使用 <strong>loader utilities</strong> 。</li><li>记录 <strong>loader 的依赖</strong> 。</li><li>解析 <strong>模块依赖关系</strong> 。</li><li>提取 <strong>通用代码</strong> 。</li><li>避免 <strong>绝对路径</strong> 。</li><li>使用 <strong>peer dependencies</strong>。</li></ul><h3><span id="simple"></span>简单(simple)<a href="#simple" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>loaders 应该只做单一任务。这不仅使每个 loader 易维护，也可以在更多场景链式调用。</p><h3><span id="chaining"></span>链式(chaining)<a href="#chaining" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>利用 loader 可以链式调用的优势。写五个简单的 loader 实现五项任务，而不是一个 loader 实现五项任务。功能隔离不仅使 loader 更简单，可能还可以将它们用于你原先没有想到的功能。</p><p>以通过 loader 选项或者查询参数得到的数据渲染模板为例。可以把源代码编译为模板，执行并输出包含 HTML 代码的字符串写到一个 loader 中。但是根据用法准则，已经存在这样一个 <code>apply-loader</code>，可以将它和其他开源 loader 串联在一起调用。</p><ul><li><code>pug-loader</code>: 导出一个函数，把模板转换为模块。</li><li><code>apply-loader</code>: 根据 loader 选项执行函数，返回原生 HTML。</li><li><code>html-loader</code>: 接收 HTML，输出一个合法的 JS 模块。</li></ul><aside class="tip"><h6 class="tip__prefix">提示</h6><p>loader 可以被链式调用意味着不一定要输出 JavaScript。只要下一个 loader 可以处理这个输出，这个 loader 就可以返回任意类型的模块。</p></aside><h3><span id="modular"></span>模块化(modular)<a href="#modular" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>保证输出模块化。loader 生成的模块与普通模块遵循相同的设计原则。</p><h3><span id="stateless"></span>无状态(stateless)<a href="#stateless" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>确保 loader 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。</p><h3><span id="loader-utilities"></span>loader 工具库(Loader Utilities)<a href="#loader-utilities" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>充分利用 <a href="https://github.com/webpack/loader-utils"><code>loader-utils</code></a> 包。它提供了许多有用的工具，但最常用的一种工具是获取传递给 loader 的选项。<a href="https://github.com/webpack-contrib/schema-utils"><code>schema-utils</code></a> 包配合 <code>loader-utils</code>，用于保证 loader 选项，进行与 JSON Schema 结构一致的校验。这里有一个简单使用两者的例子：</p><p><strong>loader.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> urlToRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;loader-utils&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;schema-utils&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#x27;object&#x27;</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#x27;string&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&#x27;Example Loader&#x27;</span><span class="token punctuation">,</span>
    baseDataPath<span class="token operator">:</span> <span class="token string">&#x27;options&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;The request path&#x27;</span><span class="token punctuation">,</span> <span class="token function">urlToRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 对资源应用一些转换……</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3><span id="loader-dependencies"></span>loader 依赖(loader dependencies)<a href="#loader-dependencies" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>如果一个 loader 使用外部资源（例如，从文件系统读取），<strong>必须</strong>声明它。这些信息用于使缓存 loaders 无效，以及在观察模式(watch mode)下重编译。下面是一个简单示例，说明如何使用 <code>addDependency</code> 方法实现上述声明：</p><p><strong>loader.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#x27;path&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> headerPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;header.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDependency</span><span class="token punctuation">(</span>headerPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>headerPath<span class="token punctuation">,</span> <span class="token string">&#x27;utf-8&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> header</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> header <span class="token operator">+</span> <span class="token string">&#x27;\n&#x27;</span> <span class="token operator">+</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3><span id="module-dependencies"></span>模块依赖(module dependencies)<a href="#module-dependencies" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>根据模块类型，可能会有不同的模式指定依赖关系。例如在 CSS 中，使用 <code>@import</code> 和 <code>url(...)</code> 语句来声明依赖。这些依赖关系应该由模块系统解析。</p><p>可以通过以下两种方式中的一种来实现：</p><ul><li>通过把它们转化成 <code>require</code> 语句。</li><li>使用 <code>this.resolve</code> 函数解析路径。</li></ul><p><code>css-loader</code> 是第一种方式的一个例子。它将 <code>@import</code> 语句替换为 <code>require</code> 其他样式文件，将 <code>url(...)</code> 替换为 <code>require</code> 引用文件，从而实现将依赖关系转化为 <code>require</code> 声明。</p><p>对于 <code>less-loader</code>，无法将每个 <code>@import</code> 转化为 <code>require</code>，因为所有 <code>.less</code> 的文件中的变量和混合跟踪必须一次编译。因此，<code>less-loader</code> 将 <code>less</code> 编译器进行了扩展，自定义路径解析逻辑。然后，利用第二种方式，通过 webpack 的 <code>this.resolve</code> 解析依赖。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p>如果语言只支持相对 url（例如 <code>url(file)</code> 总是指向 <code>./file</code>），通过使用 <code>~</code> 来指定已安装模块（例如，引用 <code>node_modules</code> 中的那些模块）。所以对于 <code>url</code>，相当于 <code>url(&#x27;~some-library/image.jpg&#x27;)</code>。</p></aside><h3><span id="common-code"></span>通用代码(common code)<a href="#common-code" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>避免在 loader 处理的每个模块中生成通用代码。相反，你应该在 loader 中创建一个运行时文件，并生成 <code>require</code> 语句以引用该共享模块：</p><p><strong>src/loader-runtime.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> someOtherModule <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./some-other-module&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> params<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">someOtherModule</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>src/loader.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> runtime <span class="token keyword">from</span> <span class="token string">&#x27;./loader-runtime.js&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 自定义的 loader 逻辑</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">runtime</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token punctuation">,</span>
    y<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3><span id="absolute-paths"></span>绝对路径(absolute paths)<a href="#absolute-paths" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>不要在模块代码中插入绝对路径，因为当项目根路径变化时，文件绝对路径也会变化。<code>loader-utils</code> 中的 <a href="https://github.com/webpack/loader-utils#stringifyrequest"><code>stringifyRequest</code></a> 方法，可以将绝对路径转化为相对路径。</p><h3><span id="peer-dependencies"></span>同等依赖(peer dependencies)<a href="#peer-dependencies" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>如果你的 loader 简单包裹另外一个包，你应该把这个包作为一个 <code>peerDependency</code> 引入。这种方式允许应用程序开发者在必要情况下，在 <code>package.json</code> 中指定所需的确定版本。</p><p>例如，<code>sass-loader</code> <a href="https://github.com/webpack-contrib/sass-loader/blob/master/package.json">指定 <code>node-sass</code></a> 作为同等依赖，引用如下：</p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;peerDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node-sass&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2><span id="testing"></span>测试<a href="#testing" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>当你遵循上面的用法准则编写了一个 loader，并且可以在本地运行。下一步该做什么呢？让我们用一个简单的单元测试，来保证 loader 能够按照我们预期的方式正确运行。我们将使用 <a href="https://jestjs.io/">Jest</a> 框架。然后还需要安装 <code>babel-jest</code> 和允许我们使用 <code>import</code> / <code>export</code> 和 <code>async</code> / <code>await</code> 的一些预设环境(presets)。让我们开始安装，并且将这些依赖保存为 <code>devDependencies</code>：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest babel-jest @babel/core @babel/preset-env</code></pre><p><strong>babel.config.js</strong></p><pre><code class="hljs language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&#x27;@babel/preset-env&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        targets<span class="token operator">:</span> <span class="token punctuation">{</span>
          node<span class="token operator">:</span> <span class="token string">&#x27;current&#x27;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>我们的 loader 将会处理 <code>.txt</code> 文件，并且将任何实例中的 <code>[name]</code> 直接替换为 loader 选项中设置的 <code>name</code>。然后返回包含默认导出文本的 JavaScript 模块：</p><p><strong>src/loader.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\[name\]/g</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>我们将会使用这个 loader 处理以下文件：</p><p><strong>test/example.txt</strong></p><pre><code class="hljs language-bash">Hey <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">!</span></code></pre><p>请注意留心接下来的步骤，我们将会使用 <a href="/api/node">Node.js API</a> 和 <a href="https://github.com/streamich/memfs"><code>memfs</code></a> 去执行 webpack。这让我们避免向磁盘产生 <code>输出文件</code>，并允许我们访问获取转换模块的统计数据 <code>stats</code>：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack memfs</code></pre><p><strong>test/compiler.js</strong></p><pre><code class="hljs language-js"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#x27;path&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createFsFromVolume<span class="token punctuation">,</span> Volume <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;memfs&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">fixture<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fixture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">&#x27;bundle.js&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
      rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;../src/loader.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            options<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  compiler<span class="token punctuation">.</span>outputFileSystem <span class="token operator">=</span> <span class="token function">createFsFromVolume</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Volume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>outputFileSystem<span class="token punctuation">.</span>join <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">resolve</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>这种情况下，我们可以内联 webpack 配置，也可以把配置作为参数传给导出的函数。这允许我们使用相同的编译模块测试多个设置。</p></aside><p>最后，我们来编写测试，并且添加 npm script 运行它：</p><p><strong>test/loader.test.js</strong></p><pre><code class="hljs language-js"><span class="token comment">/**
 * @jest-environment node
 */</span>
<span class="token keyword">import</span> compiler <span class="token keyword">from</span> <span class="token string">&#x27;./compiler.js&#x27;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;Inserts name and outputs JavaScript&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stats <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">compiler</span><span class="token punctuation">(</span><span class="token string">&#x27;example.txt&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;Alice&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">{</span> source<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>source<span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#x27;export default &quot;Hey Alice!\\n&quot;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>package.json</strong></p><pre><code class="hljs language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;testEnvironment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>准备就绪后，我们可以运行它，然后看新的 loader 是否能通过测试：</p><pre><code class="hljs language-bash"> PASS  test/loader.test.js
  ✓ Inserts name and outputs JavaScript <span class="token punctuation">(</span>229ms<span class="token punctuation">)</span>

Test Suites: <span class="token number">1</span> passed, <span class="token number">1</span> total
Tests:       <span class="token number">1</span> passed, <span class="token number">1</span> total
Snapshots:   <span class="token number">0</span> total
Time:        <span class="token number">1</span>.853s, estimated 2s
Ran all <span class="token builtin class-name">test</span> suites.</code></pre><p>一切正常！现在，你应该准备开始开发、测试、部署你的 loaders 了。我们希望你可以在社区分享你的 loader！</p><h1><span id="自定义插件"></span>自定义插件<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>插件向第三方开发者提供了 webpack 引擎中完整的能力。使用阶段式的构建回调，开发者可以在 webpack 构建流程中引入自定义的行为。创建插件比创建 loader 更加高级，因为你需要理解 webpack 底层的特性来处理相应的钩子，所以请做好阅读源码的准备！</p><h2><span id="creating-a-plugin"></span>创建插件<a href="#creating-a-plugin" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>webpack 插件由以下组成：</p><ul><li>一个 JavaScript 命名函数或 JavaScript 类。</li><li>在插件函数的 prototype 上定义一个 <code>apply</code> 方法。</li><li>指定一个绑定到 webpack 自身的<a href="/api/compiler-hooks/">事件钩子</a>。</li><li>处理 webpack 内部实例的特定数据。</li><li>功能完成后调用 webpack 提供的回调。</li></ul><pre><code class="hljs language-javascript"><span class="token comment">// 一个 JavaScript 类</span>
<span class="token keyword">class</span> <span class="token class-name">MyExampleWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在插件函数的 prototype 上定义一个 `apply` 方法，以 compiler 为参数。</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定一个挂载到 webpack 自身的事件钩子。</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;MyExampleWebpackPlugin&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;这是一个示例插件！&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
          <span class="token string">&#x27;这里表示了资源的单次构建的 `compilation` 对象：&#x27;</span><span class="token punctuation">,</span>
          compilation
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 用 webpack 提供的插件 API 处理构建过程</span>
        compilation<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2><span id="basic-plugin-architecture"></span>基本插件架构<a href="#basic-plugin-architecture" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>插件是由「具有 <code>apply</code> 方法的 prototype 对象」所实例化出来的。这个 <code>apply</code> 方法在安装插件时，会被 webpack compiler 调用一次。<code>apply</code> 方法可以接收一个 webpack compiler 对象的引用，从而可以在回调函数中访问到 compiler 对象。一个插件结构如下：</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloWorldPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;Hello World Plugin&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>
        stats <span class="token comment">/* 绑定 done 钩子后，stats 会作为参数传入。 */</span>
      <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello World!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloWorldPlugin<span class="token punctuation">;</span></code></pre><p>然后，要安装这个插件，只需要在你的 webpack 配置的 plugin 数组中添加一个实例：</p><pre><code class="hljs language-javascript"><span class="token comment">// webpack.config.js</span>
<span class="token keyword">var</span> HelloWorldPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;hello-world&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 这里是其他配置 ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HelloWorldPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> options<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>使用 <a href="https://github.com/webpack/schema-utils"><code>schema-utils</code></a> 来校验传入插件的选项。这里是个例子：</p><pre><code class="hljs language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;schema-utils&#x27;</span><span class="token punctuation">;</span>

<span class="token comment">// 选项对象的 schema</span>
<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#x27;object&#x27;</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#x27;string&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#x27;Hello World Plugin&#x27;</span><span class="token punctuation">,</span>
      baseDataPath<span class="token operator">:</span> <span class="token string">&#x27;options&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2><span id="compiler-and-compilation"></span>Compiler 和 Compilation<a href="#compiler-and-compilation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在插件开发中最重要的两个资源就是 <a href="/api/node/#compiler-instance"><code>compiler</code></a> 和 <a href="/api/compilation-hooks/"><code>compilation</code></a> 对象。理解它们的角色是扩展 webpack 引擎重要的第一步。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloCompilationPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定一个挂载到 compilation 的钩子，回调函数的参数为 compilation 。</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloCompilationPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 现在可以通过 compilation 对象绑定各种钩子</span>
      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloCompilationPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;资源已经优化完毕。&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloCompilationPlugin<span class="token punctuation">;</span></code></pre><p><code>compiler</code> 和 <code>compilation</code> 以及其他重要对象提供的钩子清单，请查看 <a href="/api/plugins/">plugins API</a> 文档。</p><h2><span id="async-event-hooks"></span>异步编译插件<a href="#async-event-hooks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>有些插件钩子是异步的。我们可以像同步方式一样用 <code>tap</code> 方法来绑定，也可以用 <code>tapAsync</code> 或 <code>tapPromise</code> 这两个异步方法来绑定。</p><h3><span id="tapasync"></span>tapAsync<a href="#tapasync" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>当我们用 <code>tapAsync</code> 方法来绑定插件时，_必须_调用函数的最后一个参数 <code>callback</code> 指定的回调函数。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloAsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;HelloAsyncPlugin&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行某些异步操作...</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;异步任务完成...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloAsyncPlugin<span class="token punctuation">;</span></code></pre><h4><span id="tappromise"></span>tapPromise<a href="#tappromise" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>当我们用 <code>tapPromise</code> 方法来绑定插件时，_必须_返回一个 pormise ，异步任务完成后 resolve 。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloAsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloAsyncPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 返回一个 pormise ，异步任务完成后 resolve</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;异步任务完成...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloAsyncPlugin<span class="token punctuation">;</span></code></pre><h2><span id="example"></span>示例<a href="#example" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>一旦我们可以深入理解 webpack compiler 和每个独立的 compilation，我们依赖 webpack 引擎将有无限多的事可以做。我们可以重新格式化已有的文件，创建衍生的文件，或者制作全新的生成文件。</p><p>让我们来写一个简单的示例插件，生成一个叫做 <code>assets.md</code> 的新文件；文件内容是所有构建生成的文件的列表。这个插件大概像下面这样：</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">FileListPlugin</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    outputFile<span class="token operator">:</span> <span class="token string">&#x27;assets.md&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 需要传入自定义插件构造函数的任意选项</span>
  <span class="token comment">//（这是自定义插件的公开API）</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在应用默认选项前，先应用用户指定选项</span>
    <span class="token comment">// 合并后的选项暴露给插件方法</span>
    <span class="token comment">// 记得在这里校验所有选项</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>FileListPlugin<span class="token punctuation">.</span>defaultOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pluginName <span class="token operator">=</span> FileListPlugin<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

    <span class="token comment">// webpack 模块实例，可以通过 compiler 对象访问，</span>
    <span class="token comment">// 这样确保使用的是模块的正确版本</span>
    <span class="token comment">// （不要直接 require/import webpack）</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> webpack <span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">;</span>

    <span class="token comment">// Compilation 对象提供了对一些有用常量的访问。</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> Compilation <span class="token punctuation">}</span> <span class="token operator">=</span> webpack<span class="token punctuation">;</span>

    <span class="token comment">// RawSource 是其中一种 “源码”(&quot;sources&quot;) 类型，</span>
    <span class="token comment">// 用来在 compilation 中表示资源的源码</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> RawSource <span class="token punctuation">}</span> <span class="token operator">=</span> webpack<span class="token punctuation">.</span>sources<span class="token punctuation">;</span>

    <span class="token comment">// 绑定到 “thisCompilation” 钩子，</span>
    <span class="token comment">// 以便进一步绑定到 compilation 过程更早期的阶段</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 绑定到资源处理流水线(assets processing pipeline)</span>
      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>processAssets<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> pluginName<span class="token punctuation">,</span>

          <span class="token comment">// 用某个靠后的资源处理阶段，</span>
          <span class="token comment">// 确保所有资源已被插件添加到 compilation</span>
          stage<span class="token operator">:</span> Compilation<span class="token punctuation">.</span><span class="token constant">PROCESS_ASSETS_STAGE_SUMMARIZE</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">assets</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// &quot;assets&quot; 是一个包含 compilation 中所有资源(assets)的对象。</span>
          <span class="token comment">// 该对象的键是资源的路径，</span>
          <span class="token comment">// 值是文件的源码</span>

          <span class="token comment">// 遍历所有资源，</span>
          <span class="token comment">// 生成 Markdown 文件的内容</span>
          <span class="token keyword">const</span> content <span class="token operator">=</span>
            <span class="token string">&#x27;# In this build:\n\n&#x27;</span> <span class="token operator">+</span>
            Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;\n&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 向 compilation 添加新的资源，</span>
          <span class="token comment">// 这样 webpack 就会自动生成并输出到 output 目录</span>
          compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>outputFile<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> FileListPlugin <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> FileListPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./file-list-plugin.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在 webpack 配置中使用自定义的插件：</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 添加插件，使用默认选项</span>
    <span class="token keyword">new</span> <span class="token class-name">FileListPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 或者:</span>

    <span class="token comment">// 使用任意支持的选项</span>
    <span class="token keyword">new</span> <span class="token class-name">FileListPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      outputFile<span class="token operator">:</span> <span class="token string">&#x27;my-assets.md&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>这样就生成了一个制定名称的 markdown 文件：</p><pre><code class="hljs language-markdown"># In this build:

- main.css
- main.js
- index.html
</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>我们使用 <code>tap()</code> 方法来绑定 <code>processAssets</code> 钩子，是因为上例中不需要执行任何异步操作。不过 <code>processAssets</code> 钩子是一个异步钩子，因此需要的时候也可用 <code>tapPromise()</code> 或 <code>tapAsync()</code> 方法。</p></aside><aside class="tip"><h6 class="tip__prefix">提示</h6><p><a href="/api/compilation-hooks/#processassets"><code>processAssets</code></a> 钩子还支持 <code>additionalAssets</code> 属性，不仅支持自定义插件拦截其他插件在当前阶段之前添加的资源，还支持当前阶段之后添加的资源。这样可以拦截 compilation 中的所有资源。不过这个例子在 <code>SUMMARIZE</code> 阶段捕获之前阶段生成的所有资源就够了（因为这些资源就是所有的了）。</p></aside><h2><span id="different-plugin-shapes"></span>插件的不同类型<a href="#different-plugin-shapes" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>webpack 插件可以按照它所注册的事件分成不同的类型。每一个事件钩子都预先定义为同步、异步、瀑布或并行钩子，钩子在内部用 call/callAsync 方法调用。支持的钩子清单或可被绑定的钩子清单，通常在 <code>this.hooks</code> 属性指定。</p><p>例如:</p><pre><code class="hljs language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
  shouldEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>表示唯一支持的钩子是 <code>shouldEmit</code> ，这是一个 <code>SyncBailHook</code> 类型的钩子，传入插件的唯一参数是 <code>compilation</code> 。</p><p>支持的各类型钩子：</p><h3><span id="synchronous-hooks"></span>Synchronous(同步) Hooks<a href="#synchronous-hooks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><p><strong>SyncHook</strong></p><ul><li>通过 <code>new SyncHook([params])</code> 定义。</li><li>用 <code>tap</code> 方法绑定。</li><li>用 <code>call(...params)</code> 方法调用。</li></ul></li><li><p><strong>Bail(保险) Hooks</strong></p><ul><li>通过 <code>new SyncBailHook([params])</code> 定义。</li><li>用 <code>tap</code> 方法绑定。</li><li>用 <code>call(...params)</code> 方法调用。</li></ul><p>Bail类型的钩子，其插件回调函数是串行调用，任意一个插件回调函数返回非 undefined 值，则停止执行插件，该值作为钩子的返回值。<code>optimizeChunks</code>，<code>optimizeChunkModules</code> 等很有用的事件都是 SyncBailHooks 。</p></li><li><p><strong>Waterfall(瀑布) Hooks</strong></p><ul><li>通过 <code>new SyncWaterfallHook([params])</code> 定义。</li><li>用 <code>tap</code> 方法绑定。</li><li>用 <code>call(...params)</code> 方法调用。</li></ul><p>该类型的插件是一个接一个串行执行，前一个的返回值作为后一个的入参。插件需要考虑执行的顺序，因为后一个插件必须接受前一个插件执行的结果作为入参。第一个插件的参数为 <code>init</code> 。
所以 waterfall 钩子至少要制定一个参数。这种模式用于和 <code>ModuleTemplate</code>，<code>ChunkTemplate</code> 等 webpack 模板相关的 Tapable 实例。</p></li></ul><h3><span id="asynchronous-hooks"></span>Asynchronous(异步) Hooks<a href="#asynchronous-hooks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><p><strong>Async Series(异步串联) Hook</strong></p><ul><li>通过 <code>new AsyncSeriesHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul><p>插件处理函数(handler functions)的参数为所有参数，以及一个签名为 <code>(err?: Error) -&gt; void</code> 的 callback 函数，callback 函数的处理函数按注册顺序执行。<code>callback</code> 在所有处理函数执行完后调用。
这是 <code>emit</code> 和 <code>run</code> 事件的常见使用模式。</p></li><li><p><strong>Async waterfall(异步瀑布)</strong> 插件会用 waterfall 方式异步应用</p><ul><li>通过 <code>new AsyncWaterfallHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul><p>插件处理函数的参数为当前值，以及一个签名为 <code>(err: Error, nextValue: any) -&gt; void</code> 的 callback 函数。调用时 <code>nextValue</code> 是下一个处理函数的当前值。第一个处理函数的当前是只 <code>init</code> 。当所有 handler 都执行后，callback执行，参数为最后一个值。任一个 handler 传入 <code>err</code> 值，停止调用 handler 且 callback 被调用。
这种模式在 <code>before-resolve</code> 和 <code>after-resolve</code> 事件中常见。</p></li><li><p><strong>Async Series Bail</strong></p><ul><li>通过 <code>new AsyncSeriesBailHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul></li><li><p><strong>Async Parallel</strong></p><ul><li>通过 <code>new AsyncParallelHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul></li></ul><h3><span id="configuration-defaults"></span>默认配置<a href="#configuration-defaults" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>Webpack 先应用插件的默认配置，再应用自身的默认配置。这样可以让插件拥有自己的默认配置，同时支持实现创建预设配置的插件。</p><h1><span id="插件模式"></span>插件模式<a href="#%E6%8F%92%E4%BB%B6%E6%A8%A1%E5%BC%8F" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>在 webpack 构建系统中，能够通过插件进行定制，这赋予了无限的可能性。这使你可以创建自定义资源类型，执行唯一的构建修改，甚至可以使用中间件来增强 webpack 运行时。下面是在编写插件时非常有用一些 webpack 的功能。</p><h2><span id="exploring-assets-chunks-modules-and-dependencies"></span>检索遍历资源、chunk、模块和依赖<a href="#exploring-assets-chunks-modules-and-dependencies" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在执行完成编译的封存阶段后，编译的所有结构都可以遍历。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 检索每个（构建输出的）chunk：</span>
      compilation<span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 检索 chunk 中（内置输入的）的每个模块：</span>
        chunk<span class="token punctuation">.</span><span class="token function">getModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 检索模块中包含的每个源文件路径：</span>
          module<span class="token punctuation">.</span>buildInfo <span class="token operator">&amp;&amp;</span>
            module<span class="token punctuation">.</span>buildInfo<span class="token punctuation">.</span>fileDependencies <span class="token operator">&amp;&amp;</span>
            module<span class="token punctuation">.</span>buildInfo<span class="token punctuation">.</span>fileDependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">filepath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// 我们现在已经对源结构有不少了解……</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 检索由 chunk 生成的每个资源文件名：</span>
        chunk<span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 获取 chunk 生成的每个文件的资源源代码：</span>
          <span class="token keyword">var</span> source <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span></code></pre><ul><li><code>compilation.modules</code>：编译后的（内置输入的）模块数组。每个模块管理控制来源代码库中的原始文件的构建。</li></ul><aside class="warning"><h6 class="warning__prefix">警告</h6><p><strong>弃用警告</strong>：数组函数依然可用。</p></aside><ul><li><code>module.fileDependencies</code>：模块中引入的源文件路径构成的数组。这包括源 JavaScript 文件本身（例如：index.js）以及它所需的所有依赖资源文件（样式表、图像等）。审查依赖，可以用于查看一个模块有哪些从属的源文件。</li><li><code>compilation.chunks</code>：编译后的（构建输出的）chunk 集合。每个 chunk 所管理控制的最终渲染资源的组合。</li></ul><aside class="warning"><h6 class="warning__prefix">警告</h6><p><strong>弃用警告</strong>：数组函数依然可用。</p></aside><ul><li><code>chunk.getModules()</code>：chunk 中引入的模块构成的数组。通过扩展可以审查每个模块的依赖，来查看哪些原始源文件被注入到 chunk 中。</li><li><code>chunk.files</code>：chunk 生成的输出文件名构成的集合。你可以从 <code>compilation.assets</code> 表中访问这些资源来源。</li></ul><h3><span id="monitoring-the-watch-graph"></span>监听观察图的修改<a href="#monitoring-the-watch-graph" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>运行 webpack 中间件时，每个编译包括一个 <code>fileDependencies</code> <code>Set</code>（正在观察哪些文件）和一个 <code>fileTimestamps</code> <code>Map</code>，它将被观察的文件路径映射到时间戳。这可以用于检测编译中哪些文件已经修改：</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prevTimestamps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> changedFiles <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>compilation<span class="token punctuation">.</span>fileTimestamps<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">watchfile</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prevTimestamps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>watchfile<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token operator">&lt;</span>
            <span class="token punctuation">(</span>compilation<span class="token punctuation">.</span>fileTimestamps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>watchfile<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">Infinity</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>prevTimestamps <span class="token operator">=</span> compilation<span class="token punctuation">.</span>fileTimestamps<span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span></code></pre><p>还可以将新文件路径添加到观察图中，以在这些文件修改时，接收消息和重新触发编译。只要将有效的文件路径推送到 <code>compilation.fileDependencies</code> <code>Set</code> 中，就可以将其添加到观察图中。</p><aside class="tip"><h6 class="tip__prefix">提示</h6><p><code>fileDependencies</code> <code>Set</code> 在每次编译时都会重新构建，因此你的插件必须将自己要观察的依赖都推送到每次编译中，以使它们都处于观察中。</p></aside><aside class="warning"><h6 class="warning__prefix">警告</h6><p>从 webpack v5 开始, <code>compilation.fileDependencies</code>，<code>compilation.contextDependencies</code> 和 <code>compilation.missingDependencies</code> 是 <code>Set</code> 类型，而不是 <code>Sortable Set</code>，因此不再是有序的了。</p></aside><h2><span id="changed-chunks"></span>监听 chunk 的修改<a href="#changed-chunks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>类似于观察图，监听 chunk（或者模块，就当前情况而言）的修改也很简单，通过在编译时跟踪它们的哈希来实现。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunkVersions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> changedChunks <span class="token operator">=</span> compilation<span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> oldVersion <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunkVersions<span class="token punctuation">[</span>chunk<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>chunkVersions<span class="token punctuation">[</span>chunk<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> chunk<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
        <span class="token keyword">return</span> chunk<span class="token punctuation">.</span>hash <span class="token operator">!==</span> oldVersion<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span></code></pre><h1><span id="发布流程"></span>发布流程<a href="#%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>部署 webpack 的发布流程实际上非常简单。请阅读以下步骤，以了解清楚这些是如何完成的。</p><h2><span id="pull-requests"></span>拉取请求（pull request）<a href="#pull-requests" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>当向 <code>main</code> 分支上提交 pull request 时，选择 <strong>Create Merge Commit</strong> 选项。</p><h2><span id="releasing"></span>发布<a href="#releasing" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><pre><code class="hljs language-bash"><span class="token function">npm</span> version patch <span class="token operator">&amp;&amp;</span> <span class="token function">git</span> push --follow-tags <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> publish
<span class="token function">npm</span> version minor <span class="token operator">&amp;&amp;</span> <span class="token function">git</span> push --follow-tags <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> publish
<span class="token function">npm</span> version major <span class="token operator">&amp;&amp;</span> <span class="token function">git</span> push --follow-tags <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> publish</code></pre><p><strong>这样将递增包版本号，提交变更，然后创建一个本地标签（tag），并推送到 GitHub，然后发布到 npm package</strong>。</p><p>之后就可以到 GitHub 的 <a href="https://github.com/webpack/webpack/releases">发布页面</a> 上为新的标签（tag）编写 Changelog。</p><h1><span id="调试"></span>调试<a href="#%E8%B0%83%E8%AF%95" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h1>
<p>在为核心仓库贡献代码，编写 loader/plugin，又或是处理复杂的项目时，调试工具将会成为工作流程的重心。无论问题是大型项目的性能下降还是无用追溯，以下工具都可以使这些问题变得不那么痛苦。</p><ul><li><a href="/api/node/#stats-object">Node</a> 和 <a href="/api/cli/#common-options">CLI</a> 提供的 <a href="/api/stats"><code>stats</code> 数据</a>。</li><li><code>node-nightly</code> 和 Node.js 最新版本提供的 Chrome <strong>DevTools</strong>。</li></ul><h2><span id="stats"></span>Stats<a href="#stats" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>无论你是想手动还是使用工具来筛选 <a href="/api/stats">这些数据</a>，<code>stats</code> 数据在调试构建的问题时都非常有用。我们不会在此处深入介绍，请参阅 <a href="/api/stats">此页面</a> 以了解详细内容。但应该知道可以使用它来查找以下信息：</p><ul><li>每个模块的内容。</li><li>每个 chunk 中包含的模块。</li><li>每个模块编译(compilation)和解析的 stats。</li><li>构建错误和警告。</li><li>模块之间的关系。</li><li>其他更多……</li></ul><p>最重要的是，<a href="https://github.com/webpack/analyse">官方分析工具</a> 和 <a href="/guides/code-splitting/#bundle-analysis">各种其他分析工具</a> 会将这些数据展示为多种形式的可视化图表。</p><h2><span id="devtools"></span>DevTools<a href="#devtools" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>虽然在简单场景中，可能 <a href="https://nodejs.org/api/console.html"><code>console</code></a> 语句会表现良好，然而有时还需要更加强大的解决方案。正如大多数前端开发人员已经知道的，将 Chrome DevTools 用在调试 web 应用程序，是一个能够解救我们的实用工具，<strong>但它并没有局限于调试 web 应用程序</strong>。从 Node v6.3.0+ 开始，开发人员可以使用内置的 <code>--inspect</code> 标记以使用 DevTools 调试 Node.js 应用程序。</p><p>这可以帮助轻松创建断点、调试内存使用情况、在控制台中暴露和检查对象等。在这个简短的演示中，我们将利用 <a href="https://github.com/hemanth/node-nightly"><code>node-nightly</code></a> 包，它提供最新和强大的检测能力。</p><aside class="warning"><h6 class="warning__prefix">警告</h6><p>从 v6.3.0 开始，<code>--inspect</code> 接口就一直可用，因此可以尝试使用本地版本的 npm 包，但要注意某些功能和标记，可能与这里演示中的版本有所不同。</p></aside><p>首先在全局安装：</p><pre><code class="hljs language-bash"><span class="token function">npm</span> <span class="token function">install</span> --global node-nightly</code></pre><p>现在，需要运行一次以结束安装：</p><pre><code class="hljs language-bash">node-nightly</code></pre><p>现在，我们可以直接使用带有 <code>--inspect</code> 标记的 <code>node-nightly</code>，在任何基于 webpack 的项目中开始构建。注意，我们不应该运行 NPM <code>scripts</code>，例如 <code>npm run build</code>，所以需要指定完整的 <code>node_modules</code> 路径：</p><pre><code class="hljs language-bash">node-nightly --inspect ./node_modules/webpack/bin/webpack.js</code></pre><p>应该输出类似如下内容：</p><pre><code class="hljs language-bash">Debugger listening on ws://127.0.0.1:9229/c624201a-250f-416e-a018-300bbec7be2c
For <span class="token builtin class-name">help</span> see https://nodejs.org/en/docs/inspector</code></pre><p>现在，在浏览器中访问 <code>chrome://inspect</code>，你会看到在 <strong>Remote Target</strong> 标题下可以进行审查（inspect）的活动脚本。单击每个脚本下自动连接会话的“inspect”链接，会打开一个专门用于 debugger 或 <strong>Open dedicated DevTools for Node</strong> 链接。除此之外还可以看到 <a href="https://chrome.google.com/webstore/detail/nodejs-v8-inspector-manag/gnhhdgbaldcilmgcpfddgdbkhjohddkj">NiM 扩展程序</a>，这是一个方便的 Chrome 插件。每当通过 <code>--inspect</code> 调试某个脚本时，都会自动打开 DevTools 标签页。</p><p>我们推荐使用 <code>--inspect-brk</code> 标记，此标记将在脚本的第一条语句处断开，以便你可以在源代码中设置断点，并根据需要启动/停止构建。此外不要忘记仍然可以向脚本传递参数。例如，如果你有多个配置文件，你可以通过 <code>--config webpack.prod.js</code> 指定想要调试的配置。</p></div><div class="print:hidden mt-20"><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline" href="https://github.com/docschina/webpack.js.org/edit/cn/src/content/contribute/printable.mdx">编辑此页</a><span class="mx-5 text-black font-bold dark:text-white">·</span><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline">打印文档</a></div><div data-testid="contributors" class="print:hidden"><h2 class="!font-sans !font-normal">1<!-- --> <!-- -->位贡献者</h2><div><div class="grid gap-[10px] lg:gap-[15px] grid-cols-contributors"><a href="https://github.com/webpack"><img width="45" height="45" alt="webpack" title="webpack" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a></div></div></div></div></section></div><footer class="footer"><div class="container footer__inner"><section class="footer__left"><a class="footer__link" href="/guides/getting-started/">快速开始</a><a class="footer__link" href="/comparison/">对比</a><a href="https://privacy-policy.openjsf.org/" target="_blank" rel="noopener noreferrer" class="footer__link">Privacy Policy</a></section><section class="footer__middle"><a class="footer__icon" href="/"><img src="/icon-square-small.85ba630cf0c5f29ae3e3.svg" alt="webpack icon" width="35" height="35"/></a></section><section class="footer__right"><a href="https://webpack.threadless.com/" target="_blank" rel="noopener noreferrer" class="footer__link">周边</a><a class="footer__link" href="/awesome-webpack/">Awesome webpack</a><a class="footer__link" href="/glossary/">术语</a><a class="footer__link" href="/branding/">品牌</a><a href="https://gitter.im/webpack/webpack" target="_blank" rel="noopener noreferrer" class="footer__link">Gitter</a><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener noreferrer" class="footer__link">更新日志</a><a class="footer__link footer__license" href="/license"><img alt="Creative Commons License" src="/cc.ab77d813bf219c6e34ff.svg" width="25" height="25"/><img alt="Creative Commons License" src="/by.1360bb2e6d1fc28cdd9e.svg" width="25" height="25"/></a></section></div></footer></div></div><script>
window.matchMedia('print').addListener(function(mql) {
  if (!mql.matches) {
      window.close();
  }
});
window.print();
</script><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f92e0e48311f635665d2de225751a349";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script></body>